<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLP Shield - Security Settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f3f4f6; 
            overflow-x: hidden;
        }
        
        /* Remove the old dashboard-container styles */
        .main-content { 
            margin-left: 240px;
            transition: margin-left 0.3s;
            min-height: 100vh;
            padding-top: 60px; /* Add padding for fixed header */
        }
        
        .main-content.expanded { 
            margin-left: 70px; 
        }
        
        /* .content-area { 
            padding: 24px; 
            max-width: 900px;
            margin: 0 auto;
        } */

         .content-area { 
            padding: 24px; 
           
            margin: 0 auto;
        }
        
        /* Fixed header positioning */
        .top-header {
            position: fixed;
            top: 0;
            left: 240px;
            right: 0;
            z-index: 500;
            transition: left 0.3s ease;
            background: white;
            padding: 14px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e7eb;
            gap: 16px;
        }
        
        .top-header.expanded {
            left: 70px;
        }
        
        /* Adjust main content when sidebar collapsed */
        .main-content.expanded .top-header {
            left: 70px;
        }
        
        .page-header { 
            background: white; 
            padding: 20px 24px; 
            border-radius: 12px; 
            border: 1px solid #e5e7eb; 
            margin-bottom: 24px; 
        }
        .page-title-section { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
        }
        .page-icon { 
            width: 48px; 
            height: 48px; 
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .page-icon i { 
            font-size: 22px; 
            color: white; 
        }
        .page-title-text h1 { 
            font-size: 1.5em; 
            color: #111827; 
            font-weight: 700; 
        }
        .page-subtitle { 
            color: #6b7280; 
            font-size: 0.9em; 
        }
        
        .settings-form { 
            background: white; 
            padding: 28px; 
            border-radius: 12px; 
            border: 1px solid #e5e7eb; 
        }
        .form-section { 
            margin-bottom: 28px; 
            padding-bottom: 28px; 
            border-bottom: 1px solid #e5e7eb; 
        }
        .form-section:last-child { 
            border-bottom: none; 
            margin-bottom: 0; 
            padding-bottom: 0; 
        }
        .section-title { 
            font-size: 1.05em; 
            font-weight: 600; 
            color: #111827; 
            margin-bottom: 16px; 
        }
        
        .form-group { 
            margin-bottom: 18px; 
        }
        .form-label { 
            display: block; 
            font-size: 0.85em; 
            color: #374151; 
            font-weight: 500; 
            margin-bottom: 6px; 
        }
        .form-input, .form-select { 
            width: 100%; 
            padding: 10px 12px; 
            border: 1.5px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 0.9em; 
        }
        .form-input:focus, .form-select:focus { 
            outline: none; 
            border-color: #3b82f6; 
        }
        .form-select { 
            background: white; 
        }
        .form-hint { 
            font-size: 0.8em; 
            color: #9ca3af; 
            margin-top: 4px; 
        }
        
        .toggle-group { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 12px 0; 
        }
        .toggle-label { 
            flex: 1; 
        }
        .toggle-title { 
            font-size: 0.9em; 
            font-weight: 600; 
            color: #111827; 
        }
        .toggle-desc { 
            font-size: 0.8em; 
            color: #6b7280; 
            margin-top: 2px; 
        }
        .toggle-switch { 
            position: relative; 
            width: 50px; 
            height: 26px; 
        }
        .toggle-switch input { 
            opacity: 0; 
            width: 0; 
            height: 0; 
        }
        .toggle-slider { 
            position: absolute; 
            cursor: pointer; 
            top: 0; 
            left: 0; 
            right: 0; 
            bottom: 0; 
            background-color: #cbd5e1; 
            border-radius: 26px; 
            transition: .3s; 
        }
        .toggle-slider:before { 
            position: absolute; 
            content: ""; 
            height: 20px; 
            width: 20px; 
            left: 3px; 
            bottom: 3px; 
            background-color: white; 
            border-radius: 50%; 
            transition: .3s; 
        }
        input:checked + .toggle-slider { 
            background-color: #10b981; 
        }
        input:checked + .toggle-slider:before { 
            transform: translateX(24px); 
        }
        
        .api-key-row { 
            display: flex; 
            gap: 10px; 
            align-items: flex-end; 
        }
        .api-key-row .form-input { 
            flex: 1; 
            font-family: monospace; 
            background: #f9fafb; 
        }
        .btn-generate { 
            padding: 10px 16px; 
            background: #2563eb; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 0.85em; 
            cursor: pointer; 
            white-space: nowrap; 
        }
        .btn-generate:hover { 
            background: #1d4ed8; 
        }
        
        .btn-group { 
            display: flex; 
            gap: 12px; 
            margin-top: 28px; 
        }
        .btn { 
            flex: 1; 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-size: 0.95em; 
            font-weight: 600; 
            cursor: pointer; 
            border: none; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
        }
        .btn-primary { 
            background: #2563eb; 
            color: white; 
        }
        .btn-primary:hover { 
            background: #1d4ed8; 
        }
        .btn-secondary { 
            background: white; 
            color: #374151; 
            border: 1.5px solid #e5e7eb; 
        }
        .btn-secondary:hover { 
            background: #f9fafb; 
        }
        
        /* Mobile Responsive */
        @media (max-width: 968px) { 
            .main-content { 
                margin-left: 0 !important; 
            }
            .top-header {
                left: 0 !important;
            }
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
        }
        
        @media (max-width: 640px) { 
            .content-area { 
                padding: 16px; 
            } 
            .btn-group, .api-key-row { 
                flex-direction: column; 
            } 
            .api-key-row .btn-generate { 
                width: 100%; 
            }
            .top-header {
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Include Sidebar Directly -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <i class="fas fa-shield-halved"></i>
            </div>
            <div class="sidebar-title">DLP Shield</div>
        </div>

        <nav class="nav-menu">
            <div class="nav-item">
                <a href="../dashboard.html" class="nav-link" data-page="dashboard">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
            </div>

            <div class="nav-item">
                <a href="../alerts.html" class="nav-link" data-page="alerts">
                    <i class="fas fa-triangle-exclamation"></i>
                    <span>Alerts & Incidents</span>
                </a>
            </div>

            <div class="nav-item">
                <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
                    <i class="fas fa-shield-alt"></i>
                    <span>Policies</span>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="sub-menu">
                    <a href="../manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>
                    <a href="../file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>
                    <a href="../assign-policy.html" class="sub-menu-item" data-page="assign-policy">Assign Policy</a>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
                    <i class="fas fa-eye"></i>
                    <span>OCR & Image Analysis</span>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="sub-menu">
                    <a href="../ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>
                    <a href="../ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
                    <i class="fas fa-file-lines"></i>
                    <span>Reports & Logs</span>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="sub-menu">
                    <a href="../reports.html" class="sub-menu-item" data-page="reports">Reports</a>
                    <a href="../generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>
                    <a href="../audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>
                    <a href="../device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>
                </div>
            </div>

            <div class="nav-item">
                <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
                    <i class="fas fa-users"></i>
                    <span>Users & Roles</span>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="sub-menu">
                    <a href="../users.html" class="sub-menu-item" data-page="users">Users</a>
                    <a href="../roles.html" class="sub-menu-item" data-page="roles">Roles & Permissions</a>
                </div>
            </div>

            <div class="nav-item active">
                <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
                    <i class="fas fa-gear"></i>
                    <span>Settings</span>
                    <i class="fas fa-chevron-down chevron-icon"></i>
                </div>
                <div class="sub-menu">
                    <a href="general.html" class="sub-menu-item" data-page="general">General</a>
                    <a href="security.html" class="sub-menu-item active" data-page="security">Security</a>
                    <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>
                    <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>
                </div>
            </div>
        </nav>

        <div class="sidebar-footer">
            <button class="collapse-btn" onclick="toggleSidebar()">
                <i class="fas fa-chevron-left"></i>
                <span>Collapse</span>
            </button>
        </div>
    </aside>

    <!-- Mobile Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <!-- Include Header Directly -->
        <header class="top-header" id="topHeader">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>

            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Search alerts, agents, policies...">
            </div>

            <div class="header-actions">
                <button class="notification-btn" onclick="toggleNotifications(event)">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">5</span>
                </button>

                <div class="user-profile" onclick="toggleUserDropdown(event)">
                    <div class="user-avatar">JS</div>
                    <div class="user-info">
                        <div class="user-name">John Smith</div>
                        <div class="user-role">Security Admin</div>
                    </div>
                    <i class="fas fa-chevron-down dropdown-icon"></i>

                    <div class="user-dropdown" id="userDropdown">
                        <a href="general.html" class="dropdown-item">
                            <i class="fas fa-gear"></i>
                            <span>Settings</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-circle-question"></i>
                            <span>Help & Support</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="../index.html" class="dropdown-item danger" onclick="logout(event)">
                            <i class="fas fa-right-from-bracket"></i>
                            <span>Sign out</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <div class="content-area">
            <div class="page-header">
                <div class="page-title-section">
                    <div class="page-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="page-title-text">
                        <h1>Security Settings</h1>
                        <p class="page-subtitle">Configure authentication and security policies</p>
                    </div>
                </div>
            </div>

            <form class="settings-form" id="settingsForm">
                <!-- Form content remains the same -->
                <div class="form-section">
                    <div class="section-title">API Keys</div>
                    <div class="form-group">
                        <label class="form-label">Production API Key</label>
                        <div class="api-key-row">
                            <input type="text" class="form-input" value="dlp_live_k8x9p2m5n7q4w1z3a6s8d0f" readonly>
                            <button type="button" class="btn-generate" onclick="regenerateKey('prod')"><i class="fas fa-rotate"></i> Regenerate</button>
                        </div>
                        <div class="form-hint">Use this key for production integrations</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Test API Key</label>
                        <div class="api-key-row">
                            <input type="text" class="form-input" value="dlp_test_j7y5h3g1b9n4m2k8l6x0c" readonly>
                            <button type="button" class="btn-generate" onclick="regenerateKey('test')"><i class="fas fa-rotate"></i> Regenerate</button>
                        </div>
                        <div class="form-hint">Use this key for development and testing</div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Multi-Factor Authentication</div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Require MFA for All Users</div>
                            <div class="toggle-desc">Users must enable 2FA to access the system</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">MFA for Admins Only</div>
                            <div class="toggle-desc">Require MFA only for administrator accounts</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">MFA Methods</label>
                        <select class="form-select">
                            <option selected>Authenticator App</option>
                            <option>SMS</option>
                            <option>Email</option>
                            <option>All Methods</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Password Policy</div>
                    <div class="form-group">
                        <label class="form-label">Minimum Password Length</label>
                        <select class="form-select">
                            <option>8 characters</option>
                            <option>10 characters</option>
                            <option selected>12 characters</option>
                            <option>14 characters</option>
                            <option>16 characters</option>
                        </select>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Require Special Characters</div>
                            <div class="toggle-desc">Passwords must contain at least one special character</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Require Uppercase & Lowercase</div>
                            <div class="toggle-desc">Mix of upper and lower case letters required</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Require Numbers</div>
                            <div class="toggle-desc">Passwords must contain at least one number</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password Expiration</label>
                        <select class="form-select">
                            <option>Never</option>
                            <option>30 days</option>
                            <option selected>90 days</option>
                            <option>180 days</option>
                            <option>365 days</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Session Management</div>
                    <div class="form-group">
                        <label class="form-label">Session Timeout</label>
                        <select class="form-select">
                            <option>15 minutes</option>
                            <option selected>30 minutes</option>
                            <option>1 hour</option>
                            <option>4 hours</option>
                            <option>8 hours</option>
                            <option>Never</option>
                        </select>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Single Sign-On (SSO)</div>
                            <div class="toggle-desc">Enable SSO authentication via SAML/OAuth</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">Concurrent Session Limit</div>
                            <div class="toggle-desc">Limit users to one active session at a time</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">Encryption</div>
                    <div class="toggle-group">
                        <div class="toggle-label">
                            <div class="toggle-title">End-to-End Encryption</div>
                            <div class="toggle-desc">Encrypt all data in transit and at rest</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Encryption Algorithm</label>
                        <select class="form-select">
                            <option selected>AES-256</option>
                            <option>AES-128</option>
                            <option>RSA-2048</option>
                            <option>RSA-4096</option>
                        </select>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i><span>Save Changes</span>
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-rotate-left"></i><span>Reset</span>
                    </button>
                </div>
            </form>
        </div>
    </main>

    <!-- Add Sidebar and Header Styles -->
    <style>
        /* Sidebar Styles */
        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            position: fixed;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            z-index: 1000;
            left: 0;
            top: 0;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar.collapsed .sidebar-title {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }

        .sidebar.collapsed .nav-link span,
        .sidebar.collapsed .collapse-btn span {
            display: none;
        }

        .sidebar.collapsed .sub-menu {
            display: none !important;
        }

        .sidebar.collapsed .nav-link {
            justify-content: center;
            padding: 10px;
        }

        .sidebar.collapsed .nav-link i:first-child {
            margin-right: 0;
        }

        .sidebar.collapsed .chevron-icon {
            display: none;
        }

        .sidebar.collapsed .collapse-btn {
            justify-content: center;
        }

        .sidebar.collapsed .collapse-btn i {
            transform: rotate(180deg);
        }

        .sidebar-header {
            padding: 18px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .sidebar-logo {
            width: 38px;
            height: 38px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sidebar-logo i {
            font-size: 20px;
            color: #2563eb;
        }

        .sidebar-title {
            font-size: 1.2em;
            font-weight: 700;
            white-space: nowrap;
            transition: opacity 0.3s;
        }

        .nav-menu {
            padding: 12px 0;
            overflow-y: auto;
            overflow-x: hidden;
            flex: 1;
        }

        .nav-item {
            margin: 2px 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 0.9em;
            cursor: pointer;
            position: relative;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-link.active,
        .sub-menu-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            font-weight: 600;
        }

        .nav-link i:first-child {
            width: 20px;
            font-size: 0.95em;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .chevron-icon {
            margin-left: auto !important;
            font-size: 0.7em !important;
            transition: transform 0.3s;
            width: auto !important;
        }

        .nav-link.expanded .chevron-icon {
            transform: rotate(180deg);
        }

        .sub-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .sub-menu.open {
            max-height: 500px;
        }

        .sub-menu-item {
            display: flex;
            align-items: center;
            padding: 8px 12px 8px 42px;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 0.85em;
            transition: all 0.2s;
            border-radius: 8px;
            margin: 2px 0;
        }

        .sub-menu-item:hover {
            color: white;
            background: rgba(255,255,255,0.08);
        }

        .sub-menu-item::before {
            content: 'â€¢';
            margin-right: 10px;
            font-size: 1.2em;
        }

        .sidebar-footer {
            padding: 12px 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
        }

        .collapse-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .collapse-btn:hover {
            background: rgba(255,255,255,0.15);
        }

        .collapse-btn i {
            transition: transform 0.3s;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .sidebar-overlay.active {
            display: block;
            opacity: 1;
        }

        /* Mobile responsive */
        @media (max-width: 968px) {
            .sidebar {
                transform: translateX(-100%);
                box-shadow: 4px 0 15px rgba(0,0,0,0.3);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
            }
        }

        /* Header specific styles */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1.3em;
            cursor: pointer;
            padding: 8px;
            transition: color 0.2s;
        }

        .mobile-menu-toggle:hover {
            color: #111827;
        }

        .search-bar {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-bar i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 0.9em;
        }

        .search-input {
            width: 100%;
            padding: 9px 14px 9px 38px;
            border: 1.5px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9em;
            background: #f9fafb;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1.1em;
            cursor: pointer;
            padding: 8px;
            transition: all 0.2s;
            border-radius: 8px;
        }

        .notification-btn:hover {
            color: #111827;
            background: #f3f4f6;
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ef4444;
            color: white;
            font-size: 0.65em;
            min-width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            padding: 0 4px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 6px 10px;
            border-radius: 8px;
            transition: background 0.2s;
            position: relative;
        }

        .user-profile:hover {
            background: #f3f4f6;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 0.9em;
            font-weight: 600;
            color: #111827;
        }

        .user-role {
            font-size: 0.75em;
            color: #6b7280;
        }

        .dropdown-icon {
            color: #6b7280;
            font-size: 0.75em;
            margin-left: 4px;
            transition: transform 0.3s;
        }

        .user-profile.active .dropdown-icon {
            transform: rotate(180deg);
        }

        /* User Dropdown */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 10px 15px rgba(0,0,0,0.1);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            color: #374151;
            text-decoration: none;
            font-size: 0.9em;
            transition: background 0.2s;
        }

        .dropdown-item:hover {
            background: #f3f4f6;
        }

        .dropdown-item i {
            width: 18px;
            color: #6b7280;
            font-size: 0.95em;
        }

        .dropdown-item.danger {
            color: #dc2626;
        }

        .dropdown-item.danger i {
            color: #dc2626;
        }

        .dropdown-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 4px 0;
        }

        @media (max-width: 968px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .user-info {
                display: none;
            }

            .dropdown-icon {
                display: none;
            }
        }

        @media (max-width: 640px) {
            .search-bar {
                display: none;
            }
        }
    </style>

    <script>
        // Check if user is logged in
        // Check login status
        async function checkAuth() {
                try {
                    const response = await fetch("/api/auth/check", {
                        credentials: "include"
                    });

                    if (!response.ok) {
                        throw new Error("Not authenticated");
                    }

                    const result = await response.json();

                    if (!result.success) {
                        window.location.href = "index.html";
                    }

                } catch (err) {
                    window.location.href = "index.html";
                }
            }

        // Form submission
        document.getElementById('settingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Security settings saved successfully!');
        });
        
        function resetForm() {
            if (confirm('Reset all security settings to default?')) {
                document.getElementById('settingsForm').reset();
            }
        }
        
        function regenerateKey(type) {
            if (confirm(`Regenerate ${type} API key? This will invalidate the current key.`)) {
                alert(`New ${type} API key generated successfully!`);
            }
        }

        // Sidebar functionality
        function toggleSubMenu(element) {
            const sidebar = document.getElementById('sidebar');
            
            // Don't open submenu if sidebar is collapsed
            if (sidebar.classList.contains('collapsed')) {
                return;
            }
            
            const subMenu = element.nextElementSibling;
            element.classList.toggle('expanded');
            subMenu.classList.toggle('open');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const topHeader = document.getElementById('topHeader');
            
            sidebar.classList.toggle('collapsed');
            
            if (mainContent) {
                mainContent.classList.toggle('expanded');
            }
            
            if (topHeader) {
                topHeader.classList.toggle('expanded');
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('mobile-open');
            if (overlay) overlay.classList.remove('active');
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar) {
                sidebar.classList.toggle('mobile-open');
                if (overlay) {
                    overlay.classList.toggle('active');
                }
            }
        }

        // Header functionality
        function toggleUserDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            const userProfile = event.currentTarget;
            
            dropdown.classList.toggle('show');
            userProfile.classList.toggle('active');
        }

        function toggleNotifications(event) {
            event.stopPropagation();
            alert('Notifications panel coming soon!');
        }

        function logout(event) {
            event.preventDefault();
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            window.location.href = '../index.html';
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            const userProfile = document.querySelector('.user-profile');
            const dropdown = document.getElementById('userDropdown');
            
            if (dropdown && userProfile && !userProfile.contains(e.target)) {
                dropdown.classList.remove('show');
                userProfile.classList.remove('active');
            }
        });

        // Set active menu based on current page
        document.addEventListener('DOMContentLoaded', function() {
            // Security page is already active in the HTML
            const currentPage = 'security.html';
            
            // Highlight active menu
            const navLinks = document.querySelectorAll('.nav-link, .sub-menu-item');
            navLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (href === currentPage) {
                    link.classList.add('active');
                    
                    // Open parent menu if it's a submenu item
                    const parentSubMenu = link.closest('.sub-menu');
                    if (parentSubMenu) {
                        const parentNavLink = parentSubMenu.previousElementSibling;
                        if (parentNavLink) {
                            parentSubMenu.classList.add('open');
                            parentNavLink.classList.add('expanded');
                        }
                    }
                }
            });

            // Set user info
            const userEmail = localStorage.getItem('userEmail');
            if (userEmail) {
                const userName = document.querySelector('.user-name');
                const userAvatar = document.querySelector('.user-avatar');
                
                const name = userEmail.split('@')[0];
                const initials = name.split('.').map(n => n[0].toUpperCase()).join('');
                
                if (userName) {
                    userName.textContent = name.split('.').map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
                }
                if (userAvatar) {
                    userAvatar.textContent = initials;
                }
            }
        });
    </script>
</body>
</html>