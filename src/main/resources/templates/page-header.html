<!-- Top Header Component -->
<!-- <header class="top-header">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" class="search-input" placeholder="Search alerts, agents, policies...">
    </div>

    <div class="header-actions">
        <button class="notification-btn" onclick="toggleNotifications()">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">5</span>
        </button>

        <div class="user-profile" onclick="toggleUserDropdown(event)">
            <div class="user-avatar">JS</div>
            <div class="user-info">
                <div class="user-name">John Smith</div>
                <div class="user-role">Security Admin</div>
            </div>
            <i class="fas fa-chevron-down dropdown-icon"></i>

            <div class="user-dropdown" id="userDropdown">
                <a href="#" class="dropdown-item">
                    <i class="fas fa-gear"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="dropdown-item">
                    <i class="fas fa-circle-question"></i>
                    <span>Help & Support</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="indexn.html" class="dropdown-item danger" onclick="logout(event)">
                    <i class="fas fa-right-from-bracket"></i>
                    <span>Sign out</span>
                </a>
            </div>
        </div>
    </div>
</header>

<style>
/* Top Header Styles */
.top-header {
    background: white;
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #e5e7eb;
    position: sticky;
    top: 0;
    z-index: 100;
    gap: 16px;
}

.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    color: #6b7280;
    font-size: 1.3em;
    cursor: pointer;
    padding: 8px;
}

.mobile-menu-toggle:hover {
    color: #111827;
}

.search-bar {
    flex: 1;
    max-width: 400px;
    position: relative;
}

.search-bar i {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 0.9em;
}

.search-input {
    width: 100%;
    padding: 9px 14px 9px 38px;
    border: 1.5px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9em;
    background: #f9fafb;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #3b82f6;
    background: white;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.notification-btn {
    position: relative;
    background: none;
    border: none;
    color: #6b7280;
    font-size: 1.1em;
    cursor: pointer;
    padding: 8px;
    transition: color 0.2s;
}

.notification-btn:hover {
    color: #111827;
}

.notification-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #ef4444;
    color: white;
    font-size: 0.65em;
    min-width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    padding: 0 4px;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 6px 10px;
    border-radius: 8px;
    transition: background 0.2s;
    position: relative;
}

.user-profile:hover {
    background: #f3f4f6;
}

.user-avatar {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.9em;
    flex-shrink: 0;
}

.user-info {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-size: 0.9em;
    font-weight: 600;
    color: #111827;
}

.user-role {
    font-size: 0.75em;
    color: #6b7280;
}

.dropdown-icon {
    color: #6b7280;
    font-size: 0.75em;
    margin-left: 4px;
    transition: transform 0.3s;
}

.user-profile.active .dropdown-icon {
    transform: rotate(180deg);
}

/* User Dropdown */
.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 10px 15px rgba(0,0,0,0.1);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1000;
}

.user-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    color: #374151;
    text-decoration: none;
    font-size: 0.9em;
    transition: background 0.2s;
}

.dropdown-item:first-child {
    border-radius: 8px 8px 0 0;
}

.dropdown-item:last-child {
    border-radius: 0 0 8px 8px;
}

.dropdown-item:hover {
    background: #f3f4f6;
}

.dropdown-item i {
    width: 18px;
    color: #6b7280;
    font-size: 0.95em;
}

.dropdown-item.danger {
    color: #dc2626;
}

.dropdown-item.danger i {
    color: #dc2626;
}

.dropdown-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 4px 0;
}

/* Mobile responsive */
@media (max-width: 968px) {
    .mobile-menu-toggle {
        display: block;
    }

    .user-info {
        display: none;
    }

    .dropdown-icon {
        display: none;
    }
}

@media (max-width: 640px) {
    .top-header {
        padding: 12px 16px;
    }

    .search-bar {
        display: none;
    }

    .notification-btn {
        font-size: 1em;
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        font-size: 0.85em;
    }
}
</style>

<script>
// Toggle mobile menu
function toggleMobileMenu() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar) {
        sidebar.classList.toggle('mobile-open');
    }
}

// Toggle user dropdown
function toggleUserDropdown(event) {
    event.stopPropagation();
    const dropdown = document.getElementById('userDropdown');
    const userProfile = event.currentTarget;
    
    dropdown.classList.toggle('show');
    userProfile.classList.toggle('active');
}

// Toggle notifications
function toggleNotifications() {
    // Add notification panel functionality here
    alert('Notifications panel coming soon!');
}

// Close dropdown when clicking outside
document.addEventListener('click', function(e) {
    const userProfile = document.querySelector('.user-profile');
    const dropdown = document.getElementById('userDropdown');
    
    if (dropdown && userProfile && !userProfile.contains(e.target)) {
        dropdown.classList.remove('show');
        userProfile.classList.remove('active');
    }
});

// Close mobile menu when clicking outside
document.addEventListener('click', function(e) {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    
    if (sidebar && menuToggle && window.innerWidth <= 968) {
        if (!sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
            sidebar.classList.remove('mobile-open');
        }
    }
});

// Logout function
function logout(event) {
    event.preventDefault();
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('userEmail');
    window.location.href = 'indexn.html';
}

// Set user info from localStorage
document.addEventListener('DOMContentLoaded', function() {
    const userEmail = localStorage.getItem('userEmail');
    if (userEmail) {
        const userName = document.querySelector('.user-name');
        const userAvatar = document.querySelector('.user-avatar');
        
        // Extract name from email
        const name = userEmail.split('@')[0];
        const initials = name.split('.').map(n => n[0].toUpperCase()).join('');
        
        if (userName) {
            userName.textContent = name.split('.').map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
        }
        if (userAvatar) {
            userAvatar.textContent = initials;
        }
    }
});
</script> -->





<!-- Top Header Component -->
<header class="top-header">
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" class="search-input" placeholder="Search alerts, agents, policies...">
    </div>

    <div class="header-actions">
        <button class="notification-btn" onclick="toggleNotifications(event)">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">5</span>
        </button>

        <div class="user-profile" onclick="toggleUserDropdown(event)">
            <div class="user-avatar">[[${userInitials}]]</div> 
            <div class="user-info"> 
                <div class="user-name">[[${userName}]]</div>
                <!-- <div class="user-role">[[${userRole}]]</div> -->
                <div id="userEmail">[[${userEmail}]]</div>
            </div>
            <i class="fas fa-chevron-down dropdown-icon"></i>

            <div class="user-dropdown" id="userDropdown">
                <a href="general.html" class="dropdown-item">
                    <i class="fas fa-gear"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="dropdown-item">
                    <i class="fas fa-circle-question"></i>
                    <span>Help & Support</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="indexn.html" class="dropdown-item danger" onclick="logout(event)">
                    <i class="fas fa-right-from-bracket"></i>
                    <span>Sign out</span>
                </a>
            </div>
        </div>
    </div>
</header>

<!-- Notifications Panel -->
<div class="notifications-panel" id="notificationsPanel">
    <div class="notifications-header">
        <h3>Notifications</h3>
        <button class="close-notifications" onclick="closeNotifications()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="notifications-tabs">
        <button class="tab-btn active" onclick="switchTab(event, 'all')">All (5)</button>
        <button class="tab-btn" onclick="switchTab(event, 'unread')">Unread (3)</button>
    </div>

    <div class="notifications-content" id="notificationsContent">
        <div class="notification-item unread">
            <div class="notification-icon critical">
                <i class="fas fa-shield-exclamation"></i>
            </div>
            <div class="notification-body">
                <div class="notification-title">Critical Policy Violation</div>
                <div class="notification-text">User attempted to copy sensitive files to USB drive</div>
                <div class="notification-time">2 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
            <div class="notification-icon warning">
                <i class="fas fa-triangle-exclamation"></i>
            </div>
            <div class="notification-body">
                <div class="notification-title">Agent Offline</div>
                <div class="notification-text">DESKTOP-DEF456 has been offline for 2 hours</div>
                <div class="notification-time">15 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
            <div class="notification-icon info">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-body">
                <div class="notification-title">Policy Updated</div>
                <div class="notification-text">File Protection Policy has been modified by Admin</div>
                <div class="notification-time">1 hour ago</div>
            </div>
            <div class="notification-dot"></div>
        </div>

        <div class="notification-item">
            <div class="notification-icon success">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-body">
                <div class="notification-title">Agent Connected</div>
                <div class="notification-text">New agent LAPTOP-XYZ789 successfully registered</div>
                <div class="notification-time">3 hours ago</div>
            </div>
        </div>

        <div class="notification-item">
            <div class="notification-icon info">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="notification-body">
                <div class="notification-title">Report Generated</div>
                <div class="notification-text">Weekly security report is ready for review</div>
                <div class="notification-time">5 hours ago</div>
            </div>
        </div>
    </div>

    <div class="notifications-footer">
        <a href="alerts.html" class="view-all-btn">View All Notifications</a>
    </div>
</div>

<!-- Notification Overlay -->
<div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>

<style>
/* Top Header Styles - Fixed Position */
.top-header {
    background: white;
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #e5e7eb;
    position: fixed;
    top: 0;
    left: 240px;
    right: 0;
    z-index: 500;
    gap: 16px;
    transition: left 0.3s ease;
}



.mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    color: #6b7280;
    font-size: 1.3em;
    cursor: pointer;
    padding: 8px;
    transition: color 0.2s;
}

.mobile-menu-toggle:hover {
    color: #111827;
}

.search-bar {
    flex: 1;
    max-width: 400px;
    position: relative;
}

.search-bar i {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 0.9em;
}

.search-input {
    width: 100%;
    padding: 9px 14px 9px 38px;
    border: 1.5px solid #e5e7eb;
    border-radius: 8px;
    font-size: 0.9em;
    background: #f9fafb;
    transition: all 0.3s ease;
}

.search-input:focus {
    outline: none;
    border-color: #3b82f6;
    background: white;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
}

.notification-btn {
    position: relative;
    background: none;
    border: none;
    color: #6b7280;
    font-size: 1.1em;
    cursor: pointer;
    padding: 8px;
    transition: all 0.2s;
    border-radius: 8px;
}

.notification-btn:hover {
    color: #111827;
    background: #f3f4f6;
}

.notification-btn.active {
    color: #2563eb;
    background: #eff6ff;
}

.notification-badge {
    position: absolute;
    top: 4px;
    right: 4px;
    background: #ef4444;
    color: white;
    font-size: 0.65em;
    min-width: 18px;
    height: 18px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    padding: 0 4px;
    /* animation: pulse 2s ease-in-out infinite; */
}





@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 6px 10px;
    border-radius: 8px;
    transition: background 0.2s;
    position: relative;
}

.user-profile:hover {
    background: #f3f4f6;
}

.user-avatar {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.9em;
    flex-shrink: 0;
}

.user-info {
    display: flex;
    flex-direction: column;
}

.user-name {
    font-size: 0.9em;
    font-weight: 600;
    color: #111827;
}

.user-role {
    font-size: 0.75em;
    color: #6b7280;
}

.dropdown-icon {
    color: #6b7280;
    font-size: 0.75em;
    margin-left: 4px;
    transition: transform 0.3s;
}

.user-profile.active .dropdown-icon {
    transform: rotate(180deg);
}

/* User Dropdown */
.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.07), 0 10px 15px rgba(0,0,0,0.1);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1000;
}

.user-dropdown.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    color: #374151;
    text-decoration: none;
    font-size: 0.9em;
    transition: background 0.2s;
}

.dropdown-item:first-child {
    border-radius: 8px 8px 0 0;
}

.dropdown-item:last-child {
    border-radius: 0 0 8px 8px;
}

.dropdown-item:hover {
    background: #f3f4f6;
}

.dropdown-item i {
    width: 18px;
    color: #6b7280;
    font-size: 0.95em;
}

.dropdown-item.danger {
    color: #dc2626;
}

.dropdown-item.danger i {
    color: #dc2626;
}

.dropdown-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 4px 0;
}

/* Notifications Panel - Half Screen */
.notifications-panel {
    position: fixed;
    top: 0;
    right: -50%;
    width: 50%;
    max-width: 600px;
    height: 100vh;
    background: white;
    box-shadow: -4px 0 15px rgba(0,0,0,0.1);
    z-index: 1001;
    display: flex;
    flex-direction: column;
    transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.notifications-panel.show {
    right: 0;
}

.notifications-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notifications-header h3 {
    font-size: 1.2em;
    font-weight: 700;
    color: #111827;
}

.close-notifications {
    background: none;
    border: none;
    color: #6b7280;
    font-size: 1.2em;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    transition: all 0.2s;
}

.close-notifications:hover {
    background: #f3f4f6;
    color: #111827;
}

.notifications-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
    padding: 0 24px;
}

.tab-btn {
    flex: 1;
    padding: 12px;
    background: none;
    border: none;
    color: #6b7280;
    font-size: 0.9em;
    font-weight: 500;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: all 0.2s;
}

.tab-btn:hover {
    color: #111827;
}

.tab-btn.active {
    color: #2563eb;
    border-bottom-color: #2563eb;
}

.notifications-content {
    flex: 1;
    overflow-y: auto;
    padding: 12px 0;
}

.notifications-content::-webkit-scrollbar {
    width: 6px;
}

.notifications-content::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

.notification-item {
    display: flex;
    gap: 12px;
    padding: 14px 24px;
    cursor: pointer;
    transition: background 0.2s;
    position: relative;
    border-left: 3px solid transparent;
}

.notification-item:hover {
    background: #f9fafb;
}

.notification-item.unread {
    background: #eff6ff;
    border-left-color: #3b82f6;
}

.notification-item.unread:hover {
    background: #dbeafe;
}

.notification-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1em;
    flex-shrink: 0;
}

.notification-icon.critical {
    background: #fee2e2;
    color: #dc2626;
}

.notification-icon.warning {
    background: #fef3c7;
    color: #f59e0b;
}

.notification-icon.info {
    background: #dbeafe;
    color: #3b82f6;
}

.notification-icon.success {
    background: #d1fae5;
    color: #10b981;
}

.notification-body {
    flex: 1;
}

.notification-title {
    font-size: 0.9em;
    font-weight: 600;
    color: #111827;
    margin-bottom: 4px;
}

.notification-text {
    font-size: 0.85em;
    color: #6b7280;
    margin-bottom: 6px;
    line-height: 1.4;
}

.notification-time {
    font-size: 0.75em;
    color: #9ca3af;
}

.notification-dot {
    width: 8px;
    height: 8px;
    background: #3b82f6;
    border-radius: 50%;
    flex-shrink: 0;
    margin-top: 8px;
}

.notification-item:not(.unread) .notification-dot {
    display: none;
}

.notifications-footer {
    padding: 16px 24px;
    border-top: 1px solid #e5e7eb;
}

.view-all-btn {
    display: block;
    width: 100%;
    padding: 10px;
    background: #f3f4f6;
    color: #2563eb;
    text-align: center;
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.9em;
    font-weight: 600;
    transition: all 0.2s;
}

.view-all-btn:hover {
    background: #e5e7eb;
}

/* Notification Overlay */
.notification-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.notification-overlay.show {
    opacity: 1;
    visibility: visible;
}

/* Mobile responsive */
@media (max-width: 968px) {
    .top-header {
        left: 0 !important; /* Force header to left on mobile */
    }
    
    .mobile-menu-toggle {
        display: block;
    }
    
    .user-info {
        display: none;
    }

    .dropdown-icon {
        display: none;
    }

    .notifications-panel {
        width: 70%;
        right: -70%;
        max-width: none;
    }

    .notifications-panel.show {
        right: 0;
    }
}

    .user-info {
        display: none;
    }

    .dropdown-icon {
        display: none;
    }

    .notifications-panel {
        width: 100%;
        right: -100%;
    }

    .notifications-panel.show {
        right: 0;
    }


@media (max-width: 640px) {
    .top-header {
        padding: 12px 16px;
    }

    .search-bar {
        display: none;
    }

    .notification-btn {
        font-size: 1em;
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        font-size: 0.85em;
    }

    .notifications-header {
        padding: 16px 20px;
    }

    .notifications-content {
        padding: 8px 0;
    }

    .notification-item {
        padding: 12px 20px;
    }
}
@media (max-width: 968px) {
    .top-header {
        left: 0 !important;
    }
    
    .mobile-menu-toggle {
        display: block;
    }

    .user-info {
        display: none;
    }

    .dropdown-icon {
        display: none;
    }
}


</style>

<script>

// Toggle mobile menu
function toggleMobileMenu() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (sidebar) {
        sidebar.classList.toggle('mobile-open');
        if (overlay) {
            overlay.classList.toggle('active');
        }
    }
    
    // Call the global function if available
    if (typeof window.openMobileSidebar === 'function') {
        window.openMobileSidebar();
    }
}

// Toggle notifications panel
function toggleNotifications(event) {
    event.stopPropagation();
    const panel = document.getElementById('notificationsPanel');
    const overlay = document.getElementById('notificationOverlay');
    const btn = event.currentTarget;
    
    if (panel && overlay) {
        const isOpen = panel.classList.contains('show');
        
        if (isOpen) {
            closeNotifications();
        } else {
            // Close user dropdown if open
            closeUserDropdown();
            
            panel.classList.add('show');
            overlay.classList.add('show');
            btn.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
    }
}

// Close notifications panel
function closeNotifications() {
    const panel = document.getElementById('notificationsPanel');
    const overlay = document.getElementById('notificationOverlay');
    const btn = document.querySelector('.notification-btn');
    
    if (panel) panel.classList.remove('show');
    if (overlay) overlay.classList.remove('show');
    if (btn) btn.classList.remove('active');
    document.body.style.overflow = '';
}

// Switch notification tabs
function switchTab(event, tabName) {
    const allTabs = document.querySelectorAll('.tab-btn');
    allTabs.forEach(tab => tab.classList.remove('active'));
    event.currentTarget.classList.add('active');
    
    const notifications = document.querySelectorAll('.notification-item');
    
    if (tabName === 'unread') {
        notifications.forEach(notif => {
            notif.style.display = notif.classList.contains('unread') ? 'flex' : 'none';
        });
    } else {
        notifications.forEach(notif => {
            notif.style.display = 'flex';
        });
    }
}

// Toggle user dropdown
function toggleUserDropdown(event) {
    event.stopPropagation();
    const dropdown = document.getElementById('userDropdown');
    const userProfile = event.currentTarget;
    
    const isOpen = dropdown.classList.contains('show');
    
    if (isOpen) {
        closeUserDropdown();
    } else {
        // Close notifications if open
        closeNotifications();
        
        dropdown.classList.add('show');
        userProfile.classList.add('active');
    }
}

// Close user dropdown
function closeUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    const userProfile = document.querySelector('.user-profile');
    
    if (dropdown) dropdown.classList.remove('show');
    if (userProfile) userProfile.classList.remove('active');
}

// Close dropdowns and panels when clicking outside
document.addEventListener('click', function(e) {
    const userProfile = document.querySelector('.user-profile');
    const notificationBtn = document.querySelector('.notification-btn');
    const notificationPanel = document.getElementById('notificationsPanel');
    
    // Close user dropdown
    if (userProfile && !userProfile.contains(e.target)) {
        closeUserDropdown();
    }
    
    // Close notification panel
    if (notificationBtn && notificationPanel && 
        !notificationBtn.contains(e.target) && 
        !notificationPanel.contains(e.target)) {
        closeNotifications();
    }
});

// Handle escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeNotifications();
        closeUserDropdown();
    }
});

// Logout function
function logout(event) {
    event.preventDefault();
    window.location.href = '/logout';
}

// Set user info from localStorage
document.addEventListener('DOMContentLoaded', function() {
    const userEmail = localStorage.getItem('userEmail');
    if (userEmail) {
        const userName = document.querySelector('.user-name');
        const userAvatar = document.querySelector('.user-avatar');
        
        // Extract name from email
        const name = userEmail.split('@')[0];
        const initials = name.split('.').map(n => n[0].toUpperCase()).join('');
        
        if (userName) {
            userName.textContent = name.split('.').map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(' ');
        }
        if (userAvatar) {
            userAvatar.textContent = initials;
        }
    }
});




// Listen for sidebar toggle events
window.addEventListener('sidebarToggle', function(event) {
    const header = document.querySelector('.top-header');
    if (header) {
        if (event.detail.collapsed) {
            header.style.left = '70px';
        } else {
            header.style.left = '240px';
        }
    }
});

// Also check sidebar state on page load
window.addEventListener('load', function() {
    setTimeout(function() {
        const sidebar = document.getElementById('sidebar');
        const header = document.querySelector('.top-header');
        
        if (sidebar && header) {
            if (sidebar.classList.contains('collapsed')) {
                header.style.left = '70px';
            } else {
                header.style.left = '240px';
            }
        }
    }, 100);
});
</script>