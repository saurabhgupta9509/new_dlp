<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DLP Shield - Assign Policy</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* All your existing styles remain exactly the same */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f3f4f6;
        overflow-x: hidden;
      }

      .dashboard-container {
        display: flex;
        min-height: 100vh;
        max-width: 100vw;
        overflow-x: hidden;
      }

      .main-content {
        flex: 1;
        margin-left: 240px;
        transition: margin-left 0.3s ease;
        min-height: 100vh;
        max-width: calc(100vw - 240px);
        overflow-x: hidden;
      }

      .main-content.expanded {
        margin-left: 70px;
        max-width: calc(100vw - 70px);
      }

      .content-area {
        padding: 24px;
        padding-top: 100px;
        max-width: 1400px;
        margin: 0 auto;
      }

      /* ================ SIDEBAR STYLES ================ */
      .sidebar {
        width: 240px;
        background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
        color: white;
        position: fixed;
        height: 100vh;
        display: flex;
        flex-direction: column;
        transition: width 0.3s ease;
        z-index: 1000;
        left: 0;
        top: 0;
        overflow: hidden;
      }

      .sidebar::-webkit-scrollbar {
        width: 4px;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
      }

      .sidebar-header {
        padding: 18px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-shrink: 0;
      }

      .sidebar-logo {
        width: 38px;
        height: 38px;
        background: white;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .sidebar-logo i {
        font-size: 20px;
        color: #2563eb;
      }

      .sidebar-title {
        font-size: 1.2em;
        font-weight: 700;
        white-space: nowrap;
        transition: opacity 0.2s, width 0.3s;
        overflow: hidden;
      }

      .nav-menu {
        padding: 12px 0;
        overflow-y: auto;
        overflow-x: hidden;
        flex: 1;
      }

      .nav-item {
        margin: 2px 8px;
      }

      .nav-link {
        display: flex;
        align-items: center;
        padding: 10px 12px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s;
        font-size: 0.9em;
        cursor: pointer;
        white-space: nowrap;
      }

      .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      .nav-link.active,
      .sub-menu-item.active {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        font-weight: 600;
      }

      .nav-link i:first-child {
        width: 20px;
        font-size: 0.95em;
        margin-right: 10px;
        flex-shrink: 0;
      }

      .chevron-icon {
        margin-left: auto !important;
        font-size: 0.7em !important;
        transition: transform 0.3s;
        width: auto !important;
        flex-shrink: 0;
      }

      .nav-link.expanded .chevron-icon {
        transform: rotate(180deg);
      }

      .sub-menu {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .sub-menu.open {
        max-height: 500px;
      }

      .sub-menu-item {
        display: flex;
        align-items: center;
        padding: 8px 12px 8px 42px;
        color: rgba(255, 255, 255, 0.7);
        text-decoration: none;
        font-size: 0.85em;
        transition: all 0.2s;
        border-radius: 8px;
        margin: 2px 0;
        white-space: nowrap;
      }

      .sub-menu-item:hover {
        color: white;
        background: rgba(255, 255, 255, 0.08);
      }

      .sub-menu-item::before {
        content: "â€¢";
        margin-right: 10px;
        font-size: 1.2em;
      }

      .sidebar-footer {
        padding: 12px 16px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        flex-shrink: 0;
      }

      .collapse-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        font-size: 0.85em;
        transition: all 0.2s;
        white-space: nowrap;
        overflow: hidden;
      }

      .collapse-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .collapse-btn i {
        transition: transform 0.3s;
        flex-shrink: 0;
      }

      /* Sidebar collapsed state */
      .sidebar.collapsed {
        width: 70px;
      }

      .sidebar.collapsed .sidebar-title {
        opacity: 0;
        width: 0;
      }

      .sidebar.collapsed .nav-link span,
      .sidebar.collapsed .collapse-btn span {
        display: none;
      }

      .sidebar.collapsed .sub-menu {
        display: none !important;
      }

      .sidebar.collapsed .nav-link {
        justify-content: center;
        padding: 10px;
      }

      .sidebar.collapsed .nav-link i:first-child {
        margin-right: 0;
      }

      .sidebar.collapsed .chevron-icon {
        display: none;
      }

      .sidebar.collapsed .collapse-btn {
        justify-content: center;
      }

      .sidebar.collapsed .collapse-btn i {
        transform: rotate(180deg);
      }

      /* Mobile Overlay */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .sidebar-overlay.active {
        display: block;
        opacity: 1;
      }

      /* ================ HEADER STYLES ================ */
      .top-header {
        background: white;
        padding: 14px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid #e5e7eb;
        position: fixed;
        top: 0;
        left: 240px;
        right: 0;
        z-index: 500;
        gap: 16px;
        transition: left 0.3s ease;
      }

      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: #6b7280;
        font-size: 1.3em;
        cursor: pointer;
        padding: 8px;
        transition: color 0.2s;
      }

      .mobile-menu-toggle:hover {
        color: #111827;
      }

      .search-bar {
        flex: 1;
        max-width: 400px;
        position: relative;
      }

      .search-bar i {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
        font-size: 0.9em;
      }

      .search-input {
        width: 100%;
        padding: 9px 14px 9px 38px;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.9em;
        background: #f9fafb;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #3b82f6;
        background: white;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .notification-btn {
        position: relative;
        background: none;
        border: none;
        color: #6b7280;
        font-size: 1.1em;
        cursor: pointer;
        padding: 8px;
        transition: all 0.2s;
        border-radius: 8px;
      }

      .notification-btn:hover {
        color: #111827;
        background: #f3f4f6;
      }

      .notification-btn.active {
        color: #2563eb;
        background: #eff6ff;
      }

      .notification-badge {
        position: absolute;
        top: 4px;
        right: 4px;
        background: #ef4444;
        color: white;
        font-size: 0.65em;
        min-width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        padding: 0 4px;
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 6px 10px;
        border-radius: 8px;
        transition: background 0.2s;
        position: relative;
      }

      .user-profile:hover {
        background: #f3f4f6;
      }

      .user-avatar {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 0.9em;
        flex-shrink: 0;
      }

      .user-info {
        display: flex;
        flex-direction: column;
      }

      .user-name {
        font-size: 0.9em;
        font-weight: 600;
        color: #111827;
      }

      .user-role {
        font-size: 0.75em;
        color: #6b7280;
      }

      .dropdown-icon {
        color: #6b7280;
        font-size: 0.75em;
        margin-left: 4px;
        transition: transform 0.3s;
      }

      .user-profile.active .dropdown-icon {
        transform: rotate(180deg);
      }

      .user-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07),
          0 10px 15px rgba(0, 0, 0, 0.1);
        min-width: 200px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1000;
      }

      .user-dropdown.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 14px;
        color: #374151;
        text-decoration: none;
        font-size: 0.9em;
        transition: background 0.2s;
      }

      .dropdown-item:first-child {
        border-radius: 8px 8px 0 0;
      }

      .dropdown-item:last-child {
        border-radius: 0 0 8px 8px;
      }

      .dropdown-item:hover {
        background: #f3f4f6;
      }

      .dropdown-item i {
        width: 18px;
        color: #6b7280;
        font-size: 0.95em;
      }

      .dropdown-item.danger {
        color: #dc2626;
      }

      .dropdown-item.danger i {
        color: #dc2626;
      }

      .dropdown-divider {
        height: 1px;
        background: #e5e7eb;
        margin: 4px 0;
      }

      /* ================ NOTIFICATIONS PANEL ================ */
      .notifications-panel {
        position: fixed;
        top: 0;
        right: -50%;
        width: 50%;
        max-width: 600px;
        height: 100vh;
        background: white;
        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
        z-index: 1001;
        display: flex;
        flex-direction: column;
        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .notifications-panel.show {
        right: 0;
      }

      .notifications-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }

      .notifications-header h3 {
        font-size: 1.2em;
        font-weight: 700;
        color: #111827;
      }

      .close-notifications {
        background: none;
        border: none;
        color: #6b7280;
        font-size: 1.2em;
        cursor: pointer;
        padding: 6px;
        border-radius: 6px;
        transition: all 0.2s;
      }

      .close-notifications:hover {
        background: #f3f4f6;
        color: #111827;
      }

      .notifications-tabs {
        display: flex;
        border-bottom: 1px solid #e5e7eb;
        padding: 0 24px;
        flex-shrink: 0;
      }

      .tab-btn {
        flex: 1;
        padding: 12px;
        background: none;
        border: none;
        color: #6b7280;
        font-size: 0.9em;
        font-weight: 500;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .tab-btn:hover {
        color: #111827;
      }

      .tab-btn.active {
        color: #2563eb;
        border-bottom-color: #2563eb;
      }

      .notifications-content {
        flex: 1;
        overflow-y: auto;
        padding: 12px 0;
      }

      .notifications-content::-webkit-scrollbar {
        width: 6px;
      }

      .notifications-content::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
      }

      .notification-item {
        display: flex;
        gap: 12px;
        padding: 14px 24px;
        cursor: pointer;
        transition: background 0.2s;
        border-left: 3px solid transparent;
      }

      .notification-item:hover {
        background: #f9fafb;
      }

      .notification-item.unread {
        background: #eff6ff;
        border-left-color: #3b82f6;
      }

      .notification-item.unread:hover {
        background: #dbeafe;
      }

      .notification-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1em;
        flex-shrink: 0;
      }

      .notification-icon.critical {
        background: #fee2e2;
        color: #dc2626;
      }

      .notification-icon.warning {
        background: #fef3c7;
        color: #f59e0b;
      }

      .notification-icon.info {
        background: #dbeafe;
        color: #3b82f6;
      }

      .notification-icon.success {
        background: #d1fae5;
        color: #10b981;
      }

      .notification-body {
        flex: 1;
      }

      .notification-title {
        font-size: 0.9em;
        font-weight: 600;
        color: #111827;
        margin-bottom: 4px;
      }

      .notification-text {
        font-size: 0.85em;
        color: #6b7280;
        margin-bottom: 6px;
        line-height: 1.4;
      }

      .notification-time {
        font-size: 0.75em;
        color: #9ca3af;
      }

      .notification-dot {
        width: 8px;
        height: 8px;
        background: #3b82f6;
        border-radius: 50%;
        flex-shrink: 0;
        margin-top: 8px;
      }

      .notification-item:not(.unread) .notification-dot {
        display: none;
      }

      .notifications-footer {
        padding: 16px 24px;
        border-top: 1px solid #e5e7eb;
        flex-shrink: 0;
      }

      .view-all-btn {
        display: block;
        width: 100%;
        padding: 10px;
        background: #f3f4f6;
        color: #2563eb;
        text-align: center;
        text-decoration: none;
        border-radius: 8px;
        font-size: 0.9em;
        font-weight: 600;
        transition: all 0.2s;
      }

      .view-all-btn:hover {
        background: #e5e7eb;
      }

      .notification-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }

      .notification-overlay.show {
        opacity: 1;
        visibility: visible;
      }

      /* Assign Policy Page Styles */
      .page-header {
        background: white;
        padding: 20px 24px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        margin-bottom: 24px;
      }

      .page-title-section {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .page-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .page-icon i {
        font-size: 22px;
        color: white;
      }

      .page-title-text h1 {
        font-size: 1.5em;
        color: #111827;
        font-weight: 700;
      }

      .page-subtitle {
        color: #6b7280;
        font-size: 0.9em;
        margin-top: 4px;
      }

      .breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
        font-size: 0.85em;
      }

      .breadcrumb a {
        color: #6b7280;
        text-decoration: none;
      }

      .breadcrumb a:hover {
        color: #2563eb;
      }

      .breadcrumb span {
        color: #9ca3af;
      }

      .assign-container {
        background: white;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        padding: 28px;
      }

      .step-indicator {
        display: flex;
        justify-content: space-between;
        margin-bottom: 32px;
        position: relative;
      }

      .step-indicator::before {
        content: "";
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        background: #e5e7eb;
        z-index: 0;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        position: relative;
        z-index: 1;
        flex: 1;
      }

      .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: 2px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #9ca3af;
        transition: all 0.3s;
      }

      .step.active .step-circle {
        background: #2563eb;
        border-color: #2563eb;
        color: white;
      }

      .step.completed .step-circle {
        background: #10b981;
        border-color: #10b981;
        color: white;
      }

      .step-label {
        font-size: 0.85em;
        color: #6b7280;
        font-weight: 500;
      }

      .step.active .step-label {
        color: #2563eb;
        font-weight: 600;
      }

      .section {
        margin-bottom: 28px;
      }

      .section-title {
        font-size: 1.1em;
        font-weight: 600;
        color: #111827;
        margin-bottom: 16px;
      }

      .section-desc {
        font-size: 0.9em;
        color: #6b7280;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        font-size: 0.9em;
        color: #374151;
        font-weight: 500;
        margin-bottom: 8px;
      }

      .form-select {
        width: 100%;
        padding: 11px 14px;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.9em;
        background: white;
        cursor: pointer;
      }

      .form-select:focus {
        outline: none;
        border-color: #3b82f6;
      }

      .form-select:disabled {
        background: #f9fafb;
        cursor: not-allowed;
        opacity: 0.6;
      }

      .search-box {
        position: relative;
        margin-bottom: 16px;
      }

      .search-box i {
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #9ca3af;
      }

      .search-input {
        width: 100%;
        padding: 11px 14px 11px 42px;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.9em;
      }

      .search-input:focus {
        outline: none;
        border-color: #3b82f6;
      }

      .agents-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 12px;
        max-height: 400px;
        overflow-y: auto;
        padding: 12px;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .agent-card {
        background: white;
        padding: 14px;
        border-radius: 8px;
        border: 1.5px solid #e5e7eb;
        cursor: pointer;
        transition: all 0.2s;
      }

      .agent-card:hover {
        border-color: #3b82f6;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
      }

      .agent-card.selected {
        border-color: #2563eb;
        background: #eff6ff;
      }

      .agent-card-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .agent-checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .agent-name {
        font-weight: 600;
        font-size: 0.9em;
        color: #111827;
        flex: 1;
      }

      .agent-status {
        font-size: 0.75em;
        padding: 3px 8px;
        border-radius: 4px;
      }

      .status-online {
        background: #d1fae5;
        color: #059669;
      }

      .status-offline {
        background: #f3f4f6;
        color: #6b7280;
      }

      .agent-info {
        font-size: 0.8em;
        color: #6b7280;
        display: flex;
        gap: 12px;
        margin-top: 6px;
      }

      .selected-count {
        background: #eff6ff;
        padding: 12px 16px;
        border-radius: 8px;
        border: 1px solid #bfdbfe;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .selected-count i {
        color: #2563eb;
      }

      .selected-count span {
        font-size: 0.9em;
        color: #1e40af;
        font-weight: 500;
      }

      .summary-box {
        background: #f9fafb;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .summary-row:last-child {
        border-bottom: none;
      }

      .summary-label {
        font-size: 0.9em;
        color: #6b7280;
      }

      .summary-value {
        font-size: 0.9em;
        color: #111827;
        font-weight: 600;
      }

      .policy-preview {
        background: white;
        padding: 16px;
        border-radius: 8px;
        border: 1.5px solid #3b82f6;
        margin-bottom: 16px;
      }

      .policy-preview-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .policy-preview-icon {
        width: 36px;
        height: 36px;
        background: #eff6ff;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #2563eb;
      }

      .policy-preview-title {
        font-weight: 600;
        color: #111827;
      }

      .policy-preview-desc {
        font-size: 0.85em;
        color: #6b7280;
      }

      .domain-input-container {
        margin-top: 16px;
      }

      .domain-input-group {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .domain-input {
        flex: 1;
        padding: 10px 14px;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.9em;
      }

      .domain-input:focus {
        outline: none;
        border-color: #3b82f6;
      }

      .btn-add-domain {
        padding: 10px 20px;
        background: #2563eb;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 600;
      }

      .btn-add-domain:hover {
        background: #1d4ed8;
      }

      .domain-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
      }

      .domain-tag {
        background: #eff6ff;
        color: #1e40af;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.85em;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid #bfdbfe;
      }

      .domain-tag i {
        cursor: pointer;
        color: #ef4444;
      }

      .domain-tag i:hover {
        color: #dc2626;
      }

      .btn-group {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding-top: 24px;
        border-top: 1px solid #e5e7eb;
      }

      .btn {
        padding: 11px 24px;
        border-radius: 8px;
        font-size: 0.9em;
        font-weight: 600;
        cursor: pointer;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #2563eb;
        color: white;
      }

      .btn-primary:hover {
        background: #1d4ed8;
      }

      .btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      .btn-secondary {
        background: white;
        color: #374151;
        border: 1.5px solid #e5e7eb;
      }

      .btn-secondary:hover {
        background: #f9fafb;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-warning {
        background: #f59e0b;
        color: white;
      }

      .btn-warning:hover {
        background: #d97706;
      }

      .alert {
        padding: 14px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .alert-info {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        color: #1e40af;
      }

      .alert-success {
        background: #d1fae5;
        border: 1px solid #a7f3d0;
        color: #065f46;
      }

      .alert-warning {
        background: #fff3cd;
        border: 1px solid #ffeeba;
        color: #856404;
      }

      .alert i {
        font-size: 1.1em;
      }

      .loading {
        padding: 40px;
        text-align: center;
        color: #6b7280;
        font-style: italic;
      }

      .error {
        padding: 40px;
        text-align: center;
        color: #ef4444;
        background: #fee2e2;
        border-radius: 8px;
        border: 1px solid #fca5a5;
      }

      .summary-domain-tag {
        background: #eff6ff;
        color: #1e40af;
        padding: 4px 10px;
        border-radius: 16px;
        font-size: 0.8em;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border: 1px solid #bfdbfe;
      }

      .summary-domain-tag i {
        cursor: pointer;
        color: #ef4444;
        font-size: 0.8em;
        transition: all 0.2s;
      }

      .summary-domain-tag i:hover {
        color: #dc2626;
        transform: scale(1.1);
      }

      #summaryDomainTags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 0;
      }

      /* Mobile responsive */
      @media (max-width: 1200px) {
        .main-content {
          margin-left: 70px;
          max-width: calc(100vw - 70px);
        }

        .main-content.expanded {
          margin-left: 70px;
          max-width: calc(100vw - 70px);
        }

        .top-header {
          left: 70px;
        }
      }

      @media (max-width: 968px) {
        .main-content {
          margin-left: 0;
          max-width: 100vw;
        }

        .top-header {
          left: 0;
        }

        .mobile-menu-toggle {
          display: block;
        }

        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .sidebar.mobile-open {
          transform: translateX(0);
        }

        .agents-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 768px) {
        .content-area {
          padding: 16px;
          padding-top: 80px;
        }

        .notifications-panel {
          width: 90%;
          right: -90%;
        }

        .step-indicator {
          flex-direction: column;
          gap: 12px;
        }

        .step-indicator::before {
          display: none;
        }

        .btn-group {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }

        .user-info {
          display: none;
        }
      }

      @media (max-width: 640px) {
        .content-area {
          padding: 12px;
          padding-top: 70px;
        }

        .page-title-section {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
        }

        .page-icon {
          width: 40px;
          height: 40px;
        }

        .page-icon i {
          font-size: 18px;
        }

        .page-title-text h1 {
          font-size: 1.3em;
        }

        .assign-container {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <-- ==================== SIDEBAR ==================== 
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <i class="fas fa-shield-halved"></i>
          </div>
          <div class="sidebar-title">DLP Shield</div>
        </div>

        <nav class="nav-menu">
          <div class="nav-item">
            <a href="dashboard.html" class="nav-link" data-page="dashboard">
              <i class="fas fa-th-large"></i>
              <span>Dashboard</span>
            </a>
          </div>

          <div class="nav-item">
            <a href="alerts.html" class="nav-link" data-page="alerts">
              <i class="fas fa-triangle-exclamation"></i>
              <span>Alerts &amp; Incidents</span>
            </a>
          </div>

          <div class="nav-item">
            <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">
              <i class="fas fa-shield-alt"></i>
              <span>Policies</span>
              <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="sub-menu open">
              <a
                href="manage-agents.html"
                class="sub-menu-item"
                data-page="manage-agents"
                >Manage Agents</a
              >
              <a
                href="file-policies.html"
                class="sub-menu-item"
                data-page="file-policies"
                >File Policies</a
              >
              <a
                href="assign-policy.html"
                class="sub-menu-item active"
                data-page="assign-policy"
                >Assign Policy</a
              >
            </div>
          </div>

          <div class="nav-item">
            <a href="agents.html" class="nav-link" data-page="agents">
              <i class="fas fa-desktop"></i>
              <span>Agents / Endpoints</span>
            </a>
          </div>

          <div class="nav-item">
            <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
              <i class="fas fa-eye"></i>
              <span>OCR &amp; Image Analysis</span>
              <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="sub-menu">
              <a
                href="ocr-dashboard.html"
                class="sub-menu-item"
                data-page="ocr-dashboard"
                >OCR Dashboard</a
              >
              <a
                href="ocr-policies.html"
                class="sub-menu-item"
                data-page="ocr-policies"
                >OCR Policies</a
              >
            </div>
          </div>

          <div class="nav-item">
            <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
              <i class="fas fa-file-lines"></i>
              <span>Reports &amp; Logs</span>
              <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="sub-menu">
              <a href="reports.html" class="sub-menu-item" data-page="reports"
                >Reports</a
              >
              <a
                href="generate-report.html"
                class="sub-menu-item"
                data-page="generate-report"
                >Generate Report</a
              >
              <a
                href="audit-logs.html"
                class="sub-menu-item"
                data-page="audit-logs"
                >Audit Logs</a
              >
              <a
                href="device-logs.html"
                class="sub-menu-item"
                data-page="device-logs"
                >Device Logs</a
              >
            </div>
          </div>

          <div class="nav-item">
            <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
              <i class="fas fa-users"></i>
              <span>Users &amp; Roles</span>
              <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="sub-menu">
              <a href="users.html" class="sub-menu-item" data-page="users"
                >Users</a
              >
              <a href="roles.html" class="sub-menu-item" data-page="roles"
                >Roles &amp; Permissions</a
              >
              <a
                href="permissions.html"
                class="sub-menu-item"
                data-page="permissions"
                >Permissions</a
              >
            </div>
          </div>

          <div class="nav-item">
            <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
              <i class="fas fa-gear"></i>
              <span>Settings</span>
              <i class="fas fa-chevron-down chevron-icon"></i>
            </div>
            <div class="sub-menu">
              <a href="general.html" class="sub-menu-item" data-page="general"
                >General</a
              >
              <a href="security.html" class="sub-menu-item" data-page="security"
                >Security</a
              >
              <a
                href="integrations.html"
                class="sub-menu-item"
                data-page="integrations"
                >Integrations</a
              >
              <a
                href="data-retention.html"
                class="sub-menu-item"
                data-page="data-retention"
                >Data Retention</a
              >
            </div>
          </div>
        </nav>

        <div class="sidebar-footer">
          <button class="collapse-btn" onclick="toggleSidebar()">
            <i class="fas fa-chevron-left"></i>
            <span>Collapse</span>
          </button>
        </div>
      </aside>

      <!-- Mobile Overlay (for sidebar) 
      <div
        class="sidebar-overlay"
        id="sidebarOverlay"
        onclick="closeMobileSidebar()"
      ></div>

      <!-- ==================== HEADER ====================
      <header class="top-header" id="topHeader">
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input
            type="text"
            class="search-input"
            placeholder="Search alerts, agents, policies..."
          />
        </div>

        <div class="header-actions">
          <button class="notification-btn" onclick="toggleNotifications(event)">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="alertBadge">5</span>
          </button>

          <div class="user-profile" onclick="toggleUserDropdown(event)">
            <div class="user-avatar">A</div>
            <div class="user-info">
              <div class="user-name">Admin</div>
              <div class="user-role">Security Admin</div>
            </div>
            <i class="fas fa-chevron-down dropdown-icon"></i>

            <div class="user-dropdown" id="userDropdown">
              <a href="general.html" class="dropdown-item">
                <i class="fas fa-gear"></i>
                <span>Settings</span>
              </a>
              <a href="#" class="dropdown-item">
                <i class="fas fa-circle-question"></i>
                <span>Help &amp; Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a
                href="index.html"
                class="dropdown-item danger"
                onclick="logout(event)"
              >
                <i class="fas fa-right-from-bracket"></i>
                <span>Sign out</span>
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- ==================== NOTIFICATIONS PANEL ==================== 
      <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
          <h3>Notifications</h3>
          <button class="close-notifications" onclick="closeNotifications()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="notifications-tabs">
          <button class="tab-btn active" onclick="switchTab(event, 'all')">
            All (5)
          </button>
          <button class="tab-btn" onclick="switchTab(event, 'unread')">
            Unread (3)
          </button>
        </div>

        <div class="notifications-content" id="notificationsContent">
          <div class="notification-item unread">
            <div class="notification-icon critical">
              <i class="fas fa-shield-exclamation"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Critical Policy Violation</div>
              <div class="notification-text">
                User attempted to copy sensitive files to USB drive
              </div>
              <div class="notification-time">2 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item unread">
            <div class="notification-icon warning">
              <i class="fas fa-triangle-exclamation"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Agent Offline</div>
              <div class="notification-text">
                DESKTOP-DEF456 has been offline for 2 hours
              </div>
              <div class="notification-time">15 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item unread">
            <div class="notification-icon info">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Policy Updated</div>
              <div class="notification-text">
                File Protection Policy has been modified by Admin
              </div>
              <div class="notification-time">1 hour ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item">
            <div class="notification-icon success">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Agent Connected</div>
              <div class="notification-text">
                New agent LAPTOP-XYZ789 successfully registered
              </div>
              <div class="notification-time">3 hours ago</div>
            </div>
          </div>

          <div class="notification-item">
            <div class="notification-icon info">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Report Generated</div>
              <div class="notification-text">
                Weekly security report is ready for review
              </div>
              <div class="notification-time">5 hours ago</div>
            </div>
          </div>
        </div>

        <div class="notifications-footer">
          <a href="alerts.html" class="view-all-btn">View All Notifications</a>
        </div>
      </div>

      <!-- Notification Overlay 
      <div
        class="notification-overlay"
        id="notificationOverlay"
        onclick="closeNotifications()"
      ></div>

      <main class="main-content" id="mainContent">
        <div class="content-area">
          <div class="breadcrumb">
            <a href="dashboard.html"><i class="fas fa-home"></i></a>
            <span>/</span>
            <a href="file-policies.html">Policies</a>
            <span>/</span>
            <span>Assign Policy</span>
          </div>

          <div class="page-header">
            <div class="page-title-section">
              <div class="page-icon"><i class="fas fa-user-shield"></i></div>
              <div class="page-title-text">
                <h1>Assign Policy to Agents</h1>
                <p class="page-subtitle">
                  Select agents and assign protection policies
                </p>
              </div>
            </div>
          </div>

          <div class="assign-container">
            <div class="step-indicator">
              <div class="step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Choose Agent</div>
              </div>
              <div class="step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Policy Type</div>
              </div>
              <div class="step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Select Policy</div>
              </div>
              <div class="step" data-step="4">
                <div class="step-circle">4</div>
                <div class="step-label">Review & Apply</div>
              </div>
            </div>

            <!-- STEP 1: Choose Agent 
            <div id="step1">
              <div class="section">
                <div class="section-title">Step 1: Choose Agent</div>
                <div class="section-desc">
                  Select the agents you want to assign a policy to
                </div>

                <div class="search-box">
                  <i class="fas fa-search"></i>
                  <input
                    type="text"
                    class="search-input"
                    placeholder="Search agents by name, user, or IP..."
                    id="agentSearch"
                  />
                </div>

                <div class="selected-count" id="selectedCount">
                  <i class="fas fa-check-circle"></i>
                  <span>0 agents selected</span>
                </div>

                <div class="agents-grid" id="agentsGrid">
                  <!-- Agent cards will be dynamically generated 
                </div>

                <div class="alert alert-info">
                  <i class="fas fa-info-circle"></i>
                  <span>Select at least one agent to continue</span>
                </div>
              </div>
            </div>

            <!-- STEP 2: Policy Type 
            <div id="step2" style="display: none">
              <div class="section">
                <div class="section-title">Step 2: Select Policy Type</div>
                <div class="section-desc">
                  Choose the type of policy you want to assign
                </div>

                <div class="form-group">
                  <label class="form-label">Policy Type</label>
                  <select class="form-select" id="policyType">
                    <option value="">-- Select Policy Type --</option>
                    <option value="network">Network Policy</option>
                    <option value="file">File Protection</option>
                    <option value="usb">USB</option>
                    <option value="ocr">OCR</option>
                  </select>
                </div>

                <div class="alert alert-info">
                  <i class="fas fa-info-circle"></i>
                  <span
                    >Different policy types provide different protection
                    mechanisms</span
                  >
                </div>
              </div>
            </div>

            <!-- STEP 3: Select Policy 
            <div id="step3" style="display: none">
              <div class="section">
                <div class="section-title">Step 3: Select Policy</div>
                <div class="section-desc">
                  Choose the specific policy to assign
                </div>

                <div class="form-group">
                  <label class="form-label">Available Policies</label>
                  <select class="form-select" id="policySelect" disabled>
                    <option value="">-- Select a policy type first --</option>
                  </select>
                </div>

                <!-- DNS Domain Input (for Network Policy) 
                <div id="dnsInputContainer" style="display: none">
                  <div class="domain-input-container">
                    <label class="form-label">Block Domains</label>
                    <div class="domain-input-group">
                      <input
                        type="text"
                        class="domain-input"
                        id="domainInput"
                        placeholder="Enter domain (e.g., www.example.com)"
                      />
                      <button class="btn-add-domain" onclick="addDomain()">
                        <i class="fas fa-plus"></i> Add
                      </button>
                    </div>
                    <div class="domain-tags" id="domainTags">
                      <!-- Domain tags will appear here -->
</div>
</div>
</div>

<!-- File Protection Info 
                <div id="fileProtectionInfo" style="display: none">
                  <div class="alert alert-info">
                    <i class="fas fa-shield-alt"></i>
                    <span
                      >File Protection policy will block unauthorized file
                      transfers</span
                    >
                  </div>
                </div>

                <!-- OCR Info 
                <div id="ocrInfo" style="display: none">
                  <div class="alert alert-info">
                    <i class="fas fa-eye"></i>
                    <span
                      >OCR policy will scan and analyze text in images and
                      documents</span
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- STEP 4: Review & Apply 
            <div id="step4" style="display: none">
              <div class="section">
                <div class="section-title">Step 4: Review & Apply</div>
                <div class="section-desc">
                  Verify the policy assignment before applying
                </div>

                <div class="summary-box">
                  <div class="summary-row">
                    <span class="summary-label">Agents Selected</span>
                    <span class="summary-value" id="summaryAgentCount">0</span>
                  </div>

                  <div class="summary-row">
                    <span class="summary-label">Policy Type</span>
                    <span class="summary-value" id="summaryPolicyType">-</span>
                  </div>

                  <div class="summary-row">
                    <span class="summary-label">Policy Name</span>
                    <span class="summary-value" id="summaryPolicyName">-</span>
                  </div>

                  <!-- DNS Domains Summary with Remove Buttons 
                  <div id="summaryDomainsContainer" style="display: none">
                    <div
                      class="summary-row"
                      style="border-bottom: none; padding-bottom: 5px"
                    >
                      <span class="summary-label">Blocked Domains</span>
                      <span
                        class="summary-value"
                        style="display: flex; align-items: center; gap: 10px"
                      >
                        <span id="summaryDomainsCount">0</span> domains
                      </span>
                    </div>
                    <div
                      class="domain-tags"
                      id="summaryDomainTags"
                      style="
                        margin-top: 5px;
                        margin-bottom: 10px;
                        padding-left: 20px;
                      "
                    >
                      <!-- Domain tags with remove buttons will appear here 
                    </div>
                  </div>
                </div>

                <div class="alert alert-success" style="margin-top: 20px">
                  <i class="fas fa-check-circle"></i>
                  <span
                    >The policy will be applied to all selected agents within 5
                    minutes.</span
                  >
                </div>
              </div>
            </div>

            <div class="btn-group">
              <button
                class="btn btn-secondary"
                onclick="previousStep()"
                id="prevBtn"
                style="display: none"
              >
                <i class="fas fa-arrow-left"></i><span>Previous</span>
              </button>
              <button
                class="btn btn-secondary"
                onclick="window.location.href = 'file-policies.html'"
              >
                <i class="fas fa-times"></i><span>Cancel</span>
              </button>
              <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">
                <span>Next</span><i class="fas fa-arrow-right"></i>
              </button>
              <button
                class="btn btn-primary"
                onclick="applyPolicy()"
                id="applyBtn"
                style="display: none"
              >
                <i class="fas fa-check"></i><span>Apply Policy</span>
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      /* ==================== AUTHENTICATION & USER DATA ==================== */

      async function checkAuth() {
        try {
          const response = await fetch("/api/auth/check", {
            credentials: "include",
          });

          if (!response.ok) {
            throw new Error("Not authenticated");
          }

          const result = await response.json();

          if (!result.success) {
            window.location.href = "index.html";
            return null;
          }

          // Store user data in localStorage
          if (result.data) {
            localStorage.setItem("userData", JSON.stringify(result.data));
            return result.data;
          }

          return null;
        } catch (err) {
          window.location.href = "index.html";
          return null;
        }
      }

      // Load admin info into header
      function loadAdminInfo() {
        const userDataStr = localStorage.getItem("userData");

        if (userDataStr) {
          try {
            const userData = JSON.parse(userDataStr);

            const userName = document.querySelector(".user-name");
            const userAvatar = document.querySelector(".user-avatar");
            const userRole = document.querySelector(".user-role");

            if (userName) {
              const namePart = userData.username || "Admin";
              const formattedName = namePart
                .split(".")
                .map((n) => n.charAt(0).toUpperCase() + n.slice(1))
                .join(" ");
              userName.textContent = formattedName;
            }

            if (userAvatar) {
              const namePart = userData.username || "Admin";
              const initials = namePart
                .split(".")
                .map((n) => (n[0] ? n[0].toUpperCase() : ""))
                .join("");
              userAvatar.textContent = initials || "A";
            }

            if (userRole) {
              userRole.textContent = userData.role || "Security Admin";
            }
          } catch (e) {
            console.error("Error parsing user data:", e);
          }
        }
      }

      async function refreshUserData() {
        const userData = await checkAuth();
        if (userData) {
          localStorage.setItem("userData", JSON.stringify(userData));
          loadAdminInfo();
        }
      }

      // Refresh every 5 minutes
      setInterval(refreshUserData, 5 * 60 * 1000);

      /* ==================== SIDEBAR FUNCTIONS ==================== */

      function toggleSubMenu(element) {
        var sidebar = document.getElementById("sidebar");
        if (sidebar.classList.contains("collapsed")) return;

        var subMenu = element.nextElementSibling;
        var allSubMenus = document.querySelectorAll(".sub-menu");
        var allDropdowns = document.querySelectorAll(".nav-dropdown");

        // Close other open submenus
        allSubMenus.forEach(function (menu) {
          if (menu !== subMenu) menu.classList.remove("open");
        });
        allDropdowns.forEach(function (link) {
          if (link !== element) link.classList.remove("expanded");
        });

        // Toggle current
        element.classList.toggle("expanded");
        subMenu.classList.toggle("open");
      }

      function toggleSidebar() {
        var sidebar = document.getElementById("sidebar");
        var mainContent = document.getElementById("mainContent");
        var header = document.getElementById("topHeader");

        sidebar.classList.toggle("collapsed");
        var isCollapsed = sidebar.classList.contains("collapsed");

        if (mainContent) mainContent.classList.toggle("expanded");

        // Update header left position
        if (header) {
          header.style.left = isCollapsed ? "70px" : "240px";
        }

        // Close all submenus when collapsing
        if (isCollapsed) {
          document.querySelectorAll(".sub-menu").forEach(function (m) {
            m.classList.remove("open");
          });
          document.querySelectorAll(".nav-dropdown").forEach(function (l) {
            l.classList.remove("expanded");
          });
        }

        // Dispatch event for other components
        window.dispatchEvent(
          new CustomEvent("sidebarToggle", {
            detail: { collapsed: isCollapsed },
          })
        );
      }

      function openMobileSidebar() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (sidebar) sidebar.classList.add("mobile-open");
        if (overlay) overlay.classList.add("active");
      }

      function closeMobileSidebar() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (sidebar) sidebar.classList.remove("mobile-open");
        if (overlay) overlay.classList.remove("active");
      }

      function toggleMobileMenu() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (!sidebar) return;

        if (sidebar.classList.contains("mobile-open")) {
          closeMobileSidebar();
        } else {
          openMobileSidebar();
        }
      }

      function setActiveMenuItem() {
        var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';
        
        // First remove all active classes
        document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {
          el.classList.remove('active');
        });

        // Handle sub-menu items
        document.querySelectorAll('.sub-menu-item[data-page]').forEach(function (item) {
          var href = item.getAttribute('href');
          if (href === currentPage) {
            item.classList.add('active');
            var parentSubMenu = item.closest('.sub-menu');
            if (parentSubMenu) {
              parentSubMenu.classList.add('open');
              var parentNav = parentSubMenu.previousElementSibling;
              if (parentNav) parentNav.classList.add('expanded');
            }
          }
        });

        // Handle main nav links
        document.querySelectorAll('.nav-link[data-page]').forEach(function (link) {
          var href = link.getAttribute('href');
          if (href === currentPage) {
            link.classList.add('active');
          }
        });
      }

      /* ==================== HEADER FUNCTIONS ==================== */

      function toggleNotifications(event) {
        event.stopPropagation();
        var panel = document.getElementById("notificationsPanel");
        var overlay = document.getElementById("notificationOverlay");
        var btn = event.currentTarget;
        if (!panel || !overlay) return;

        if (panel.classList.contains("show")) {
          closeNotifications();
        } else {
          closeUserDropdown();
          panel.classList.add("show");
          overlay.classList.add("show");
          btn.classList.add("active");
          document.body.style.overflow = "hidden";
        }
      }

      function closeNotifications() {
        var panel = document.getElementById("notificationsPanel");
        var overlay = document.getElementById("notificationOverlay");
        var btn = document.querySelector(".notification-btn");
        if (panel) panel.classList.remove("show");
        if (overlay) overlay.classList.remove("show");
        if (btn) btn.classList.remove("active");
        document.body.style.overflow = "";
      }

      function switchTab(event, tabName) {
        document.querySelectorAll(".tab-btn").forEach(function (t) {
          t.classList.remove("active");
        });
        event.currentTarget.classList.add("active");

        document
          .querySelectorAll(".notification-item")
          .forEach(function (item) {
            item.style.display =
              tabName === "unread" && !item.classList.contains("unread")
                ? "none"
                : "flex";
          });
      }

      function toggleUserDropdown(event) {
        event.stopPropagation();
        var dropdown = document.getElementById("userDropdown");
        var userProfile = event.currentTarget;
        if (!dropdown) return;

        if (dropdown.classList.contains("show")) {
          closeUserDropdown();
        } else {
          closeNotifications();
          dropdown.classList.add("show");
          userProfile.classList.add("active");
        }
      }

      function closeUserDropdown() {
        var dropdown = document.getElementById("userDropdown");
        var userProfile = document.querySelector(".user-profile");
        if (dropdown) dropdown.classList.remove("show");
        if (userProfile) userProfile.classList.remove("active");
      }

      function logout(event) {
        event.preventDefault();

        fetch("/api/auth/logout", {
          method: "POST",
          credentials: "include",
        }).finally(() => {
          localStorage.removeItem("isLoggedIn");
          localStorage.removeItem("userEmail");
          localStorage.removeItem("userData");
          window.location.href = "index.html";
        });
      }

      // Close dropdowns when clicking outside
      document.addEventListener("click", function (event) {
        if (!event.target.closest(".user-profile")) {
          closeUserDropdown();
        }
        if (
          !event.target.closest(".notification-btn") &&
          !event.target.closest(".notifications-panel")
        ) {
          closeNotifications();
        }
      });

      /* ==================== ASSIGN POLICY FUNCTIONS ==================== */

      let selectedAgents = new Set();
      let agentsBasicData = {};
      let agentsCapabilities = {};
      let currentStep = 1;
      let selectedPolicyType = "";
      let selectedPolicy = "";
      let blockedDomains = [];
      let isEditingExistingPolicy = false;
      let statusRefreshInterval;

      function startStatusRefresh() {
        if (statusRefreshInterval) {
          clearInterval(statusRefreshInterval);
        }

        // Refresh agent status every 30 seconds
        statusRefreshInterval = setInterval(async () => {
          console.log("Refreshing agent status...");
          await refreshAllAgents();
        }, 10000);
      }

      async function refreshAllAgents() {
        try {
          // Fetch fresh agent data
          const response = await fetch("/api/admin/agents", {
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          });

          if (!response.ok) {
            throw new Error("Failed to fetch agents");
          }

          const result = await response.json();

          if (result.success && result.data) {
            const agents = result.data;

            // Update agentsBasicData with fresh data
            agents.forEach((agent) => {
              agentsBasicData[agent.id] = agent;
            });

            // Refresh the agent cards UI
            await initializeAgentCards();
          }
        } catch (error) {
          console.error("Error refreshing agents:", error);
        }
      }

      async function initializeAgentCards() {
        const agentsGrid = document.getElementById("agentsGrid");
        if (!agentsGrid) return;

        agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';

        try {
          // Fetch agents from API
          const response = await fetch("/api/admin/agents", {
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          });

          if (!response.ok) {
            throw new Error("Failed to fetch agents");
          }

          const result = await response.json();

          if (!result.success || !result.data) {
            throw new Error(result.message || "No agents found");
          }

          const agents = result.data;
          agentsGrid.innerHTML = "";

          agents.forEach((agent) => {
            const agentCard = document.createElement("div");
            agentCard.className = "agent-card";
            agentCard.dataset.id = agent.id;
            agentCard.onclick = () => toggleAgent(agent.id);

            agentCard.innerHTML = `
                <div class="agent-card-header">
                    <input type="checkbox" class="agent-checkbox" ${
                      selectedAgents.has(agent.id) ? "checked" : ""
                    }>
                    <div class="agent-name"> ${agent.username}</div>
                     <span class="agent-status ${
                       isAgentOnline(agent) ? "status-online" : "status-offline"
                     }">
                        ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}
                    </span>
                </div>
                <div class="agent-info">
                    <span><i class="fas fa-user"></i> ${
                      agent.hostname || agent.username
                    }</span>
                    <span><i class="fas fa-id-badge"></i> ${agent.id}</span>
                </div>
                <div class="agent-info">
                    <span><i class="fab fa-${getOSIcon(
                      agent.osType
                    )}"></i> ${agent.osType || "Unknown OS"}</span>
                    <span><i class="fas fa-network-wired"></i> ${
                      agent.ipAddress || "N/A"
                    }</span>
                </div>
            `;

            function isAgentOnline(agent) {
              if (
                agent.agentRuntimeState &&
                agent.agentRuntimeState.toUpperCase() === "ONLINE"
              ) {
                return true;
              }

              if (agent.lastHeartbeat) {
                const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();
                const now = new Date();
                const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);
                return diffMinutes <= 10;
              }

              return false;
            }

            agentsGrid.appendChild(agentCard);

            if (selectedAgents.has(agent.id)) {
              agentCard.classList.add("selected");
              agentCard.querySelector(".agent-checkbox").checked = true;
            }
          });
        } catch (error) {
          console.error("Error loading agents:", error);
          agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;
        }

        updateSelectedCount();
      }

      function getOSIcon(os) {
        if (!os) return "desktop";

        const osLower = os.toLowerCase();
        if (osLower.includes("windows")) return "windows";
        if (osLower.includes("macos") || osLower.includes("mac")) return "apple";
        if (osLower.includes("ubuntu") || osLower.includes("linux"))
          return "linux";
        return "desktop";
      }

      async function toggleAgent(agentId) {
        if (selectedAgents.has(agentId)) {
          selectedAgents.delete(agentId);
          delete agentsCapabilities[agentId];
        } else {
          selectedAgents.add(agentId);
          // Fetch agent capabilities if not already fetched
          if (!agentsCapabilities[agentId]) {
            try {
              await fetchAgentDetails(agentId);
              if (selectedPolicy === "NETWORK_DNS_BLOCK") {
                const capabilities = agentsCapabilities[agentId];
                if (capabilities && capabilities.NETWORK) {
                  const policy = capabilities.NETWORK.find(
                    (p) => p.code === selectedPolicy
                  );
                  if (policy && policy.isActive) {
                    isEditingExistingPolicy = true;
                  }
                }
              }
            } catch (error) {
              console.error(
                `Failed to fetch capabilities for agent ${agentId}:`,
                error
              );
              agentsCapabilities[agentId] = {};
            }
          }
        }

        const agentCard = document.querySelector(
          `.agent-card[data-id="${agentId}"]`
        );
        if (agentCard) {
          agentCard.classList.toggle("selected");
          const checkbox = agentCard.querySelector(".agent-checkbox");
          if (checkbox) {
            checkbox.checked = selectedAgents.has(agentId);
          }
        }

        updateSelectedCount();

        // Update policy types based on selected agents
        if (selectedAgents.size > 0) {
          updatePolicyTypes();
        }
      }

      async function fetchAgentDetails(agentId) {
        try {
          const response = await fetch(
            `/api/admin/agents/${agentId}/capabilities`,
            {
              headers: {
                "Content-Type": "application/json",
              },
              credentials: "include",
            }
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: Failed to fetch capabilities`
            );
          }

          const result = await response.json();

          if (result.success && result.data) {
            agentsCapabilities[agentId] = result.data;
          } else {
            throw new Error(result.message || "Failed to load capabilities");
          }
        } catch (error) {
          console.error(
            `Error fetching capabilities for agent ${agentId}:`,
            error
          );
          agentsCapabilities[agentId] = {};
          throw error;
        }
      }

      async function fetchAgentSimpleDetails() {
        try {
          const response = await fetch("/api/admin/agents", {
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          });

          if (!response.ok) throw new Error("Failed to fetch agents");

          const result = await response.json();
          if (result.success && result.data) {
            result.data.forEach((agent) => {
              agentsBasicData[agent.id] = agent;
            });
          }
        } catch (error) {
          console.error("Error fetching agents:", error);
        }
      }

      async function updatePolicyTypes() {
        if (selectedAgents.size === 0) {
          const policyTypeSelect = document.getElementById("policyType");
          policyTypeSelect.innerHTML =
            '<option value="">-- Select Policy Type --</option>';
          selectedPolicyType = "";
          updatePolicySelect();
          return;
        }

        let commonCategories = null;

        for (const agentId of selectedAgents) {
          const capabilities = agentsCapabilities[agentId];

          if (capabilities && Object.keys(capabilities).length > 0) {
            const agentCategories = Object.keys(capabilities);

            if (commonCategories === null) {
              commonCategories = new Set(agentCategories);
            } else {
              commonCategories = new Set(
                [...commonCategories].filter((cat) =>
                  agentCategories.includes(cat)
                )
              );
            }
          } else {
            commonCategories = new Set();
            break;
          }
        }

        const policyTypeSelect = document.getElementById("policyType");
        const currentValue = policyTypeSelect.value;

        policyTypeSelect.innerHTML =
          '<option value="">-- Select Policy Type --</option>';

        if (commonCategories && commonCategories.size > 0) {
          const sortedCategories = Array.from(commonCategories).sort();

          sortedCategories.forEach((category) => {
            const option = document.createElement("option");
            option.value = category;
            option.textContent = category;
            policyTypeSelect.appendChild(option);
          });

          if (currentValue && commonCategories.has(currentValue)) {
            policyTypeSelect.value = currentValue;
            selectedPolicyType = currentValue;
          } else {
            selectedPolicyType = "";
          }
        } else {
          selectedPolicyType = "";
        }

        updatePolicySelect();
      }

      function updateSelectedCount() {
        const count = selectedAgents.size;
        const selectedCountElement = document.getElementById("selectedCount");
        if (selectedCountElement) {
          selectedCountElement.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${count} agent${count !== 1 ? "s" : ""} selected</span>
                `;
        }
      }

      document.addEventListener("change", function (e) {
        if (e.target && e.target.id === "policyType") {
          selectedPolicyType = e.target.value;
          updatePolicySelect();
        }

        if (e.target && e.target.id === "policySelect") {
          selectedPolicy = e.target.value;
          updatePolicyOptions();
        }
      });

      function updatePolicySelect() {
        const policySelect = document.getElementById("policySelect");
        if (!policySelect) return;

        policySelect.innerHTML = '<option value="">-- Select Policy --</option>';

        if (selectedPolicyType && selectedAgents.size > 0) {
          let commonPolicies = null;
          let policyStatusMap = new Map();

          for (const agentId of selectedAgents) {
            const capabilities = agentsCapabilities[agentId];

            if (capabilities && capabilities[selectedPolicyType]) {
              const agentPolicies = capabilities[selectedPolicyType];

              if (!Array.isArray(agentPolicies)) {
                console.error(
                  `Agent ${agentId}: Expected array for ${selectedPolicyType}, got:`,
                  agentPolicies
                );
                commonPolicies = new Map();
                break;
              }

              if (commonPolicies === null) {
                commonPolicies = new Map();
                agentPolicies.forEach((policy) => {
                  if (policy && policy.code) {
                    commonPolicies.set(policy.code, policy);
                    policyStatusMap.set(policy.code, {
                      [agentId]: policy.isActive || false,
                    });
                  }
                });
              } else {
                const agentPolicyCodes = new Set(
                  agentPolicies.map((p) => p?.code).filter((code) => code)
                );

                agentPolicies.forEach((policy) => {
                  if (
                    policy &&
                    policy.code &&
                    policyStatusMap.has(policy.code)
                  ) {
                    policyStatusMap.get(policy.code)[agentId] =
                      policy.isActive || false;
                  }
                });

                commonPolicies = new Map(
                  [...commonPolicies].filter(([code, policy]) =>
                    agentPolicyCodes.has(code)
                  )
                );
              }
            } else {
              commonPolicies = new Map();
              break;
            }
          }

          if (commonPolicies && commonPolicies.size > 0) {
            policySelect.disabled = false;

            const sortedPolicies = Array.from(commonPolicies.values())
              .filter((policy) => policy && policy.name)
              .sort((a, b) => a.name.localeCompare(b.name));

            sortedPolicies.forEach((policy) => {
              const option = document.createElement("option");
              option.value = policy.code;

              const statusInfo = policyStatusMap.get(policy.code);
              let appliedCount = 0;
              if (statusInfo) {
                appliedCount = Object.values(statusInfo).filter(
                  (isActive) => isActive
                ).length;
              }

              let statusText = "";
              if (appliedCount === selectedAgents.size) {
                statusText = " (Applied to all)";
              } else if (appliedCount > 0) {
                statusText = ` (Applied to ${appliedCount}/${selectedAgents.size})`;
              }

              option.textContent = policy.name + statusText;
              option.title = policy.description || "";
              option.dataset.isApplied = appliedCount === selectedAgents.size;

              policySelect.appendChild(option);
            });

            if (sortedPolicies.length > 0) {
              policySelect.value = sortedPolicies[0].code;
              selectedPolicy = sortedPolicies[0].code;
              updatePolicyAppliedStatus();
            }
          } else {
            policySelect.disabled = true;
            policySelect.innerHTML =
              '<option value="">No common policies available</option>';
            selectedPolicy = "";
          }
        } else {
          policySelect.disabled = true;
          policySelect.innerHTML =
            '<option value="">-- Select a policy type first --</option>';
          selectedPolicy = "";
        }

        updatePolicyOptions();
      }

      function updatePolicyAppliedStatus() {
        const policySelect = document.getElementById("policySelect");
        const selectedOption = policySelect.options[policySelect.selectedIndex];
        const isApplied = selectedOption
          ? selectedOption.dataset.isApplied === "true"
          : false;

        const nextBtn = document.getElementById("nextBtn");
        const applyBtn = document.getElementById("applyBtn");

        if (currentStep === 3 && isApplied) {
          nextBtn.innerHTML =
            '<span>Next</span><i class="fas fa-arrow-right"></i>';
        }
      }

      function updatePolicyOptions() {
        const dnsContainer = document.getElementById("dnsInputContainer");
        const fileInfo = document.getElementById("fileProtectionInfo");
        const ocrInfo = document.getElementById("ocrInfo");

        if (dnsContainer) dnsContainer.style.display = "none";
        if (fileInfo) fileInfo.style.display = "none";
        if (ocrInfo) ocrInfo.style.display = "none";

        if (!selectedPolicy || !selectedPolicyType) return;

        if (selectedPolicy === "NETWORK_DNS_BLOCK") {
          if (dnsContainer) dnsContainer.style.display = "block";

          if (selectedAgents.size === 1) {
            const agentId = Array.from(selectedAgents)[0];
            const capabilities = agentsCapabilities[agentId];
            if (capabilities && capabilities.NETWORK) {
              const policy = capabilities.NETWORK.find(
                (p) => p.code === selectedPolicy
              );
              if (policy && policy.policyData && policy.policyData !== "null") {
                try {
                  const data = JSON.parse(policy.policyData);
                  if (data.domains && Array.isArray(data.domains)) {
                    blockedDomains = data.domains;
                    isEditingExistingPolicy = true;
                    console.log("Loaded domains:", blockedDomains);
                  } else {
                    blockedDomains = [];
                    isEditingExistingPolicy = false;
                  }
                } catch (e) {
                  console.error("Error parsing policy data:", e);
                  blockedDomains = [];
                  isEditingExistingPolicy = false;
                }
              }
            }
          } else {
            blockedDomains = [];
            isEditingExistingPolicy = false;
          }
          renderDomainTags();
        } else if (selectedPolicyType === "FILE") {
          fileInfo.style.display = "block";
        } else if (selectedPolicyType === "SECURITY_MONITOR") {
          ocrInfo.style.display = "block";
        }
      }

      function addDomain() {
        const domainInput = document.getElementById("domainInput");
        let domain = domainInput.value.trim();

        if (!domain) {
          alert("Please enter a domain name");
          return;
        }

        domain = domain.replace(/^https?:\/\//, "");
        domain = domain.replace(/\/$/, "");

        const domainLower = domain.toLowerCase();
        const exists = blockedDomains.some(
          (d) => d.toLowerCase() === domainLower
        );

        if (exists) {
          alert("Domain already added");
          return;
        }
        blockedDomains.push(domain);
        domainInput.value = "";

        renderDomainTags();

        if (currentStep === 4) {
          renderSummaryDomainTags();
          const summaryDomainsCount =
            document.getElementById("summaryDomainsCount");
          if (summaryDomainsCount) {
            summaryDomainsCount.textContent = blockedDomains.length;
          }
        }
      }

      function renderDomainTags() {
        const domainTags = document.getElementById("domainTags");
        if (!domainTags) return;

        domainTags.innerHTML = "";

        blockedDomains.forEach((domain, index) => {
          const tag = document.createElement("div");
          tag.className = "domain-tag";
          tag.innerHTML = `
                    <span>${domain}</span>
                    <i class="fas fa-times" onclick="removeDomain(${index})"></i>
                `;
          domainTags.appendChild(tag);
        });
      }

      function removeDomain(index) {
        blockedDomains.splice(index, 1);
        renderDomainTags();
      }

      function nextStep() {
        if (currentStep === 1 && selectedAgents.size === 0) {
          alert("Please select at least one agent");
          return;
        }

        if (currentStep === 2 && !selectedPolicyType) {
          alert("Please select a policy type");
          return;
        }

        if (currentStep === 3) {
          if (!selectedPolicy) {
            alert("Please select a policy");
            return;
          }

          if (
            selectedPolicyType === "NETWORK" &&
            selectedPolicy === "NETWORK_DNS_BLOCK" &&
            blockedDomains.length === 0
          ) {
            alert("Please add at least one domain to block");
            return;
          }
        }

        currentStep++;
        updateStepDisplay();
      }

      function previousStep() {
        currentStep--;
        updateStepDisplay();
      }

      function updateStepDisplay() {
        document.getElementById("step1").style.display = "none";
        document.getElementById("step2").style.display = "none";
        document.getElementById("step3").style.display = "none";
        document.getElementById("step4").style.display = "none";

        document.getElementById(`step${currentStep}`).style.display = "block";

        document.querySelectorAll(".step").forEach((step, index) => {
          step.classList.remove("active", "completed");
          if (index + 1 < currentStep) {
            step.classList.add("completed");
            step.querySelector(".step-circle").innerHTML =
              '<i class="fas fa-check"></i>';
          } else if (index + 1 === currentStep) {
            step.classList.add("active");
            step.querySelector(".step-circle").textContent = index + 1;
          } else {
            step.querySelector(".step-circle").textContent = index + 1;
          }
        });

        document.getElementById("prevBtn").style.display =
          currentStep > 1 ? "flex" : "none";
        document.getElementById("nextBtn").style.display =
          currentStep < 4 ? "flex" : "none";
        document.getElementById("applyBtn").style.display =
          currentStep === 4 ? "flex" : "none";

        if (currentStep === 4) {
          updateSummary();
        }
      }

      function updateSummary() {
        document.getElementById("summaryAgentCount").textContent =
          selectedAgents.size;

        document.getElementById("summaryPolicyType").textContent =
          selectedPolicyType || "-";

        let policyName = "-";
        let appliedCount = 0;

        if (selectedPolicy && selectedPolicyType && selectedAgents.size > 0) {
          const firstAgentId = Array.from(selectedAgents)[0];
          const capabilities = agentsCapabilities[firstAgentId];
          if (capabilities && capabilities[selectedPolicyType]) {
            const policy = capabilities[selectedPolicyType].find(
              (p) => p.code === selectedPolicy
            );
            if (policy) {
              policyName = policy.name;

              appliedCount = 0;

              for (const agentId of selectedAgents) {
                const agentCapabilities = agentsCapabilities[agentId];
                const agentPolicy =
                  agentCapabilities &&
                  agentCapabilities[selectedPolicyType]?.find(
                    (p) => p.code === selectedPolicy
                  );
                if (agentPolicy && agentPolicy.isActive) {
                  appliedCount++;
                }
              }
            }
          }
        }

        document.getElementById("summaryPolicyName").textContent = policyName;

        const applyBtn = document.getElementById("applyBtn");
        if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
          applyBtn.innerHTML =
            '<i class="fas fa-times"></i><span>Remove Policy</span>';
          applyBtn.classList.remove("btn-primary", "btn-warning");
          applyBtn.classList.add("btn-danger");
        } else if (appliedCount > 0 && appliedCount < selectedAgents.size) {
          applyBtn.innerHTML =
            '<i class="fas fa-sync"></i><span>Update Policy</span>';
          applyBtn.classList.remove("btn-primary", "btn-danger");
          applyBtn.classList.add("btn-warning");
        } else {
          applyBtn.innerHTML =
            '<i class="fas fa-check"></i><span>Apply Policy</span>';
          applyBtn.classList.remove("btn-danger", "btn-warning");
          applyBtn.classList.add("btn-primary");
        }

        const alertBox = document.querySelector(".alert.alert-success");
        if (alertBox) {
          if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
            alertBox.innerHTML =
              '<i class="fas fa-info-circle"></i><span>This policy is already applied to all selected agents. Click "Remove Policy" to deactivate it.</span>';
            alertBox.className = "alert alert-info";
          } else if (appliedCount > 0) {
            alertBox.innerHTML = `<i class="fas fa-info-circle"></i><span>This policy is applied to ${appliedCount}/${selectedAgents.size} selected agents. Click "Update Policy" to apply to all.</span>`;
            alertBox.className = "alert alert-warning";
          } else {
            alertBox.innerHTML =
              '<i class="fas fa-check-circle"></i><span>The policy will be applied to all selected agents within 5 minutes.</span>';
            alertBox.className = "alert alert-success";
          }
        }

        const domainsContainer = document.getElementById(
          "summaryDomainsContainer"
        );

        if (selectedPolicy === "NETWORK_DNS_BLOCK") {
          if (blockedDomains.length > 0) {
            domainsContainer.style.display = "block";
            document.getElementById("summaryDomainsCount").textContent =
              blockedDomains.length;
            renderSummaryDomainTags();
          } else {
            domainsContainer.style.display = "none";
          }
        } else {
          if (domainsContainer) domainsContainer.style.display = "none";
        }
      }

      function renderSummaryDomainTags() {
        const domainTags = document.getElementById("summaryDomainTags");
        if (!domainTags) return;

        domainTags.innerHTML = "";
        if (blockedDomains.length === 0) {
          const emptyMsg = document.createElement("div");
          emptyMsg.style.color = "#6b7280";
          emptyMsg.style.fontStyle = "italic";
          emptyMsg.style.padding = "8px";
          emptyMsg.textContent = "No domains added";
          domainTags.appendChild(emptyMsg);
          return;
        }
        blockedDomains.forEach((domain, index) => {
          const tag = document.createElement("span");
          tag.className = "summary-domain-tag";
          tag.innerHTML = `
            <span>${domain}</span>
            <i class="fas fa-times" onclick="removeDomainFromSummary(${index})"></i>
        `;
          domainTags.appendChild(tag);
        });
      }

      function removeDomainFromSummary(index) {
        blockedDomains.splice(index, 1);

        renderDomainTags();
        renderSummaryDomainTags();

        const summaryDomainsCount =
          document.getElementById("summaryDomainsCount");
        if (summaryDomainsCount) {
          summaryDomainsCount.textContent = blockedDomains.length;
        }

        if (blockedDomains.length === 0) {
          const domainsContainer =
            document.getElementById("summaryDomainsContainer");
          if (domainsContainer) {
            domainsContainer.style.display = "none";
          }

          if (currentStep === 4) {
            const alertBox = document.querySelector(
              ".alert.alert-info, .alert.alert-success"
            );
            if (alertBox) {
              alertBox.innerHTML =
                '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';
              alertBox.className = "alert alert-warning";
            }
          }
        }
      }

      async function applyPolicy() {
        if (
          selectedAgents.size === 0 ||
          !selectedPolicyType ||
          !selectedPolicy
        ) {
          alert("Please complete all steps");
          return;
        }

        try {
          const agentIds = Array.from(selectedAgents);

          let appliedCount = 0;
          for (const agentId of selectedAgents) {
            const capabilities = agentsCapabilities[agentId];
            const policy =
              capabilities &&
              capabilities[selectedPolicyType]?.find(
                (p) => p.code === selectedPolicy
              );
            if (policy && policy.isActive) {
              appliedCount++;
            }
          }

          const isRemoving = appliedCount === selectedAgents.size;
          const isUpdating =
            appliedCount > 0 && appliedCount < selectedAgents.size;

          const firstAgentId = agentIds[0];
          const capabilities = agentsCapabilities[firstAgentId];
          const policyDetails =
            capabilities &&
            capabilities[selectedPolicyType]?.find(
              (p) => p.code === selectedPolicy
            );

          if (!policyDetails) {
            throw new Error("Could not find policy details");
          }

          const requestBody = {
            agentIds: agentIds,
            policyCode: selectedPolicy,
          };

          if (selectedPolicy === "NETWORK_DNS_BLOCK" && !isRemoving) {
            if (blockedDomains.length === 0) {
              alert("Please add at least one domain to block");
              return;
            }
            requestBody.policyData = JSON.stringify({
              domains: blockedDomains,
              ips: [],
            });
          }

          const endpoint = isRemoving
            ? "/api/admin/deactivate-protection"
            : "/api/admin/assign-protection";

          console.log("Applying policy:", requestBody);

          const response = await fetch(endpoint, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
            body: JSON.stringify(requestBody),
          });

          const result = await response.json();

          if (result.success) {
            const agentNames = agentIds
              .map((id) => {
                const agent = agentsBasicData[id];
                return agent ? agent.hostname || agent.username : `Agent ${id}`;
              })
              .filter((name) => name);

            let message = `âœ… ${result.message}\n\n`;
            message += `Agents: ${agentNames.join(", ")}\n`;
            message += `Policy: ${policyDetails.name}\n`;

            if (isRemoving) {
              message += `Action: Policy removed\n`;
            } else if (isUpdating) {
              message += `Action: Policy updated and applied to remaining agents\n`;
            } else {
              message += `Action: Policy applied\n`;
              if (
                selectedPolicy === "NETWORK_DNS_BLOCK" &&
                blockedDomains.length > 0
              ) {
                message += `Blocked Domains: ${blockedDomains.join(", ")}\n`;
              }
            }

            alert(message);

            for (const agentId of selectedAgents) {
              try {
                await fetchAgentDetails(agentId);
              } catch (error) {
                console.error(`Failed to refresh agent ${agentId}:`, error);
              }
            }

            if (isRemoving) {
              selectedAgents.clear();
              selectedPolicyType = "";
              selectedPolicy = "";
              blockedDomains = [];
              isEditingExistingPolicy = false;

              currentStep = 1;
              updateStepDisplay();
              await initializeAgentCards();
              updateSelectedCount();

              const alertBox = document.querySelector(".alert.alert-success");
              if (alertBox) {
                alertBox.innerHTML =
                  '<i class="fas fa-check-circle"></i><span>Policy removed successfully. Select new agents to continue.</span>';
                alertBox.className = "alert alert-success";
              }
            } else {
              setTimeout(() => {
                window.location.href = "file-policies.html";
              }, 2000);
            }
          } else {
            alert(
              `âŒ Failed to ${isRemoving ? "remove" : "apply"} policy: ${
                result.message
              }`
            );
          }
        } catch (error) {
          console.error("Error applying policy:", error);
          alert(
            `âŒ Error ${isRemoving ? "removing" : "applying"} policy: ${
              error.message
            }`
          );
        }
      }

      document.addEventListener("input", function (e) {
        if (e.target && e.target.id === "agentSearch") {
          const searchTerm = e.target.value.toLowerCase();
          const agentCards = document.querySelectorAll(".agent-card");

          agentCards.forEach((card) => {
            const text = card.textContent.toLowerCase();
            card.style.display = text.includes(searchTerm) ? "block" : "none";
          });
        }
      });

      /* ==================== EVENT LISTENERS ==================== */

      window.addEventListener("resize", function () {
        const sidebar = document.getElementById("sidebar");
        const mainContent = document.getElementById("mainContent");
        const header = document.getElementById("topHeader");
        const windowWidth = window.innerWidth;

        if (windowWidth <= 968) {
          if (sidebar) sidebar.classList.remove("collapsed");
          if (mainContent) mainContent.classList.remove("expanded");
          if (header) {
            header.style.left = "0";
          }
        } else {
          if (sidebar && mainContent && header) {
            if (sidebar.classList.contains("collapsed")) {
              mainContent.classList.add("expanded");
              header.style.left = "70px";
            } else {
              mainContent.classList.remove("expanded");
              header.style.left = "240px";
            }
          }
        }
      });

      window.addEventListener("sidebarToggle", function (event) {
        const header = document.getElementById("topHeader");
        const mainContent = document.getElementById("mainContent");

        if (header && mainContent) {
          if (event.detail.collapsed) {
            header.style.left = "70px";
            mainContent.classList.add("expanded");
          } else {
            header.style.left = "240px";
            mainContent.classList.remove("expanded");
          }
        }
      });

      document.addEventListener("click", function (e) {
        const sidebar = document.getElementById("sidebar");
        const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");

        if (sidebar && window.innerWidth <= 968) {
          if (
            !sidebar.contains(e.target) &&
            (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))
          ) {
            sidebar.classList.remove("mobile-open");
            const overlay = document.getElementById("sidebarOverlay");
            if (overlay) {
              overlay.classList.remove("active");
            }
          }
        }
      });

      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const userData = await checkAuth();
          if (userData) {
            loadAdminInfo();
          }

          setActiveMenuItem();

          await Promise.all([
            initializeAgentCards(),
            fetchAgentSimpleDetails(),
          ]);

          startStatusRefresh();

          const sidebar = document.getElementById("sidebar");
          const mainContent = document.getElementById("mainContent");
          const header = document.getElementById("topHeader");
          const windowWidth = window.innerWidth;

          if (sidebar && mainContent && header) {
            if (windowWidth <= 968) {
              mainContent.classList.remove("expanded");
              header.style.left = "0";
            } else {
              if (sidebar.classList.contains("collapsed")) {
                mainContent.classList.add("expanded");
                header.style.left = "70px";
              } else {
                mainContent.classList.remove("expanded");
                header.style.left = "240px";
              }
            }
          }
        } catch (error) {
          console.error("Error initializing page:", error);
        }
      });
    </script>
  </body>
</html> -->






<!-- usb,ocr and the network-->
<!-- <!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DLP Shield - Assign Policy</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* All your existing styles remain exactly the same */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        sans-serif;
      background: #f3f4f6;
      overflow-x: hidden;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
      max-width: 100vw;
      overflow-x: hidden;
    }

    .main-content {
      flex: 1;
      margin-left: 240px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
      max-width: calc(100vw - 240px);
      overflow-x: hidden;
    }

    .main-content.expanded {
      margin-left: 70px;
      max-width: calc(100vw - 70px);
    }

    .content-area {
      padding: 24px;
      padding-top: 100px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* ================ SIDEBAR STYLES ================ */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease;
      z-index: 1000;
      left: 0;
      top: 0;
      overflow: hidden;
    }

    .sidebar::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .sidebar-header {
      padding: 18px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .sidebar-logo {
      width: 38px;
      height: 38px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .sidebar-logo i {
      font-size: 20px;
      color: #2563eb;
    }

    .sidebar-title {
      font-size: 1.2em;
      font-weight: 700;
      white-space: nowrap;
      transition: opacity 0.2s, width 0.3s;
      overflow: hidden;
    }

    .nav-menu {
      padding: 12px 0;
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
    }

    .nav-item {
      margin: 2px 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.9em;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-link.active,
    .sub-menu-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-weight: 600;
    }

    .nav-link i:first-child {
      width: 20px;
      font-size: 0.95em;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .chevron-icon {
      margin-left: auto !important;
      font-size: 0.7em !important;
      transition: transform 0.3s;
      width: auto !important;
      flex-shrink: 0;
    }

    .nav-link.expanded .chevron-icon {
      transform: rotate(180deg);
    }

    .sub-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .sub-menu.open {
      max-height: 500px;
    }

    .sub-menu-item {
      display: flex;
      align-items: center;
      padding: 8px 12px 8px 42px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 0.85em;
      transition: all 0.2s;
      border-radius: 8px;
      margin: 2px 0;
      white-space: nowrap;
    }

    .sub-menu-item:hover {
      color: white;
      background: rgba(255, 255, 255, 0.08);
    }

    .sub-menu-item::before {
      content: "â€¢";
      margin-right: 10px;
      font-size: 1.2em;
    }

    .sidebar-footer {
      padding: 12px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .collapse-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 0.85em;
      transition: all 0.2s;
      white-space: nowrap;
      overflow: hidden;
    }

    .collapse-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .collapse-btn i {
      transition: transform 0.3s;
      flex-shrink: 0;
    }

    /* Sidebar collapsed state */
    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar.collapsed .sidebar-title {
      opacity: 0;
      width: 0;
    }

    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .collapse-btn span {
      display: none;
    }

    .sidebar.collapsed .sub-menu {
      display: none !important;
    }

    .sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 10px;
    }

    .sidebar.collapsed .nav-link i:first-child {
      margin-right: 0;
    }

    .sidebar.collapsed .chevron-icon {
      display: none;
    }

    .sidebar.collapsed .collapse-btn {
      justify-content: center;
    }

    .sidebar.collapsed .collapse-btn i {
      transform: rotate(180deg);
    }

    /* Mobile Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sidebar-overlay.active {
      display: block;
      opacity: 1;
    }

    /* ================ HEADER STYLES ================ */
    .top-header {
      background: white;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 500;
      gap: 16px;
      transition: left 0.3s ease;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.3em;
      cursor: pointer;
      padding: 8px;
      transition: color 0.2s;
    }

    .mobile-menu-toggle:hover {
      color: #111827;
    }

    .search-bar {
      flex: 1;
      max-width: 400px;
      position: relative;
    }

    .search-bar i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 0.9em;
    }

    .search-input {
      width: 100%;
      padding: 9px 14px 9px 38px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
      background: #f9fafb;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .notification-btn {
      position: relative;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.1em;
      cursor: pointer;
      padding: 8px;
      transition: all 0.2s;
      border-radius: 8px;
    }

    .notification-btn:hover {
      color: #111827;
      background: #f3f4f6;
    }

    .notification-btn.active {
      color: #2563eb;
      background: #eff6ff;
    }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #ef4444;
      color: white;
      font-size: 0.65em;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      padding: 0 4px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background 0.2s;
      position: relative;
    }

    .user-profile:hover {
      background: #f3f4f6;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.9em;
      flex-shrink: 0;
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
    }

    .user-role {
      font-size: 0.75em;
      color: #6b7280;
    }

    .dropdown-icon {
      color: #6b7280;
      font-size: 0.75em;
      margin-left: 4px;
      transition: transform 0.3s;
    }

    .user-profile.active .dropdown-icon {
      transform: rotate(180deg);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07),
        0 10px 15px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      color: #374151;
      text-decoration: none;
      font-size: 0.9em;
      transition: background 0.2s;
    }

    .dropdown-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .dropdown-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item:hover {
      background: #f3f4f6;
    }

    .dropdown-item i {
      width: 18px;
      color: #6b7280;
      font-size: 0.95em;
    }

    .dropdown-item.danger {
      color: #dc2626;
    }

    .dropdown-item.danger i {
      color: #dc2626;
    }

    .dropdown-divider {
      height: 1px;
      background: #e5e7eb;
      margin: 4px 0;
    }

    /* ================ NOTIFICATIONS PANEL ================ */
    .notifications-panel {
      position: fixed;
      top: 0;
      right: -50%;
      width: 50%;
      max-width: 600px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      display: flex;
      flex-direction: column;
      transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .notifications-panel.show {
      right: 0;
    }

    .notifications-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .notifications-header h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #111827;
    }

    .close-notifications {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.2em;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .close-notifications:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .notifications-tabs {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      padding: 0 24px;
      flex-shrink: 0;
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 0.9em;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: #111827;
    }

    .tab-btn.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .notifications-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px 0;
    }

    .notifications-content::-webkit-scrollbar {
      width: 6px;
    }

    .notifications-content::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 3px;
    }

    .notification-item {
      display: flex;
      gap: 12px;
      padding: 14px 24px;
      cursor: pointer;
      transition: background 0.2s;
      border-left: 3px solid transparent;
    }

    .notification-item:hover {
      background: #f9fafb;
    }

    .notification-item.unread {
      background: #eff6ff;
      border-left-color: #3b82f6;
    }

    .notification-item.unread:hover {
      background: #dbeafe;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      flex-shrink: 0;
    }

    .notification-icon.critical {
      background: #fee2e2;
      color: #dc2626;
    }

    .notification-icon.warning {
      background: #fef3c7;
      color: #f59e0b;
    }

    .notification-icon.info {
      background: #dbeafe;
      color: #3b82f6;
    }

    .notification-icon.success {
      background: #d1fae5;
      color: #10b981;
    }

    .notification-body {
      flex: 1;
    }

    .notification-title {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }

    .notification-text {
      font-size: 0.85em;
      color: #6b7280;
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .notification-time {
      font-size: 0.75em;
      color: #9ca3af;
    }

    .notification-dot {
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 8px;
    }

    .notification-item:not(.unread) .notification-dot {
      display: none;
    }

    .notifications-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e7eb;
      flex-shrink: 0;
    }

    .view-all-btn {
      display: block;
      width: 100%;
      padding: 10px;
      background: #f3f4f6;
      color: #2563eb;
      text-align: center;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.2s;
    }

    .view-all-btn:hover {
      background: #e5e7eb;
    }

    .notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .notification-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* Assign Policy Page Styles */
    .page-header {
      background: white;
      padding: 20px 24px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      margin-bottom: 24px;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .page-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-icon i {
      font-size: 22px;
      color: white;
    }

    .page-title-text h1 {
      font-size: 1.5em;
      color: #111827;
      font-weight: 700;
    }

    .page-subtitle {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 4px;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      font-size: 0.85em;
    }

    .breadcrumb a {
      color: #6b7280;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: #2563eb;
    }

    .breadcrumb span {
      color: #9ca3af;
    }

    .assign-container {
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 28px;
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 32px;
      position: relative;
    }

    .step-indicator::before {
      content: "";
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
      z-index: 0;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      position: relative;
      z-index: 1;
      flex: 1;
    }

    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: 2px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #9ca3af;
      transition: all 0.3s;
    }

    .step.active .step-circle {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
    }

    .step.completed .step-circle {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }

    .step-label {
      font-size: 0.85em;
      color: #6b7280;
      font-weight: 500;
    }

    .step.active .step-label {
      color: #2563eb;
      font-weight: 600;
    }

    .section {
      margin-bottom: 28px;
    }

    .section-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 16px;
    }

    .section-desc {
      font-size: 0.9em;
      color: #6b7280;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 0.9em;
      color: #374151;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-select {
      width: 100%;
      padding: 11px 14px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
      background: white;
      cursor: pointer;
    }

    .form-select:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .form-select:disabled {
      background: #f9fafb;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .search-box {
      position: relative;
      margin-bottom: 16px;
    }

    .search-box i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
    }

    .search-input {
      width: 100%;
      padding: 11px 14px 11px 42px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .search-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .agent-card {
      background: white;
      padding: 14px;
      border-radius: 8px;
      border: 1.5px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.2s;
    }

    .agent-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }

    .agent-card.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .agent-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .agent-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .agent-name {
      font-weight: 600;
      font-size: 0.9em;
      color: #111827;
      flex: 1;
    }

    .agent-status {
      font-size: 0.75em;
      padding: 3px 8px;
      border-radius: 4px;
    }

    .status-online {
      background: #d1fae5;
      color: #059669;
    }

    .status-offline {
      background: #f3f4f6;
      color: #6b7280;
    }

    .agent-info {
      font-size: 0.8em;
      color: #6b7280;
      display: flex;
      gap: 12px;
      margin-top: 6px;
    }

    .selected-count {
      background: #eff6ff;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid #bfdbfe;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .selected-count i {
      color: #2563eb;
    }

    .selected-count span {
      font-size: 0.9em;
      color: #1e40af;
      font-weight: 500;
    }

    .summary-box {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-label {
      font-size: 0.9em;
      color: #6b7280;
    }

    .summary-value {
      font-size: 0.9em;
      color: #111827;
      font-weight: 600;
    }

    .policy-preview {
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1.5px solid #3b82f6;
      margin-bottom: 16px;
    }

    .policy-preview-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .policy-preview-icon {
      width: 36px;
      height: 36px;
      background: #eff6ff;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2563eb;
    }

    .policy-preview-title {
      font-weight: 600;
      color: #111827;
    }

    .policy-preview-desc {
      font-size: 0.85em;
      color: #6b7280;
    }

    .domain-input-container {
      margin-top: 16px;
    }

    .domain-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .domain-input {
      flex: 1;
      padding: 10px 14px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .domain-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .btn-add-domain {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
    }

    .btn-add-domain:hover {
      background: #1d4ed8;
    }

    .domain-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .domain-tag {
      background: #eff6ff;
      color: #1e40af;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #bfdbfe;
    }

    .domain-tag i {
      cursor: pointer;
      color: #ef4444;
    }

    .domain-tag i:hover {
      color: #dc2626;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    .btn {
      padding: 11px 24px;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1.5px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    .alert {
      padding: 14px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .alert-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e40af;
    }

    .alert-success {
      background: #d1fae5;
      border: 1px solid #a7f3d0;
      color: #065f46;
    }

    .alert-warning {
      background: #fff3cd;
      border: 1px solid #ffeeba;
      color: #856404;
    }

    .alert i {
      font-size: 1.1em;
    }

    .loading {
      padding: 40px;
      text-align: center;
      color: #6b7280;
      font-style: italic;
    }

    .error {
      padding: 40px;
      text-align: center;
      color: #ef4444;
      background: #fee2e2;
      border-radius: 8px;
      border: 1px solid #fca5a5;
    }

    .summary-domain-tag {
      background: #eff6ff;
      color: #1e40af;
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 0.8em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #bfdbfe;
    }

    .summary-domain-tag i {
      cursor: pointer;
      color: #ef4444;
      font-size: 0.8em;
      transition: all 0.2s;
    }

    .summary-domain-tag i:hover {
      color: #dc2626;
      transform: scale(1.1);
    }

    #summaryDomainTags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 0;
    }

    /* Mobile responsive */
    @media (max-width: 1200px) {
      .main-content {
        margin-left: 70px;
        max-width: calc(100vw - 70px);
      }

      .main-content.expanded {
        margin-left: 70px;
        max-width: calc(100vw - 70px);
      }

      .top-header {
        left: 70px;
      }
    }

    @media (max-width: 968px) {
      .main-content {
        margin-left: 0;
        max-width: 100vw;
      }

      .top-header {
        left: 0;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .agents-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .content-area {
        padding: 16px;
        padding-top: 80px;
      }

      .notifications-panel {
        width: 90%;
        right: -90%;
      }

      .step-indicator {
        flex-direction: column;
        gap: 12px;
      }

      .step-indicator::before {
        display: none;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .user-info {
        display: none;
      }
    }

    @media (max-width: 640px) {
      .content-area {
        padding: 12px;
        padding-top: 70px;
      }

      .page-title-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .page-icon {
        width: 40px;
        height: 40px;
      }

      .page-icon i {
        font-size: 18px;
      }

      .page-title-text h1 {
        font-size: 1.3em;
      }

      .assign-container {
        padding: 16px;
      }
    }

    /* NEW: File Protection UI Styles */
    .file-explorer-container {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
      padding: 16px;
      margin-bottom: 20px;
    }

    .explorer-header {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .explorer-btn {
      padding: 8px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    .explorer-btn:hover {
      background: #1d4ed8;
    }

    .explorer-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .tree-container {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 12px;
      height: 300px;
      overflow-y: auto;
      background: white;
      font-family: monospace;
      font-size: 13px;
    }

    .tree-node {
      padding: 6px 8px;
      margin: 2px 0;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
      position: relative;
    }

    .tree-node:hover {
      background: #e8f0fe;
    }

    .tree-node.selected {
      background: #d2e3fc;
      border-left: 3px solid #2563eb;
    }

    .tree-node.protected {
      background: #fee2e2;
      border-left: 3px solid #dc2626;
    }

    .tree-node-icon {
      width: 20px;
      text-align: center;
    }

    .tree-node-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tree-node-badge {
      background: #dc2626;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 12px;
      margin-left: 8px;
      font-family: sans-serif;
    }

    .tree-node-children {
      margin-left: 24px;
      border-left: 1px dashed #ddd;
      padding-left: 12px;
    }

    .tree-node-expand {
      font-size: 10px;
      color: #6b7280;
      cursor: pointer;
      width: 16px;
      text-align: center;
    }

    .selected-path-info {
      background: #eff6ff;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #bfdbfe;
    }

    .path-label {
      font-size: 0.85em;
      color: #1e40af;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .path-value {
      font-family: monospace;
      font-size: 0.9em;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      word-break: break-all;
    }

    .operations-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 20px 0;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
    }

    .operation-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 6px;
      background: white;
      border: 1px solid #e5e7eb;
      transition: all 0.2s;
    }

    .operation-item.disabled {
      opacity: 0.5;
      background: #f3f4f6;
    }

    .operation-checkbox {
      width: 18px;
      height: 18px;
      margin-right: 12px;
      cursor: pointer;
    }

    .operation-label {
      flex: 1;
      font-weight: 500;
      font-size: 0.95em;
    }

    .operation-desc {
      font-size: 0.8em;
      color: #6b7280;
      margin-left: 8px;
    }

    .read-block-all {
      background: #fee2e2;
      border: 1px solid #fecaca;
      padding: 12px 16px;
      border-radius: 6px;
      margin-top: 12px;
      display: none;
      color: #991b1b;
      font-weight: 500;
      align-items: center;
      gap: 8px;
    }

    .read-block-all.active {
      display: flex;
    }

    /* Active Policies Section */
    .active-policies-section {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
      margin-top: 20px;
    }

    .policies-list {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      background: white;
    }

    .policy-item-small {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      margin: 6px 0;
      background: white;
      border-radius: 6px;
      border-left: 4px solid #2563eb;
      font-size: 0.9em;
    }

    .policy-item-small.block-all {
      border-left-color: #dc2626;
      background: #fee2e2;
    }

    .policy-info-compact {
      flex: 1;
    }

    .policy-name-compact {
      font-weight: 600;
      color: #111827;
    }

    .policy-details-compact {
      font-size: 0.85em;
      color: #6b7280;
      margin-top: 2px;
    }

    .policy-remove-btn {
      background: none;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .policy-remove-btn:hover {
      color: #dc2626;
      background: #fee2e2;
    }

    .remove-policy-container {
      margin-top: 20px;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #111827;
    }

    .modal-close {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.2em;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 20px 24px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      background: #10b981;
    }

    .toast.error {
      background: #ef4444;
    }

    .toast.warning {
      background: #f59e0b;
    }

    .toast.info {
      background: #3b82f6;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .mt-20 {
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- ==================== SIDEBAR ====================
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-shield-halved"></i>
        </div>
        <div class="sidebar-title">DLP Shield</div>
      </div>

      <nav class="nav-menu">
        <div class="nav-item">
          <a href="dashboard.html" class="nav-link" data-page="dashboard">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="alerts.html" class="nav-link" data-page="alerts">
            <i class="fas fa-triangle-exclamation"></i>
            <span>Alerts &amp; Incidents</span>
          </a>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">
            <i class="fas fa-shield-alt"></i>
            <span>Policies</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu open">
            <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>
            <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>
            <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>
          </div>
        </div>

        <div class="nav-item">
          <a href="agents.html" class="nav-link" data-page="agents">
            <i class="fas fa-desktop"></i>
            <span>Agents / Endpoints</span>
          </a>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-eye"></i>
            <span>OCR &amp; Image Analysis</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>
            <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-file-lines"></i>
            <span>Reports &amp; Logs</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>
            <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>
            <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>
            <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-users"></i>
            <span>Users &amp; Roles</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="users.html" class="sub-menu-item" data-page="users">Users</a>
            <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>
            <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-gear"></i>
            <span>Settings</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="general.html" class="sub-menu-item" data-page="general">General</a>
            <a href="security.html" class="sub-menu-item" data-page="security">Security</a>
            <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>
            <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="collapse-btn" onclick="toggleSidebar()">
          <i class="fas fa-chevron-left"></i>
          <span>Collapse</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Overlay (for sidebar)
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <!-- ==================== HEADER ==================== 
    <header class="top-header" id="topHeader">
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>

      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />
      </div>

      <div class="header-actions">
        <button class="notification-btn" onclick="toggleNotifications(event)">
          <i class="fas fa-bell"></i>
          <span class="notification-badge" id="alertBadge">5</span>
        </button>

        <div class="user-profile" onclick="toggleUserDropdown(event)">
          <div class="user-avatar">A</div>
          <div class="user-info">
            <div class="user-name">Admin</div>
            <div class="user-role">Security Admin</div>
          </div>
          <i class="fas fa-chevron-down dropdown-icon"></i>

          <div class="user-dropdown" id="userDropdown">
            <a href="general.html" class="dropdown-item">
              <i class="fas fa-gear"></i>
              <span>Settings</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-circle-question"></i>
              <span>Help &amp; Support</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="index.html" class="dropdown-item danger" onclick="logout(event)">
              <i class="fas fa-right-from-bracket"></i>
              <span>Sign out</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- ==================== NOTIFICATIONS PANEL ==================== 
    <div class="notifications-panel" id="notificationsPanel">
      <div class="notifications-header">
        <h3>Notifications</h3>
        <button class="close-notifications" onclick="closeNotifications()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="notifications-tabs">
        <button class="tab-btn active" onclick="switchTab(event, 'all')">
          All (5)
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'unread')">
          Unread (3)
        </button>
      </div>

      <div class="notifications-content" id="notificationsContent">
        <div class="notification-item unread">
          <div class="notification-icon critical">
            <i class="fas fa-shield-exclamation"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Critical Policy Violation</div>
            <div class="notification-text">
              User attempted to copy sensitive files to USB drive
            </div>
            <div class="notification-time">2 minutes ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
          <div class="notification-icon warning">
            <i class="fas fa-triangle-exclamation"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Agent Offline</div>
            <div class="notification-text">
              DESKTOP-DEF456 has been offline for 2 hours
            </div>
            <div class="notification-time">15 minutes ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
          <div class="notification-icon info">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Policy Updated</div>
            <div class="notification-text">
              File Protection Policy has been modified by Admin
            </div>
            <div class="notification-time">1 hour ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item">
          <div class="notification-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Agent Connected</div>
            <div class="notification-text">
              New agent LAPTOP-XYZ789 successfully registered
            </div>
            <div class="notification-time">3 hours ago</div>
          </div>
        </div>

        <div class="notification-item">
          <div class="notification-icon info">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Report Generated</div>
            <div class="notification-text">
              Weekly security report is ready for review
            </div>
            <div class="notification-time">5 hours ago</div>
          </div>
        </div>
      </div>

      <div class="notifications-footer">
        <a href="alerts.html" class="view-all-btn">View All Notifications</a>
      </div>
    </div>

    <!-- Notification Overlay
    <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>

    <main class="main-content" id="mainContent">
      <div class="content-area">
        <div class="breadcrumb">
          <a href="dashboard.html"><i class="fas fa-home"></i></a>
          <span>/</span>
          <a href="file-policies.html">Policies</a>
          <span>/</span>
          <span>Assign Policy</span>
        </div>

        <div class="page-header">
          <div class="page-title-section">
            <div class="page-icon"><i class="fas fa-user-shield"></i></div>
            <div class="page-title-text">
              <h1>Assign Policy to Agents</h1>
              <p class="page-subtitle">
                Select agents and assign protection policies
              </p>
            </div>
          </div>
        </div>

<<<<<<< HEAD
        <div class="assign-container">
          <div class="step-indicator">
            <div class="step active" data-step="1">
              <div class="step-circle">1</div>
              <div class="step-label">Choose Agent</div>
            </div>
            <div class="step" data-step="2">
              <div class="step-circle">2</div>
              <div class="step-label">Policy Type</div>
            </div>
            <div class="step" data-step="3">
              <div class="step-circle">3</div>
              <div class="step-label">Select Policy</div>
            </div>
            <div class="step" data-step="4">
              <div class="step-circle">4</div>
              <div class="step-label">Review & Apply</div>
            </div>
          </div>

          <!-- STEP 1: Choose Agent 
            <div class="section">
              <div class="section-title">Step 1: Choose Agent</div>
              <div class="section-desc">
                Select the agents you want to assign a policy to
              </div>

              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..."
                  id="agentSearch" />
              </div>

              <div class="selected-count" id="selectedCount">
                <i class="fas fa-check-circle"></i>
                <span>0 agents selected</span>
              </div>

              <div class="agents-grid" id="agentsGrid">
                <!-- Agent cards will be dynamically generated -->
</div>

<div class="alert alert-info">
  <i class="fas fa-info-circle"></i>
  <span>Select at least one agent to continue</span>
</div>
</div>
</div>

<!-- STEP 2: Policy Type 
          <div id="step2" style="display: none">
            <div class="section">
              <div class="section-title">Step 2: Select Policy Type</div>
              <div class="section-desc">
                Choose the type of policy you want to assign
              </div>

              <div class="form-group">
                <label class="form-label">Policy Type</label>
                <select class="form-select" id="policyType">
                  <option value="">-- Select Policy Type --</option>
                  <option value="network">Network Policy</option>
                  <option value="file">File Protection</option>
                  <option value="usb">USB</option>
                  <option value="ocr">OCR</option>
                </select>
              </div>

              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <span>Different policy types provide different protection
                  mechanisms</span>
              </div>
            </div>
          </div>

          <!-- STEP 3: Select Policy 
          <div id="step3" style="display: none">
            <div class="section">
              <div class="section-title">Step 3: Select Policy</div>
              <div class="section-desc">
                Choose the specific policy to assign
              </div>

              <div class="form-group">
                <label class="form-label">Available Policies</label>
                <select class="form-select" id="policySelect" disabled>
                  <option value="">-- Select a policy type first --</option>
                </select>
              </div>

              <!-- DNS Domain Input (for Network Policy) 
              <div id="dnsInputContainer" style="display: none">
                <div class="domain-input-container">
                  <label class="form-label">Block Domains</label>
                  <div class="domain-input-group">
                    <input type="text" class="domain-input" id="domainInput"
                      placeholder="Enter domain (e.g., www.example.com)" />
                    <button class="btn-add-domain" onclick="addDomain()">
                      <i class="fas fa-plus"></i> Add
                    </button>
                  </div>
                  <div class="domain-tags" id="domainTags">
                    <!-- Domain tags will appear here -->
</div>
</div>
</div>

<!-- ===== COMPREHENSIVE FILE PROTECTION UI ===== 
              <div id="fileProtectionUI" style="display: none;">
                <!-- Selected Path Info 
                <div class="selected-path-info" id="selectedPathInfo" style="display: none;">
                  <div class="path-label">Selected Path:</div>
                  <div class="path-value" id="selectedPathValue">-</div>
                </div>

                <!-- File Explorer 
                <div class="file-explorer-container">
                  <div class="explorer-header">
                    <button class="explorer-btn" id="btnGetDrives" onclick="getDrives()">
                      <i class="fas fa-hdd"></i> Get Drives
                    </button>
                    <button class="explorer-btn" id="btnRefresh" onclick="refreshExplorer()" disabled>
                      <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <div style="flex:1;"></div>
                    <button class="explorer-btn" id="btnClearSelection" onclick="clearSelection()">
                      <i class="fas fa-times"></i> Clear
                    </button>
                  </div>
                  <div class="tree-container" id="treeContainer">
                    <div class="loading">Click "Get Drives" to load file system</div>
                  </div>
                </div>

                <!-- Active Policies for Selected Node >
                <div class="active-policies-section" id="activePoliciesSection" style="display: none;">
                  <div class="section-title" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-shield-alt" style="color: #2563eb;"></i>
                    <span>Active Policies on Selected Resource</span>
                  </div>
                  <div class="policies-list" id="selectedNodePolicies">
                    <div class="loading">Loading policies...</div>
                  </div>
                  <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i>
                    <span>No active policies on this resource</span>
                  </div>
                </div>

                <!-- Remove Policy Container --
                <div class="remove-policy-container" id="removePolicyContainer" style="display: none;">
                  <div class="alert alert-warning"
                    style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span><strong>Policy Already Exists</strong> - This resource already has protection policies
                        applied.</span>
                    </div>
                    <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">
                      <i class="fas fa-trash-alt"></i> Remove Policy
                    </button>
                  </div>
                </div>

                <!-- Operations Selection --
                <div class="section-title mt-20">Block Operations</div>
                <div class="operations-list">
                  <div class="operation-item" id="read-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">
                    <div class="operation-label">READ</div>
                    <div class="operation-desc">Open, view, read content</div>
                  </div>
                  <div class="operation-item" id="write-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">
                    <div class="operation-label">WRITE</div>
                    <div class="operation-desc">Modify, edit, save changes</div>
                  </div>
                  <div class="operation-item" id="delete-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">
                    <div class="operation-label">DELETE</div>
                    <div class="operation-desc">Remove, trash, permanently delete</div>
                  </div>
                  <div class="operation-item" id="rename-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">
                    <div class="operation-label">RENAME</div>
                    <div class="operation-desc">Change name, move within volume</div>
                  </div>
                  <div class="operation-item" id="create-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">
                    <div class="operation-label">CREATE</div>
                    <div class="operation-desc">New file/folder creation (folders only)</div>
                  </div>
                </div>

                <div class="read-block-all" id="readBlockAllWarning">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>
                </div>
              </div>

              <!-- File Protection Info (Original Simple) --
              <div id="fileProtectionInfo" style="display: none">
                <div class="alert alert-info">
                  <i class="fas fa-shield-alt"></i>
                  <span>File Protection policy will block unauthorized file transfers</span>
                </div>
              </div>


              <!-- OCR Info --
              <div id="ocrInfo" style="display: none">
                <div class="alert alert-info">
                  <i class="fas fa-eye"></i>
                  <span>OCR policy will scan and analyze text in images and
                    documents</span>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 4: Review & Apply --
          <div id="step4" style="display: none">
            <div class="section">
              <div class="section-title">Step 4: Review & Apply</div>
              <div class="section-desc">
                Verify the policy assignment before applying
              </div>

              <div class="summary-box">
                <div class="summary-row">
                  <span class="summary-label">Agents Selected</span>
                  <span class="summary-value" id="summaryAgentCount">0</span>
                </div>

                <div class="summary-row">
                  <span class="summary-label">Policy Type</span>
                  <span class="summary-value" id="summaryPolicyType">-</span>
                </div>

                <div class="summary-row">
                  <span class="summary-label">Policy Name</span>
                  <span class="summary-value" id="summaryPolicyName">-</span>
                </div>

                <!-- File Protection Summary --
                <div id="fileSummaryContainer" style="display: none;">
                  <div class="summary-row">
                    <span class="summary-label">Protected Path</span>
                    <span class="summary-value" id="summaryPath">-</span>
                  </div>
                  <div class="summary-row">
                    <span class="summary-label">Resource Type</span>
                    <span class="summary-value" id="summaryResourceType">-</span>
                  </div>
                  <div class="summary-row">
                    <span class="summary-label">Blocked Operations</span>
                    <span class="summary-value" id="summaryOperations">-</span>
                  </div>
                  <div class="summary-row" id="summaryBlockAllRow" style="display: none;">
                    <span class="summary-label text-error">âš ï¸ Effect</span>
                    <span class="summary-value text-error">ALL ACCESS BLOCKED</span>
                  </div>
                </div>

                <!-- DNS Domains Summary with Remove Buttons --
                <div id="summaryDomainsContainer" style="display: none">
                  <div class="summary-row" style="border-bottom: none; padding-bottom: 5px">
                    <span class="summary-label">Blocked Domains</span>
                    <span class="summary-value" style="display: flex; align-items: center; gap: 10px">
                      <span id="summaryDomainsCount">0</span> domains
                    </span>
                  </div>
                  <div class="domain-tags" id="summaryDomainTags" style="
                        margin-top: 5px;
                        margin-bottom: 10px;
                        padding-left: 20px;
                      ">
                    <!-- Domain tags with remove buttons will appear here --
                  </div>
                </div>
              </div>

              <div class="alert alert-success" style="margin-top: 20px">
                <i class="fas fa-check-circle"></i>
                <span>The policy will be applied to all selected agents within 5
                  minutes.</span>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">
              <i class="fas fa-arrow-left"></i><span>Previous</span>
            </button>
            <button class="btn btn-secondary" onclick="window.location.href = 'file-policies.html'">
              <i class="fas fa-times"></i><span>Cancel</span>
            </button>
            <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">
              <span>Next</span><i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">
              <i class="fas fa-check"></i><span>Apply Policy</span>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>


    // ===== FILE EXPLORER VARIABLES =====
    let treeData = {};
    let selectedNode = null;
    let operations = {
      read: false,
      write: false,
      delete: false,
      rename: false,
      create: false
    };
    let activeNodePolicies = [];
    let policyToRemove = null;
    let currentlyExpanding = new Set();

    /* ==================== FILE EXPLORER FUNCTIONS ==================== */
    async function getDrives() {
      try {
        const treeContainer = document.getElementById('treeContainer');
        treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';

        const response = await fetch(`/api/admin/explorer/drives`);
        const data = await response.json();

        treeData = data;
        document.getElementById('btnRefresh').disabled = false;
        renderTree(data);
      } catch (error) {
        console.error('Failed to get drives:', error);
        document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';
      }
    }

    async function expandNode(node) {
      if (!node || node.expanded || currentlyExpanding.has(node.id)) {
        return;
      }

      currentlyExpanding.add(node.id);

      try {
        const response = await fetch(`/api/admin/explorer/nodes/${node.id}/expand`, { method: 'POST' });

        if (response.status === 409) {
          console.info(`Node already expanded: ${node.name}`);
          node.expanded = true;
          return;
        }

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        if (!Array.isArray(data)) {
          console.error('Invalid expand response:', data);
          return;
        }

        updateTreeWithChildren(node.id, data);
        node.expanded = true;

      } catch (error) {
        console.error('Expand failed:', error);
      } finally {
        currentlyExpanding.delete(node.id);
        renderTree(treeData);
      }
    }

    async function refreshExplorer() {
      if (!selectedNode) {
        await getDrives();
        return;
      }

      const node = findNode(treeData, selectedNode.id);
      if (!node) return;

      if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {
        node.expanded = false;
        node.children = [];
        renderTree(treeData);

        setTimeout(() => {
          expandNode(node);
        }, 200);
      }
    }

    function findNode(nodes, id) {
      for (const node of nodes) {
        if (node.id === id) return node;
        if (node.children) {
          const found = findNode(node.children, id);
          if (found) return found;
        }
      }
      return null;
    }

    function renderTree(data) {
      const treeContainer = document.getElementById('treeContainer');
      if (!treeContainer) return;

      treeContainer.innerHTML = '';

      if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {
        treeContainer.innerHTML = '<div class="loading">No items found</div>';
        return;
      }

      const items = Array.isArray(data) ? data : Object.values(data);
      items.forEach(item => {
        renderTreeNode(item, 0);
      });
    }

    function renderTreeNode(node, level) {
      const treeContainer = document.getElementById('treeContainer');
      const nodeEl = document.createElement('div');
      const isSelected = selectedNode && selectedNode.id === node.id;

      nodeEl.className = 'tree-node';
      if (isSelected) nodeEl.classList.add('selected');

      const indent = level * 20;
      nodeEl.style.paddingLeft = `${indent + 10}px`;

      if (node.type === 'folder' || node.type === 'drive') {
        const expandEl = document.createElement('div');
        expandEl.className = 'tree-node-expand';
        expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';
        expandEl.style.cursor = 'pointer';
        expandEl.style.marginRight = '5px';
        expandEl.style.fontSize = '12px';

        expandEl.addEventListener('click', function (e) {
          e.stopPropagation();
          toggleFolder(node);
        });

        nodeEl.appendChild(expandEl);
      } else {
        const spacer = document.createElement('div');
        spacer.style.width = '16px';
        spacer.style.display = 'inline-block';
        nodeEl.appendChild(spacer);
      }

      const iconEl = document.createElement('div');
      iconEl.className = 'tree-node-icon';
      iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';
      nodeEl.appendChild(iconEl);

      const nameEl = document.createElement('div');
      nameEl.className = 'tree-node-name';
      nameEl.textContent = node.name || 'Unnamed';
      nodeEl.appendChild(nameEl);

      nodeEl.addEventListener('click', function (e) {
        e.stopPropagation();
        selectNode(node);
      });

      treeContainer.appendChild(nodeEl);

      if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {
        node.children.forEach(child => {
          renderTreeNode(child, level + 1);
        });
      }
    }

    async function toggleFolder(node) {
      if (node.expanded) {
        try {
          await fetch(`/api/admin/explorer/nodes/${node.id}/collapse`, { method: 'POST' });
          node.expanded = false;
          node.children = [];
          renderTree(treeData);
        } catch (e) {
          console.error("Collapse failed", e);
        }
        return;
      }

      if (currentlyExpanding.has(node.id)) return;
      expandNode(node);
    }

    function selectNode(node) {
      selectedNode = node;

      document.getElementById('selectedPathInfo').style.display = 'block';
      document.getElementById('selectedPathValue').textContent = node.full_path || node.id;

      loadNodePolicies(node.id);

      const cbCreate = document.getElementById('cb-create');
      if (node.type === 'file') {
        operations.create = false;
        cbCreate.checked = false;
        cbCreate.disabled = true;
        document.getElementById('create-operation').classList.add('disabled');
      } else {
        cbCreate.disabled = false;
        document.getElementById('create-operation').classList.remove('disabled');
      }

      clearOperations();
      renderTree(treeData);
      updateNextButton();
    }

    function clearSelection() {
      selectedNode = null;
      document.getElementById('selectedPathInfo').style.display = 'none';
      document.getElementById('selectedPathValue').textContent = '-';
      clearOperations();
      renderTree(treeData);
    }

    function updateTreeWithChildren(parentId, children) {
      if (!Array.isArray(children)) {
        console.error("Children is not array:", children);
        return;
      }

      function updateNode(nodes) {
        for (let node of nodes) {
          if (!node) continue;

          if (node.id === parentId) {
            node.children = children;
            node.expanded = true;
            return true;
          }

          if (Array.isArray(node.children)) {
            if (updateNode(node.children)) return true;
          }
        }
        return false;
      }

      if (Array.isArray(treeData)) {
        updateNode(treeData);
      }
    }

    /* ==================== OPERATIONS FUNCTIONS ==================== */
    function initOperationCheckboxes() {
      const checkboxes = document.querySelectorAll('.operation-checkbox');
      checkboxes.forEach(cb => {
        cb.addEventListener('change', function () {
          const operation = this.getAttribute('data-operation');

          if (operation === 'read') {
            handleReadCheckboxChange(this.checked);
          } else {
            handleOperationChange(operation, this.checked);
          }

          updateNextButton();
        });
      });
    }

    function handleReadCheckboxChange(isChecked) {
      operations.read = isChecked;

      document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);

      if (isChecked) {
        const otherOperations = ['write', 'delete', 'rename', 'create'];
        otherOperations.forEach(op => {
          operations[op] = false;
          const cb = document.getElementById(`cb-${op}`);
          cb.checked = false;
          cb.disabled = true;
          document.getElementById(`${op}-operation`).classList.add('disabled');
        });
      } else {
        const otherOperations = ['write', 'delete', 'rename', 'create'];
        otherOperations.forEach(op => {
          const cb = document.getElementById(`cb-${op}`);
          cb.disabled = false;
          document.getElementById(`${op}-operation`).classList.remove('disabled');
        });

        if (selectedNode && selectedNode.type === 'file') {
          document.getElementById('cb-create').disabled = true;
          document.getElementById('create-operation').classList.add('disabled');
        }
      }
    }

    function handleOperationChange(operation, isChecked) {
      operations[operation] = isChecked;
    }

    function clearOperations() {
      Object.keys(operations).forEach(op => {
        operations[op] = false;
      });

      document.querySelectorAll('.operation-checkbox').forEach(cb => {
        cb.checked = false;
        cb.disabled = false;
      });

      document.querySelectorAll('.operation-item').forEach(item => {
        item.classList.remove('disabled');
      });

      document.getElementById('readBlockAllWarning').classList.remove('active');

      if (selectedNode && selectedNode.type === 'file') {
        document.getElementById('cb-create').disabled = true;
        document.getElementById('create-operation').classList.add('disabled');
      }
    }

    function updateNextButton() {
      const hasSelection = selectedNode !== null;
      const hasAnyOperationChecked = Object.values(operations).some(v => v);
      const nextBtn = document.getElementById('nextBtn');

      if (currentStep === 3 && selectedPolicyType === "FILE") {
        nextBtn.disabled = !hasSelection || !hasAnyOperationChecked;
      } else {
        nextBtn.disabled = false;
      }
    }

    /* ==================== ACTIVE POLICIES FUNCTIONS ==================== */
    async function loadNodePolicies(nodeId) {
      try {
        const response = await fetch(`/api/admin/policies`);
        if (!response.ok) throw new Error('Failed to load policies');

        const result = await response.json();

        let policiesArray = [];
        if (Array.isArray(result)) {
          policiesArray = result;
        } else if (result.data && Array.isArray(result.data)) {
          policiesArray = result.data;
        }

        activeNodePolicies = policiesArray.filter(p =>
          p.nodeId === nodeId || p.node_id === nodeId
        );

        const section = document.getElementById('activePoliciesSection');
        const policiesList = document.getElementById('selectedNodePolicies');
        const noPoliciesMsg = document.getElementById('noPoliciesMsg');
        const removeContainer = document.getElementById('removePolicyContainer');

        if (activeNodePolicies.length > 0) {
          section.style.display = 'block';
          removeContainer.style.display = 'block';
          noPoliciesMsg.style.display = 'none';

          policiesList.innerHTML = '';
          activeNodePolicies.forEach(policy => {
            const policyItem = document.createElement('div');
            policyItem.className = 'policy-item-small';

            const operations = policy.operations || {};
            const isBlockAll = operations.read === true;

            if (isBlockAll) {
              policyItem.classList.add('block-all');
            }

            const ops = [];
            if (operations.read === true) ops.push('READ');
            if (operations.write === true) ops.push('WRITE');
            if (operations.delete === true) ops.push('DELETE');
            if (operations.rename === true) ops.push('RENAME');
            if (operations.create === true) ops.push('CREATE');

            policyItem.innerHTML = `
                    <div class="policy-info-compact">
                        <div class="policy-name-compact">
                            ${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}
                        </div>
                        <div class="policy-details-compact">
                            Scope: ${policy.scope || 'file'} | ID: ${policy.id}
                        </div>
                    </div>
                    <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">
                        <i class="fas fa-times"></i>
                    </button>
                `;

            policiesList.appendChild(policyItem);
          });
        } else {
          section.style.display = 'block';
          removeContainer.style.display = 'none';
          noPoliciesMsg.style.display = 'flex';
          policiesList.innerHTML = '';
        }

      } catch (error) {
        console.error('Error loading node policies:', error);
      }
    }

    function showRemovePolicyModal() {
      if (activeNodePolicies.length === 0) return;

      if (activeNodePolicies.length > 1) {
        showPolicySelectionModal();
      } else {
        showRemovePolicyModalForPolicy(activeNodePolicies[0].id);
      }
    }

    function showPolicySelectionModal() {
      const modal = document.getElementById('removePolicyModal');
      const details = document.getElementById('removeModalDetails');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      const confirmInput = document.getElementById('removeConfirmInput');

      let html = '<p><strong>Multiple policies found:</strong></p>';
      html += '<div style="margin: 15px 0;">';

      activeNodePolicies.forEach(policy => {
        const operations = policy.operations || {};
        const ops = Object.entries(operations)
          .filter(([op, val]) => val)
          .map(([op]) => op.toUpperCase())
          .join(', ');

        html += `
            <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">
                <label for="policy_${policy.id}" style="flex: 1;">
                    <strong>Policy ID ${policy.id}</strong><br>
                    Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}
                </label>
            </div>
        `;
      });

      html += '</div>';
      html += '<p>Select a policy to remove:</p>';

      details.innerHTML = html;

      setTimeout(() => {
        const radios = document.querySelectorAll('input[name="policySelect"]');
        radios.forEach(radio => {
          radio.addEventListener('change', function () {
            policyToRemove = parseInt(this.value);
            updateRemoveConfirmButton();
          });
        });
      }, 100);

      confirmInput.value = '';
      confirmInput.disabled = false;
      confirmBtn.disabled = true;

      confirmInput.oninput = function () {
        updateRemoveConfirmButton();
      };

      modal.classList.add('active');
    }

    function showRemovePolicyModalForPolicy(policyId) {
      const policy = activeNodePolicies.find(p => p.id === policyId);
      if (!policy) return;

      policyToRemove = policyId;

      const modal = document.getElementById('removePolicyModal');
      const details = document.getElementById('removeModalDetails');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      const confirmInput = document.getElementById('removeConfirmInput');

      const operations = policy.operations || {};
      const ops = Object.entries(operations)
        .filter(([op, val]) => val)
        .map(([op]) => op.toUpperCase())
        .join(', ');

      details.innerHTML = `
        <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>
        <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>
        <div><strong>Policy ID:</strong> ${policy.id}</div>
        <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>
        <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>
    `;

      confirmInput.value = '';
      confirmBtn.disabled = true;

      confirmInput.oninput = function () {
        confirmBtn.disabled = this.value !== 'REMOVE';
      };

      modal.classList.add('active');
    }

    function updateRemoveConfirmButton() {
      const confirmInput = document.getElementById('removeConfirmInput');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;
    }

    function closeRemovePolicyModal() {
      document.getElementById('removePolicyModal').classList.remove('active');
      policyToRemove = null;
    }

    async function removeSelectedPolicy() {
      if (!policyToRemove) {
        closeRemovePolicyModal();
        return;
      }

      try {
        const response = await fetch(`/api/admin/policies/${policyToRemove}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error('Failed to remove policy');
        }

        showToast("Policy removed successfully!", "success");
        closeRemovePolicyModal();

        if (selectedNode) {
          await loadNodePolicies(selectedNode.id);
        }

      } catch (error) {
        console.error('Remove policy error:', error);
        showToast("Failed to remove policy: " + error.message, "error");
        closeRemovePolicyModal();
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;

      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }


    /* ==================== AUTHENTICATION & USER DATA ==================== */

    async function checkAuth() {
      try {
        const response = await fetch("/api/auth/check", {
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Not authenticated");
        }

        const result = await response.json();

        if (!result.success) {
          window.location.href = "index.html";
          return null;
        }

        // Store user data in localStorage
        if (result.data) {
          localStorage.setItem("userData", JSON.stringify(result.data));
          return result.data;
        }

        return null;
      } catch (err) {
        window.location.href = "index.html";
        return null;
      }
    }

    // Load admin info into header
    function loadAdminInfo() {
      const userDataStr = localStorage.getItem("userData");

      if (userDataStr) {
        try {
          const userData = JSON.parse(userDataStr);

          const userName = document.querySelector(".user-name");
          const userAvatar = document.querySelector(".user-avatar");
          const userRole = document.querySelector(".user-role");

          if (userName) {
            const namePart = userData.username || "Admin";
            const formattedName = namePart
              .split(".")
              .map((n) => n.charAt(0).toUpperCase() + n.slice(1))
              .join(" ");
            userName.textContent = formattedName;
          }

          if (userAvatar) {
            const namePart = userData.username || "Admin";
            const initials = namePart
              .split(".")
              .map((n) => (n[0] ? n[0].toUpperCase() : ""))
              .join("");
            userAvatar.textContent = initials || "A";
=======
    <script th:inline="javascript">
      /* ==================== AUTHENTICATION & USER DATA ==================== */

      // User data from server
    const userData = {
        username: [[${username}]],
        userName: [[${userName}]],
        userInitials: [[${userInitials}]],
        userRole: [[${userRole}]],
        userEmail: [[${userEmail}]],
        userId: [[${userId}]]
    };
    function loadAdminInfo() {
        const userName = document.querySelector(".user-name");
        const userAvatar = document.querySelector(".user-avatar");
        const userRole = document.querySelector(".user-role");
 
        if (userName && userData.userName) {
            userName.textContent = userData.userName;
        }
 
        if (userAvatar && userData.userInitials) {
            userAvatar.textContent = userData.userInitials;
        }
 
        if (userRole && userData.userRole) {
            userRole.textContent = userData.userRole;
        }
    }


      /* ==================== SIDEBAR FUNCTIONS ==================== */

      function toggleSubMenu(element) {
        var sidebar = document.getElementById("sidebar");
        if (sidebar.classList.contains("collapsed")) return;

        var subMenu = element.nextElementSibling;
        var allSubMenus = document.querySelectorAll(".sub-menu");
        var allDropdowns = document.querySelectorAll(".nav-dropdown");

        // Close other open submenus
        allSubMenus.forEach(function (menu) {
          if (menu !== subMenu) menu.classList.remove("open");
        });
        allDropdowns.forEach(function (link) {
          if (link !== element) link.classList.remove("expanded");
        });

        // Toggle current
        element.classList.toggle("expanded");
        subMenu.classList.toggle("open");
      }

      function toggleSidebar() {
        var sidebar = document.getElementById("sidebar");
        var mainContent = document.getElementById("mainContent");
        var header = document.getElementById("topHeader");

        sidebar.classList.toggle("collapsed");
        var isCollapsed = sidebar.classList.contains("collapsed");

        if (mainContent) mainContent.classList.toggle("expanded");

        // Update header left position
        if (header) {
          header.style.left = isCollapsed ? "70px" : "240px";
        }

        // Close all submenus when collapsing
        if (isCollapsed) {
          document.querySelectorAll(".sub-menu").forEach(function (m) {
            m.classList.remove("open");
          });
          document.querySelectorAll(".nav-dropdown").forEach(function (l) {
            l.classList.remove("expanded");
          });
        }

        // Dispatch event for other components
        window.dispatchEvent(
          new CustomEvent("sidebarToggle", {
            detail: { collapsed: isCollapsed },
          })
        );
      }

      function openMobileSidebar() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (sidebar) sidebar.classList.add("mobile-open");
        if (overlay) overlay.classList.add("active");
      }

      function closeMobileSidebar() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (sidebar) sidebar.classList.remove("mobile-open");
        if (overlay) overlay.classList.remove("active");
      }

      function toggleMobileMenu() {
        var sidebar = document.getElementById("sidebar");
        var overlay = document.getElementById("sidebarOverlay");
        if (!sidebar) return;

        if (sidebar.classList.contains("mobile-open")) {
          closeMobileSidebar();
        } else {
          openMobileSidebar();
        }
      }

      function setActiveMenuItem() {
        var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';
        
        // First remove all active classes
        document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {
          el.classList.remove('active');
        });

        // Handle sub-menu items
        document.querySelectorAll('.sub-menu-item[data-page]').forEach(function (item) {
          var href = item.getAttribute('href');
          if (href === currentPage) {
            item.classList.add('active');
            var parentSubMenu = item.closest('.sub-menu');
            if (parentSubMenu) {
              parentSubMenu.classList.add('open');
              var parentNav = parentSubMenu.previousElementSibling;
              if (parentNav) parentNav.classList.add('expanded');
            }
>>>>>>> 8d476d2a36a10307e0748cbf1f5ce139560af312
          }

          if (userRole) {
            userRole.textContent = userData.role || "Security Admin";
          }
        } catch (e) {
          console.error("Error parsing user data:", e);
        }
      }
    }

    async function refreshUserData() {
      const userData = await checkAuth();
      if (userData) {
        localStorage.setItem("userData", JSON.stringify(userData));
        loadAdminInfo();
      }
    }

    // Refresh every 5 minutes
    setInterval(refreshUserData, 5 * 60 * 1000);

    /* ==================== SIDEBAR FUNCTIONS ==================== */

    function toggleSubMenu(element) {
      var sidebar = document.getElementById("sidebar");
      if (sidebar.classList.contains("collapsed")) return;

      var subMenu = element.nextElementSibling;
      var allSubMenus = document.querySelectorAll(".sub-menu");
      var allDropdowns = document.querySelectorAll(".nav-dropdown");

      // Close other open submenus
      allSubMenus.forEach(function (menu) {
        if (menu !== subMenu) menu.classList.remove("open");
      });
      allDropdowns.forEach(function (link) {
        if (link !== element) link.classList.remove("expanded");
      });

      // Toggle current
      element.classList.toggle("expanded");
      subMenu.classList.toggle("open");
    }

    function toggleSidebar() {
      var sidebar = document.getElementById("sidebar");
      var mainContent = document.getElementById("mainContent");
      var header = document.getElementById("topHeader");

      sidebar.classList.toggle("collapsed");
      var isCollapsed = sidebar.classList.contains("collapsed");

      if (mainContent) mainContent.classList.toggle("expanded");

      // Update header left position
      if (header) {
        header.style.left = isCollapsed ? "70px" : "240px";
      }

      // Close all submenus when collapsing
      if (isCollapsed) {
        document.querySelectorAll(".sub-menu").forEach(function (m) {
          m.classList.remove("open");
        });
        document.querySelectorAll(".nav-dropdown").forEach(function (l) {
          l.classList.remove("expanded");
        });
      }

      // Dispatch event for other components
      window.dispatchEvent(
        new CustomEvent("sidebarToggle", {
          detail: { collapsed: isCollapsed },
        })
      );
    }

    function openMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.add("mobile-open");
      if (overlay) overlay.classList.add("active");
    }

    function closeMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.remove("mobile-open");
      if (overlay) overlay.classList.remove("active");
    }

    function toggleMobileMenu() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (!sidebar) return;

      if (sidebar.classList.contains("mobile-open")) {
        closeMobileSidebar();
      } else {
        openMobileSidebar();
      }
    }

    function setActiveMenuItem() {
      var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';

      // First remove all active classes
      document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function (el) {
        el.classList.remove('active');
      });

      // Handle sub-menu items
      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function (item) {
        var href = item.getAttribute('href');
        if (href === currentPage) {
          item.classList.add('active');
          var parentSubMenu = item.closest('.sub-menu');
          if (parentSubMenu) {
            parentSubMenu.classList.add('open');
            var parentNav = parentSubMenu.previousElementSibling;
            if (parentNav) parentNav.classList.add('expanded');
          }
        }
      });

      // Handle main nav links
      document.querySelectorAll('.nav-link[data-page]').forEach(function (link) {
        var href = link.getAttribute('href');
        if (href === currentPage) {
          link.classList.add('active');
        }
      });
    }

    /* ==================== HEADER FUNCTIONS ==================== */

    function toggleNotifications(event) {
      event.stopPropagation();
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = event.currentTarget;
      if (!panel || !overlay) return;

      if (panel.classList.contains("show")) {
        closeNotifications();
      } else {
        closeUserDropdown();
        panel.classList.add("show");
        overlay.classList.add("show");
        btn.classList.add("active");
        document.body.style.overflow = "hidden";
      }
    }

    function closeNotifications() {
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = document.querySelector(".notification-btn");
      if (panel) panel.classList.remove("show");
      if (overlay) overlay.classList.remove("show");
      if (btn) btn.classList.remove("active");
      document.body.style.overflow = "";
    }

    function switchTab(event, tabName) {
      document.querySelectorAll(".tab-btn").forEach(function (t) {
        t.classList.remove("active");
      });
      event.currentTarget.classList.add("active");

      document
        .querySelectorAll(".notification-item")
        .forEach(function (item) {
          item.style.display =
            tabName === "unread" && !item.classList.contains("unread")
              ? "none"
              : "flex";
        });
    }

    function toggleUserDropdown(event) {
      event.stopPropagation();
      var dropdown = document.getElementById("userDropdown");
      var userProfile = event.currentTarget;
      if (!dropdown) return;

      if (dropdown.classList.contains("show")) {
        closeUserDropdown();
      } else {
        closeNotifications();
        dropdown.classList.add("show");
        userProfile.classList.add("active");
      }
    }

    function closeUserDropdown() {
      var dropdown = document.getElementById("userDropdown");
      var userProfile = document.querySelector(".user-profile");
      if (dropdown) dropdown.classList.remove("show");
      if (userProfile) userProfile.classList.remove("active");
    }

    function logout(event) {
      event.preventDefault();
      window.location.href = "/logout";

    }

    // Close dropdowns when clicking outside
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".user-profile")) {
        closeUserDropdown();
      }
      if (
        !event.target.closest(".notification-btn") &&
        !event.target.closest(".notifications-panel")
      ) {
        closeNotifications();
      }
    });

    /* ==================== ASSIGN POLICY FUNCTIONS ==================== */

    let selectedAgents = new Set();
    let agentsBasicData = {};
    let agentsCapabilities = {};
    let currentStep = 1;
    let selectedPolicyType = "";
    let selectedPolicy = "";
    let blockedDomains = [];
    let isEditingExistingPolicy = false;
    let statusRefreshInterval;

    function startStatusRefresh() {
      if (statusRefreshInterval) {
        clearInterval(statusRefreshInterval);
      }

      // Refresh agent status every 30 seconds
      statusRefreshInterval = setInterval(async () => {
        console.log("Refreshing agent status...");
        await refreshAllAgents();
      }, 10000);
    }

    async function refreshAllAgents() {
      try {
        // Fetch fresh agent data
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Failed to fetch agents");
        }

        const result = await response.json();

        if (result.success && result.data) {
          const agents = result.data;

          // Update agentsBasicData with fresh data
          agents.forEach((agent) => {
            agentsBasicData[agent.id] = agent;
          });

          // Refresh the agent cards UI
          await initializeAgentCards();
        }
      } catch (error) {
        console.error("Error refreshing agents:", error);
      }
    }

    async function initializeAgentCards() {
      const agentsGrid = document.getElementById("agentsGrid");
      if (!agentsGrid) return;

      agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';

      try {
        // Fetch agents from API
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Failed to fetch agents");
        }

        const result = await response.json();

        if (!result.success || !result.data) {
          throw new Error(result.message || "No agents found");
        }

        const agents = result.data;
        agentsGrid.innerHTML = "";

        agents.forEach((agent) => {
          const agentCard = document.createElement("div");
          agentCard.className = "agent-card";
          agentCard.dataset.id = agent.id;
          agentCard.onclick = () => toggleAgent(agent.id);

          agentCard.innerHTML = `
                <div class="agent-card-header">
                    <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""
            }>
                    <div class="agent-name"> ${agent.username}</div>
                     <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"
            }">
                        ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}
                    </span>
                </div>
                <div class="agent-info">
                    <span><i class="fas fa-user"></i> ${agent.hostname || agent.username
            }</span>
                    <span><i class="fas fa-id-badge"></i> ${agent.id}</span>
                </div>
                <div class="agent-info">
                    <span><i class="fab fa-${getOSIcon(
              agent.osType
            )}"></i> ${agent.osType || "Unknown OS"}</span>
                    <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"
            }</span>
                </div>
            `;

          function isAgentOnline(agent) {
            if (
              agent.agentRuntimeState &&
              agent.agentRuntimeState.toUpperCase() === "ONLINE"
            ) {
              return true;
            }

            if (agent.lastHeartbeat) {
              const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();
              const now = new Date();
              const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);
              return diffMinutes <= 10;
            }

            return false;
          }

          agentsGrid.appendChild(agentCard);

          if (selectedAgents.has(agent.id)) {
            agentCard.classList.add("selected");
            agentCard.querySelector(".agent-checkbox").checked = true;
          }
        });
      } catch (error) {
        console.error("Error loading agents:", error);
        agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;
      }

      updateSelectedCount();
    }

    function getOSIcon(os) {
      if (!os) return "desktop";

      const osLower = os.toLowerCase();
      if (osLower.includes("windows")) return "windows";
      if (osLower.includes("macos") || osLower.includes("mac")) return "apple";
      if (osLower.includes("ubuntu") || osLower.includes("linux"))
        return "linux";
      return "desktop";
    }

    async function toggleAgent(agentId) {
      if (selectedAgents.has(agentId)) {
        selectedAgents.delete(agentId);
        delete agentsCapabilities[agentId];
      } else {
        selectedAgents.add(agentId);
        // Fetch agent capabilities if not already fetched
        if (!agentsCapabilities[agentId]) {
          try {
            await fetchAgentDetails(agentId);
            if (selectedPolicy === "NETWORK_DNS_BLOCK") {
              const capabilities = agentsCapabilities[agentId];
              if (capabilities && capabilities.NETWORK) {
                const policy = capabilities.NETWORK.find(
                  (p) => p.code === selectedPolicy
                );
                if (policy && policy.isActive) {
                  isEditingExistingPolicy = true;
                }
              }
            }
          } catch (error) {
            console.error(
              `Failed to fetch capabilities for agent ${agentId}:`,
              error
            );
            agentsCapabilities[agentId] = {};
          }
        }
      }

      const agentCard = document.querySelector(
        `.agent-card[data-id="${agentId}"]`
      );
      if (agentCard) {
        agentCard.classList.toggle("selected");
        const checkbox = agentCard.querySelector(".agent-checkbox");
        if (checkbox) {
          checkbox.checked = selectedAgents.has(agentId);
        }
      }

      updateSelectedCount();

      // Update policy types based on selected agents
      if (selectedAgents.size > 0) {
        updatePolicyTypes();
      }
    }

    async function fetchAgentDetails(agentId) {
      try {
        const response = await fetch(
          `/api/admin/agents/${agentId}/capabilities`,
          {
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          }
        );

        if (!response.ok) {
          throw new Error(
            `HTTP ${response.status}: Failed to fetch capabilities`
          );
        }

        const result = await response.json();

        if (result.success && result.data) {
          agentsCapabilities[agentId] = result.data;
        } else {
          throw new Error(result.message || "Failed to load capabilities");
        }
      } catch (error) {
        console.error(
          `Error fetching capabilities for agent ${agentId}:`,
          error
        );
        agentsCapabilities[agentId] = {};
        throw error;
      }
    }

    async function fetchAgentSimpleDetails() {
      try {
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) throw new Error("Failed to fetch agents");

        const result = await response.json();
        if (result.success && result.data) {
          result.data.forEach((agent) => {
            agentsBasicData[agent.id] = agent;
          });
        }
      } catch (error) {
        console.error("Error fetching agents:", error);
      }
    }

    async function updatePolicyTypes() {
      if (selectedAgents.size === 0) {
        const policyTypeSelect = document.getElementById("policyType");
        policyTypeSelect.innerHTML =
          '<option value="">-- Select Policy Type --</option>';
        selectedPolicyType = "";
        updatePolicySelect();
        return;
      }

      let commonCategories = null;

      for (const agentId of selectedAgents) {
        const capabilities = agentsCapabilities[agentId];

        if (capabilities && Object.keys(capabilities).length > 0) {
          const agentCategories = Object.keys(capabilities);

          if (commonCategories === null) {
            commonCategories = new Set(agentCategories);
          } else {
            commonCategories = new Set(
              [...commonCategories].filter((cat) =>
                agentCategories.includes(cat)
              )
            );
          }
        } else {
          commonCategories = new Set();
          break;
        }
      }

      const policyTypeSelect = document.getElementById("policyType");
      const currentValue = policyTypeSelect.value;

      policyTypeSelect.innerHTML =
        '<option value="">-- Select Policy Type --</option>';

      if (commonCategories && commonCategories.size > 0) {
        const sortedCategories = Array.from(commonCategories).sort();

        sortedCategories.forEach((category) => {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          policyTypeSelect.appendChild(option);
        });

        if (currentValue && commonCategories.has(currentValue)) {
          policyTypeSelect.value = currentValue;
          selectedPolicyType = currentValue;
        } else {
          selectedPolicyType = "";
        }
      } else {
        selectedPolicyType = "";
      }

      updatePolicySelect();
    }

    function updateSelectedCount() {
      const count = selectedAgents.size;
      const selectedCountElement = document.getElementById("selectedCount");
      if (selectedCountElement) {
        selectedCountElement.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <span>${count} agent${count !== 1 ? "s" : ""} selected</span>
                `;
      }
    }

    document.addEventListener("change", function (e) {
      if (e.target && e.target.id === "policyType") {
        selectedPolicyType = e.target.value;
        updatePolicySelect();
      }

      if (e.target && e.target.id === "policySelect") {
        selectedPolicy = e.target.value;
        updatePolicyOptions();
      }
    });

    function updatePolicySelect() {
      const policySelect = document.getElementById("policySelect");
      if (!policySelect) return;

      policySelect.innerHTML = '<option value="">-- Select Policy --</option>';

      if (selectedPolicyType && selectedAgents.size > 0) {
        let commonPolicies = null;
        let policyStatusMap = new Map();

        for (const agentId of selectedAgents) {
          const capabilities = agentsCapabilities[agentId];

          if (capabilities && capabilities[selectedPolicyType]) {
            const agentPolicies = capabilities[selectedPolicyType];

            if (!Array.isArray(agentPolicies)) {
              console.error(
                `Agent ${agentId}: Expected array for ${selectedPolicyType}, got:`,
                agentPolicies
              );
              commonPolicies = new Map();
              break;
            }

            if (commonPolicies === null) {
              commonPolicies = new Map();
              agentPolicies.forEach((policy) => {
                if (policy && policy.code) {
                  commonPolicies.set(policy.code, policy);
                  policyStatusMap.set(policy.code, {
                    [agentId]: policy.isActive || false,
                  });
                }
              });
            } else {
              const agentPolicyCodes = new Set(
                agentPolicies.map((p) => p?.code).filter((code) => code)
              );

              agentPolicies.forEach((policy) => {
                if (
                  policy &&
                  policy.code &&
                  policyStatusMap.has(policy.code)
                ) {
                  policyStatusMap.get(policy.code)[agentId] =
                    policy.isActive || false;
                }
              });

              commonPolicies = new Map(
                [...commonPolicies].filter(([code, policy]) =>
                  agentPolicyCodes.has(code)
                )
              );
            }
          } else {
            commonPolicies = new Map();
            break;
          }
        }

        if (commonPolicies && commonPolicies.size > 0) {
          policySelect.disabled = false;

          const sortedPolicies = Array.from(commonPolicies.values())
            .filter((policy) => policy && policy.name)
            .sort((a, b) => a.name.localeCompare(b.name));

          sortedPolicies.forEach((policy) => {
            const option = document.createElement("option");
            option.value = policy.code;

            const statusInfo = policyStatusMap.get(policy.code);
            let appliedCount = 0;
            if (statusInfo) {
              appliedCount = Object.values(statusInfo).filter(
                (isActive) => isActive
              ).length;
            }

            let statusText = "";
            if (appliedCount === selectedAgents.size) {
              statusText = " (Applied to all)";
            } else if (appliedCount > 0) {
              statusText = ` (Applied to ${appliedCount}/${selectedAgents.size})`;
            }

            option.textContent = policy.name + statusText;
            option.title = policy.description || "";
            option.dataset.isApplied = appliedCount === selectedAgents.size;

            policySelect.appendChild(option);
          });

          if (sortedPolicies.length > 0) {
            policySelect.value = sortedPolicies[0].code;
            selectedPolicy = sortedPolicies[0].code;
            updatePolicyAppliedStatus();
          }
        } else {
          policySelect.disabled = true;
          policySelect.innerHTML =
            '<option value="">No common policies available</option>';
          selectedPolicy = "";
        }
      } else {
        policySelect.disabled = true;
        policySelect.innerHTML =
          '<option value="">-- Select a policy type first --</option>';
        selectedPolicy = "";
      }

      updatePolicyOptions();
    }

    function updatePolicyAppliedStatus() {
      const policySelect = document.getElementById("policySelect");
      const selectedOption = policySelect.options[policySelect.selectedIndex];
      const isApplied = selectedOption
        ? selectedOption.dataset.isApplied === "true"
        : false;

      const nextBtn = document.getElementById("nextBtn");
      const applyBtn = document.getElementById("applyBtn");

      if (currentStep === 3 && isApplied) {
        nextBtn.innerHTML =
          '<span>Next</span><i class="fas fa-arrow-right"></i>';
      }
    }

    // function updatePolicyOptions() {
    //   const dnsContainer = document.getElementById("dnsInputContainer");
    //   const fileInfo = document.getElementById("fileProtectionInfo");
    //   const ocrInfo = document.getElementById("ocrInfo");
    //   const fileProtectionUI = document.getElementById("fileProtectionUI");
    //   const step3Desc = document.querySelector("#step3 .section-desc");

    //   if (dnsContainer) dnsContainer.style.display = "none";
    //   if (fileInfo) fileInfo.style.display = "none";
    //   if (ocrInfo) ocrInfo.style.display = "none";
    //   if (fileProtectionUI) fileProtectionUI.style.display = "none";

    //   if (!selectedPolicy || !selectedPolicyType) return;


    //   if (selectedPolicyType === "FILE") {
    //     if (fileProtectionUI) {
    //       fileProtectionUI.style.display = "block";
    //       step3Desc.textContent = "Select files/folders and choose operations to block";
    //       if (Object.keys(treeData).length === 0) {
    //         getDrives();
    //       }
    //     }
    //   } else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
    //     if (dnsContainer) dnsContainer.style.display = "block";

    //     if (selectedAgents.size === 1) {
    //       const agentId = Array.from(selectedAgents)[0];
    //       const capabilities = agentsCapabilities[agentId];
    //       if (capabilities && capabilities.NETWORK) {
    //         const policy = capabilities.NETWORK.find(
    //           (p) => p.code === selectedPolicy
    //         );
    //         if (policy && policy.policyData && policy.policyData !== "null") {
    //           try {
    //             const data = JSON.parse(policy.policyData);
    //             if (data.domains && Array.isArray(data.domains)) {
    //               blockedDomains = data.domains;
    //               isEditingExistingPolicy = true;
    //               console.log("Loaded domains:", blockedDomains);
    //             } else {
    //               blockedDomains = [];
    //               isEditingExistingPolicy = false;
    //             }
    //           } catch (e) {
    //             console.error("Error parsing policy data:", e);
    //             blockedDomains = [];
    //             isEditingExistingPolicy = false;
    //           }
    //         }
    //       }
    //     } else {
    //       blockedDomains = [];
    //       isEditingExistingPolicy = false;
    //     }
    //     renderDomainTags();
    //   } else if (selectedPolicyType === "FILE") {
    //     fileInfo.style.display = "block";
    //   } else if (selectedPolicyType === "SECURITY_MONITOR") {
    //     ocrInfo.style.display = "block";
    //   }
    // }

    function updatePolicyOptions() {
      const dnsContainer = document.getElementById("dnsInputContainer");
      const fileInfo = document.getElementById("fileProtectionInfo");
      const ocrInfo = document.getElementById("ocrInfo");
      const fileProtectionUI = document.getElementById("fileProtectionUI");
      const step3Desc = document.querySelector("#step3 .section-desc");

      if (dnsContainer) dnsContainer.style.display = "none";
      if (fileInfo) fileInfo.style.display = "none";
      if (ocrInfo) ocrInfo.style.display = "none";
      if (fileProtectionUI) fileProtectionUI.style.display = "none";

      if (!selectedPolicy || !selectedPolicyType) return;

      // Handle FILE policy type - show comprehensive UI
      if (selectedPolicyType === "FILE") {
        if (fileProtectionUI) {
          fileProtectionUI.style.display = "block";
          step3Desc.textContent = "Select files/folders and choose operations to block";
          if (Object.keys(treeData).length === 0) {
            getDrives();
          }
        }
      }
      // Handle NETWORK DNS BLOCK policy
      else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
        if (dnsContainer) dnsContainer.style.display = "block";

        if (selectedAgents.size === 1) {
          const agentId = Array.from(selectedAgents)[0];
          const capabilities = agentsCapabilities[agentId];
          if (capabilities && capabilities.NETWORK) {
            const policy = capabilities.NETWORK.find(
              (p) => p.code === selectedPolicy
            );
            if (policy && policy.policyData && policy.policyData !== "null") {
              try {
                const data = JSON.parse(policy.policyData);
                if (data.domains && Array.isArray(data.domains)) {
                  blockedDomains = data.domains;
                  isEditingExistingPolicy = true;
                  console.log("Loaded domains:", blockedDomains);
                } else {
                  blockedDomains = [];
                  isEditingExistingPolicy = false;
                }
              } catch (e) {
                console.error("Error parsing policy data:", e);
                blockedDomains = [];
                isEditingExistingPolicy = false;
              }
            }
          }
        } else {
          blockedDomains = [];
          isEditingExistingPolicy = false;
        }
        renderDomainTags();
      }
      // Handle SECURITY_MONITOR (OCR) policy
      else if (selectedPolicyType === "SECURITY_MONITOR") {
        ocrInfo.style.display = "block";
      }
    }

    function addDomain() {
      const domainInput = document.getElementById("domainInput");
      let domain = domainInput.value.trim();

      if (!domain) {
        alert("Please enter a domain name");
        return;
      }

      domain = domain.replace(/^https?:\/\//, "");
      domain = domain.replace(/\/$/, "");

      const domainLower = domain.toLowerCase();
      const exists = blockedDomains.some(
        (d) => d.toLowerCase() === domainLower
      );

      if (exists) {
        alert("Domain already added");
        return;
      }
      blockedDomains.push(domain);
      domainInput.value = "";

      renderDomainTags();

      if (currentStep === 4) {
        renderSummaryDomainTags();
        const summaryDomainsCount =
          document.getElementById("summaryDomainsCount");
        if (summaryDomainsCount) {
          summaryDomainsCount.textContent = blockedDomains.length;
        }
      }
    }

    function renderDomainTags() {
      const domainTags = document.getElementById("domainTags");
      if (!domainTags) return;

      domainTags.innerHTML = "";

      blockedDomains.forEach((domain, index) => {
        const tag = document.createElement("div");
        tag.className = "domain-tag";
        tag.innerHTML = `
                    <span>${domain}</span>
                    <i class="fas fa-times" onclick="removeDomain(${index})"></i>
                `;
        domainTags.appendChild(tag);
      });
    }

    function removeDomain(index) {
      blockedDomains.splice(index, 1);
      renderDomainTags();
    }

    function nextStep() {
      if (currentStep === 1 && selectedAgents.size === 0) {
        alert("Please select at least one agent");
        return;
      }

      if (currentStep === 2 && !selectedPolicyType) {
        alert("Please select a policy type");
        return;
      }

      if (currentStep === 3) {
        if (!selectedPolicy) {
          alert("Please select a policy");
          return;
        }

        if (
          selectedPolicyType === "NETWORK" &&
          selectedPolicy === "NETWORK_DNS_BLOCK" &&
          blockedDomains.length === 0
        ) {
          alert("Please add at least one domain to block");
          return;
        }
      }

      currentStep++;
      updateStepDisplay();
    }

    function previousStep() {
      currentStep--;
      updateStepDisplay();
    }

    function updateStepDisplay() {
      document.getElementById("step1").style.display = "none";
      document.getElementById("step2").style.display = "none";
      document.getElementById("step3").style.display = "none";
      document.getElementById("step4").style.display = "none";

      document.getElementById(`step${currentStep}`).style.display = "block";

      document.querySelectorAll(".step").forEach((step, index) => {
        step.classList.remove("active", "completed");
        if (index + 1 < currentStep) {
          step.classList.add("completed");
          step.querySelector(".step-circle").innerHTML =
            '<i class="fas fa-check"></i>';
        } else if (index + 1 === currentStep) {
          step.classList.add("active");
          step.querySelector(".step-circle").textContent = index + 1;
        } else {
          step.querySelector(".step-circle").textContent = index + 1;
        }
      });

      document.getElementById("prevBtn").style.display =
        currentStep > 1 ? "flex" : "none";
      document.getElementById("nextBtn").style.display =
        currentStep < 4 ? "flex" : "none";
      document.getElementById("applyBtn").style.display =
        currentStep === 4 ? "flex" : "none";

      if (currentStep === 4) {
        updateSummary();
      }
    }

    function updateSummary() {
      document.getElementById("summaryAgentCount").textContent =
        selectedAgents.size;

      document.getElementById("summaryPolicyType").textContent =
        selectedPolicyType || "-";

      let policyName = "-";
      let appliedCount = 0;

      if (selectedPolicy && selectedPolicyType && selectedAgents.size > 0) {
        const firstAgentId = Array.from(selectedAgents)[0];
        const capabilities = agentsCapabilities[firstAgentId];
        if (capabilities && capabilities[selectedPolicyType]) {
          const policy = capabilities[selectedPolicyType].find(
            (p) => p.code === selectedPolicy
          );
          if (policy) {
            policyName = policy.name;

            appliedCount = 0;

            for (const agentId of selectedAgents) {
              const agentCapabilities = agentsCapabilities[agentId];
              const agentPolicy =
                agentCapabilities &&
                agentCapabilities[selectedPolicyType]?.find(
                  (p) => p.code === selectedPolicy
                );
              if (agentPolicy && agentPolicy.isActive) {
                appliedCount++;
              }
            }
          }
        }
      }

      document.getElementById("summaryPolicyName").textContent = policyName;

      // Handle File Protection Summary
      if (selectedPolicyType === "FILE" && selectedNode) {
        document.getElementById("fileSummaryContainer").style.display = "block";
        document.getElementById("summaryDomainsContainer").style.display = "none";

        document.getElementById("summaryPath").textContent = selectedNode.full_path || selectedNode.id;
        document.getElementById("summaryResourceType").textContent = selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File';

        const blockedOps = Object.entries(operations)
          .filter(([op, checked]) => checked)
          .map(([op]) => op.toUpperCase())
          .join(', ');

        document.getElementById("summaryOperations").textContent = blockedOps || 'None';
        document.getElementById("summaryBlockAllRow").style.display = operations.read ? 'flex' : 'none';

      } else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
        document.getElementById("fileSummaryContainer").style.display = "none";
        document.getElementById("summaryDomainsContainer").style.display = "block";
        document.getElementById("summaryDomainsCount").textContent = blockedDomains.length;
        renderSummaryDomainTags();
      } else {
        document.getElementById("fileSummaryContainer").style.display = "none";
        document.getElementById("summaryDomainsContainer").style.display = "none";
      }


      const applyBtn = document.getElementById("applyBtn");
      if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
        applyBtn.innerHTML =
          '<i class="fas fa-times"></i><span>Remove Policy</span>';
        applyBtn.classList.remove("btn-primary", "btn-warning");
        applyBtn.classList.add("btn-danger");
      } else if (appliedCount > 0 && appliedCount < selectedAgents.size) {
        applyBtn.innerHTML =
          '<i class="fas fa-sync"></i><span>Update Policy</span>';
        applyBtn.classList.remove("btn-primary", "btn-danger");
        applyBtn.classList.add("btn-warning");
      } else {
        applyBtn.innerHTML =
          '<i class="fas fa-check"></i><span>Apply Policy</span>';
        applyBtn.classList.remove("btn-danger", "btn-warning");
        applyBtn.classList.add("btn-primary");
      }

      // Update alert message
      const alertBox = document.querySelector(".alert.alert-success");
      if (alertBox) {
        if (selectedPolicyType === "FILE" && selectedNode) {
          if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
            alertBox.innerHTML = '<i class="fas fa-info-circle"></i><span>This policy is already applied to all selected agents. Click "Remove Policy" to deactivate it.</span>';
            alertBox.className = "alert alert-info";
          } else if (appliedCount > 0) {
            alertBox.innerHTML = `<i class="fas fa-info-circle"></i><span>This policy is applied to ${appliedCount}/${selectedAgents.size} selected agents. Click "Update Policy" to apply to all.</span>`;
            alertBox.className = "alert alert-warning";
          } else {
            alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The file protection policy will be applied to all selected agents within 5 minutes.</span>';
            alertBox.className = "alert alert-success";
          }
        } else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
          if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
            alertBox.innerHTML = '<i class="fas fa-info-circle"></i><span>This policy is already applied to all selected agents. Click "Remove Policy" to deactivate it.</span>';
            alertBox.className = "alert alert-info";
          } else if (appliedCount > 0) {
            alertBox.innerHTML = `<i class="fas fa-info-circle"></i><span>This policy is applied to ${appliedCount}/${selectedAgents.size} selected agents. Click "Update Policy" to apply to all.</span>`;
            alertBox.className = "alert alert-warning";
          } else if (blockedDomains.length === 0) {
            alertBox.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';
            alertBox.className = "alert alert-warning";
          } else {
            alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The network policy will be applied to all selected agents within 5 minutes.</span>';
            alertBox.className = "alert alert-success";
          }
        } else {
          alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The policy will be applied to all selected agents within 5 minutes.</span>';
          alertBox.className = "alert alert-success";
        }
      }
    }

    function renderSummaryDomainTags() {
      const domainTags = document.getElementById("summaryDomainTags");
      if (!domainTags) return;

      domainTags.innerHTML = "";
      if (blockedDomains.length === 0) {
        const emptyMsg = document.createElement("div");
        emptyMsg.style.color = "#6b7280";
        emptyMsg.style.fontStyle = "italic";
        emptyMsg.style.padding = "8px";
        emptyMsg.textContent = "No domains added";
        domainTags.appendChild(emptyMsg);
        return;
      }
      blockedDomains.forEach((domain, index) => {
        const tag = document.createElement("span");
        tag.className = "summary-domain-tag";
        tag.innerHTML = `
            <span>${domain}</span>
            <i class="fas fa-times" onclick="removeDomainFromSummary(${index})"></i>
        `;
        domainTags.appendChild(tag);
      });
    }

    function removeDomainFromSummary(index) {
      blockedDomains.splice(index, 1);

      renderDomainTags();
      renderSummaryDomainTags();

      const summaryDomainsCount =
        document.getElementById("summaryDomainsCount");
      if (summaryDomainsCount) {
        summaryDomainsCount.textContent = blockedDomains.length;
      }

      if (blockedDomains.length === 0) {
        const domainsContainer =
          document.getElementById("summaryDomainsContainer");
        if (domainsContainer) {
          domainsContainer.style.display = "none";
        }

        if (currentStep === 4) {
          const alertBox = document.querySelector(
            ".alert.alert-info, .alert.alert-success"
          );
          if (alertBox) {
            alertBox.innerHTML =
              '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';
            alertBox.className = "alert alert-warning";
          }
        }
      }
    }

    async function applyPolicy() {
      if (
        selectedAgents.size === 0 ||
        !selectedPolicyType ||
        !selectedPolicy
      ) {
        alert("Please complete all steps");
        return;
      }

      try {
        const agentIds = Array.from(selectedAgents);

        let appliedCount = 0;
        for (const agentId of selectedAgents) {
          const capabilities = agentsCapabilities[agentId];
          const policy =
            capabilities &&
            capabilities[selectedPolicyType]?.find(
              (p) => p.code === selectedPolicy
            );
          if (policy && policy.isActive) {
            appliedCount++;
          }
        }

        const isRemoving = appliedCount === selectedAgents.size;
        const isUpdating =
          appliedCount > 0 && appliedCount < selectedAgents.size;

        const firstAgentId = agentIds[0];
        const capabilities = agentsCapabilities[firstAgentId];
        const policyDetails =
          capabilities &&
          capabilities[selectedPolicyType]?.find(
            (p) => p.code === selectedPolicy
          );

        if (!policyDetails) {
          throw new Error("Could not find policy details");
        }

        const requestBody = {
          agentIds: agentIds,
          policyCode: selectedPolicy,
        };

        if (selectedPolicy === "NETWORK_DNS_BLOCK" && !isRemoving) {
          if (blockedDomains.length === 0) {
            alert("Please add at least one domain to block");
            return;
          }
          requestBody.policyData = JSON.stringify({
            domains: blockedDomains,
            ips: [],
          });
        }

        const endpoint = isRemoving
          ? "/api/admin/deactivate-protection"
          : "/api/admin/assign-protection";

        console.log("Applying policy:", requestBody);

        const response = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify(requestBody),
        });

        const result = await response.json();

        if (result.success) {
          const agentNames = agentIds
            .map((id) => {
              const agent = agentsBasicData[id];
              return agent ? agent.hostname || agent.username : `Agent ${id}`;
            })
            .filter((name) => name);

          let message = `âœ… ${result.message}\n\n`;
          message += `Agents: ${agentNames.join(", ")}\n`;
          message += `Policy: ${policyDetails.name}\n`;

          if (isRemoving) {
            message += `Action: Policy removed\n`;
          } else if (isUpdating) {
            message += `Action: Policy updated and applied to remaining agents\n`;
          } else {
            message += `Action: Policy applied\n`;
            if (
              selectedPolicy === "NETWORK_DNS_BLOCK" &&
              blockedDomains.length > 0
            ) {
              message += `Blocked Domains: ${blockedDomains.join(", ")}\n`;
            }
          }

          alert(message);

          for (const agentId of selectedAgents) {
            try {
              await fetchAgentDetails(agentId);
            } catch (error) {
              console.error(`Failed to refresh agent ${agentId}:`, error);
            }
          }

          if (isRemoving) {
            selectedAgents.clear();
            selectedPolicyType = "";
            selectedPolicy = "";
            blockedDomains = [];
            isEditingExistingPolicy = false;

            currentStep = 1;
            updateStepDisplay();
            await initializeAgentCards();
            updateSelectedCount();

            const alertBox = document.querySelector(".alert.alert-success");
            if (alertBox) {
              alertBox.innerHTML =
                '<i class="fas fa-check-circle"></i><span>Policy removed successfully. Select new agents to continue.</span>';
              alertBox.className = "alert alert-success";
            }
          } else {
            setTimeout(() => {
              window.location.href = "file-policies.html";
            }, 2000);
          }
        } else {
          alert(
            `âŒ Failed to ${isRemoving ? "remove" : "apply"} policy: ${result.message
            }`
          );
        }
      } catch (error) {
        console.error("Error applying policy:", error);
        alert(
          `âŒ Error ${isRemoving ? "removing" : "applying"} policy: ${error.message
          }`
        );
      }
    }

    document.addEventListener("input", function (e) {
      if (e.target && e.target.id === "agentSearch") {
        const searchTerm = e.target.value.toLowerCase();
        const agentCards = document.querySelectorAll(".agent-card");

        agentCards.forEach((card) => {
          const text = card.textContent.toLowerCase();
          card.style.display = text.includes(searchTerm) ? "block" : "none";
        });
      }
    });

    /* ==================== EVENT LISTENERS ==================== */

    window.addEventListener("resize", function () {
      const sidebar = document.getElementById("sidebar");
      const mainContent = document.getElementById("mainContent");
      const header = document.getElementById("topHeader");
      const windowWidth = window.innerWidth;

      if (windowWidth <= 968) {
        if (sidebar) sidebar.classList.remove("collapsed");
        if (mainContent) mainContent.classList.remove("expanded");
        if (header) {
          header.style.left = "0";
        }
      } else {
        if (sidebar && mainContent && header) {
          if (sidebar.classList.contains("collapsed")) {
            mainContent.classList.add("expanded");
            header.style.left = "70px";
          } else {
            mainContent.classList.remove("expanded");
            header.style.left = "240px";
          }
        }
      }
    });

    window.addEventListener("sidebarToggle", function (event) {
      const header = document.getElementById("topHeader");
      const mainContent = document.getElementById("mainContent");

      if (header && mainContent) {
        if (event.detail.collapsed) {
          header.style.left = "70px";
          mainContent.classList.add("expanded");
        } else {
          header.style.left = "240px";
          mainContent.classList.remove("expanded");
        }
      }
    });

    document.addEventListener("click", function (e) {
      const sidebar = document.getElementById("sidebar");
      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");

      if (sidebar && window.innerWidth <= 968) {
        if (
          !sidebar.contains(e.target) &&
          (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))
        ) {
          sidebar.classList.remove("mobile-open");
          const overlay = document.getElementById("sidebarOverlay");
          if (overlay) {
            overlay.classList.remove("active");
          }
        }
      }
    });

    document.addEventListener("DOMContentLoaded", async function () {

      loadAdminInfo();

      setActiveMenuItem();
      initOperationCheckboxes();
      await Promise.all([
        initializeAgentCards(),
        fetchAgentSimpleDetails(),
      ]);

      startStatusRefresh();
    });

  </script>

  <!-- Remove Policy Modal --
  <div class="modal-overlay" id="removePolicyModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Remove Policy</h3>
        <button class="modal-close" onclick="closeRemovePolicyModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Type <strong>REMOVE</strong> to confirm policy removal:</p>
        <div style="margin: 15px 0;" id="removeModalDetails"></div>
        <input type="text" class="domain-input" id="removeConfirmInput" placeholder="Type REMOVE to confirm"
          style="width: 100%;">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRemovePolicyModal()">Cancel</button>
        <button class="btn btn-danger" onclick="removeSelectedPolicy()" id="confirmRemoveBtn" disabled>Remove
          Policy</button>
      </div>
    </div>
  </div>
</body>

</html>  

-->






























<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DLP Shield - Assign Policy</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* All your existing styles remain exactly the same */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        sans-serif;
      background: #f3f4f6;
      overflow-x: hidden;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
      max-width: 100vw;
      overflow-x: hidden;
    }

    .main-content {
      flex: 1;
      margin-left: 240px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
      max-width: calc(100vw - 240px);
      overflow-x: hidden;
    }

    .main-content.expanded {
      margin-left: 70px;
      max-width: calc(100vw - 70px);
    }

    .content-area {
      padding: 24px;
      /* padding-top: 100px; */
      /* max-width: 1400px; */
      margin: 0 auto;
    }

    /* ================ SIDEBAR STYLES ================ */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease;
      z-index: 1000;
      left: 0;
      top: 0;
      overflow: hidden;
    }

    .sidebar::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .sidebar-header {
      padding: 18px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .sidebar-logo {
      width: 38px;
      height: 38px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .sidebar-logo i {
      font-size: 20px;
      color: #2563eb;
    }

    .sidebar-title {
      font-size: 1.2em;
      font-weight: 700;
      white-space: nowrap;
      transition: opacity 0.2s, width 0.3s;
      overflow: hidden;
    }

    .nav-menu {
      padding: 12px 0;
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
    }

    .nav-item {
      margin: 2px 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.9em;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-link.active,
    .sub-menu-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-weight: 600;
    }

    .nav-link i:first-child {
      width: 20px;
      font-size: 0.95em;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .chevron-icon {
      margin-left: auto !important;
      font-size: 0.7em !important;
      transition: transform 0.3s;
      width: auto !important;
      flex-shrink: 0;
    }

    .nav-link.expanded .chevron-icon {
      transform: rotate(180deg);
    }

    .sub-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .sub-menu.open {
      max-height: 500px;
    }

    .sub-menu-item {
      display: flex;
      align-items: center;
      padding: 8px 12px 8px 42px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 0.85em;
      transition: all 0.2s;
      border-radius: 8px;
      margin: 2px 0;
      white-space: nowrap;
    }

    .sub-menu-item:hover {
      color: white;
      background: rgba(255, 255, 255, 0.08);
    }

    .sub-menu-item::before {
      content: "â€¢";
      margin-right: 10px;
      font-size: 1.2em;
    }

    .sidebar-footer {
      padding: 12px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .collapse-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 0.85em;
      transition: all 0.2s;
      white-space: nowrap;
      overflow: hidden;
    }

    .collapse-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .collapse-btn i {
      transition: transform 0.3s;
      flex-shrink: 0;
    }

    /* Sidebar collapsed state */
    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar.collapsed .sidebar-title {
      opacity: 0;
      width: 0;
    }

    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .collapse-btn span {
      display: none;
    }

    .sidebar.collapsed .sub-menu {
      display: none !important;
    }

    .sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 10px;
    }

    .sidebar.collapsed .nav-link i:first-child {
      margin-right: 0;
    }

    .sidebar.collapsed .chevron-icon {
      display: none;
    }

    .sidebar.collapsed .collapse-btn {
      justify-content: center;
    }

    .sidebar.collapsed .collapse-btn i {
      transform: rotate(180deg);
    }

    /* Mobile Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sidebar-overlay.active {
      display: block;
      opacity: 1;
    }

    /* ================ HEADER STYLES ================ */
    .top-header {
      background: white;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 500;
      gap: 16px;
      transition: left 0.3s ease;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.3em;
      cursor: pointer;
      padding: 8px;
      transition: color 0.2s;
    }

    .mobile-menu-toggle:hover {
      color: #111827;
    }

    .search-bar {
      flex: 1;
      max-width: 400px;
      position: relative;
    }

    .search-bar i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 0.9em;
    }

    .search-input {
      width: 100%;
      padding: 9px 14px 9px 38px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
      background: #f9fafb;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .notification-btn {
      position: relative;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.1em;
      cursor: pointer;
      padding: 8px;
      transition: all 0.2s;
      border-radius: 8px;
    }

    .notification-btn:hover {
      color: #111827;
      background: #f3f4f6;
    }

    .notification-btn.active {
      color: #2563eb;
      background: #eff6ff;
    }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #ef4444;
      color: white;
      font-size: 0.65em;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      padding: 0 4px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background 0.2s;
      position: relative;
    }

    .user-profile:hover {
      background: #f3f4f6;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.9em;
      flex-shrink: 0;
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
    }

    .user-role {
      font-size: 0.75em;
      color: #6b7280;
    }

    .dropdown-icon {
      color: #6b7280;
      font-size: 0.75em;
      margin-left: 4px;
      transition: transform 0.3s;
    }

    .user-profile.active .dropdown-icon {
      transform: rotate(180deg);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07),
        0 10px 15px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      color: #374151;
      text-decoration: none;
      font-size: 0.9em;
      transition: background 0.2s;
    }

    .dropdown-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .dropdown-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item:hover {
      background: #f3f4f6;
    }

    .dropdown-item i {
      width: 18px;
      color: #6b7280;
      font-size: 0.95em;
    }

    .dropdown-item.danger {
      color: #dc2626;
    }

    .dropdown-item.danger i {
      color: #dc2626;
    }

    .dropdown-divider {
      height: 1px;
      background: #e5e7eb;
      margin: 4px 0;
    }

    /* ================ NOTIFICATIONS PANEL ================ */
    .notifications-panel {
      position: fixed;
      top: 0;
      right: -50%;
      width: 50%;
      max-width: 600px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      display: flex;
      flex-direction: column;
      transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .notifications-panel.show {
      right: 0;
    }

    .notifications-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .notifications-header h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #111827;
    }

    .close-notifications {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.2em;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .close-notifications:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .notifications-tabs {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      padding: 0 24px;
      flex-shrink: 0;
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 0.9em;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: #111827;
    }

    .tab-btn.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .notifications-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px 0;
    }

    .notifications-content::-webkit-scrollbar {
      width: 6px;
    }

    .notifications-content::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 3px;
    }

    .notification-item {
      display: flex;
      gap: 12px;
      padding: 14px 24px;
      cursor: pointer;
      transition: background 0.2s;
      border-left: 3px solid transparent;
    }

    .notification-item:hover {
      background: #f9fafb;
    }

    .notification-item.unread {
      background: #eff6ff;
      border-left-color: #3b82f6;
    }

    .notification-item.unread:hover {
      background: #dbeafe;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      flex-shrink: 0;
    }

    .notification-icon.critical {
      background: #fee2e2;
      color: #dc2626;
    }

    .notification-icon.warning {
      background: #fef3c7;
      color: #f59e0b;
    }

    .notification-icon.info {
      background: #dbeafe;
      color: #3b82f6;
    }

    .notification-icon.success {
      background: #d1fae5;
      color: #10b981;
    }

    .notification-body {
      flex: 1;
    }

    .notification-title {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }

    .notification-text {
      font-size: 0.85em;
      color: #6b7280;
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .notification-time {
      font-size: 0.75em;
      color: #9ca3af;
    }

    .notification-dot {
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 8px;
    }

    .notification-item:not(.unread) .notification-dot {
      display: none;
    }

    .notifications-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e7eb;
      flex-shrink: 0;
    }

    .view-all-btn {
      display: block;
      width: 100%;
      padding: 10px;
      background: #f3f4f6;
      color: #2563eb;
      text-align: center;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.2s;
    }

    .view-all-btn:hover {
      background: #e5e7eb;
    }

    .notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .notification-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* Assign Policy Page Styles */
    .page-header {
      background: white;
      padding: 20px 24px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      margin-bottom: 24px;
    }

    .page-title-section {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .page-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-icon i {
      font-size: 22px;
      color: white;
    }

    .page-title-text h1 {
      font-size: 1.5em;
      color: #111827;
      font-weight: 700;
    }

    .page-subtitle {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 4px;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      font-size: 0.85em;
    }

    .breadcrumb a {
      color: #6b7280;
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: #2563eb;
    }

    .breadcrumb span {
      color: #9ca3af;
    }

    .assign-container {
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 28px;
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      margin-bottom: 32px;
      position: relative;
    }

    .step-indicator::before {
      content: "";
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
      z-index: 0;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      position: relative;
      z-index: 1;
      flex: 1;
    }

    .step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: white;
      border: 2px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #9ca3af;
      transition: all 0.3s;
    }

    .step.active .step-circle {
      background: #2563eb;
      border-color: #2563eb;
      color: white;
    }

    .step.completed .step-circle {
      background: #10b981;
      border-color: #10b981;
      color: white;
    }

    .step-label {
      font-size: 0.85em;
      color: #6b7280;
      font-weight: 500;
    }

    .step.active .step-label {
      color: #2563eb;
      font-weight: 600;
    }

    .section {
      margin-bottom: 28px;
    }

    .section-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 16px;
    }

    .section-desc {
      font-size: 0.9em;
      color: #6b7280;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 0.9em;
      color: #374151;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .form-select {
      width: 100%;
      padding: 11px 14px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
      background: white;
      cursor: pointer;
    }

    .form-select:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .form-select:disabled {
      background: #f9fafb;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .search-box {
      position: relative;
      margin-bottom: 16px;
    }

    .search-box i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
    }

    .search-input {
      width: 100%;
      padding: 11px 14px 11px 42px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .search-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .agent-card {
      background: white;
      padding: 14px;
      border-radius: 8px;
      border: 1.5px solid #e5e7eb;
      cursor: pointer;
      transition: all 0.2s;
    }

    .agent-card:hover {
      border-color: #3b82f6;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);
    }

    .agent-card.selected {
      border-color: #2563eb;
      background: #eff6ff;
    }

    .agent-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .agent-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .agent-name {
      font-weight: 600;
      font-size: 0.9em;
      color: #111827;
      flex: 1;
    }

    .agent-status {
      font-size: 0.75em;
      padding: 3px 8px;
      border-radius: 4px;
    }

    .status-online {
      background: #d1fae5;
      color: #059669;
    }

    .status-offline {
      background: #f3f4f6;
      color: #6b7280;
    }

    .agent-info {
      font-size: 0.8em;
      color: #6b7280;
      display: flex;
      gap: 12px;
      margin-top: 6px;
    }

    .selected-count {
      background: #eff6ff;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid #bfdbfe;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .selected-count i {
      color: #2563eb;
    }

    .selected-count span {
      font-size: 0.9em;
      color: #1e40af;
      font-weight: 500;
    }

    .summary-box {
      background: #f9fafb;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #e5e7eb;
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-label {
      font-size: 0.9em;
      color: #6b7280;
    }

    .summary-value {
      font-size: 0.9em;
      color: #111827;
      font-weight: 600;
    }

    .policy-preview {
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1.5px solid #3b82f6;
      margin-bottom: 16px;
    }

    .policy-preview-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .policy-preview-icon {
      width: 36px;
      height: 36px;
      background: #eff6ff;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #2563eb;
    }

    .policy-preview-title {
      font-weight: 600;
      color: #111827;
    }

    .policy-preview-desc {
      font-size: 0.85em;
      color: #6b7280;
    }

    .domain-input-container {
      margin-top: 16px;
    }

    .domain-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .domain-input {
      flex: 1;
      padding: 10px 14px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .domain-input:focus {
      outline: none;
      border-color: #3b82f6;
    }

    .btn-add-domain {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
    }

    .btn-add-domain:hover {
      background: #1d4ed8;
    }

    .domain-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .domain-tag {
      background: #eff6ff;
      color: #1e40af;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid #bfdbfe;
    }

    .domain-tag i {
      cursor: pointer;
      color: #ef4444;
    }

    .domain-tag i:hover {
      color: #dc2626;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    .btn {
      padding: 11px 24px;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1.5px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
    }

    .btn-warning:hover {
      background: #d97706;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-success:hover {
      background: #059669;
    }

    .alert {
      padding: 14px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .alert-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e40af;
    }

    .alert-success {
      background: #d1fae5;
      border: 1px solid #a7f3d0;
      color: #065f46;
    }

    .alert-warning {
      background: #fff3cd;
      border: 1px solid #ffeeba;
      color: #856404;
    }

    .alert i {
      font-size: 1.1em;
    }

    .loading {
      padding: 40px;
      text-align: center;
      color: #6b7280;
      font-style: italic;
    }

    .error {
      padding: 40px;
      text-align: center;
      color: #ef4444;
      background: #fee2e2;
      border-radius: 8px;
      border: 1px solid #fca5a5;
    }

    .summary-domain-tag {
      background: #eff6ff;
      color: #1e40af;
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 0.8em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #bfdbfe;
    }

    .summary-domain-tag i {
      cursor: pointer;
      color: #ef4444;
      font-size: 0.8em;
      transition: all 0.2s;
    }

    .summary-domain-tag i:hover {
      color: #dc2626;
      transform: scale(1.1);
    }

    #summaryDomainTags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 0;
    }

    /* NEW: File Protection UI Styles */
    .file-explorer-container {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #f9fafb;
      padding: 16px;
      margin-bottom: 20px;
    }

    .explorer-header {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .explorer-btn {
      padding: 8px 16px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    .explorer-btn:hover {
      background: #1d4ed8;
    }

    .explorer-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .tree-container {
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 12px;
      height: 300px;
      overflow-y: auto;
      background: white;
      font-family: monospace;
      font-size: 13px;
    }

    .tree-node {
      padding: 6px 8px;
      margin: 2px 0;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
      position: relative;
    }

    .tree-node:hover {
      background: #e8f0fe;
    }

    .tree-node.selected {
      background: #d2e3fc;
      border-left: 3px solid #2563eb;
    }

    .tree-node.protected {
      background: #fee2e2;
      border-left: 3px solid #dc2626;
    }

    .tree-node-icon {
      width: 20px;
      text-align: center;
    }

    .tree-node-name {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tree-node-badge {
      background: #dc2626;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 12px;
      margin-left: 8px;
      font-family: sans-serif;
    }

    .tree-node-children {
      margin-left: 24px;
      border-left: 1px dashed #ddd;
      padding-left: 12px;
    }

    .tree-node-expand {
      font-size: 10px;
      color: #6b7280;
      cursor: pointer;
      width: 16px;
      text-align: center;
    }

    .selected-path-info {
      background: #eff6ff;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #bfdbfe;
    }

    .path-label {
      font-size: 0.85em;
      color: #1e40af;
      font-weight: 500;
      margin-bottom: 4px;
    }

    .path-value {
      font-family: monospace;
      font-size: 0.9em;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      word-break: break-all;
    }

    .operations-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 20px 0;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
    }

    .operation-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      border-radius: 6px;
      background: white;
      border: 1px solid #e5e7eb;
      transition: all 0.2s;
    }

    .operation-item.disabled {
      opacity: 0.5;
      background: #f3f4f6;
    }

    .operation-checkbox {
      width: 18px;
      height: 18px;
      margin-right: 12px;
      cursor: pointer;
    }

    .operation-label {
      flex: 1;
      font-weight: 500;
      font-size: 0.95em;
    }

    .operation-desc {
      font-size: 0.8em;
      color: #6b7280;
      margin-left: 8px;
    }

    .read-block-all {
      background: #fee2e2;
      border: 1px solid #fecaca;
      padding: 12px 16px;
      border-radius: 6px;
      margin-top: 12px;
      display: none;
      color: #991b1b;
      font-weight: 500;
      align-items: center;
      gap: 8px;
    }

    .read-block-all.active {
      display: flex;
    }

    /* Active Policies Section */
    .active-policies-section {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
      margin-top: 20px;
    }

    .policies-list {
      max-height: 150px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      background: white;
    }

    .policy-item-small {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      margin: 6px 0;
      background: white;
      border-radius: 6px;
      border-left: 4px solid #2563eb;
      font-size: 0.9em;
    }

    .policy-item-small.block-all {
      border-left-color: #dc2626;
      background: #fee2e2;
    }

    .policy-info-compact {
      flex: 1;
    }

    .policy-name-compact {
      font-weight: 600;
      color: #111827;
    }

    .policy-details-compact {
      font-size: 0.85em;
      color: #6b7280;
      margin-top: 2px;
    }

    .policy-remove-btn {
      background: none;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .policy-remove-btn:hover {
      color: #dc2626;
      background: #fee2e2;
    }

    .remove-policy-container {
      margin-top: 20px;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #111827;
    }

    .modal-close {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.2em;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 20px 24px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      background: #10b981;
    }

    .toast.error {
      background: #ef4444;
    }

    .toast.warning {
      background: #f59e0b;
    }

    .toast.info {
      background: #3b82f6;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .mt-20 {
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- ==================== SIDEBAR ==================== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-shield-halved"></i>
        </div>
        <div class="sidebar-title">DLP Shield</div>
      </div>

      <nav class="nav-menu">
        <div class="nav-item">
          <a href="dashboard.html" class="nav-link" data-page="dashboard">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="alerts.html" class="nav-link" data-page="alerts">
            <i class="fas fa-triangle-exclamation"></i>
            <span>Alerts &amp; Incidents</span>
          </a>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">
            <i class="fas fa-shield-alt"></i>
            <span>Policies</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu open">
            <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>
            <!-- <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a> -->
            <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>
          </div>
        </div>

        <!-- <div class="nav-item">
          <a href="agents.html" class="nav-link" data-page="agents">
            <i class="fas fa-desktop"></i>
            <span>Agents / Endpoints</span>
          </a>
        </div> -->

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-eye"></i>
            <span>OCR &amp; Image Analysis</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>
            <!-- <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a> -->
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-file-lines"></i>
            <span>Reports &amp; Logs</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>
            <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>
            <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>
            <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-users"></i>
            <span>Users &amp; Roles</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="users.html" class="sub-menu-item" data-page="users">Users</a>
            <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>
            <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-gear"></i>
            <span>Settings</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="general.html" class="sub-menu-item" data-page="general">General</a>
            <a href="security.html" class="sub-menu-item" data-page="security">Security</a>
            <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>
            <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="collapse-btn" onclick="toggleSidebar()">
          <i class="fas fa-chevron-left"></i>
          <span>Collapse</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Overlay (for sidebar) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <!-- ==================== HEADER ==================== -->
    <header class="top-header" id="topHeader">
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>

      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />
      </div>

      <div class="header-actions">
        <button class="notification-btn" onclick="toggleNotifications(event)">
          <i class="fas fa-bell"></i>
          <span class="notification-badge" id="alertBadge">5</span>
        </button>

        <div class="user-profile" onclick="toggleUserDropdown(event)">
          <div class="user-avatar">[[${userInitials}]]</div>
          <div class="user-info">
            <div class="user-name">[[${userName}]]</div>
            <!-- <div class="user-role">[[${userRole}]]</div> -->
            <div id="userEmail">[[${userEmail}]]</div>
          </div>
          <i class="fas fa-chevron-down dropdown-icon"></i>

          <div class="user-dropdown" id="userDropdown">
            <a href="general.html" class="dropdown-item">
              <i class="fas fa-gear"></i>
              <span>Settings</span>
            </a>
            <a href="#" class="dropdown-item">
              <i class="fas fa-circle-question"></i>
              <span>Help &amp; Support</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="index.html" class="dropdown-item danger" onclick="logout(event)">
              <i class="fas fa-right-from-bracket"></i>
              <span>Sign out</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- ==================== NOTIFICATIONS PANEL ==================== -->
    <div class="notifications-panel" id="notificationsPanel">
      <div class="notifications-header">
        <h3>Notifications</h3>
        <button class="close-notifications" onclick="closeNotifications()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="notifications-tabs">
        <button class="tab-btn active" onclick="switchTab(event, 'all')">
          All (5)
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'unread')">
          Unread (3)
        </button>
      </div>

      <div class="notifications-content" id="notificationsContent">
        <div class="notification-item unread">
          <div class="notification-icon critical">
            <i class="fas fa-shield-exclamation"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Critical Policy Violation</div>
            <div class="notification-text">
              User attempted to copy sensitive files to USB drive
            </div>
            <div class="notification-time">2 minutes ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
          <div class="notification-icon warning">
            <i class="fas fa-triangle-exclamation"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Agent Offline</div>
            <div class="notification-text">
              DESKTOP-DEF456 has been offline for 2 hours
            </div>
            <div class="notification-time">15 minutes ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item unread">
          <div class="notification-icon info">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Policy Updated</div>
            <div class="notification-text">
              File Protection Policy has been modified by Admin
            </div>
            <div class="notification-time">1 hour ago</div>
          </div>
          <div class="notification-dot"></div>
        </div>

        <div class="notification-item">
          <div class="notification-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Agent Connected</div>
            <div class="notification-text">
              New agent LAPTOP-XYZ789 successfully registered
            </div>
            <div class="notification-time">3 hours ago</div>
          </div>
        </div>

        <div class="notification-item">
          <div class="notification-icon info">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="notification-body">
            <div class="notification-title">Report Generated</div>
            <div class="notification-text">
              Weekly security report is ready for review
            </div>
            <div class="notification-time">5 hours ago</div>
          </div>
        </div>
      </div>

      <div class="notifications-footer">
        <a href="alerts.html" class="view-all-btn">View All Notifications</a>
      </div>
    </div>

    <!-- Notification Overlay -->
    <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>

    <main class="main-content" id="mainContent">
      <div class="content-area">
        <div class="breadcrumb">
          <a href="dashboard.html"><i class="fas fa-home"></i></a>
          <span>/</span>
          <a href="file-policies.html">Policies</a>
          <span>/</span>
          <span>Assign Policy</span>
        </div>

        <div class="page-header">
          <div class="page-title-section">
            <div class="page-icon"><i class="fas fa-user-shield"></i></div>
            <div class="page-title-text">
              <h1>Assign Policy to Agents</h1>
              <p class="page-subtitle">
                Select agents and assign protection policies
              </p>
            </div>
          </div>
        </div>

        <div class="assign-container">
          <div class="step-indicator">
            <div class="step active" data-step="1">
              <div class="step-circle">1</div>
              <div class="step-label">Choose Agent</div>
            </div>
            <div class="step" data-step="2">
              <div class="step-circle">2</div>
              <div class="step-label">Policy Type</div>
            </div>
            <div class="step" data-step="3">
              <div class="step-circle">3</div>
              <div class="step-label">Select Policy</div>
            </div>
            <div class="step" data-step="4">
              <div class="step-circle">4</div>
              <div class="step-label">Review & Apply</div>
            </div>
          </div>

          <!-- STEP 1: Choose Agent -->
          <div id="step1">
            <div class="section">
              <div class="section-title">Step 1: Choose Agent</div>
              <div class="section-desc">
                Select the agents you want to assign a policy to
              </div>

              <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..."
                  id="agentSearch" />
              </div>

              <div class="selected-count" id="selectedCount">
                <i class="fas fa-check-circle"></i>
                <span>0 agents selected</span>
              </div>

              <div class="agents-grid" id="agentsGrid">
                <!-- Agent cards will be dynamically generated -->
              </div>

              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <span>Select at least one agent to continue</span>
              </div>
            </div>
          </div>

          <!-- STEP 2: Policy Type -->
          <div id="step2" style="display: none">
            <div class="section">
              <div class="section-title">Step 2: Select Policy Type</div>
              <div class="section-desc">
                Choose the type of policy you want to assign
              </div>

              <div class="form-group">
                <label class="form-label">Policy Type</label>
                <select class="form-select" id="policyType">
                  <option value="">-- Select Policy Type --</option>
                  <option value="network">Network Policy</option>
                  <option value="file">File Protection</option>
                  <option value="usb">USB</option>
                  <option value="ocr">OCR</option>
                </select>
              </div>

              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <span>Different policy types provide different protection
                  mechanisms</span>
              </div>
            </div>
          </div>

          <!-- STEP 3: Select Policy -->
          <div id="step3" style="display: none">
            <div class="section">
              <div class="section-title">Step 3: Select Policy</div>
              <div class="section-desc">
                Choose the specific policy to assign
              </div>

              <div class="form-group">
                <label class="form-label">Available Policies</label>
                <select class="form-select" id="policySelect" disabled>
                  <option value="">-- Select a policy type first --</option>
                </select>
              </div>

              <!-- DNS Domain Input (for Network Policy) -->
              <div id="dnsInputContainer" style="display: none">
                <div class="domain-input-container">
                  <label class="form-label">Block Domains</label>
                  <div class="domain-input-group">
                    <input type="text" class="domain-input" id="domainInput"
                      placeholder="Enter domain (e.g., www.example.com)" />
                    <button class="btn-add-domain" onclick="addDomain()">
                      <i class="fas fa-plus"></i> Add
                    </button>
                  </div>
                  <div class="domain-tags" id="domainTags">
                    <!-- Domain tags will appear here -->
                  </div>
                </div>
              </div>

              <!-- ===== COMPREHENSIVE FILE PROTECTION UI ===== -->
              <div id="fileProtectionUI" style="display: none;">
                <!-- Selected Path Info -->
                <div class="selected-path-info" id="selectedPathInfo" style="display: none;">
                  <div class="path-label">Selected Path:</div>
                  <div class="path-value" id="selectedPathValue">-</div>
                </div>

                <!-- File Explorer -->
                <div class="file-explorer-container">
                  <div class="explorer-header">
                    <button class="explorer-btn" id="btnGetDrives" onclick="getDrives()">
                      <i class="fas fa-hdd"></i> Get Drives
                    </button>
                    <button class="explorer-btn" id="btnRefresh" onclick="refreshExplorer()" disabled>
                      <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <div style="flex:1;"></div>
                    <button class="explorer-btn" id="btnClearSelection" onclick="clearSelection()">
                      <i class="fas fa-times"></i> Clear
                    </button>
                  </div>
                  <div class="tree-container" id="treeContainer">
                    <div class="loading">Click "Get Drives" to load file system</div>
                  </div>
                </div>

                <!-- Active Policies for Selected Node -->
                <div class="active-policies-section" id="activePoliciesSection" style="display: none;">
                  <div class="section-title" style="display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-shield-alt" style="color: #2563eb;"></i>
                    <span>Active Policies on Selected Resource</span>
                  </div>
                  <div class="policies-list" id="selectedNodePolicies">
                    <div class="loading">Loading policies...</div>
                  </div>
                  <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i>
                    <span>No active policies on this resource</span>
                  </div>
                </div>

                <!-- Remove Policy Container -->
                <div class="remove-policy-container" id="removePolicyContainer" style="display: none;">
                  <div class="alert alert-warning"
                    style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                      <i class="fas fa-exclamation-triangle"></i>
                      <span><strong>Policy Already Exists</strong> - This resource already has protection policies
                        applied.</span>
                    </div>
                    <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">
                      <i class="fas fa-trash-alt"></i> Remove Policy
                    </button>
                  </div>
                </div>

                <!-- Operations Selection -->
                <div class="section-title mt-20">Block Operations</div>
                <div class="operations-list">
                  <div class="operation-item" id="read-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">
                    <div class="operation-label">READ</div>
                    <div class="operation-desc">Open, view, read content</div>
                  </div>
                  <div class="operation-item" id="write-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">
                    <div class="operation-label">WRITE</div>
                    <div class="operation-desc">Modify, edit, save changes</div>
                  </div>
                  <div class="operation-item" id="delete-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">
                    <div class="operation-label">DELETE</div>
                    <div class="operation-desc">Remove, trash, permanently delete</div>
                  </div>
                  <div class="operation-item" id="rename-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">
                    <div class="operation-label">RENAME</div>
                    <div class="operation-desc">Change name, move within volume</div>
                  </div>
                  <div class="operation-item" id="create-operation">
                    <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">
                    <div class="operation-label">CREATE</div>
                    <div class="operation-desc">New file/folder creation (folders only)</div>
                  </div>
                </div>

                <div class="read-block-all" id="readBlockAllWarning">
                  <i class="fas fa-exclamation-triangle"></i>
                  <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>
                </div>
              </div>

              <!-- File Protection Info (Original Simple) -->
              <div id="fileProtectionInfo" style="display: none">
                <div class="alert alert-info">
                  <i class="fas fa-shield-alt"></i>
                  <span>File Protection policy will block unauthorized file transfers</span>
                </div>
              </div>


              <!-- OCR Info -->
              <div id="ocrInfo" style="display: none">
                <div class="alert alert-info">
                  <i class="fas fa-eye"></i>
                  <span>OCR policy will scan and analyze text in images and
                    documents</span>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 4: Review & Apply -->
          <div id="step4" style="display: none">
            <div class="section">
              <div class="section-title">Step 4: Review & Apply</div>
              <div class="section-desc">
                Verify the policy assignment before applying
              </div>

              <div class="summary-box">
                <div class="summary-row">
                  <span class="summary-label">Agents Selected</span>
                  <span class="summary-value" id="summaryAgentCount">0</span>
                </div>

                <div class="summary-row">
                  <span class="summary-label">Policy Type</span>
                  <span class="summary-value" id="summaryPolicyType">-</span>
                </div>

                <div class="summary-row">
                  <span class="summary-label">Policy Name</span>
                  <span class="summary-value" id="summaryPolicyName">-</span>
                </div>

                <!-- File Protection Summary -->
                <div id="fileSummaryContainer" style="display: none;">
                  <div class="summary-row">
                    <span class="summary-label">Protected Path</span>
                    <span class="summary-value" id="summaryPath">-</span>
                  </div>
                  <div class="summary-row">
                    <span class="summary-label">Resource Type</span>
                    <span class="summary-value" id="summaryResourceType">-</span>
                  </div>
                  <div class="summary-row">
                    <span class="summary-label">Blocked Operations</span>
                    <span class="summary-value" id="summaryOperations">-</span>
                  </div>
                  <div class="summary-row" id="summaryBlockAllRow" style="display: none;">
                    <span class="summary-label text-error">âš ï¸ Effect</span>
                    <span class="summary-value text-error">ALL ACCESS BLOCKED</span>
                  </div>
                </div>

                <!-- DNS Domains Summary with Remove Buttons -->
                <div id="summaryDomainsContainer" style="display: none">
                  <div class="summary-row" style="border-bottom: none; padding-bottom: 5px">
                    <span class="summary-label">Blocked Domains</span>
                    <span class="summary-value" style="display: flex; align-items: center; gap: 10px">
                      <span id="summaryDomainsCount">0</span> domains
                    </span>
                  </div>
                  <div class="domain-tags" id="summaryDomainTags" style="
                        margin-top: 5px;
                        margin-bottom: 10px;
                        padding-left: 20px;
                      ">
                    <!-- Domain tags with remove buttons will appear here -->
                  </div>
                </div>
              </div>

              <div class="alert alert-success" style="margin-top: 20px">
                <i class="fas fa-check-circle"></i>
                <span>The policy will be applied to all selected agents within 5
                  minutes.</span>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">
              <i class="fas fa-arrow-left"></i><span>Previous</span>
            </button>
            <button class="btn btn-secondary" onclick="window.location.href = 'file-policies.html'">
              <i class="fas fa-times"></i><span>Cancel</span>
            </button>
            <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">
              <span>Next</span><i class="fas fa-arrow-right"></i>
            </button>
            <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">
              <i class="fas fa-check"></i><span>Apply Policy</span>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Remove Policy Modal -->
  <div class="modal-overlay" id="removePolicyModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Remove Policy</h3>
        <button class="modal-close" onclick="closeRemovePolicyModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Type <strong>REMOVE</strong> to confirm policy removal:</p>
        <div style="margin: 15px 0;" id="removeModalDetails"></div>
        <input type="text" class="domain-input" id="removeConfirmInput" placeholder="Type REMOVE to confirm"
          style="width: 100%;">
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRemovePolicyModal()">Cancel</button>
        <button class="btn btn-danger" onclick="removeSelectedPolicy()" id="confirmRemoveBtn" disabled>Remove
          Policy</button>
      </div>
    </div>
  </div>

  <script th:inline="javascript">
    // ===== STATE VARIABLES =====
    let selectedAgents = new Set();
    let agentsBasicData = {};
    let agentsCapabilities = {};
    let currentStep = 1;
    let selectedPolicyType = "";
    let selectedPolicy = "";
    let blockedDomains = [];
    let isEditingExistingPolicy = false;
    let statusRefreshInterval;

    // ===== FILE EXPLORER VARIABLES =====
    let treeData = {};
    let selectedNode = null;
    let operations = {
      read: false,
      write: false,
      delete: false,
      rename: false,
      create: false
    };
    let activeNodePolicies = [];
    let policyToRemove = null;
    let currentlyExpanding = new Set();

    // ===== API BASE =====
    const API_BASE = '';

    /* ==================== FILE EXPLORER FUNCTIONS ==================== */
    async function getDrives() {
      try {
        const treeContainer = document.getElementById('treeContainer');
        treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';

        const response = await fetch(`/api/admin/explorer/drives`);
        const data = await response.json();

        treeData = data;
        document.getElementById('btnRefresh').disabled = false;
        renderTree(data);
      } catch (error) {
        console.error('Failed to get drives:', error);
        document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';
      }
    }

    async function expandNode(node) {
      if (!node || node.expanded || currentlyExpanding.has(node.id)) {
        return;
      }

      currentlyExpanding.add(node.id);

      try {
        const response = await fetch(`/api/admin/explorer/nodes/${node.id}/expand`, { method: 'POST' });

        if (response.status === 409) {
          console.info(`Node already expanded: ${node.name}`);
          node.expanded = true;
          return;
        }

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const data = await response.json();

        if (!Array.isArray(data)) {
          console.error('Invalid expand response:', data);
          return;
        }

        updateTreeWithChildren(node.id, data);
        node.expanded = true;

      } catch (error) {
        console.error('Expand failed:', error);
      } finally {
        currentlyExpanding.delete(node.id);
        renderTree(treeData);
      }
    }

    async function refreshExplorer() {
      if (!selectedNode) {
        await getDrives();
        return;
      }

      const node = findNode(treeData, selectedNode.id);
      if (!node) return;

      if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {
        node.expanded = false;
        node.children = [];
        renderTree(treeData);

        setTimeout(() => {
          expandNode(node);
        }, 200);
      }
    }

    function findNode(nodes, id) {
      for (const node of nodes) {
        if (node.id === id) return node;
        if (node.children) {
          const found = findNode(node.children, id);
          if (found) return found;
        }
      }
      return null;
    }

    function renderTree(data) {
      const treeContainer = document.getElementById('treeContainer');
      if (!treeContainer) return;

      treeContainer.innerHTML = '';

      if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {
        treeContainer.innerHTML = '<div class="loading">No items found</div>';
        return;
      }

      const items = Array.isArray(data) ? data : Object.values(data);
      items.forEach(item => {
        renderTreeNode(item, 0);
      });
    }

    function renderTreeNode(node, level) {
      const treeContainer = document.getElementById('treeContainer');
      const nodeEl = document.createElement('div');
      const isSelected = selectedNode && selectedNode.id === node.id;

      nodeEl.className = 'tree-node';
      if (isSelected) nodeEl.classList.add('selected');

      const indent = level * 20;
      nodeEl.style.paddingLeft = `${indent + 10}px`;

      if (node.type === 'folder' || node.type === 'drive') {
        const expandEl = document.createElement('div');
        expandEl.className = 'tree-node-expand';
        expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';
        expandEl.style.cursor = 'pointer';
        expandEl.style.marginRight = '5px';
        expandEl.style.fontSize = '12px';

        expandEl.addEventListener('click', function (e) {
          e.stopPropagation();
          toggleFolder(node);
        });

        nodeEl.appendChild(expandEl);
      } else {
        const spacer = document.createElement('div');
        spacer.style.width = '16px';
        spacer.style.display = 'inline-block';
        nodeEl.appendChild(spacer);
      }

      const iconEl = document.createElement('div');
      iconEl.className = 'tree-node-icon';
      iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';
      nodeEl.appendChild(iconEl);

      const nameEl = document.createElement('div');
      nameEl.className = 'tree-node-name';
      nameEl.textContent = node.name || 'Unnamed';
      nodeEl.appendChild(nameEl);

      nodeEl.addEventListener('click', function (e) {
        e.stopPropagation();
        selectNode(node);
      });

      treeContainer.appendChild(nodeEl);

      if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {
        node.children.forEach(child => {
          renderTreeNode(child, level + 1);
        });
      }
    }

    async function toggleFolder(node) {
      if (node.expanded) {
        try {
          await fetch(`/api/admin/explorer/nodes/${node.id}/collapse`, { method: 'POST' });
          node.expanded = false;
          node.children = [];
          renderTree(treeData);
        } catch (e) {
          console.error("Collapse failed", e);
        }
        return;
      }

      if (currentlyExpanding.has(node.id)) return;
      expandNode(node);
    }

    function selectNode(node) {
      selectedNode = node;

      document.getElementById('selectedPathInfo').style.display = 'block';
      document.getElementById('selectedPathValue').textContent = node.full_path || node.id;

      loadNodePolicies(node.id);

      const cbCreate = document.getElementById('cb-create');
      if (node.type === 'file') {
        operations.create = false;
        cbCreate.checked = false;
        cbCreate.disabled = true;
        document.getElementById('create-operation').classList.add('disabled');
      } else {
        cbCreate.disabled = false;
        document.getElementById('create-operation').classList.remove('disabled');
      }

      clearOperations();
      renderTree(treeData);
      updateNextButton();
    }

    function clearSelection() {
      selectedNode = null;
      document.getElementById('selectedPathInfo').style.display = 'none';
      document.getElementById('selectedPathValue').textContent = '-';
      clearOperations();
      renderTree(treeData);
    }

    function updateTreeWithChildren(parentId, children) {
      if (!Array.isArray(children)) {
        console.error("Children is not array:", children);
        return;
      }

      function updateNode(nodes) {
        for (let node of nodes) {
          if (!node) continue;

          if (node.id === parentId) {
            node.children = children;
            node.expanded = true;
            return true;
          }

          if (Array.isArray(node.children)) {
            if (updateNode(node.children)) return true;
          }
        }
        return false;
      }

      if (Array.isArray(treeData)) {
        updateNode(treeData);
      }
    }

    /* ==================== OPERATIONS FUNCTIONS ==================== */
    function initOperationCheckboxes() {
      const checkboxes = document.querySelectorAll('.operation-checkbox');
      checkboxes.forEach(cb => {
        cb.addEventListener('change', function () {
          const operation = this.getAttribute('data-operation');

          if (operation === 'read') {
            handleReadCheckboxChange(this.checked);
          } else {
            handleOperationChange(operation, this.checked);
          }

          updateNextButton();
        });
      });
    }

    function handleReadCheckboxChange(isChecked) {
      operations.read = isChecked;

      document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);

      if (isChecked) {
        const otherOperations = ['write', 'delete', 'rename', 'create'];
        otherOperations.forEach(op => {
          operations[op] = false;
          const cb = document.getElementById(`cb-${op}`);
          cb.checked = false;
          cb.disabled = true;
          document.getElementById(`${op}-operation`).classList.add('disabled');
        });
      } else {
        const otherOperations = ['write', 'delete', 'rename', 'create'];
        otherOperations.forEach(op => {
          const cb = document.getElementById(`cb-${op}`);
          cb.disabled = false;
          document.getElementById(`${op}-operation`).classList.remove('disabled');
        });

        if (selectedNode && selectedNode.type === 'file') {
          document.getElementById('cb-create').disabled = true;
          document.getElementById('create-operation').classList.add('disabled');
        }
      }
    }

    function handleOperationChange(operation, isChecked) {
      operations[operation] = isChecked;
    }

    function clearOperations() {
      Object.keys(operations).forEach(op => {
        operations[op] = false;
      });

      document.querySelectorAll('.operation-checkbox').forEach(cb => {
        cb.checked = false;
        cb.disabled = false;
      });

      document.querySelectorAll('.operation-item').forEach(item => {
        item.classList.remove('disabled');
      });

      document.getElementById('readBlockAllWarning').classList.remove('active');

      if (selectedNode && selectedNode.type === 'file') {
        document.getElementById('cb-create').disabled = true;
        document.getElementById('create-operation').classList.add('disabled');
      }
    }

    function updateNextButton() {
      const hasSelection = selectedNode !== null;
      const hasAnyOperationChecked = Object.values(operations).some(v => v);
      const nextBtn = document.getElementById('nextBtn');

      if (currentStep === 3 && selectedPolicyType === "file") {
        nextBtn.disabled = !hasSelection || !hasAnyOperationChecked;
      } else {
        nextBtn.disabled = false;
      }
    }

    /* ==================== ACTIVE POLICIES FUNCTIONS ==================== */
    async function loadNodePolicies(nodeId) {
      try {
        const response = await fetch(`/api/admin/policies`);
        if (!response.ok) throw new Error('Failed to load policies');

        const result = await response.json();

        let policiesArray = [];
        if (Array.isArray(result)) {
          policiesArray = result;
        } else if (result.data && Array.isArray(result.data)) {
          policiesArray = result.data;
        }

        activeNodePolicies = policiesArray.filter(p =>
          p.nodeId === nodeId || p.node_id === nodeId
        );

        const section = document.getElementById('activePoliciesSection');
        const policiesList = document.getElementById('selectedNodePolicies');
        const noPoliciesMsg = document.getElementById('noPoliciesMsg');
        const removeContainer = document.getElementById('removePolicyContainer');

        if (activeNodePolicies.length > 0) {
          section.style.display = 'block';
          removeContainer.style.display = 'block';
          noPoliciesMsg.style.display = 'none';

          policiesList.innerHTML = '';
          activeNodePolicies.forEach(policy => {
            const policyItem = document.createElement('div');
            policyItem.className = 'policy-item-small';

            const operations = policy.operations || {};
            const isBlockAll = operations.read === true;

            if (isBlockAll) {
              policyItem.classList.add('block-all');
            }

            const ops = [];
            if (operations.read === true) ops.push('READ');
            if (operations.write === true) ops.push('WRITE');
            if (operations.delete === true) ops.push('DELETE');
            if (operations.rename === true) ops.push('RENAME');
            if (operations.create === true) ops.push('CREATE');

            policyItem.innerHTML = `
              <div class="policy-info-compact">
                <div class="policy-name-compact">
                  ${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}
                </div>
                <div class="policy-details-compact">
                  Scope: ${policy.scope || 'file'} | ID: ${policy.id}
                </div>
              </div>
              <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">
                <i class="fas fa-times"></i>
              </button>
            `;

            policiesList.appendChild(policyItem);
          });
        } else {
          section.style.display = 'block';
          removeContainer.style.display = 'none';
          noPoliciesMsg.style.display = 'flex';
          policiesList.innerHTML = '';
        }

      } catch (error) {
        console.error('Error loading node policies:', error);
      }
    }

    function showRemovePolicyModal() {
      if (activeNodePolicies.length === 0) return;

      if (activeNodePolicies.length > 1) {
        showPolicySelectionModal();
      } else {
        showRemovePolicyModalForPolicy(activeNodePolicies[0].id);
      }
    }

    function showPolicySelectionModal() {
      const modal = document.getElementById('removePolicyModal');
      const details = document.getElementById('removeModalDetails');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      const confirmInput = document.getElementById('removeConfirmInput');

      let html = '<p><strong>Multiple policies found:</strong></p>';
      html += '<div style="margin: 15px 0;">';

      activeNodePolicies.forEach(policy => {
        const operations = policy.operations || {};
        const ops = Object.entries(operations)
          .filter(([op, val]) => val)
          .map(([op]) => op.toUpperCase())
          .join(', ');

        html += `
          <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
            <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">
            <label for="policy_${policy.id}" style="flex: 1;">
              <strong>Policy ID ${policy.id}</strong><br>
              Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}
            </label>
          </div>
        `;
      });

      html += '</div>';
      html += '<p>Select a policy to remove:</p>';

      details.innerHTML = html;

      setTimeout(() => {
        const radios = document.querySelectorAll('input[name="policySelect"]');
        radios.forEach(radio => {
          radio.addEventListener('change', function () {
            policyToRemove = parseInt(this.value);
            updateRemoveConfirmButton();
          });
        });
      }, 100);

      confirmInput.value = '';
      confirmInput.disabled = false;
      confirmBtn.disabled = true;

      confirmInput.oninput = function () {
        updateRemoveConfirmButton();
      };

      modal.classList.add('active');
    }

    function showRemovePolicyModalForPolicy(policyId) {
      const policy = activeNodePolicies.find(p => p.id === policyId);
      if (!policy) return;

      policyToRemove = policyId;

      const modal = document.getElementById('removePolicyModal');
      const details = document.getElementById('removeModalDetails');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      const confirmInput = document.getElementById('removeConfirmInput');

      const operations = policy.operations || {};
      const ops = Object.entries(operations)
        .filter(([op, val]) => val)
        .map(([op]) => op.toUpperCase())
        .join(', ');

      details.innerHTML = `
        <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>
        <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>
        <div><strong>Policy ID:</strong> ${policy.id}</div>
        <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>
        <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>
      `;

      confirmInput.value = '';
      confirmBtn.disabled = true;

      confirmInput.oninput = function () {
        confirmBtn.disabled = this.value !== 'REMOVE';
      };

      modal.classList.add('active');
    }

    function updateRemoveConfirmButton() {
      const confirmInput = document.getElementById('removeConfirmInput');
      const confirmBtn = document.getElementById('confirmRemoveBtn');
      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;
    }

    function closeRemovePolicyModal() {
      document.getElementById('removePolicyModal').classList.remove('active');
      policyToRemove = null;
    }

    async function removeSelectedPolicy() {
      if (!policyToRemove) {
        closeRemovePolicyModal();
        return;
      }

      try {
        const response = await fetch(`/api/admin/policies/${policyToRemove}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error('Failed to remove policy');
        }

        showToast("Policy removed successfully!", "success");
        closeRemovePolicyModal();

        if (selectedNode) {
          await loadNodePolicies(selectedNode.id);
        }

      } catch (error) {
        console.error('Remove policy error:', error);
        showToast("Failed to remove policy: " + error.message, "error");
        closeRemovePolicyModal();
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;

      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }


    /* ==================== AUTHENTICATION & USER DATA ==================== */
    
    
      const userData = {
        username: [[${username}]],
        userName: [[${userName}]],
        userInitials: [[${userInitials}]],
        userRole: [[${userRole}]],
        userEmail: [[${userEmail}]],
        userId: [[${userId}]]
    };

    function loadAdminInfo() {
        const userName = document.querySelector(".user-name");
        const userAvatar = document.querySelector(".user-avatar");
        const userRole = document.querySelector(".user-role");
 
        if (userName && userData.userName) {
            userName.textContent = userData.userName;
        }
 
        if (userAvatar && userData.userInitials) {
            userAvatar.textContent = userData.userInitials;
        }
 
        if (userRole && userData.userRole) {
            userRole.textContent = userData.userRole;
        }
    }


    /* ==================== SIDEBAR FUNCTIONS ==================== */

    function toggleSubMenu(element) {
      var sidebar = document.getElementById("sidebar");
      if (sidebar.classList.contains("collapsed")) return;

      var subMenu = element.nextElementSibling;
      var allSubMenus = document.querySelectorAll(".sub-menu");
      var allDropdowns = document.querySelectorAll(".nav-dropdown");

      // Close other open submenus
      allSubMenus.forEach(function (menu) {
        if (menu !== subMenu) menu.classList.remove("open");
      });
      allDropdowns.forEach(function (link) {
        if (link !== element) link.classList.remove("expanded");
      });

      // Toggle current
      element.classList.toggle("expanded");
      subMenu.classList.toggle("open");
    }

    function toggleSidebar() {
      var sidebar = document.getElementById("sidebar");
      var mainContent = document.getElementById("mainContent");
      var header = document.getElementById("topHeader");

      sidebar.classList.toggle("collapsed");
      var isCollapsed = sidebar.classList.contains("collapsed");

      if (mainContent) mainContent.classList.toggle("expanded");

      // Update header left position
      if (header) {
        header.style.left = isCollapsed ? "70px" : "240px";
      }

      // Close all submenus when collapsing
      if (isCollapsed) {
        document.querySelectorAll(".sub-menu").forEach(function (m) {
          m.classList.remove("open");
        });
        document.querySelectorAll(".nav-dropdown").forEach(function (l) {
          l.classList.remove("expanded");
        });
      }

      // Dispatch event for other components
      window.dispatchEvent(
        new CustomEvent("sidebarToggle", {
          detail: { collapsed: isCollapsed },
        })
      );
    }

    function openMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.add("mobile-open");
      if (overlay) overlay.classList.add("active");
    }

    function closeMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.remove("mobile-open");
      if (overlay) overlay.classList.remove("active");
    }

    function toggleMobileMenu() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (!sidebar) return;

      if (sidebar.classList.contains("mobile-open")) {
        closeMobileSidebar();
      } else {
        openMobileSidebar();
      }
    }

    function setActiveMenuItem() {
      var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';

      // First remove all active classes
      document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function (el) {
        el.classList.remove('active');
      });

      // Handle sub-menu items
      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function (item) {
        var href = item.getAttribute('href');
        if (href === currentPage) {
          item.classList.add('active');
          var parentSubMenu = item.closest('.sub-menu');
          if (parentSubMenu) {
            parentSubMenu.classList.add('open');
            var parentNav = parentSubMenu.previousElementSibling;
            if (parentNav) parentNav.classList.add('expanded');
          }
        }
      });

      // Handle main nav links
      document.querySelectorAll('.nav-link[data-page]').forEach(function (link) {
        var href = link.getAttribute('href');
        if (href === currentPage) {
          link.classList.add('active');
        }
      });
    }

    /* ==================== HEADER FUNCTIONS ==================== */

    function toggleNotifications(event) {
      event.stopPropagation();
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = event.currentTarget;
      if (!panel || !overlay) return;

      if (panel.classList.contains("show")) {
        closeNotifications();
      } else {
        closeUserDropdown();
        panel.classList.add("show");
        overlay.classList.add("show");
        btn.classList.add("active");
        document.body.style.overflow = "hidden";
      }
    }

    function closeNotifications() {
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = document.querySelector(".notification-btn");
      if (panel) panel.classList.remove("show");
      if (overlay) overlay.classList.remove("show");
      if (btn) btn.classList.remove("active");
      document.body.style.overflow = "";
    }

    function switchTab(event, tabName) {
      document.querySelectorAll(".tab-btn").forEach(function (t) {
        t.classList.remove("active");
      });
      event.currentTarget.classList.add("active");

      document
        .querySelectorAll(".notification-item")
        .forEach(function (item) {
          item.style.display =
            tabName === "unread" && !item.classList.contains("unread")
              ? "none"
              : "flex";
        });
    }

    function toggleUserDropdown(event) {
      event.stopPropagation();
      var dropdown = document.getElementById("userDropdown");
      var userProfile = event.currentTarget;
      if (!dropdown) return;

      if (dropdown.classList.contains("show")) {
        closeUserDropdown();
      } else {
        closeNotifications();
        dropdown.classList.add("show");
        userProfile.classList.add("active");
      }
    }

    function closeUserDropdown() {
      var dropdown = document.getElementById("userDropdown");
      var userProfile = document.querySelector(".user-profile");
      if (dropdown) dropdown.classList.remove("show");
      if (userProfile) userProfile.classList.remove("active");
    }

    function logout(event) {
      event.preventDefault();
      window.location.href = "/logout";
    }

    // Close dropdowns when clicking outside
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".user-profile")) {
        closeUserDropdown();
      }
      if (
        !event.target.closest(".notification-btn") &&
        !event.target.closest(".notifications-panel")
      ) {
        closeNotifications();
      }
    });

    /* ==================== ASSIGN POLICY FUNCTIONS ==================== */

    function startStatusRefresh() {
      if (statusRefreshInterval) {
        clearInterval(statusRefreshInterval);
      }

      // Refresh agent status every 30 seconds
      statusRefreshInterval = setInterval(async () => {
        console.log("Refreshing agent status...");
        await refreshAllAgents();
      }, 10000);
    }

    async function refreshAllAgents() {
      try {
        // Fetch fresh agent data
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Failed to fetch agents");
        }

        const result = await response.json();

        if (result.success && result.data) {
          const agents = result.data;

          // Update agentsBasicData with fresh data
          agents.forEach((agent) => {
            agentsBasicData[agent.id] = agent;
          });

          // Refresh the agent cards UI
          await initializeAgentCards();
        }
      } catch (error) {
        console.error("Error refreshing agents:", error);
      }
    }

    async function initializeAgentCards() {
      const agentsGrid = document.getElementById("agentsGrid");
      if (!agentsGrid) return;

      agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';

      try {
        // Fetch agents from API
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) {
          throw new Error("Failed to fetch agents");
        }

        const result = await response.json();

        if (!result.success || !result.data) {
          throw new Error(result.message || "No agents found");
        }

        const agents = result.data;
        agentsGrid.innerHTML = "";

        agents.forEach((agent) => {
          const agentCard = document.createElement("div");
          agentCard.className = "agent-card";
          agentCard.dataset.id = agent.id;
          agentCard.onclick = () => toggleAgent(agent.id);

          agentCard.innerHTML = `
            <div class="agent-card-header">
              <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""}>
              <div class="agent-name">${agent.username || agent.hostname || 'Unknown'}</div>
              <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"}">
                ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}
              </span>
            </div>
            <div class="agent-info">
              <span><i class="fas fa-user"></i> ${agent.hostname || agent.username || 'N/A'}</span>
              <span><i class="fas fa-id-badge"></i> ${agent.id}</span>
            </div>
            <div class="agent-info">
              <span><i class="fab fa-${getOSIcon(agent.osType)}"></i> ${agent.osType || "Unknown OS"}</span>
              <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"}</span>
            </div>
          `;

          agentsGrid.appendChild(agentCard);

          if (selectedAgents.has(agent.id)) {
            agentCard.classList.add("selected");
            agentCard.querySelector(".agent-checkbox").checked = true;
          }
        });
      } catch (error) {
        console.error("Error loading agents:", error);
        agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;
      }

      updateSelectedCount();
    }

    function isAgentOnline(agent) {
      if (agent.agentRuntimeState && agent.agentRuntimeState.toUpperCase() === "ONLINE") {
        return true;
      }

      if (agent.lastHeartbeat) {
        const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();
        const now = new Date();
        const diffMinutes = Math.floor((now - lastHeartbeat) / 1000 / 60);
        return diffMinutes <= 10;
      }

      return false;
    }

    function getOSIcon(os) {
      if (!os) return "desktop";

      const osLower = os.toLowerCase();
      if (osLower.includes("windows")) return "windows";
      if (osLower.includes("macos") || osLower.includes("mac")) return "apple";
      if (osLower.includes("ubuntu") || osLower.includes("linux")) return "linux";
      return "desktop";
    }

    async function toggleAgent(agentId) {
      if (selectedAgents.has(agentId)) {
        selectedAgents.delete(agentId);
        delete agentsCapabilities[agentId];
      } else {
        selectedAgents.add(agentId);
        // Fetch agent capabilities if not already fetched
        if (!agentsCapabilities[agentId]) {
          try {
            await fetchAgentDetails(agentId);
            if (selectedPolicy === "NETWORK_DNS_BLOCK") {
              const capabilities = agentsCapabilities[agentId];
              if (capabilities && capabilities.NETWORK) {
                const policy = capabilities.NETWORK.find(
                  (p) => p.code === selectedPolicy
                );
                if (policy && policy.isActive) {
                  isEditingExistingPolicy = true;
                }
              }
            }
          } catch (error) {
            console.error(
              `Failed to fetch capabilities for agent ${agentId}:`,
              error
            );
            agentsCapabilities[agentId] = {};
          }
        }
      }

      const agentCard = document.querySelector(
        `.agent-card[data-id="${agentId}"]`
      );
      if (agentCard) {
        agentCard.classList.toggle("selected");
        const checkbox = agentCard.querySelector(".agent-checkbox");
        if (checkbox) {
          checkbox.checked = selectedAgents.has(agentId);
        }
      }

      updateSelectedCount();

      // Update policy types based on selected agents
      if (selectedAgents.size > 0) {
        updatePolicyTypes();
      }
    }

    async function fetchAgentDetails(agentId) {
      try {
        const response = await fetch(
          `/api/admin/agents/${agentId}/capabilities`,
          {
            headers: {
              "Content-Type": "application/json",
            },
            credentials: "include",
          }
        );

        if (!response.ok) {
          throw new Error(
            `HTTP ${response.status}: Failed to fetch capabilities`
          );
        }

        const result = await response.json();

        if (result.success && result.data) {
          agentsCapabilities[agentId] = result.data;
        } else {
          throw new Error(result.message || "Failed to load capabilities");
        }
      } catch (error) {
        console.error(
          `Error fetching capabilities for agent ${agentId}:`,
          error
        );
        agentsCapabilities[agentId] = {};
        throw error;
      }
    }

    async function fetchAgentSimpleDetails() {
      try {
        const response = await fetch("/api/admin/agents", {
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
        });

        if (!response.ok) throw new Error("Failed to fetch agents");

        const result = await response.json();
        if (result.success && result.data) {
          result.data.forEach((agent) => {
            agentsBasicData[agent.id] = agent;
          });
        }
      } catch (error) {
        console.error("Error fetching agents:", error);
      }
    }

    async function updatePolicyTypes() {
      if (selectedAgents.size === 0) {
        const policyTypeSelect = document.getElementById("policyType");
        policyTypeSelect.innerHTML =
          '<option value="">-- Select Policy Type --</option>';
        selectedPolicyType = "";
        updatePolicySelect();
        return;
      }

      let commonCategories = null;

      for (const agentId of selectedAgents) {
        const capabilities = agentsCapabilities[agentId];

        if (capabilities && Object.keys(capabilities).length > 0) {
          const agentCategories = Object.keys(capabilities);

          if (commonCategories === null) {
            commonCategories = new Set(agentCategories);
          } else {
            commonCategories = new Set(
              [...commonCategories].filter((cat) =>
                agentCategories.includes(cat)
              )
            );
          }
        } else {
          commonCategories = new Set();
          break;
        }
      }

      const policyTypeSelect = document.getElementById("policyType");
      const currentValue = policyTypeSelect.value;

      policyTypeSelect.innerHTML =
        '<option value="">-- Select Policy Type --</option>';

      if (commonCategories && commonCategories.size > 0) {
        const sortedCategories = Array.from(commonCategories).sort();

        sortedCategories.forEach((category) => {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          policyTypeSelect.appendChild(option);
        });

        if (currentValue && commonCategories.has(currentValue)) {
          policyTypeSelect.value = currentValue;
          selectedPolicyType = currentValue;
        } else {
          selectedPolicyType = "";
        }
      } else {
        selectedPolicyType = "";
      }

      updatePolicySelect();
    }

    function updateSelectedCount() {
      const count = selectedAgents.size;
      const selectedCountElement = document.getElementById("selectedCount");
      if (selectedCountElement) {
        selectedCountElement.innerHTML = `
          <i class="fas fa-check-circle"></i>
          <span>${count} agent${count !== 1 ? "s" : ""} selected</span>
        `;
      }
    }

    document.addEventListener("change", function (e) {
      if (e.target && e.target.id === "policyType") {
        selectedPolicyType = e.target.value;
        updatePolicySelect();
      }

      if (e.target && e.target.id === "policySelect") {
        selectedPolicy = e.target.value;
        updatePolicyOptions();
      }
    });

    function updatePolicySelect() {
      const policySelect = document.getElementById("policySelect");
      if (!policySelect) return;

      policySelect.innerHTML = '<option value="">-- Select Policy --</option>';

      if (selectedPolicyType && selectedAgents.size > 0) {
        let commonPolicies = null;
        let policyStatusMap = new Map();

        for (const agentId of selectedAgents) {
          const capabilities = agentsCapabilities[agentId];

          if (capabilities && capabilities[selectedPolicyType]) {
            const agentPolicies = capabilities[selectedPolicyType];

            if (!Array.isArray(agentPolicies)) {
              console.error(
                `Agent ${agentId}: Expected array for ${selectedPolicyType}, got:`,
                agentPolicies
              );
              commonPolicies = new Map();
              break;
            }

            if (commonPolicies === null) {
              commonPolicies = new Map();
              agentPolicies.forEach((policy) => {
                if (policy && policy.code) {
                  commonPolicies.set(policy.code, policy);
                  policyStatusMap.set(policy.code, {
                    [agentId]: policy.isActive || false,
                  });
                }
              });
            } else {
              const agentPolicyCodes = new Set(
                agentPolicies.map((p) => p?.code).filter((code) => code)
              );

              agentPolicies.forEach((policy) => {
                if (
                  policy &&
                  policy.code &&
                  policyStatusMap.has(policy.code)
                ) {
                  policyStatusMap.get(policy.code)[agentId] =
                    policy.isActive || false;
                }
              });

              commonPolicies = new Map(
                [...commonPolicies].filter(([code, policy]) =>
                  agentPolicyCodes.has(code)
                )
              );
            }
          } else {
            commonPolicies = new Map();
            break;
          }
        }

        if (commonPolicies && commonPolicies.size > 0) {
          policySelect.disabled = false;

          const sortedPolicies = Array.from(commonPolicies.values())
            .filter((policy) => policy && policy.name)
            .sort((a, b) => a.name.localeCompare(b.name));

          sortedPolicies.forEach((policy) => {
            const option = document.createElement("option");
            option.value = policy.code;

            const statusInfo = policyStatusMap.get(policy.code);
            let appliedCount = 0;
            if (statusInfo) {
              appliedCount = Object.values(statusInfo).filter(
                (isActive) => isActive
              ).length;
            }

            let statusText = "";
            if (appliedCount === selectedAgents.size) {
              statusText = " (Applied to all)";
            } else if (appliedCount > 0) {
              statusText = ` (Applied to ${appliedCount}/${selectedAgents.size})`;
            }

            option.textContent = policy.name + statusText;
            option.title = policy.description || "";
            option.dataset.isApplied = appliedCount === selectedAgents.size;

            policySelect.appendChild(option);
          });

          if (sortedPolicies.length > 0) {
            policySelect.value = sortedPolicies[0].code;
            selectedPolicy = sortedPolicies[0].code;
            updatePolicyAppliedStatus();
          }
        } else {
          policySelect.disabled = true;
          policySelect.innerHTML =
            '<option value="">No common policies available</option>';
          selectedPolicy = "";
        }
      } else {
        policySelect.disabled = true;
        policySelect.innerHTML =
          '<option value="">-- Select a policy type first --</option>';
        selectedPolicy = "";
      }

      updatePolicyOptions();
    }

    function updatePolicyAppliedStatus() {
      const policySelect = document.getElementById("policySelect");
      const selectedOption = policySelect.options[policySelect.selectedIndex];
      const isApplied = selectedOption
        ? selectedOption.dataset.isApplied === "true"
        : false;

      const nextBtn = document.getElementById("nextBtn");
      const applyBtn = document.getElementById("applyBtn");

      if (currentStep === 3 && isApplied) {
        nextBtn.innerHTML =
          '<span>Next</span><i class="fas fa-arrow-right"></i>';
      }
    }

    function updatePolicyOptions() {
      const dnsContainer = document.getElementById("dnsInputContainer");
      const fileInfo = document.getElementById("fileProtectionInfo");
      const ocrInfo = document.getElementById("ocrInfo");
      const fileProtectionUI = document.getElementById("fileProtectionUI");
      const step3Desc = document.querySelector("#step3 .section-desc");

      if (dnsContainer) dnsContainer.style.display = "none";
      if (fileInfo) fileInfo.style.display = "none";
      if (ocrInfo) ocrInfo.style.display = "none";
      if (fileProtectionUI) fileProtectionUI.style.display = "none";

      if (!selectedPolicy || !selectedPolicyType) return;

      // Handle FILE policy type - show comprehensive UI
      if (selectedPolicyType.toLowerCase() === "file") {
        if (fileProtectionUI) {
          fileProtectionUI.style.display = "block";
          step3Desc.textContent = "Select files/folders and choose operations to block";
          if (Object.keys(treeData).length === 0) {
            getDrives();
          }
        }
      }
      // Handle NETWORK DNS BLOCK policy
      else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
        if (dnsContainer) dnsContainer.style.display = "block";

        if (selectedAgents.size === 1) {
          const agentId = Array.from(selectedAgents)[0];
          const capabilities = agentsCapabilities[agentId];
          if (capabilities && capabilities.NETWORK) {
            const policy = capabilities.NETWORK.find(
              (p) => p.code === selectedPolicy
            );
            if (policy && policy.policyData && policy.policyData !== "null") {
              try {
                const data = JSON.parse(policy.policyData);
                if (data.domains && Array.isArray(data.domains)) {
                  blockedDomains = data.domains;
                  isEditingExistingPolicy = true;
                  console.log("Loaded domains:", blockedDomains);
                } else {
                  blockedDomains = [];
                  isEditingExistingPolicy = false;
                }
              } catch (e) {
                console.error("Error parsing policy data:", e);
                blockedDomains = [];
                isEditingExistingPolicy = false;
              }
            }
          }
        } else {
          blockedDomains = [];
          isEditingExistingPolicy = false;
        }
        renderDomainTags();
      }
      // Handle SECURITY_MONITOR (OCR) policy
      else if (selectedPolicyType.toLowerCase() === "ocr" || selectedPolicyType === "SECURITY_MONITOR") {
        ocrInfo.style.display = "block";
      }
    }

    function addDomain() {
      const domainInput = document.getElementById("domainInput");
      let domain = domainInput.value.trim();

      if (!domain) {
        alert("Please enter a domain name");
        return;
      }

      domain = domain.replace(/^https?:\/\//, "");
      domain = domain.replace(/\/$/, "");

      const domainLower = domain.toLowerCase();
      const exists = blockedDomains.some(
        (d) => d.toLowerCase() === domainLower
      );

      if (exists) {
        alert("Domain already added");
        return;
      }
      blockedDomains.push(domain);
      domainInput.value = "";

      renderDomainTags();

      if (currentStep === 4) {
        renderSummaryDomainTags();
        const summaryDomainsCount =
          document.getElementById("summaryDomainsCount");
        if (summaryDomainsCount) {
          summaryDomainsCount.textContent = blockedDomains.length;
        }
      }
    }

    function renderDomainTags() {
      const domainTags = document.getElementById("domainTags");
      if (!domainTags) return;

      domainTags.innerHTML = "";

      blockedDomains.forEach((domain, index) => {
        const tag = document.createElement("div");
        tag.className = "domain-tag";
        tag.innerHTML = `
          <span>${domain}</span>
          <i class="fas fa-times" onclick="removeDomain(${index})"></i>
        `;
        domainTags.appendChild(tag);
      });
    }

    function removeDomain(index) {
      blockedDomains.splice(index, 1);
      renderDomainTags();
    }

    function nextStep() {
      if (currentStep === 1 && selectedAgents.size === 0) {
        alert("Please select at least one agent");
        return;
      }

      if (currentStep === 2 && !selectedPolicyType) {
        alert("Please select a policy type");
        return;
      }

      if (currentStep === 3) {
        if (!selectedPolicy) {
          alert("Please select a policy");
          return;
        }

        if (
          selectedPolicy === "NETWORK_DNS_BLOCK" &&
          blockedDomains.length === 0
        ) {
          alert("Please add at least one domain to block");
          return;
        }

        if (
          selectedPolicyType.toLowerCase() === "file" &&
          (!selectedNode || !Object.values(operations).some(v => v))
        ) {
          alert("Please select a file/folder and at least one operation to block");
          return;
        }
      }

      currentStep++;
      updateStepDisplay();
    }

    function previousStep() {
      currentStep--;
      updateStepDisplay();
    }

    function updateStepDisplay() {
      document.getElementById("step1").style.display = "none";
      document.getElementById("step2").style.display = "none";
      document.getElementById("step3").style.display = "none";
      document.getElementById("step4").style.display = "none";

      document.getElementById(`step${currentStep}`).style.display = "block";

      document.querySelectorAll(".step").forEach((step, index) => {
        step.classList.remove("active", "completed");
        if (index + 1 < currentStep) {
          step.classList.add("completed");
          step.querySelector(".step-circle").innerHTML =
            '<i class="fas fa-check"></i>';
        } else if (index + 1 === currentStep) {
          step.classList.add("active");
          step.querySelector(".step-circle").textContent = index + 1;
        } else {
          step.querySelector(".step-circle").textContent = index + 1;
        }
      });

      document.getElementById("prevBtn").style.display =
        currentStep > 1 ? "flex" : "none";
      document.getElementById("nextBtn").style.display =
        currentStep < 4 ? "flex" : "none";
      document.getElementById("applyBtn").style.display =
        currentStep === 4 ? "flex" : "none";

      if (currentStep === 4) {
        updateSummary();
      }
    }

    function updateSummary() {
      document.getElementById("summaryAgentCount").textContent =
        selectedAgents.size;

      document.getElementById("summaryPolicyType").textContent =
        selectedPolicyType || "-";

      let policyName = "-";
      let appliedCount = 0;

      if (selectedPolicy && selectedPolicyType && selectedAgents.size > 0) {
        const firstAgentId = Array.from(selectedAgents)[0];
        const capabilities = agentsCapabilities[firstAgentId];
        if (capabilities && capabilities[selectedPolicyType]) {
          const policy = capabilities[selectedPolicyType].find(
            (p) => p.code === selectedPolicy
          );
          if (policy) {
            policyName = policy.name;

            appliedCount = 0;

            for (const agentId of selectedAgents) {
              const agentCapabilities = agentsCapabilities[agentId];
              const agentPolicy =
                agentCapabilities &&
                agentCapabilities[selectedPolicyType]?.find(
                  (p) => p.code === selectedPolicy
                );
              if (agentPolicy && agentPolicy.isActive) {
                appliedCount++;
              }
            }
          }
        }
      }

      document.getElementById("summaryPolicyName").textContent = policyName;

      // Handle File Protection Summary
      if (selectedPolicyType && selectedPolicyType.toLowerCase() === "file" && selectedNode) {
        document.getElementById("fileSummaryContainer").style.display = "block";
        document.getElementById("summaryDomainsContainer").style.display = "none";

        document.getElementById("summaryPath").textContent = selectedNode.full_path || selectedNode.id;
        document.getElementById("summaryResourceType").textContent = selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File';

        const blockedOps = Object.entries(operations)
          .filter(([op, checked]) => checked)
          .map(([op]) => op.toUpperCase())
          .join(', ');

        document.getElementById("summaryOperations").textContent = blockedOps || 'None';
        document.getElementById("summaryBlockAllRow").style.display = operations.read ? 'flex' : 'none';

      } else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
        document.getElementById("fileSummaryContainer").style.display = "none";
        document.getElementById("summaryDomainsContainer").style.display = "block";
        document.getElementById("summaryDomainsCount").textContent = blockedDomains.length;
        renderSummaryDomainTags();
      } else {
        document.getElementById("fileSummaryContainer").style.display = "none";
        document.getElementById("summaryDomainsContainer").style.display = "none";
      }

      const applyBtn = document.getElementById("applyBtn");
      if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
        applyBtn.innerHTML =
          '<i class="fas fa-times"></i><span>Remove Policy</span>';
        applyBtn.classList.remove("btn-primary", "btn-warning");
        applyBtn.classList.add("btn-danger");
      } else if (appliedCount > 0 && appliedCount < selectedAgents.size) {
        applyBtn.innerHTML =
          '<i class="fas fa-sync"></i><span>Update Policy</span>';
        applyBtn.classList.remove("btn-primary", "btn-danger");
        applyBtn.classList.add("btn-warning");
      } else {
        applyBtn.innerHTML =
          '<i class="fas fa-check"></i><span>Apply Policy</span>';
        applyBtn.classList.remove("btn-danger", "btn-warning");
        applyBtn.classList.add("btn-primary");
      }

      // Update alert message
      const alertBox = document.querySelector(".alert.alert-success");
      if (alertBox) {
        if (selectedPolicyType && selectedPolicyType.toLowerCase() === "file" && selectedNode) {
          if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
            alertBox.innerHTML = '<i class="fas fa-info-circle"></i><span>This policy is already applied to all selected agents. Click "Remove Policy" to deactivate it.</span>';
            alertBox.className = "alert alert-info";
          } else if (appliedCount > 0) {
            alertBox.innerHTML = `<i class="fas fa-info-circle"></i><span>This policy is applied to ${appliedCount}/${selectedAgents.size} selected agents. Click "Update Policy" to apply to all.</span>`;
            alertBox.className = "alert alert-warning";
          } else {
            alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The file protection policy will be applied to all selected agents within 5 minutes.</span>';
            alertBox.className = "alert alert-success";
          }
        } else if (selectedPolicy === "NETWORK_DNS_BLOCK") {
          if (appliedCount === selectedAgents.size && selectedAgents.size > 0) {
            alertBox.innerHTML = '<i class="fas fa-info-circle"></i><span>This policy is already applied to all selected agents. Click "Remove Policy" to deactivate it.</span>';
            alertBox.className = "alert alert-info";
          } else if (appliedCount > 0) {
            alertBox.innerHTML = `<i class="fas fa-info-circle"></i><span>This policy is applied to ${appliedCount}/${selectedAgents.size} selected agents. Click "Update Policy" to apply to all.</span>`;
            alertBox.className = "alert alert-warning";
          } else if (blockedDomains.length === 0) {
            alertBox.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';
            alertBox.className = "alert alert-warning";
          } else {
            alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The network policy will be applied to all selected agents within 5 minutes.</span>';
            alertBox.className = "alert alert-success";
          }
        } else {
          alertBox.innerHTML = '<i class="fas fa-check-circle"></i><span>The policy will be applied to all selected agents within 5 minutes.</span>';
          alertBox.className = "alert alert-success";
        }
      }
    }

    function renderSummaryDomainTags() {
      const domainTags = document.getElementById("summaryDomainTags");
      if (!domainTags) return;

      domainTags.innerHTML = "";
      if (blockedDomains.length === 0) {
        const emptyMsg = document.createElement("div");
        emptyMsg.style.color = "#6b7280";
        emptyMsg.style.fontStyle = "italic";
        emptyMsg.style.padding = "8px";
        emptyMsg.textContent = "No domains added";
        domainTags.appendChild(emptyMsg);
        return;
      }
      blockedDomains.forEach((domain, index) => {
        const tag = document.createElement("span");
        tag.className = "summary-domain-tag";
        tag.innerHTML = `
          <span>${domain}</span>
          <i class="fas fa-times" onclick="removeDomainFromSummary(${index})"></i>
        `;
        domainTags.appendChild(tag);
      });
    }

    function removeDomainFromSummary(index) {
      blockedDomains.splice(index, 1);

      renderDomainTags();
      renderSummaryDomainTags();

      const summaryDomainsCount =
        document.getElementById("summaryDomainsCount");
      if (summaryDomainsCount) {
        summaryDomainsCount.textContent = blockedDomains.length;
      }

      if (blockedDomains.length === 0) {
        const domainsContainer =
          document.getElementById("summaryDomainsContainer");
        if (domainsContainer) {
          domainsContainer.style.display = "none";
        }

        if (currentStep === 4) {
          const alertBox = document.querySelector(
            ".alert.alert-info, .alert.alert-success"
          );
          if (alertBox) {
            alertBox.innerHTML =
              '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';
            alertBox.className = "alert alert-warning";
          }
        }
      }
    }

    async function applyPolicy() {
      if (
        selectedAgents.size === 0 ||
        !selectedPolicyType ||
        !selectedPolicy
      ) {
        alert("Please complete all steps");
        return;
      }

      if (selectedPolicyType.toLowerCase() === "file" && !selectedNode) {
        alert("Please select a file or folder to protect");
        return;
      }

      try {
        const agentIds = Array.from(selectedAgents);

        let appliedCount = 0;
        for (const agentId of selectedAgents) {
          const capabilities = agentsCapabilities[agentId];
          const policy =
            capabilities &&
            capabilities[selectedPolicyType]?.find(
              (p) => p.code === selectedPolicy
            );
          if (policy && policy.isActive) {
            appliedCount++;
          }
        }

        const isRemoving = appliedCount === selectedAgents.size;
        const isUpdating =
          appliedCount > 0 && appliedCount < selectedAgents.size;

        const firstAgentId = agentIds[0];
        const capabilities = agentsCapabilities[firstAgentId];
        const policyDetails =
          capabilities &&
          capabilities[selectedPolicyType]?.find(
            (p) => p.code === selectedPolicy
          );

        if (!policyDetails) {
          throw new Error("Could not find policy details");
        }

        let requestBody = {
          agentIds: agentIds,
          policyCode: selectedPolicy,
        };

        // Add policy data based on type
        if (selectedPolicy === "NETWORK_DNS_BLOCK" && !isRemoving) {
          if (blockedDomains.length === 0) {
            alert("Please add at least one domain to block");
            return;
          }
          requestBody.policyData = JSON.stringify({
            domains: blockedDomains,
            ips: [],
          });
        } else if (selectedPolicyType.toLowerCase() === "file" && selectedNode && !isRemoving) {
          requestBody.policyData = JSON.stringify({
            nodeId: selectedNode.id,
            path: selectedNode.full_path || selectedNode.id,
            type: selectedNode.type,
            operations: operations,
            scope: selectedNode.type === 'folder' ? 'folder_recursive' : 'file'
          });
        }

        const endpoint = isRemoving
          ? "/api/admin/deactivate-protection"
          : "/api/admin/assign-protection";

        console.log("Applying policy:", requestBody);

        const response = await fetch(endpoint, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify(requestBody),
        });

        const result = await response.json();

        if (result.success) {
          const agentNames = agentIds
            .map((id) => {
              const agent = agentsBasicData[id];
              return agent ? agent.hostname || agent.username : `Agent ${id}`;
            })
            .filter((name) => name);

          let message = `âœ… ${result.message}\n\n`;
          message += `Agents: ${agentNames.join(", ")}\n`;
          message += `Policy: ${policyDetails.name}\n`;

          if (isRemoving) {
            message += `Action: Policy removed\n`;
          } else if (isUpdating) {
            message += `Action: Policy updated and applied to remaining agents\n`;
          } else {
            message += `Action: Policy applied\n`;
            if (selectedPolicy === "NETWORK_DNS_BLOCK" && blockedDomains.length > 0) {
              message += `Blocked Domains: ${blockedDomains.join(", ")}\n`;
            }
            if (selectedPolicyType.toLowerCase() === "file" && selectedNode) {
              message += `Protected Path: ${selectedNode.full_path || selectedNode.id}\n`;
            }
          }

          alert(message);

          for (const agentId of selectedAgents) {
            try {
              await fetchAgentDetails(agentId);
            } catch (error) {
              console.error(`Failed to refresh agent ${agentId}:`, error);
            }
          }

          if (isRemoving) {
            selectedAgents.clear();
            selectedPolicyType = "";
            selectedPolicy = "";
            blockedDomains = [];
            selectedNode = null;
            isEditingExistingPolicy = false;

            currentStep = 1;
            updateStepDisplay();
            await initializeAgentCards();
            updateSelectedCount();

            const alertBox = document.querySelector(".alert.alert-success");
            if (alertBox) {
              alertBox.innerHTML =
                '<i class="fas fa-check-circle"></i><span>Policy removed successfully. Select new agents to continue.</span>';
              alertBox.className = "alert alert-success";
            }
          } else {
            setTimeout(() => {
              window.location.href = "file-policies.html";
            }, 2000);
          }
        } else {
          alert(
            `âŒ Failed to ${isRemoving ? "remove" : "apply"} policy: ${result.message
            }`
          );
        }
      } catch (error) {
        console.error("Error applying policy:", error);
        alert(
          `âŒ Error ${isRemoving ? "removing" : "applying"} policy: ${error.message
          }`
        );
      }
    }

    document.addEventListener("input", function (e) {
      if (e.target && e.target.id === "agentSearch") {
        const searchTerm = e.target.value.toLowerCase();
        const agentCards = document.querySelectorAll(".agent-card");

        agentCards.forEach((card) => {
          const text = card.textContent.toLowerCase();
          card.style.display = text.includes(searchTerm) ? "block" : "none";
        });
      }
    });

    /* ==================== EVENT LISTENERS ==================== */

    window.addEventListener("resize", function () {
      const sidebar = document.getElementById("sidebar");
      const mainContent = document.getElementById("mainContent");
      const header = document.getElementById("topHeader");
      const windowWidth = window.innerWidth;

      if (windowWidth <= 968) {
        if (sidebar) sidebar.classList.remove("collapsed");
        if (mainContent) mainContent.classList.remove("expanded");
        if (header) {
          header.style.left = "0";
        }
      } else {
        if (sidebar && mainContent && header) {
          if (sidebar.classList.contains("collapsed")) {
            mainContent.classList.add("expanded");
            header.style.left = "70px";
          } else {
            mainContent.classList.remove("expanded");
            header.style.left = "240px";
          }
        }
      }
    });

    window.addEventListener("sidebarToggle", function (event) {
      const header = document.getElementById("topHeader");
      const mainContent = document.getElementById("mainContent");

      if (header && mainContent) {
        if (event.detail.collapsed) {
          header.style.left = "70px";
          mainContent.classList.add("expanded");
        } else {
          header.style.left = "240px";
          mainContent.classList.remove("expanded");
        }
      }
    });

    document.addEventListener("click", function (e) {
      const sidebar = document.getElementById("sidebar");
      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");

      if (sidebar && window.innerWidth <= 968) {
        if (
          !sidebar.contains(e.target) &&
          (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))
        ) {
          sidebar.classList.remove("mobile-open");
          const overlay = document.getElementById("sidebarOverlay");
          if (overlay) {
            overlay.classList.remove("active");
          }
        }
      }
    });

    document.addEventListener("DOMContentLoaded", async function () {
      loadAdminInfo();
      setActiveMenuItem();
      initOperationCheckboxes();
      await Promise.all([
        initializeAgentCards(),
        fetchAgentSimpleDetails(),
      ]);
      startStatusRefresh();
    });
  </script>
</body>

</html>























<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <title>DLP Shield - Assign File Protection Policy</title>-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />-->
<!--  <style>-->
<!--    /* All existing styles from the second UI remain exactly the same */-->
<!--    * {-->
<!--        margin: 0;-->
<!--        padding: 0;-->
<!--        box-sizing: border-box;-->
<!--    }-->

<!--    body {-->
<!--        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;-->
<!--        background: #f3f4f6;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .dashboard-container {-->
<!--        display: flex;-->
<!--        min-height: 100vh;-->
<!--        max-width: 100vw;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content {-->
<!--        flex: 1;-->
<!--        margin-left: 240px;-->
<!--        transition: margin-left 0.3s ease;-->
<!--        min-height: 100vh;-->
<!--        max-width: calc(100vw - 240px);-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content.expanded {-->
<!--        margin-left: 70px;-->
<!--        max-width: calc(100vw - 70px);-->
<!--    }-->

<!--    .content-area {-->
<!--        padding: 24px;-->
<!--        padding-top: 100px;-->
<!--        max-width: 1400px;-->
<!--        margin: 0 auto;-->
<!--    }-->

<!--    /* Sidebar Styles */-->
<!--    .sidebar {-->
<!--        width: 240px;-->
<!--        background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);-->
<!--        color: white;-->
<!--        position: fixed;-->
<!--        height: 100vh;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: width 0.3s ease;-->
<!--        z-index: 1000;-->
<!--        left: 0;-->
<!--        top: 0;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar {-->
<!--        width: 4px;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar-thumb {-->
<!--        background: rgba(255, 255, 255, 0.3);-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .sidebar-header {-->
<!--        padding: 18px 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        border-bottom: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo {-->
<!--        width: 38px;-->
<!--        height: 38px;-->
<!--        background: white;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo i {-->
<!--        font-size: 20px;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .sidebar-title {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        white-space: nowrap;-->
<!--        transition: opacity 0.2s, width 0.3s;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .nav-menu {-->
<!--        padding: 12px 0;-->
<!--        overflow-y: auto;-->
<!--        overflow-x: hidden;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .nav-item {-->
<!--        margin: 2px 8px;-->
<!--    }-->

<!--    .nav-link {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        color: rgba(255, 255, 255, 0.8);-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        transition: all 0.2s;-->
<!--        font-size: 0.9em;-->
<!--        cursor: pointer;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .nav-link:hover {-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        color: white;-->
<!--    }-->

<!--    .nav-link.active,-->
<!--    .sub-menu-item.active {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .nav-link i:first-child {-->
<!--        width: 20px;-->
<!--        font-size: 0.95em;-->
<!--        margin-right: 10px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .chevron-icon {-->
<!--        margin-left: auto !important;-->
<!--        font-size: 0.7em !important;-->
<!--        transition: transform 0.3s;-->
<!--        width: auto !important;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .nav-link.expanded .chevron-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sub-menu {-->
<!--        max-height: 0;-->
<!--        overflow: hidden;-->
<!--        transition: max-height 0.3s ease;-->
<!--    }-->

<!--    .sub-menu.open {-->
<!--        max-height: 500px;-->
<!--    }-->

<!--    .sub-menu-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px 8px 42px;-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        text-decoration: none;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--        margin: 2px 0;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .sub-menu-item:hover {-->
<!--        color: white;-->
<!--        background: rgba(255, 255, 255, 0.08);-->
<!--    }-->

<!--    .sub-menu-item::before {-->
<!--        content: "â€¢";-->
<!--        margin-right: 10px;-->
<!--        font-size: 1.2em;-->
<!--    }-->

<!--    .sidebar-footer {-->
<!--        padding: 12px 16px;-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .collapse-btn {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        gap: 8px;-->
<!--        padding: 10px;-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        border: none;-->
<!--        color: white;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        width: 100%;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        white-space: nowrap;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .collapse-btn:hover {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--    }-->

<!--    .collapse-btn i {-->
<!--        transition: transform 0.3s;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar.collapsed {-->
<!--        width: 70px;-->
<!--    }-->

<!--    .sidebar.collapsed .sidebar-title {-->
<!--        opacity: 0;-->
<!--        width: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link span,-->
<!--    .sidebar.collapsed .collapse-btn span {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .sub-menu {-->
<!--        display: none !important;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link {-->
<!--        justify-content: center;-->
<!--        padding: 10px;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link i:first-child {-->
<!--        margin-right: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .chevron-icon {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn {-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn i {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sidebar-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 999;-->
<!--        opacity: 0;-->
<!--        transition: opacity 0.3s;-->
<!--    }-->

<!--    .sidebar-overlay.active {-->
<!--        display: block;-->
<!--        opacity: 1;-->
<!--    }-->

<!--    /* Header Styles */-->
<!--    .top-header {-->
<!--        background: white;-->
<!--        padding: 14px 24px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: space-between;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 240px;-->
<!--        right: 0;-->
<!--        z-index: 500;-->
<!--        gap: 16px;-->
<!--        transition: left 0.3s ease;-->
<!--    }-->

<!--    .mobile-menu-toggle {-->
<!--        display: none;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.3em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: color 0.2s;-->
<!--    }-->

<!--    .mobile-menu-toggle:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .search-bar {-->
<!--        flex: 1;-->
<!--        max-width: 400px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .search-bar i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 9px 14px 9px 38px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: #f9fafb;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--        background: white;-->
<!--        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);-->
<!--    }-->

<!--    .header-actions {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .notification-btn {-->
<!--        position: relative;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.1em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--    }-->

<!--    .notification-btn:hover {-->
<!--        color: #111827;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .notification-btn.active {-->
<!--        color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .notification-badge {-->
<!--        position: absolute;-->
<!--        top: 4px;-->
<!--        right: 4px;-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--        font-size: 0.65em;-->
<!--        min-width: 18px;-->
<!--        height: 18px;-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        padding: 0 4px;-->
<!--    }-->

<!--    .user-profile {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        cursor: pointer;-->
<!--        padding: 6px 10px;-->
<!--        border-radius: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .user-profile:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .user-avatar {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .user-info {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--    }-->

<!--    .user-name {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .user-role {-->
<!--        font-size: 0.75em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .dropdown-icon {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.75em;-->
<!--        margin-left: 4px;-->
<!--        transition: transform 0.3s;-->
<!--    }-->

<!--    .user-profile.active .dropdown-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .user-dropdown {-->
<!--        position: absolute;-->
<!--        top: 100%;-->
<!--        right: 0;-->
<!--        margin-top: 8px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 10px 15px rgba(0, 0, 0, 0.1);-->
<!--        min-width: 200px;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transform: translateY(-10px);-->
<!--        transition: all 0.3s ease;-->
<!--        z-index: 1000;-->
<!--    }-->

<!--    .user-dropdown.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--        transform: translateY(0);-->
<!--    }-->

<!--    .dropdown-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        padding: 10px 14px;-->
<!--        color: #374151;-->
<!--        text-decoration: none;-->
<!--        font-size: 0.9em;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .dropdown-item:first-child {-->
<!--        border-radius: 8px 8px 0 0;-->
<!--    }-->

<!--    .dropdown-item:last-child {-->
<!--        border-radius: 0 0 8px 8px;-->
<!--    }-->

<!--    .dropdown-item:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .dropdown-item i {-->
<!--        width: 18px;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .dropdown-item.danger {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-item.danger i {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-divider {-->
<!--        height: 1px;-->
<!--        background: #e5e7eb;-->
<!--        margin: 4px 0;-->
<!--    }-->

<!--    /* Notifications Panel */-->
<!--    .notifications-panel {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        right: -50%;-->
<!--        width: 50%;-->
<!--        max-width: 600px;-->
<!--        height: 100vh;-->
<!--        background: white;-->
<!--        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);-->
<!--        z-index: 1001;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--    }-->

<!--    .notifications-panel.show {-->
<!--        right: 0;-->
<!--    }-->

<!--    .notifications-header {-->
<!--        padding: 20px 24px;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notifications-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .close-notifications {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        padding: 6px;-->
<!--        border-radius: 6px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .close-notifications:hover {-->
<!--        background: #f3f4f6;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .notifications-tabs {-->
<!--        display: flex;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        padding: 0 24px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .tab-btn {-->
<!--        flex: 1;-->
<!--        padding: 12px;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 500;-->
<!--        cursor: pointer;-->
<!--        border-bottom: 2px solid transparent;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .tab-btn:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .tab-btn.active {-->
<!--        color: #2563eb;-->
<!--        border-bottom-color: #2563eb;-->
<!--    }-->

<!--    .notifications-content {-->
<!--        flex: 1;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px 0;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar {-->
<!--        width: 6px;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar-thumb {-->
<!--        background: #d1d5db;-->
<!--        border-radius: 3px;-->
<!--    }-->

<!--    .notification-item {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        padding: 14px 24px;-->
<!--        cursor: pointer;-->
<!--        transition: background 0.2s;-->
<!--        border-left: 3px solid transparent;-->
<!--    }-->

<!--    .notification-item:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .notification-item.unread {-->
<!--        background: #eff6ff;-->
<!--        border-left-color: #3b82f6;-->
<!--    }-->

<!--    .notification-item.unread:hover {-->
<!--        background: #dbeafe;-->
<!--    }-->

<!--    .notification-icon {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-size: 1.1em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notification-icon.critical {-->
<!--        background: #fee2e2;-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .notification-icon.warning {-->
<!--        background: #fef3c7;-->
<!--        color: #f59e0b;-->
<!--    }-->

<!--    .notification-icon.info {-->
<!--        background: #dbeafe;-->
<!--        color: #3b82f6;-->
<!--    }-->

<!--    .notification-icon.success {-->
<!--        background: #d1fae5;-->
<!--        color: #10b981;-->
<!--    }-->

<!--    .notification-body {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .notification-title {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .notification-text {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 6px;-->
<!--        line-height: 1.4;-->
<!--    }-->

<!--    .notification-time {-->
<!--        font-size: 0.75em;-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .notification-dot {-->
<!--        width: 8px;-->
<!--        height: 8px;-->
<!--        background: #3b82f6;-->
<!--        border-radius: 50%;-->
<!--        flex-shrink: 0;-->
<!--        margin-top: 8px;-->
<!--    }-->

<!--    .notification-item:not(.unread) .notification-dot {-->
<!--        display: none;-->
<!--    }-->

<!--    .notifications-footer {-->
<!--        padding: 16px 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .view-all-btn {-->
<!--        display: block;-->
<!--        width: 100%;-->
<!--        padding: 10px;-->
<!--        background: #f3f4f6;-->
<!--        color: #2563eb;-->
<!--        text-align: center;-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .view-all-btn:hover {-->
<!--        background: #e5e7eb;-->
<!--    }-->

<!--    .notification-overlay {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.4);-->
<!--        z-index: 1000;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .notification-overlay.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--    }-->

<!--    /* Assign Policy Page Styles */-->
<!--    .page-header {-->
<!--        background: white;-->
<!--        padding: 20px 24px;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        margin-bottom: 24px;-->
<!--    }-->

<!--    .page-title-section {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .page-icon {-->
<!--        width: 48px;-->
<!--        height: 48px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 12px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .page-icon i {-->
<!--        font-size: 22px;-->
<!--        color: white;-->
<!--    }-->

<!--    .page-title-text h1 {-->
<!--        font-size: 1.5em;-->
<!--        color: #111827;-->
<!--        font-weight: 700;-->
<!--    }-->

<!--    .page-subtitle {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        margin-top: 4px;-->
<!--    }-->

<!--    .breadcrumb {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        font-size: 0.85em;-->
<!--    }-->

<!--    .breadcrumb a {-->
<!--        color: #6b7280;-->
<!--        text-decoration: none;-->
<!--    }-->

<!--    .breadcrumb a:hover {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .breadcrumb span {-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .assign-container {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        padding: 28px;-->
<!--    }-->

<!--    .step-indicator {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        margin-bottom: 32px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .step-indicator::before {-->
<!--        content: "";-->
<!--        position: absolute;-->
<!--        top: 20px;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        height: 2px;-->
<!--        background: #e5e7eb;-->
<!--        z-index: 0;-->
<!--    }-->

<!--    .step {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        position: relative;-->
<!--        z-index: 1;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .step-circle {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 50%;-->
<!--        background: white;-->
<!--        border: 2px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        color: #9ca3af;-->
<!--        transition: all 0.3s;-->
<!--    }-->

<!--    .step.active .step-circle {-->
<!--        background: #2563eb;-->
<!--        border-color: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .step.completed .step-circle {-->
<!--        background: #10b981;-->
<!--        border-color: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .step-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    .step.active .step-label {-->
<!--        color: #2563eb;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .section {-->
<!--        margin-bottom: 28px;-->
<!--    }-->

<!--    .section-title {-->
<!--        font-size: 1.1em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .section-desc {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-group {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-label {-->
<!--        display: block;-->
<!--        font-size: 0.9em;-->
<!--        color: #374151;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .form-select {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .form-select:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .form-select:disabled {-->
<!--        background: #f9fafb;-->
<!--        cursor: not-allowed;-->
<!--        opacity: 0.6;-->
<!--    }-->

<!--    .search-box {-->
<!--        position: relative;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .search-box i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px 11px 42px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .agents-grid {-->
<!--        display: grid;-->
<!--        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));-->
<!--        gap: 12px;-->
<!--        max-height: 400px;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .agent-card {-->
<!--        background: white;-->
<!--        padding: 14px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        cursor: pointer;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .agent-card:hover {-->
<!--        border-color: #3b82f6;-->
<!--        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);-->
<!--    }-->

<!--    .agent-card.selected {-->
<!--        border-color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .agent-card-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .agent-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .agent-name {-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .agent-status {-->
<!--        font-size: 0.75em;-->
<!--        padding: 3px 8px;-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .status-online {-->
<!--        background: #d1fae5;-->
<!--        color: #059669;-->
<!--    }-->

<!--    .status-offline {-->
<!--        background: #f3f4f6;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .agent-info {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-top: 6px;-->
<!--    }-->

<!--    .selected-count {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        margin-bottom: 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--    }-->

<!--    .selected-count i {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .selected-count span {-->
<!--        font-size: 0.9em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    /* NEW: File Explorer Styles */-->
<!--    .file-explorer-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        background: #f9fafb;-->
<!--        padding: 16px;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .explorer-header {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .explorer-btn {-->
<!--        padding: 8px 16px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 6px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .explorer-btn:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .explorer-btn:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .tree-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 6px;-->
<!--        padding: 12px;-->
<!--        height: 300px;-->
<!--        overflow-y: auto;-->
<!--        background: white;-->
<!--        font-family: monospace;-->
<!--        font-size: 13px;-->
<!--    }-->

<!--    .tree-node {-->
<!--        padding: 6px 8px;-->
<!--        margin: 2px 0;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .tree-node:hover {-->
<!--        background: #e8f0fe;-->
<!--    }-->

<!--    .tree-node.selected {-->
<!--        background: #d2e3fc;-->
<!--        border-left: 3px solid #2563eb;-->
<!--    }-->

<!--    .tree-node.protected {-->
<!--        background: #fee2e2;-->
<!--        border-left: 3px solid #dc2626;-->
<!--    }-->

<!--    .tree-node-icon {-->
<!--        width: 20px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .tree-node-name {-->
<!--        flex: 1;-->
<!--        overflow: hidden;-->
<!--        text-overflow: ellipsis;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .tree-node-badge {-->
<!--        background: #dc2626;-->
<!--        color: white;-->
<!--        font-size: 10px;-->
<!--        padding: 2px 6px;-->
<!--        border-radius: 12px;-->
<!--        margin-left: 8px;-->
<!--        font-family: sans-serif;-->
<!--    }-->

<!--    .tree-node-children {-->
<!--        margin-left: 24px;-->
<!--        border-left: 1px dashed #ddd;-->
<!--        padding-left: 12px;-->
<!--    }-->

<!--    .tree-node-expand {-->
<!--        font-size: 10px;-->
<!--        color: #6b7280;-->
<!--        cursor: pointer;-->
<!--        width: 16px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .selected-path-info {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .path-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .path-value {-->
<!--        font-family: monospace;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        word-break: break-all;-->
<!--    }-->

<!--    /* NEW: Operations List Styles */-->
<!--    .operations-list {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 12px;-->
<!--        margin: 20px 0;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .operation-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .operation-item.disabled {-->
<!--        opacity: 0.5;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .operation-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        margin-right: 12px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .operation-label {-->
<!--        flex: 1;-->
<!--        font-weight: 500;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .operation-desc {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        margin-left: 8px;-->
<!--    }-->

<!--    .read-block-all {-->
<!--        background: #fee2e2;-->
<!--        border: 1px solid #fecaca;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 6px;-->
<!--        margin-top: 12px;-->
<!--        display: none;-->
<!--        color: #991b1b;-->
<!--        font-weight: 500;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--    }-->

<!--    .read-block-all.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    .summary-box {-->
<!--        background: #f9fafb;-->
<!--        padding: 20px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        padding: 10px 0;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row:last-child {-->
<!--        border-bottom: none;-->
<!--    }-->

<!--    .summary-label {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .summary-value {-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .policy-preview {-->
<!--        background: white;-->
<!--        padding: 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #3b82f6;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .policy-preview-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .policy-preview-icon {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: #eff6ff;-->
<!--        border-radius: 8px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .policy-preview-title {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-preview-desc {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .btn-group {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--        padding-top: 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .btn {-->
<!--        padding: 11px 24px;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        cursor: pointer;-->
<!--        border: none;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .btn-primary {-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-primary:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .btn-primary:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .btn-secondary {-->
<!--        background: white;-->
<!--        color: #374151;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--    }-->

<!--    .btn-secondary:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .btn-danger {-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-danger:hover {-->
<!--        background: #dc2626;-->
<!--    }-->

<!--    .btn-warning {-->
<!--        background: #f59e0b;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-warning:hover {-->
<!--        background: #d97706;-->
<!--    }-->

<!--    .btn-success {-->
<!--        background: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-success:hover {-->
<!--        background: #059669;-->
<!--    }-->

<!--    .alert {-->
<!--        padding: 14px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 12px;-->
<!--    }-->

<!--    .alert-info {-->
<!--        background: #eff6ff;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        color: #1e40af;-->
<!--    }-->

<!--    .alert-success {-->
<!--        background: #d1fae5;-->
<!--        border: 1px solid #a7f3d0;-->
<!--        color: #065f46;-->
<!--    }-->

<!--    .alert-warning {-->
<!--        background: #fff3cd;-->
<!--        border: 1px solid #ffeeba;-->
<!--        color: #856404;-->
<!--    }-->

<!--    .alert i {-->
<!--        font-size: 1.1em;-->
<!--    }-->

<!--    .loading {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #6b7280;-->
<!--        font-style: italic;-->
<!--    }-->

<!--    .error {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #ef4444;-->
<!--        background: #fee2e2;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #fca5a5;-->
<!--    }-->

<!--    .mt-10 {-->
<!--        margin-top: 10px;-->
<!--    }-->

<!--    .mb-10 {-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .text-error {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    /* Mobile responsive */-->
<!--    @media (max-width: 1200px) {-->
<!--        .main-content {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .main-content.expanded {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 70px;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 968px) {-->
<!--        .main-content {-->
<!--            margin-left: 0;-->
<!--            max-width: 100vw;-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 0;-->
<!--        }-->

<!--        .mobile-menu-toggle {-->
<!--            display: block;-->
<!--        }-->

<!--        .sidebar {-->
<!--            transform: translateX(-100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .sidebar.mobile-open {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        .agents-grid {-->
<!--            grid-template-columns: 1fr;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 768px) {-->
<!--        .content-area {-->
<!--            padding: 16px;-->
<!--            padding-top: 80px;-->
<!--        }-->

<!--        .notifications-panel {-->
<!--            width: 90%;-->
<!--            right: -90%;-->
<!--        }-->

<!--        .step-indicator {-->
<!--            flex-direction: column;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .step-indicator::before {-->
<!--            display: none;-->
<!--        }-->

<!--        .btn-group {-->
<!--            flex-direction: column;-->
<!--        }-->

<!--        .btn {-->
<!--            width: 100%;-->
<!--            justify-content: center;-->
<!--        }-->

<!--        .user-info {-->
<!--            display: none;-->
<!--        }-->

<!--        .explorer-header {-->
<!--            flex-direction: column;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 640px) {-->
<!--        .content-area {-->
<!--            padding: 12px;-->
<!--            padding-top: 70px;-->
<!--        }-->

<!--        .page-title-section {-->
<!--            flex-direction: column;-->
<!--            align-items: flex-start;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .page-icon {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--        }-->

<!--        .page-icon i {-->
<!--            font-size: 18px;-->
<!--        }-->

<!--        .page-title-text h1 {-->
<!--            font-size: 1.3em;-->
<!--        }-->

<!--        .assign-container {-->
<!--            padding: 16px;-->
<!--        }-->
<!--    }-->

<!--    /* Toast Notifications */-->
<!--    .toast {-->
<!--        position: fixed;-->
<!--        top: 20px;-->
<!--        right: 20px;-->
<!--        padding: 12px 20px;-->
<!--        border-radius: 8px;-->
<!--        color: white;-->
<!--        font-weight: 500;-->
<!--        z-index: 10000;-->
<!--        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);-->
<!--        animation: slideIn 0.3s ease;-->
<!--    }-->

<!--    .toast.success {-->
<!--        background: #10b981;-->
<!--    }-->

<!--    .toast.error {-->
<!--        background: #ef4444;-->
<!--    }-->

<!--    .toast.warning {-->
<!--        background: #f59e0b;-->
<!--    }-->

<!--    .toast.info {-->
<!--        background: #3b82f6;-->
<!--    }-->

<!--    @keyframes slideIn {-->
<!--        from {-->
<!--            transform: translateX(100%);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateX(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    /* Modal Overlay Styles */-->
<!--.modal-overlay.active {-->
<!--    display: flex !important;-->
<!--}-->

<!--.modal-overlay {-->
<!--    display: none;-->
<!--}-->

<!--.modal {-->
<!--    animation: modalSlideIn 0.3s ease;-->
<!--}-->

<!--@keyframes modalSlideIn {-->
<!--    from {-->
<!--        transform: translateY(-20px);-->
<!--        opacity: 0;-->
<!--    }-->
<!--    to {-->
<!--        transform: translateY(0);-->
<!--        opacity: 1;-->
<!--    }-->
<!--}-->

<!--/* Active Policies List Styles */-->
<!--.policy-item-small {-->
<!--    display: flex;-->
<!--    justify-content: space-between;-->
<!--    align-items: center;-->
<!--    padding: 10px 12px;-->
<!--    margin: 6px 0;-->
<!--    background: white;-->
<!--    border-radius: 6px;-->
<!--    border-left: 4px solid #2563eb;-->
<!--    font-size: 0.9em;-->
<!--}-->

<!--.policy-item-small.block-all {-->
<!--    border-left-color: #dc2626;-->
<!--    background: #fee2e2;-->
<!--}-->

<!--.policy-info-compact {-->
<!--    flex: 1;-->
<!--}-->

<!--.policy-name-compact {-->
<!--    font-weight: 600;-->
<!--    color: #111827;-->
<!--}-->

<!--.policy-details-compact {-->
<!--    font-size: 0.85em;-->
<!--    color: #6b7280;-->
<!--    margin-top: 2px;-->
<!--}-->

<!--.policy-remove-btn {-->
<!--    background: none;-->
<!--    border: none;-->
<!--    color: #9ca3af;-->
<!--    cursor: pointer;-->
<!--    padding: 4px 8px;-->
<!--    border-radius: 4px;-->
<!--    transition: all 0.2s;-->
<!--}-->

<!--.policy-remove-btn:hover {-->
<!--    color: #dc2626;-->
<!--    background: #fee2e2;-->
<!--}-->

<!--/* Remove Policy Container */-->
<!--.remove-policy-container {-->
<!--    animation: slideDown 0.3s ease;-->
<!--}-->

<!--@keyframes slideDown {-->
<!--    from {-->
<!--        opacity: 0;-->
<!--        transform: translateY(-10px);-->
<!--    }-->
<!--    to {-->
<!--        opacity: 1;-->
<!--        transform: translateY(0);-->
<!--    }-->
<!--}-->

<!--.mt-20 {-->
<!--    margin-top: 20px;-->
<!--}-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="dashboard-container">-->
<!--  &lt;!&ndash; Sidebar &ndash;&gt;-->
<!--  <aside class="sidebar" id="sidebar">-->
<!--    <div class="sidebar-header">-->
<!--      <div class="sidebar-logo">-->
<!--        <i class="fas fa-shield-halved"></i>-->
<!--      </div>-->
<!--      <div class="sidebar-title">DLP Shield</div>-->
<!--    </div>-->

<!--    <nav class="nav-menu">-->
<!--      <div class="nav-item">-->
<!--        <a href="dashboard.html" class="nav-link" data-page="dashboard">-->
<!--          <i class="fas fa-th-large"></i>-->
<!--          <span>Dashboard</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="alerts.html" class="nav-link" data-page="alerts">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--          <span>Alerts &amp; Incidents</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-shield-alt"></i>-->
<!--          <span>Policies</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu open">-->
<!--          <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>-->
<!--          <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>-->
<!--          <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="agents.html" class="nav-link" data-page="agents">-->
<!--          <i class="fas fa-desktop"></i>-->
<!--          <span>Agents / Endpoints</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-eye"></i>-->
<!--          <span>OCR &amp; Image Analysis</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>-->
<!--          <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-file-lines"></i>-->
<!--          <span>Reports &amp; Logs</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>-->
<!--          <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>-->
<!--          <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>-->
<!--          <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-users"></i>-->
<!--          <span>Users &amp; Roles</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="users.html" class="sub-menu-item" data-page="users">Users</a>-->
<!--          <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>-->
<!--          <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-gear"></i>-->
<!--          <span>Settings</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="general.html" class="sub-menu-item" data-page="general">General</a>-->
<!--          <a href="security.html" class="sub-menu-item" data-page="security">Security</a>-->
<!--          <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>-->
<!--          <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </nav>-->

<!--    <div class="sidebar-footer">-->
<!--      <button class="collapse-btn" onclick="toggleSidebar()">-->
<!--        <i class="fas fa-chevron-left"></i>-->
<!--        <span>Collapse</span>-->
<!--      </button>-->
<!--    </div>-->
<!--  </aside>-->

<!--  &lt;!&ndash; Mobile Overlay &ndash;&gt;-->
<!--  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>-->

<!--  &lt;!&ndash; Header &ndash;&gt;-->
<!--  <header class="top-header" id="topHeader">-->
<!--    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">-->
<!--      <i class="fas fa-bars"></i>-->
<!--    </button>-->

<!--    <div class="search-bar">-->
<!--      <i class="fas fa-search"></i>-->
<!--      <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />-->
<!--    </div>-->

<!--    <div class="header-actions">-->
<!--      <button class="notification-btn" onclick="toggleNotifications(event)">-->
<!--        <i class="fas fa-bell"></i>-->
<!--        <span class="notification-badge" id="alertBadge">5</span>-->
<!--      </button>-->

<!--      <div class="user-profile" onclick="toggleUserDropdown(event)">-->
<!--        <div class="user-avatar">A</div>-->
<!--        <div class="user-info">-->
<!--          <div class="user-name">Admin</div>-->
<!--          <div class="user-role">Security Admin</div>-->
<!--        </div>-->
<!--        <i class="fas fa-chevron-down dropdown-icon"></i>-->

<!--        <div class="user-dropdown" id="userDropdown">-->
<!--          <a href="general.html" class="dropdown-item">-->
<!--            <i class="fas fa-gear"></i>-->
<!--            <span>Settings</span>-->
<!--          </a>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-circle-question"></i>-->
<!--            <span>Help &amp; Support</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="index.html" class="dropdown-item danger" onclick="logout(event)">-->
<!--            <i class="fas fa-right-from-bracket"></i>-->
<!--            <span>Sign out</span>-->
<!--          </a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </header>-->

<!--  &lt;!&ndash; Notifications Panel &ndash;&gt;-->
<!--  <div class="notifications-panel" id="notificationsPanel">-->
<!--    <div class="notifications-header">-->
<!--      <h3>Notifications</h3>-->
<!--      <button class="close-notifications" onclick="closeNotifications()">-->
<!--        <i class="fas fa-times"></i>-->
<!--      </button>-->
<!--    </div>-->

<!--    <div class="notifications-tabs">-->
<!--      <button class="tab-btn active" onclick="switchTab(event, 'all')">All (5)</button>-->
<!--      <button class="tab-btn" onclick="switchTab(event, 'unread')">Unread (3)</button>-->
<!--    </div>-->

<!--    <div class="notifications-content" id="notificationsContent">-->
<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon critical">-->
<!--          <i class="fas fa-shield-exclamation"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Critical Policy Violation</div>-->
<!--          <div class="notification-text">User attempted to copy sensitive files to USB drive</div>-->
<!--          <div class="notification-time">2 minutes ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon warning">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Agent Offline</div>-->
<!--          <div class="notification-text">DESKTOP-DEF456 has been offline for 2 hours</div>-->
<!--          <div class="notification-time">15 minutes ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon info">-->
<!--          <i class="fas fa-info-circle"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Policy Updated</div>-->
<!--          <div class="notification-text">File Protection Policy has been modified by Admin</div>-->
<!--          <div class="notification-time">1 hour ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item">-->
<!--        <div class="notification-icon success">-->
<!--          <i class="fas fa-check-circle"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Agent Connected</div>-->
<!--          <div class="notification-text">New agent LAPTOP-XYZ789 successfully registered</div>-->
<!--          <div class="notification-time">3 hours ago</div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="notification-item">-->
<!--        <div class="notification-icon info">-->
<!--          <i class="fas fa-file-alt"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Report Generated</div>-->
<!--          <div class="notification-text">Weekly security report is ready for review</div>-->
<!--          <div class="notification-time">5 hours ago</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="notifications-footer">-->
<!--      <a href="alerts.html" class="view-all-btn">View All Notifications</a>-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Notification Overlay &ndash;&gt;-->
<!--  <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>-->

<!--  &lt;!&ndash; Main Content &ndash;&gt;-->
<!--  <main class="main-content" id="mainContent">-->
<!--    <div class="content-area">-->
<!--      <div class="breadcrumb">-->
<!--        <a href="dashboard.html"><i class="fas fa-home"></i></a>-->
<!--        <span>/</span>-->
<!--        <a href="file-policies.html">Policies</a>-->
<!--        <span>/</span>-->
<!--        <span>Assign File Protection Policy</span>-->
<!--      </div>-->

<!--      <div class="page-header">-->
<!--        <div class="page-title-section">-->
<!--          <div class="page-icon"><i class="fas fa-file-shield"></i></div>-->
<!--          <div class="page-title-text">-->
<!--            <h1>Assign File Protection Policy</h1>-->
<!--            <p class="page-subtitle">Select agents, choose files/folders, and configure blocking operations</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="assign-container">-->
<!--        &lt;!&ndash; Step Indicator &ndash;&gt;-->
<!--        <div class="step-indicator">-->
<!--          <div class="step active" data-step="1">-->
<!--            <div class="step-circle">1</div>-->
<!--            <div class="step-label">Choose Agent</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="2">-->
<!--            <div class="step-circle">2</div>-->
<!--            <div class="step-label">Policy Type</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="3">-->
<!--            <div class="step-circle">3</div>-->
<!--            <div class="step-label">Select File & Operations</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="4">-->
<!--            <div class="step-circle">4</div>-->
<!--            <div class="step-label">Review & Apply</div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 1: Choose Agent &ndash;&gt;-->
<!--        <div id="step1">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 1: Choose Agent</div>-->
<!--            <div class="section-desc">-->
<!--              Select the agents you want to assign a file protection policy to-->
<!--            </div>-->

<!--            <div class="search-box">-->
<!--              <i class="fas fa-search"></i>-->
<!--              <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..." id="agentSearch" />-->
<!--            </div>-->

<!--            <div class="selected-count" id="selectedCount">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>0 agents selected</span>-->
<!--            </div>-->

<!--            <div class="agents-grid" id="agentsGrid">-->
<!--              &lt;!&ndash; Agent cards will be dynamically generated &ndash;&gt;-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Select at least one agent to continue</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 2: Policy Type &ndash;&gt;-->
<!--        <div id="step2" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 2: Select Policy Type</div>-->
<!--            <div class="section-desc">-->
<!--              Choose the type of policy you want to assign-->
<!--            </div>-->

<!--            <div class="form-group">-->
<!--              <label class="form-label">Policy Type</label>-->
<!--              <select class="form-select" id="policyType">-->
<!--                <option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>-->
<!--                <option value="FILE">File Protection</option>-->
<!--                <option value="NETWORK">Network Policy</option>-->
<!--                <option value="USB">USB Control</option>-->
<!--                <option value="SECURITY_MONITOR">OCR & Security Monitor</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>File Protection allows you to block specific operations on files/folders</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 3: Policy Configuration (Dynamic based on type) &ndash;&gt;-->
<!--        <div id="step3" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 3: Configure Policy</div>-->
<!--            <div class="section-desc" id="step3Description">-->
<!--              Configure the specific settings for your selected policy type-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== FILE PROTECTION UI ===== &ndash;&gt;-->
<!--            <div id="fileProtectionUI" style="display: none;">-->
<!--              &lt;!&ndash; Selected Path Info &ndash;&gt;-->
<!--              <div class="selected-path-info" id="selectedPathInfo" style="display: none;">-->
<!--                <div class="path-label">Selected Path:</div>-->
<!--                <div class="path-value" id="selectedPathValue">-</div>-->
<!--              </div>-->

<!--              &lt;!&ndash; File Explorer &ndash;&gt;-->
<!--              <div class="file-explorer-container">-->
<!--                <div class="explorer-header">-->
<!--                  <button class="explorer-btn" id="btnGetDrives">-->
<!--                    <i class="fas fa-hdd"></i> Get Drives-->
<!--                  </button>-->
<!--                  <button class="explorer-btn" id="btnRefresh" disabled>-->
<!--                    <i class="fas fa-sync-alt"></i> Refresh-->
<!--                  </button>-->
<!--                  <div style="flex:1;"></div>-->
<!--                  <button class="explorer-btn" id="btnClearSelection">-->
<!--                    <i class="fas fa-times"></i> Clear-->
<!--                  </button>-->
<!--                </div>-->
<!--                <div class="tree-container" id="treeContainer">-->
<!--                  <div class="loading">Click "Get Drives" to load file system</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Active Policies for Selected Node &ndash;&gt;-->
<!--              <div class="active-policies-section" id="activePoliciesSection" style="display: none; margin-top: 20px;">-->
<!--                <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                  <span>Active Policies on Selected Resource</span>-->
<!--                </div>-->
<!--                <div class="policies-list" id="selectedNodePolicies" style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #f9fafb;">-->
<!--                  <div class="loading">Loading policies...</div>-->
<!--                </div>-->
<!--                <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">-->
<!--                  <i class="fas fa-info-circle"></i>-->
<!--                  <span>No active policies on this resource</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Operations Selection &ndash;&gt;-->
<!--              <div class="section-title mt-20">Block Operations</div>-->
<!--              <div class="operations-list">-->
<!--                <div class="operation-item" id="read-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">-->
<!--                  <div class="operation-label">READ</div>-->
<!--                  <div class="operation-desc">Open, view, read content</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="write-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">-->
<!--                  <div class="operation-label">WRITE</div>-->
<!--                  <div class="operation-desc">Modify, edit, save changes</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="delete-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">-->
<!--                  <div class="operation-label">DELETE</div>-->
<!--                  <div class="operation-desc">Remove, trash, permanently delete</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="rename-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">-->
<!--                  <div class="operation-label">RENAME</div>-->
<!--                  <div class="operation-desc">Change name, move within volume</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="create-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">-->
<!--                  <div class="operation-label">CREATE</div>-->
<!--                  <div class="operation-desc">New file/folder creation (folders only)</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div class="read-block-all" id="readBlockAllWarning">-->
<!--                <i class="fas fa-exclamation-triangle"></i>-->
<!--                <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>-->
<!--              </div>-->

<!--              &lt;!&ndash; Remove Policy Button &ndash;&gt;-->
<!--              <div class="remove-policy-container" id="removePolicyContainer" style="display: none; margin-top: 20px;">-->
<!--                <div class="alert alert-warning" style="display: flex; justify-content: space-between; align-items: center;">-->
<!--                  <div style="display: flex; align-items: center; gap: 10px;">-->
<!--                    <i class="fas fa-exclamation-triangle"></i>-->
<!--                    <span><strong>Policy Already Exists</strong> - This resource already has protection policies applied.</span>-->
<!--                  </div>-->
<!--                  <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">-->
<!--                    <i class="fas fa-trash-alt"></i> Remove Policy-->
<!--                  </button>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

<!--            <div class="alert alert-warning" id="fileTypeWarning" style="display: none;">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span id="fileTypeWarningText"></span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; ===== NETWORK POLICY UI ===== &ndash;&gt;-->
<!--        <div id="networkUI" style="display: none;">-->
<!--          <div class="network-config-container">-->
<!--            &lt;!&ndash; DNS Domain Blocking &ndash;&gt;-->
<!--            <div class="domain-input-container">-->
<!--              <label class="form-label">Block Domains</label>-->
<!--              <div class="domain-input-group">-->
<!--                <input type="text" class="domain-input" id="domainInput"-->
<!--                       placeholder="Enter domain (e.g., www.example.com, *.social.com)" />-->
<!--                <button class="btn-add-domain" onclick="addDomain()">-->
<!--                  <i class="fas fa-plus"></i> Add-->
<!--                </button>-->
<!--              </div>-->
<!--              <div class="domain-tags" id="domainTags"></div>-->
<!--              <small class="form-text text-muted">Use * for wildcards (e.g., *.social.com blocks all subdomains)</small>-->
<!--            </div>-->

<!--            &lt;!&ndash; IP Address Blocking &ndash;&gt;-->
<!--            <div class="ip-input-container" style="margin-top: 20px;">-->
<!--              <label class="form-label">Block IP Addresses</label>-->
<!--              <div class="domain-input-group">-->
<!--                <input type="text" class="domain-input" id="ipInput"-->
<!--                       placeholder="Enter IP (e.g., 192.168.1.100, 10.0.0.0/24)" />-->
<!--                <button class="btn-add-domain" onclick="addIP()">-->
<!--                  <i class="fas fa-plus"></i> Add-->
<!--                </button>-->
<!--              </div>-->
<!--              <div class="domain-tags" id="ipTags"></div>-->
<!--              <small class="form-text text-muted">Supports single IPs or CIDR notation (e.g., 10.0.0.0/24)</small>-->
<!--            </div>-->

<!--            &lt;!&ndash; Protocol Selection &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">Protocols to Block</label>-->
<!--              <div style="display: flex; gap: 20px; margin-top: 10px;">-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="blockHTTP" checked> HTTP-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="blockHTTPS" checked> HTTPS-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="blockFTP"> FTP-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="blockSSH"> SSH-->
<!--                </label>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Action Type &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">Action</label>-->
<!--              <select class="form-select" id="networkAction">-->
<!--                <option value="block">Block Access</option>-->
<!--                <option value="alert">Alert Only</option>-->
<!--                <option value="log">Log Only</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            &lt;!&ndash; Active Network Policies &ndash;&gt;-->
<!--            <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeNetworkPolicies">-->
<!--              <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                <span>Active Network Policies on Selected Agents</span>-->
<!--              </div>-->
<!--              <div class="policies-list" id="networkPoliciesList" style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #f9fafb;">-->
<!--                <div class="loading">Loading policies...</div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; ===== USB POLICY UI ===== &ndash;&gt;-->
<!--        <div id="usbUI" style="display: none;">-->
<!--          <div class="usb-config-container">-->
<!--            &lt;!&ndash; USB Action &ndash;&gt;-->
<!--            <div class="form-group">-->
<!--              <label class="form-label">USB Device Action</label>-->
<!--              <select class="form-select" id="usbAction">-->
<!--                <option value="block_all">Block All USB Devices</option>-->
<!--                <option value="block_write">Block Write Only (Read Allowed)</option>-->
<!--                <option value="allow_specific">Allow Specific Devices</option>-->
<!--                <option value="audit">Audit Only</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            &lt;!&ndash; Device Whitelist/Blacklist &ndash;&gt;-->
<!--            <div id="specificDevicesUI" style="display: none;">-->
<!--              <label class="form-label">Allowed/Blocked Devices</label>-->
<!--              <div class="device-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">-->
<!--                <input type="text" class="domain-input" id="deviceInput"-->
<!--                       placeholder="Enter Device ID or VID/PID" />-->
<!--                <button class="btn-add-domain" onclick="addDevice()">-->
<!--                  <i class="fas fa-plus"></i> Add-->
<!--                </button>-->
<!--              </div>-->
<!--              <div class="domain-tags" id="deviceTags"></div>-->
<!--              <small class="form-text text-muted">Format: VID:PID (e.g., 0781:5583 for Sandisk USB)</small>-->
<!--            </div>-->

<!--            &lt;!&ndash; USB Types &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">USB Types to Control</label>-->
<!--              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbStorage" checked> Storage Devices-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbKeyboard"> Keyboards-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbMouse"> Mice-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbPrinter"> Printers-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbNetwork"> Network Adapters-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="usbOther"> Other Devices-->
<!--                </label>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Active USB Policies &ndash;&gt;-->
<!--            <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeUSBPolicies">-->
<!--              <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                <span>Active USB Policies on Selected Agents</span>-->
<!--              </div>-->
<!--              <div class="policies-list" id="usbPoliciesList" style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #f9fafb;">-->
<!--                <div class="loading">Loading policies...</div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; ===== OCR/SECURITY MONITOR UI ===== &ndash;&gt;-->
<!--        <div id="ocrUI" style="display: none;">-->
<!--          <div class="ocr-config-container">-->
<!--            &lt;!&ndash; OCR Sensitivity &ndash;&gt;-->
<!--            <div class="form-group">-->
<!--              <label class="form-label">OCR Sensitivity</label>-->
<!--              <select class="form-select" id="ocrSensitivity">-->
<!--                <option value="high">High - Detect any text in images</option>-->
<!--                <option value="medium" selected>Medium - Detect sensitive patterns only</option>-->
<!--                <option value="low">Low - Specific keywords only</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            &lt;!&ndash; Content to Scan &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">Content to Monitor</label>-->
<!--              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanCreditCards" checked> Credit Card Numbers-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanSSN" checked> Social Security Numbers-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanPassports"> Passport Numbers-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanDriversLicense"> Driver's Licenses-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanBankAccounts"> Bank Account Numbers-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanCustom"> Custom Keywords-->
<!--                </label>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Custom Keywords &ndash;&gt;-->
<!--            <div id="customKeywordsUI" style="display: none; margin-top: 20px;">-->
<!--              <label class="form-label">Custom Keywords/Patterns</label>-->
<!--              <div class="domain-input-group">-->
<!--                <input type="text" class="domain-input" id="keywordInput"-->
<!--                       placeholder="Enter keyword or regex pattern" />-->
<!--                <button class="btn-add-domain" onclick="addKeyword()">-->
<!--                  <i class="fas fa-plus"></i> Add-->
<!--                </button>-->
<!--              </div>-->
<!--              <div class="domain-tags" id="keywordTags"></div>-->
<!--            </div>-->

<!--            &lt;!&ndash; File Types &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">File Types to Scan</label>-->
<!--              <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px;">-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanImages" checked> Images (JPG, PNG, GIF)-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanPDF" checked> PDF Documents-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanOffice"> Office Documents-->
<!--                </label>-->
<!--                <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <input type="checkbox" id="scanScreenshots"> Screenshots-->
<!--                </label>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; Action &ndash;&gt;-->
<!--            <div style="margin-top: 20px;">-->
<!--              <label class="form-label">On Detection</label>-->
<!--              <select class="form-select" id="ocrAction">-->
<!--                <option value="block">Block and Alert</option>-->
<!--                <option value="alert">Alert Only</option>-->
<!--                <option value="log">Log Only</option>-->
<!--                <option value="quarantine">Quarantine File</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            &lt;!&ndash; Active OCR Policies &ndash;&gt;-->
<!--            <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeOCRPolicies">-->
<!--              <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                <span>Active OCR Policies on Selected Agents</span>-->
<!--              </div>-->
<!--              <div class="policies-list" id="ocrPoliciesList" style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; background: #f9fafb;">-->
<!--                <div class="loading">Loading policies...</div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->


<!--        &lt;!&ndash; STEP 4: Review & Apply &ndash;&gt;-->
<!--        <div id="step4" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 4: Review & Apply</div>-->
<!--            <div class="section-desc">-->
<!--              Verify the file protection policy before applying-->
<!--            </div>-->

<!--            <div class="summary-box">-->
<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Agents Selected</span>-->
<!--                <span class="summary-value" id="summaryAgentCount">0</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Policy Type</span>-->
<!--                <span class="summary-value" id="summaryPolicyType">File Protection</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Protected Path</span>-->
<!--                <span class="summary-value" id="summaryPath">-</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Resource Type</span>-->
<!--                <span class="summary-value" id="summaryResourceType">-</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Node ID</span>-->
<!--                <span class="summary-value" id="summaryNodeId">-</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Blocked Operations</span>-->
<!--                <span class="summary-value" id="summaryOperations">-</span>-->
<!--              </div>-->

<!--              <div class="summary-row" id="summaryBlockAllRow" style="display: none;">-->
<!--                <span class="summary-label text-error">âš ï¸ Effect</span>-->
<!--                <span class="summary-value text-error">ALL ACCESS BLOCKED</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            <div class="policy-preview mt-20">-->
<!--              <div class="policy-preview-header">-->
<!--                <div class="policy-preview-icon">-->
<!--                  <i class="fas fa-shield-alt"></i>-->
<!--                </div>-->
<!--                <div>-->
<!--                  <div class="policy-preview-title">Policy Preview</div>-->
<!--                  <div class="policy-preview-desc">This policy will be applied to all selected agents</div>-->
<!--                </div>-->
<!--              </div>-->
<!--              <div style="font-size: 0.9em; color: #374151;">-->
<!--                <p><strong>File/Folder:</strong> <span id="previewPath">-</span></p>-->
<!--                <p><strong>Blocked Operations:</strong> <span id="previewOperations">-</span></p>-->
<!--                <p><strong>Scope:</strong> <span id="previewScope">-</span></p>-->
<!--              </div>-->
<!--            </div>-->

<!--            <div class="alert alert-success" style="margin-top: 20px">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The policy will be applied to all selected agents within 5 minutes.</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div class="btn-group">-->
<!--          <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">-->
<!--            <i class="fas fa-arrow-left"></i><span>Previous</span>-->
<!--          </button>-->
<!--          <button class="btn btn-secondary" onclick="cancelAssignment()">-->
<!--            <i class="fas fa-times"></i><span>Cancel</span>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">-->
<!--            <span>Next</span><i class="fas fa-arrow-right"></i>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">-->
<!--            <i class="fas fa-check"></i><span>Apply Policy</span>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </main>-->
<!--</div>-->
<!--<script>-->
<!--  let blockedDomains = [];-->
<!--  let blockedIPs = [];-->
<!--  let allowedDevices = [];-->
<!--  let customKeywords = [];-->
<!--    let activeNodePolicies = []; // Store policies for current selected node-->
<!--    let policyToRemove = null; // Store policy to remove-->

<!--    /* ==================== AUTHENTICATION & USER DATA ==================== */-->
<!--    async function checkAuth() {-->
<!--        try {-->
<!--            const response = await fetch("/api/auth/check", {-->
<!--                credentials: "include",-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                throw new Error("Not authenticated");-->
<!--            }-->

<!--            const result = await response.json();-->

<!--            if (!result.success) {-->
<!--                window.location.href = "index.html";-->
<!--                return null;-->
<!--            }-->

<!--            if (result.data) {-->
<!--                localStorage.setItem("userData", JSON.stringify(result.data));-->
<!--                return result.data;-->
<!--            }-->

<!--            return null;-->
<!--        } catch (err) {-->
<!--            window.location.href = "index.html";-->
<!--            return null;-->
<!--        }-->
<!--    }-->

<!--    function loadAdminInfo() {-->
<!--        const userDataStr = localStorage.getItem("userData");-->

<!--        if (userDataStr) {-->
<!--            try {-->
<!--                const userData = JSON.parse(userDataStr);-->

<!--                const userName = document.querySelector(".user-name");-->
<!--                const userAvatar = document.querySelector(".user-avatar");-->
<!--                const userRole = document.querySelector(".user-role");-->

<!--                if (userName) {-->
<!--                    const namePart = userData.username || "Admin";-->
<!--                    const formattedName = namePart-->
<!--                        .split(".")-->
<!--                        .map(n => n.charAt(0).toUpperCase() + n.slice(1))-->
<!--                        .join(" ");-->
<!--                    userName.textContent = formattedName;-->
<!--                }-->

<!--                if (userAvatar) {-->
<!--                    const namePart = userData.username || "Admin";-->
<!--                    const initials = namePart-->
<!--                        .split(".")-->
<!--                        .map(n => (n[0] ? n[0].toUpperCase() : ""))-->
<!--                        .join("");-->
<!--                    userAvatar.textContent = initials || "A";-->
<!--                }-->

<!--                if (userRole) {-->
<!--                    userRole.textContent = userData.role || "Security Admin";-->
<!--                }-->
<!--            } catch (e) {-->
<!--                console.error("Error parsing user data:", e);-->
<!--            }-->
<!--        }-->
<!--    }-->

<!--    /* ==================== SIDEBAR FUNCTIONS ==================== */-->
<!--    function toggleSubMenu(element) {-->
<!--        var sidebar = document.getElementById("sidebar");-->
<!--        if (sidebar.classList.contains("collapsed")) return;-->

<!--        var subMenu = element.nextElementSibling;-->
<!--        var allSubMenus = document.querySelectorAll(".sub-menu");-->
<!--        var allDropdowns = document.querySelectorAll(".nav-dropdown");-->

<!--        allSubMenus.forEach(function(menu) {-->
<!--            if (menu !== subMenu) menu.classList.remove("open");-->
<!--        });-->
<!--        allDropdowns.forEach(function(link) {-->
<!--            if (link !== element) link.classList.remove("expanded");-->
<!--        });-->

<!--        element.classList.toggle("expanded");-->
<!--        subMenu.classList.toggle("open");-->
<!--    }-->

<!--    function toggleSidebar() {-->
<!--        var sidebar = document.getElementById("sidebar");-->
<!--        var mainContent = document.getElementById("mainContent");-->
<!--        var header = document.getElementById("topHeader");-->

<!--        sidebar.classList.toggle("collapsed");-->
<!--        var isCollapsed = sidebar.classList.contains("collapsed");-->

<!--        if (mainContent) mainContent.classList.toggle("expanded");-->

<!--        if (header) {-->
<!--            header.style.left = isCollapsed ? "70px" : "240px";-->
<!--        }-->

<!--        if (isCollapsed) {-->
<!--            document.querySelectorAll(".sub-menu").forEach(function(m) {-->
<!--                m.classList.remove("open");-->
<!--            });-->
<!--            document.querySelectorAll(".nav-dropdown").forEach(function(l) {-->
<!--                l.classList.remove("expanded");-->
<!--            });-->
<!--        }-->

<!--        window.dispatchEvent(-->
<!--            new CustomEvent("sidebarToggle", {-->
<!--                detail: { collapsed: isCollapsed },-->
<!--            })-->
<!--        );-->
<!--    }-->

<!--    function openMobileSidebar() {-->
<!--        var sidebar = document.getElementById("sidebar");-->
<!--        var overlay = document.getElementById("sidebarOverlay");-->
<!--        if (sidebar) sidebar.classList.add("mobile-open");-->
<!--        if (overlay) overlay.classList.add("active");-->
<!--    }-->

<!--    function closeMobileSidebar() {-->
<!--        var sidebar = document.getElementById("sidebar");-->
<!--        var overlay = document.getElementById("sidebarOverlay");-->
<!--        if (sidebar) sidebar.classList.remove("mobile-open");-->
<!--        if (overlay) overlay.classList.remove("active");-->
<!--    }-->

<!--    function toggleMobileMenu() {-->
<!--        var sidebar = document.getElementById("sidebar");-->
<!--        var overlay = document.getElementById("sidebarOverlay");-->
<!--        if (!sidebar) return;-->

<!--        if (sidebar.classList.contains("mobile-open")) {-->
<!--            closeMobileSidebar();-->
<!--        } else {-->
<!--            openMobileSidebar();-->
<!--        }-->
<!--    }-->

<!--    function setActiveMenuItem() {-->
<!--        var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';-->

<!--        document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {-->
<!--            el.classList.remove('active');-->
<!--        });-->

<!--        document.querySelectorAll('.sub-menu-item[data-page]').forEach(function(item) {-->
<!--            var href = item.getAttribute('href');-->
<!--            if (href === currentPage) {-->
<!--                item.classList.add('active');-->
<!--                var parentSubMenu = item.closest('.sub-menu');-->
<!--                if (parentSubMenu) {-->
<!--                    parentSubMenu.classList.add('open');-->
<!--                    var parentNav = parentSubMenu.previousElementSibling;-->
<!--                    if (parentNav) parentNav.classList.add('expanded');-->
<!--                }-->
<!--            }-->
<!--        });-->

<!--        document.querySelectorAll('.nav-link[data-page]').forEach(function(link) {-->
<!--            var href = link.getAttribute('href');-->
<!--            if (href === currentPage) {-->
<!--                link.classList.add('active');-->
<!--            }-->
<!--        });-->
<!--    }-->

<!--    /* ==================== HEADER FUNCTIONS ==================== */-->
<!--    function toggleNotifications(event) {-->
<!--        event.stopPropagation();-->
<!--        var panel = document.getElementById("notificationsPanel");-->
<!--        var overlay = document.getElementById("notificationOverlay");-->
<!--        var btn = event.currentTarget;-->
<!--        if (!panel || !overlay) return;-->

<!--        if (panel.classList.contains("show")) {-->
<!--            closeNotifications();-->
<!--        } else {-->
<!--            closeUserDropdown();-->
<!--            panel.classList.add("show");-->
<!--            overlay.classList.add("show");-->
<!--            btn.classList.add("active");-->
<!--            document.body.style.overflow = "hidden";-->
<!--        }-->
<!--    }-->

<!--    function closeNotifications() {-->
<!--        var panel = document.getElementById("notificationsPanel");-->
<!--        var overlay = document.getElementById("notificationOverlay");-->
<!--        var btn = document.querySelector(".notification-btn");-->
<!--        if (panel) panel.classList.remove("show");-->
<!--        if (overlay) overlay.classList.remove("show");-->
<!--        if (btn) btn.classList.remove("active");-->
<!--        document.body.style.overflow = "";-->
<!--    }-->

<!--    function switchTab(event, tabName) {-->
<!--        document.querySelectorAll(".tab-btn").forEach(function(t) {-->
<!--            t.classList.remove("active");-->
<!--        });-->
<!--        event.currentTarget.classList.add("active");-->

<!--        document.querySelectorAll(".notification-item").forEach(function(item) {-->
<!--            item.style.display =-->
<!--                tabName === "unread" && !item.classList.contains("unread") ? "none" : "flex";-->
<!--        });-->
<!--    }-->

<!--    function toggleUserDropdown(event) {-->
<!--        event.stopPropagation();-->
<!--        var dropdown = document.getElementById("userDropdown");-->
<!--        var userProfile = event.currentTarget;-->
<!--        if (!dropdown) return;-->

<!--        if (dropdown.classList.contains("show")) {-->
<!--            closeUserDropdown();-->
<!--        } else {-->
<!--            closeNotifications();-->
<!--            dropdown.classList.add("show");-->
<!--            userProfile.classList.add("active");-->
<!--        }-->
<!--    }-->

<!--    function closeUserDropdown() {-->
<!--        var dropdown = document.getElementById("userDropdown");-->
<!--        var userProfile = document.querySelector(".user-profile");-->
<!--        if (dropdown) dropdown.classList.remove("show");-->
<!--        if (userProfile) userProfile.classList.remove("active");-->
<!--    }-->

<!--    function logout(event) {-->
<!--        event.preventDefault();-->
<!--        window.location.href = "/logout";-->
<!--    }-->

<!--    document.addEventListener("click", function(event) {-->
<!--        if (!event.target.closest(".user-profile")) {-->
<!--            closeUserDropdown();-->
<!--        }-->
<!--        if (-->
<!--            !event.target.closest(".notification-btn") &&-->
<!--            !event.target.closest(".notifications-panel")-->
<!--        ) {-->
<!--            closeNotifications();-->
<!--        }-->
<!--    });-->

<!--    /* ==================== ASSIGN POLICY STATE ==================== */-->
<!--    let selectedAgents = new Set();-->
<!--    let agentsBasicData = {};-->
<!--    let agentsCapabilities = {};-->
<!--    let currentStep = 1;-->

<!--    // File Explorer State-->
<!--    let treeData = {};-->
<!--    let selectedNode = null;-->
<!--    let operations = {-->
<!--        read: false,-->
<!--        write: false,-->
<!--        delete: false,-->
<!--        rename: false,-->
<!--        create: false-->
<!--    };-->
<!--    let isSearchMode = false;-->
<!--    let currentlyExpanding = new Set();-->

<!--  &lt;!&ndash;  const API_BASE = 'http://localhost:8090&ndash;&gt;-->


<!--    /* ==================== AGENT FUNCTIONS ==================== */-->
<!--    async function initializeAgentCards() {-->
<!--        const agentsGrid = document.getElementById("agentsGrid");-->
<!--        if (!agentsGrid) return;-->

<!--        agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';-->

<!--        try {-->
<!--            const response = await fetch("/api/admin/agents", {-->
<!--                headers: {-->
<!--                    "Content-Type": "application/json",-->
<!--                },-->
<!--                credentials: "include",-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                throw new Error("Failed to fetch agents");-->
<!--            }-->

<!--            const result = await response.json();-->

<!--            if (!result.success || !result.data) {-->
<!--                throw new Error(result.message || "No agents found");-->
<!--            }-->

<!--            const agents = result.data;-->
<!--            agentsGrid.innerHTML = "";-->

<!--            agents.forEach((agent) => {-->
<!--                const agentCard = document.createElement("div");-->
<!--                agentCard.className = "agent-card";-->
<!--                agentCard.dataset.id = agent.id;-->
<!--                agentCard.onclick = () => toggleAgent(agent.id);-->

<!--                agentCard.innerHTML = `-->
<!--                    <div class="agent-card-header">-->
<!--                        <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""}>-->
<!--                        <div class="agent-name">${agent.username}</div>-->
<!--                        <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"}">-->
<!--                            ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}-->
<!--                        </span>-->
<!--                    </div>-->
<!--                    <div class="agent-info">-->
<!--                        <span><i class="fas fa-user"></i> ${agent.hostname || agent.username}</span>-->
<!--                        <span><i class="fas fa-id-badge"></i> ${agent.id}</span>-->
<!--                    </div>-->
<!--                    <div class="agent-info">-->
<!--                        <span><i class="fab fa-${getOSIcon(agent.osType)}"></i> ${agent.osType || "Unknown OS"}</span>-->
<!--                        <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"}</span>-->
<!--                    </div>-->
<!--                `;-->

<!--                agentsGrid.appendChild(agentCard);-->

<!--                if (selectedAgents.has(agent.id)) {-->
<!--                    agentCard.classList.add("selected");-->
<!--                    agentCard.querySelector(".agent-checkbox").checked = true;-->
<!--                }-->
<!--            });-->
<!--        } catch (error) {-->
<!--            console.error("Error loading agents:", error);-->
<!--            agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;-->
<!--        }-->

<!--        updateSelectedCount();-->
<!--    }-->

<!--    function isAgentOnline(agent) {-->
<!--        if (agent.agentRuntimeState && agent.agentRuntimeState.toUpperCase() === "ONLINE") {-->
<!--            return true;-->
<!--        }-->

<!--        if (agent.lastHeartbeat) {-->
<!--            const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();-->
<!--            const now = new Date();-->
<!--            const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);-->
<!--            return diffMinutes <= 10;-->
<!--        }-->

<!--        return false;-->
<!--    }-->

<!--    function getOSIcon(os) {-->
<!--        if (!os) return "desktop";-->

<!--        const osLower = os.toLowerCase();-->
<!--        if (osLower.includes("windows")) return "windows";-->
<!--        if (osLower.includes("macos") || osLower.includes("mac")) return "apple";-->
<!--        if (osLower.includes("ubuntu") || osLower.includes("linux")) return "linux";-->
<!--        return "desktop";-->
<!--    }-->

<!--    async function toggleAgent(agentId) {-->
<!--        if (selectedAgents.has(agentId)) {-->
<!--            selectedAgents.delete(agentId);-->
<!--            delete agentsCapabilities[agentId];-->
<!--        } else {-->
<!--            selectedAgents.add(agentId);-->
<!--            if (!agentsCapabilities[agentId]) {-->
<!--                try {-->
<!--                    await fetchAgentDetails(agentId);-->
<!--                } catch (error) {-->
<!--                    console.error(`Failed to fetch capabilities for agent ${agentId}:`, error);-->
<!--                    agentsCapabilities[agentId] = {};-->
<!--                }-->
<!--            }-->
<!--        }-->

<!--        const agentCard = document.querySelector(`.agent-card[data-id="${agentId}"]`);-->
<!--        if (agentCard) {-->
<!--            agentCard.classList.toggle("selected");-->
<!--            const checkbox = agentCard.querySelector(".agent-checkbox");-->
<!--            if (checkbox) {-->
<!--                checkbox.checked = selectedAgents.has(agentId);-->
<!--            }-->
<!--        }-->

<!--        updateSelectedCount();-->
<!--    }-->

<!--    async function fetchAgentDetails(agentId) {-->
<!--        try {-->
<!--            const response = await fetch(`/api/admin/agents/${agentId}/capabilities`, {-->
<!--                headers: {-->
<!--                    "Content-Type": "application/json",-->
<!--                },-->
<!--                credentials: "include",-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                throw new Error(`HTTP ${response.status}: Failed to fetch capabilities`);-->
<!--            }-->

<!--            const result = await response.json();-->

<!--            if (result.success && result.data) {-->
<!--                agentsCapabilities[agentId] = result.data;-->
<!--            } else {-->
<!--                throw new Error(result.message || "Failed to load capabilities");-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error(`Error fetching capabilities for agent ${agentId}:`, error);-->
<!--            agentsCapabilities[agentId] = {};-->
<!--            throw error;-->
<!--        }-->
<!--    }-->

<!--    async function fetchAgentSimpleDetails() {-->
<!--        try {-->
<!--            const response = await fetch("/api/admin/agents", {-->
<!--                headers: {-->
<!--                    "Content-Type": "application/json",-->
<!--                },-->
<!--                credentials: "include",-->
<!--            });-->

<!--            if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--            const result = await response.json();-->
<!--            if (result.success && result.data) {-->
<!--                result.data.forEach((agent) => {-->
<!--                    agentsBasicData[agent.id] = agent;-->
<!--                });-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error("Error fetching agents:", error);-->
<!--        }-->
<!--    }-->

<!--    function updateSelectedCount() {-->
<!--        const count = selectedAgents.size;-->
<!--        const selectedCountElement = document.getElementById("selectedCount");-->
<!--        if (selectedCountElement) {-->
<!--            selectedCountElement.innerHTML = `-->
<!--                <i class="fas fa-check-circle"></i>-->
<!--                <span>${count} agent${count !== 1 ? "s" : ""} selected</span>-->
<!--            `;-->
<!--        }-->
<!--    }-->

<!--    document.addEventListener("input", function(e) {-->
<!--        if (e.target && e.target.id === "agentSearch") {-->
<!--            const searchTerm = e.target.value.toLowerCase();-->
<!--            const agentCards = document.querySelectorAll(".agent-card");-->

<!--            agentCards.forEach((card) => {-->
<!--                const text = card.textContent.toLowerCase();-->
<!--                card.style.display = text.includes(searchTerm) ? "block" : "none";-->
<!--            });-->
<!--        }-->
<!--    });-->

<!--    /* ==================== FILE EXPLORER FUNCTIONS ==================== */-->

<!--    async function getDrives() {-->
<!--        try {-->
<!--            const treeContainer = document.getElementById('treeContainer');-->
<!--            treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';-->

<!--            const response = await fetch(`/api/admin/explorer/drives`);-->
<!--            const data = await response.json();-->

<!--            treeData = data;-->
<!--            document.getElementById('btnRefresh').disabled = false;-->
<!--            renderTree(data);-->
<!--        } catch (error) {-->
<!--            console.error('Failed to get drives:', error);-->
<!--            document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';-->
<!--        }-->
<!--    }-->

<!--    async function expandNode(node) {-->
<!--        if (!node || node.expanded || currentlyExpanding.has(node.id)) {-->
<!--            return;-->
<!--        }-->

<!--        currentlyExpanding.add(node.id);-->

<!--        try {-->
<!--            const response = await fetch(-->
<!--                `/api/admin/explorer/nodes/${node.id}/expand`,-->
<!--                { method: 'POST' }-->
<!--            );-->

<!--            if (response.status === 409) {-->
<!--                console.info(`Node already expanded: ${node.name}`);-->
<!--                node.expanded = true;-->
<!--                return;-->
<!--            }-->

<!--            if (!response.ok) {-->
<!--                throw new Error(`HTTP ${response.status}`);-->
<!--            }-->

<!--            const data = await response.json();-->

<!--            if (!Array.isArray(data)) {-->
<!--                console.error('Invalid expand response:', data);-->
<!--                return;-->
<!--            }-->

<!--            updateTreeWithChildren(node.id, data);-->
<!--            node.expanded = true;-->

<!--        } catch (error) {-->
<!--            console.error('Expand failed:', error);-->
<!--        } finally {-->
<!--            currentlyExpanding.delete(node.id);-->
<!--            renderTree(treeData);-->
<!--        }-->
<!--    }-->

<!--    async function refreshExplorer() {-->
<!--        if (!selectedNode) {-->
<!--            await getDrives();-->
<!--            return;-->
<!--        }-->

<!--        const node = findNode(treeData, selectedNode.id);-->
<!--        if (!node) return;-->

<!--        if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {-->
<!--            node.expanded = false;-->
<!--            node.children = [];-->
<!--            renderTree(treeData);-->

<!--            setTimeout(() => {-->
<!--                expandNode(node);-->
<!--            }, 200);-->
<!--        }-->
<!--    }-->

<!--    function findNode(nodes, id) {-->
<!--        for (const node of nodes) {-->
<!--            if (node.id === id) return node;-->
<!--            if (node.children) {-->
<!--                const found = findNode(node.children, id);-->
<!--                if (found) return found;-->
<!--            }-->
<!--        }-->
<!--        return null;-->
<!--    }-->

<!--    function renderTree(data) {-->
<!--        const treeContainer = document.getElementById('treeContainer');-->
<!--        if (!treeContainer) return;-->

<!--        treeContainer.innerHTML = '';-->

<!--        if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {-->
<!--            treeContainer.innerHTML = '<div class="loading">No items found</div>';-->
<!--            return;-->
<!--        }-->

<!--        const items = Array.isArray(data) ? data : Object.values(data);-->
<!--        items.forEach(item => {-->
<!--            renderTreeNode(item, 0);-->
<!--        });-->
<!--    }-->

<!--    function renderTreeNode(node, level) {-->
<!--        const treeContainer = document.getElementById('treeContainer');-->
<!--        const nodeEl = document.createElement('div');-->
<!--        const isSelected = selectedNode && selectedNode.id === node.id;-->

<!--        nodeEl.className = 'tree-node';-->
<!--        if (isSelected) nodeEl.classList.add('selected');-->

<!--        const indent = level * 20;-->
<!--        nodeEl.style.paddingLeft = `${indent + 10}px`;-->

<!--        if (node.type === 'folder' || node.type === 'drive') {-->
<!--            const expandEl = document.createElement('div');-->
<!--            expandEl.className = 'tree-node-expand';-->
<!--            expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';-->
<!--            expandEl.style.cursor = 'pointer';-->
<!--            expandEl.style.marginRight = '5px';-->
<!--            expandEl.style.fontSize = '12px';-->

<!--            expandEl.addEventListener('click', function(e) {-->
<!--                e.stopPropagation();-->
<!--                toggleFolder(node);-->
<!--            });-->

<!--            nodeEl.appendChild(expandEl);-->
<!--        } else {-->
<!--            const spacer = document.createElement('div');-->
<!--            spacer.style.width = '16px';-->
<!--            spacer.style.display = 'inline-block';-->
<!--            nodeEl.appendChild(spacer);-->
<!--        }-->

<!--        const iconEl = document.createElement('div');-->
<!--        iconEl.className = 'tree-node-icon';-->
<!--        iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';-->
<!--        nodeEl.appendChild(iconEl);-->

<!--        const nameEl = document.createElement('div');-->
<!--        nameEl.className = 'tree-node-name';-->
<!--        nameEl.textContent = node.name || 'Unnamed';-->
<!--        nodeEl.appendChild(nameEl);-->

<!--        nodeEl.addEventListener('click', function(e) {-->
<!--            e.stopPropagation();-->
<!--            selectNode(node);-->
<!--        });-->

<!--        treeContainer.appendChild(nodeEl);-->

<!--        if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {-->
<!--            const childrenContainer = document.createElement('div');-->
<!--            childrenContainer.className = 'tree-node-children';-->

<!--            node.children.forEach(child => {-->
<!--                renderTreeNode(child, level + 1);-->
<!--            });-->
<!--        }-->
<!--    }-->

<!--    async function toggleFolder(node) {-->
<!--        if (node.expanded) {-->
<!--            try {-->
<!--                await fetch(-->
<!--                    `/api/admin/explorer/nodes/${node.id}/collapse`,-->
<!--                    { method: 'POST' }-->
<!--                );-->

<!--                node.expanded = false;-->
<!--                node.children = [];-->

<!--                renderTree(treeData);-->
<!--            } catch (e) {-->
<!--                console.error("Collapse failed", e);-->
<!--            }-->
<!--            return;-->
<!--        }-->

<!--        if (currentlyExpanding.has(node.id)) return;-->
<!--        expandNode(node);-->
<!--    }-->

<!--    function selectNode(node) {-->
<!--        selectedNode = node;-->

<!--        // Show selected path info-->
<!--        document.getElementById('selectedPathInfo').style.display = 'block';-->
<!--        document.getElementById('selectedPathValue').textContent = node.full_path || node.id;-->

<!--        // Load policies for this node-->
<!--      loadNodePolicies(node.id);-->

<!--        // Update operation checkboxes based on node type-->
<!--        const cbCreate = document.getElementById('cb-create');-->
<!--        if (node.type === 'file') {-->
<!--            operations.create = false;-->
<!--            cbCreate.checked = false;-->
<!--            cbCreate.disabled = true;-->
<!--            document.getElementById('create-operation').classList.add('disabled');-->
<!--        } else {-->
<!--            cbCreate.disabled = false;-->
<!--            document.getElementById('create-operation').classList.remove('disabled');-->
<!--        }-->

<!--        // Clear previous operations-->
<!--        clearOperations();-->

<!--        renderTree(treeData);-->
<!--        updatePolicyButtons();-->
<!--    }-->

<!--    function clearSelection() {-->
<!--        selectedNode = null;-->
<!--        document.getElementById('selectedPathInfo').style.display = 'none';-->
<!--        document.getElementById('selectedPathValue').textContent = '-';-->
<!--        clearOperations();-->
<!--        renderTree(treeData);-->
<!--    }-->

<!--    function updateTreeWithChildren(parentId, children) {-->
<!--        if (!Array.isArray(children)) {-->
<!--            console.error("Children is not array:", children);-->
<!--            return;-->
<!--        }-->

<!--        function updateNode(nodes) {-->
<!--            for (let node of nodes) {-->
<!--                if (!node) continue;-->

<!--                if (node.id === parentId) {-->
<!--                    node.children = children;-->
<!--                    node.expanded = true;-->
<!--                    return true;-->
<!--                }-->

<!--                if (Array.isArray(node.children)) {-->
<!--                    if (updateNode(node.children)) return true;-->
<!--                }-->
<!--            }-->
<!--            return false;-->
<!--        }-->

<!--        if (Array.isArray(treeData)) {-->
<!--            updateNode(treeData);-->
<!--        }-->
<!--    }-->

<!--    /* ==================== OPERATIONS FUNCTIONS ==================== */-->
<!--    function initOperationCheckboxes() {-->
<!--        const checkboxes = document.querySelectorAll('.operation-checkbox');-->
<!--        checkboxes.forEach(cb => {-->
<!--            cb.addEventListener('change', function() {-->
<!--                const operation = this.getAttribute('data-operation');-->

<!--                if (operation === 'read') {-->
<!--                    handleReadCheckboxChange(this.checked);-->
<!--                } else {-->
<!--                    handleOperationChange(operation, this.checked);-->
<!--                }-->

<!--                updatePolicyButtons();-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    function handleReadCheckboxChange(isChecked) {-->
<!--        operations.read = isChecked;-->

<!--        document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);-->

<!--        if (isChecked) {-->
<!--            const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--            otherOperations.forEach(op => {-->
<!--                operations[op] = false;-->
<!--                const cb = document.getElementById(`cb-${op}`);-->
<!--                cb.checked = false;-->
<!--                cb.disabled = true;-->
<!--                document.getElementById(`${op}-operation`).classList.add('disabled');-->
<!--            });-->
<!--        } else {-->
<!--            const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--            otherOperations.forEach(op => {-->
<!--                const cb = document.getElementById(`cb-${op}`);-->
<!--                cb.disabled = false;-->
<!--                document.getElementById(`${op}-operation`).classList.remove('disabled');-->
<!--            });-->

<!--            // Re-apply file type restrictions-->
<!--            if (selectedNode && selectedNode.type === 'file') {-->
<!--                document.getElementById('cb-create').disabled = true;-->
<!--                document.getElementById('create-operation').classList.add('disabled');-->
<!--            }-->
<!--        }-->
<!--    }-->

<!--    function handleOperationChange(operation, isChecked) {-->
<!--        operations[operation] = isChecked;-->
<!--    }-->

<!--    function clearOperations() {-->
<!--        Object.keys(operations).forEach(op => {-->
<!--            operations[op] = false;-->
<!--        });-->

<!--        document.querySelectorAll('.operation-checkbox').forEach(cb => {-->
<!--            cb.checked = false;-->
<!--            cb.disabled = false;-->
<!--        });-->

<!--        document.querySelectorAll('.operation-item').forEach(item => {-->
<!--            item.classList.remove('disabled');-->
<!--        });-->

<!--        document.getElementById('readBlockAllWarning').classList.remove('active');-->

<!--        // Re-apply file type restrictions-->
<!--        if (selectedNode && selectedNode.type === 'file') {-->
<!--            document.getElementById('cb-create').disabled = true;-->
<!--            document.getElementById('create-operation').classList.add('disabled');-->
<!--        }-->
<!--    }-->

<!--    function updatePolicyButtons() {-->
<!--        const hasSelection = selectedNode !== null;-->
<!--        const hasAnyOperationChecked = Object.values(operations).some(v => v);-->

<!--        document.getElementById('nextBtn').disabled = currentStep === 3 && (!hasSelection || !hasAnyOperationChecked);-->
<!--    }-->

<!--    function validateStep3() {-->
<!--        if (!selectedNode) {-->
<!--            showToast("Please select a file or folder", "warning");-->
<!--            return false;-->
<!--        }-->

<!--        const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--        if (!hasAnyOperation) {-->
<!--            showToast("Please select at least one operation to block", "warning");-->
<!--            return false;-->
<!--        }-->

<!--        return true;-->
<!--    }-->

<!--    /* ==================== STEP NAVIGATION ==================== */-->
<!--    function nextStep() {-->
<!--        if (currentStep === 1 && selectedAgents.size === 0) {-->
<!--            showToast("Please select at least one agent", "warning");-->
<!--            return;-->
<!--        }-->

<!--        if (currentStep === 2) {-->
<!--            const policyType = document.getElementById('policyType').value;-->
<!--            if (!policyType) {-->
<!--                showToast("Please select a policy type", "warning");-->
<!--                return;-->
<!--            }-->

<!--            // If it's not FILE policy, show message and redirect or handle differently-->
<!--            if (policyType !== 'FILE') {-->
<!--                showToast("This page is for File Protection only. Please select FILE policy type.", "info");-->
<!--                return;-->
<!--            }-->
<!--        }-->

<!--        if (currentStep === 3) {-->
<!--            if (!validateStep3()) {-->
<!--                return;-->
<!--            }-->
<!--        }-->

<!--        currentStep++;-->
<!--        updateStepDisplay();-->
<!--    }-->

<!--    function previousStep() {-->
<!--        currentStep&#45;&#45;;-->
<!--        updateStepDisplay();-->
<!--    }-->

<!--    function cancelAssignment() {-->
<!--        if (confirm("Are you sure you want to cancel? All selections will be lost.")) {-->
<!--            window.location.href = 'file-policies.html';-->
<!--        }-->
<!--    }-->

<!--    function updateStepDisplay() {-->
<!--        document.getElementById("step1").style.display = "none";-->
<!--        document.getElementById("step2").style.display = "none";-->
<!--        document.getElementById("step3").style.display = "none";-->
<!--        document.getElementById("step4").style.display = "none";-->

<!--        document.getElementById(`step${currentStep}`).style.display = "block";-->

<!--        document.querySelectorAll(".step").forEach((step, index) => {-->
<!--            step.classList.remove("active", "completed");-->
<!--            if (index + 1 < currentStep) {-->
<!--                step.classList.add("completed");-->
<!--                step.querySelector(".step-circle").innerHTML = '<i class="fas fa-check"></i>';-->
<!--            } else if (index + 1 === currentStep) {-->
<!--                step.classList.add("active");-->
<!--                step.querySelector(".step-circle").textContent = index + 1;-->
<!--            } else {-->
<!--                step.querySelector(".step-circle").textContent = index + 1;-->
<!--            }-->
<!--        });-->

<!--        document.getElementById("prevBtn").style.display = currentStep > 1 ? "flex" : "none";-->
<!--        document.getElementById("nextBtn").style.display = currentStep < 4 ? "flex" : "none";-->
<!--        document.getElementById("applyBtn").style.display = currentStep === 4 ? "flex" : "none";-->

<!--        if (currentStep === 4) {-->
<!--            updateSummary();-->
<!--        }-->

<!--        if (currentStep === 3) {-->
<!--            updatePolicyButtons();-->
<!--        }-->
<!--    }-->

<!--    function updateSummary() {-->
<!--        document.getElementById("summaryAgentCount").textContent = selectedAgents.size;-->

<!--        const policyType = document.getElementById('policyType').value;-->
<!--        document.getElementById("summaryPolicyType").textContent = policyType || "File Protection";-->

<!--        if (selectedNode) {-->
<!--            document.getElementById("summaryPath").textContent = selectedNode.full_path || selectedNode.id;-->
<!--            document.getElementById("summaryResourceType").textContent = selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File';-->
<!--            document.getElementById("summaryNodeId").textContent = selectedNode.id;-->

<!--            document.getElementById("previewPath").textContent = selectedNode.full_path || selectedNode.id;-->
<!--            document.getElementById("previewScope").textContent = selectedNode.type === 'folder' ? 'Folder with all contents' : 'Single file';-->
<!--        } else {-->
<!--            document.getElementById("summaryPath").textContent = "-";-->
<!--            document.getElementById("summaryResourceType").textContent = "-";-->
<!--            document.getElementById("summaryNodeId").textContent = "-";-->
<!--            document.getElementById("previewPath").textContent = "-";-->
<!--            document.getElementById("previewScope").textContent = "-";-->
<!--        }-->

<!--        const blockedOps = Object.entries(operations)-->
<!--            .filter(([op, checked]) => checked)-->
<!--            .map(([op]) => op.toUpperCase())-->
<!--            .join(', ');-->

<!--        document.getElementById("summaryOperations").textContent = blockedOps || 'None';-->
<!--        document.getElementById("previewOperations").textContent = blockedOps || 'None';-->

<!--        const isBlockAll = operations.read;-->
<!--        document.getElementById("summaryBlockAllRow").style.display = isBlockAll ? 'flex' : 'none';-->
<!--    }-->

<!--    /* ==================== APPLY POLICY ==================== */-->
<!--    async function applyPolicy() {-->
<!--        if (selectedAgents.size === 0 || !selectedNode) {-->
<!--            showToast("Missing required selections", "error");-->
<!--            return;-->
<!--        }-->

<!--        const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--        if (!hasAnyOperation) {-->
<!--            showToast("Please select at least one operation to block", "warning");-->
<!--            return;-->
<!--        }-->

<!--        try {-->
<!--            const agentIds = Array.from(selectedAgents);-->

<!--            const payload = {-->
<!--                node_id: selectedNode.id,-->
<!--                scope: selectedNode.type === 'folder' ? 'folder_recursive' : 'file',-->
<!--                action: 'block',-->
<!--                operations: { ...operations },-->
<!--                created_by: 'admin',-->
<!--                comment: 'Applied from File Protection UI',-->
<!--                confirmed: true,-->
<!--                agentIds: agentIds-->
<!--            };-->

<!--            showToast("Applying policy...", "info");-->

<!--            const response = await fetch(`/api/admin/policies/apply`, {-->
<!--                method: 'POST',-->
<!--                headers: { 'Content-Type': 'application/json' },-->
<!--                body: JSON.stringify(payload)-->
<!--            });-->

<!--            if (!response.ok) {-->
<!--                const errorText = await response.text();-->
<!--                throw new Error(errorText);-->
<!--            }-->

<!--            const result = await response.json();-->

<!--            const agentNames = agentIds-->
<!--                .map(id => {-->
<!--                    const agent = agentsBasicData[id];-->
<!--                    return agent ? agent.hostname || agent.username : `Agent ${id}`;-->
<!--                })-->
<!--                .filter(name => name);-->

<!--            let message = `âœ… Policy applied successfully!\n\n`;-->
<!--            message += `Agents: ${agentNames.join(', ')}\n`;-->
<!--            message += `Path: ${selectedNode.full_path || selectedNode.id}\n`;-->
<!--            message += `Blocked Operations: ${Object.entries(operations).filter(([op, checked]) => checked).map(([op]) => op.toUpperCase()).join(', ')}`;-->

<!--            alert(message);-->

<!--            setTimeout(() => {-->
<!--                window.location.href = 'file-policies.html';-->
<!--            }, 2000);-->

<!--        } catch (error) {-->
<!--            console.error('Apply policy error:', error);-->
<!--            showToast("Failed to apply policy: " + error.message, "error");-->
<!--        }-->
<!--    }-->

<!--    function showToast(message, type = 'success') {-->
<!--        const toast = document.createElement('div');-->
<!--        toast.className = `toast ${type}`;-->
<!--        toast.textContent = message;-->

<!--        document.body.appendChild(toast);-->
<!--        setTimeout(() => toast.remove(), 3000);-->
<!--    }-->

<!--    /* ==================== INITIALIZATION ==================== */-->
<!--    document.addEventListener("DOMContentLoaded", async function() {-->
<!--        loadAdminInfo();-->
<!--        setActiveMenuItem();-->

<!--        await Promise.all([-->
<!--            initializeAgentCards(),-->
<!--            fetchAgentSimpleDetails(),-->
<!--        ]);-->

<!--        initOperationCheckboxes();-->

<!--        // Set up file explorer event listeners-->
<!--        document.getElementById('btnGetDrives').addEventListener('click', getDrives);-->
<!--        document.getElementById('btnRefresh').addEventListener('click', refreshExplorer);-->
<!--        document.getElementById('btnClearSelection').addEventListener('click', clearSelection);-->

<!--        // Handle policy type selection-->
<!--        document.getElementById('policyType').addEventListener('change', function(e) {-->
<!--            if (e.target.value !== 'FILE') {-->
<!--                showToast("This page is for File Protection only. Please select FILE.", "info");-->
<!--            }-->
<!--        });-->
<!--    });-->

<!--    window.addEventListener("resize", function() {-->
<!--        const sidebar = document.getElementById("sidebar");-->
<!--        const mainContent = document.getElementById("mainContent");-->
<!--        const header = document.getElementById("topHeader");-->
<!--        const windowWidth = window.innerWidth;-->

<!--        if (windowWidth <= 968) {-->
<!--            if (sidebar) sidebar.classList.remove("collapsed");-->
<!--            if (mainContent) mainContent.classList.remove("expanded");-->
<!--            if (header) {-->
<!--                header.style.left = "0";-->
<!--            }-->
<!--        } else {-->
<!--            if (sidebar && mainContent && header) {-->
<!--                if (sidebar.classList.contains("collapsed")) {-->
<!--                    mainContent.classList.add("expanded");-->
<!--                    header.style.left = "70px";-->
<!--                } else {-->
<!--                    mainContent.classList.remove("expanded");-->
<!--                    header.style.left = "240px";-->
<!--                }-->
<!--            }-->
<!--        }-->
<!--    });-->

<!--    window.addEventListener("sidebarToggle", function(event) {-->
<!--        const header = document.getElementById("topHeader");-->
<!--        const mainContent = document.getElementById("mainContent");-->

<!--        if (header && mainContent) {-->
<!--            if (event.detail.collapsed) {-->
<!--                header.style.left = "70px";-->
<!--                mainContent.classList.add("expanded");-->
<!--            } else {-->
<!--                header.style.left = "240px";-->
<!--                mainContent.classList.remove("expanded");-->
<!--            }-->
<!--        }-->
<!--    });-->


<!--  /* ==================== ACTIVE POLICIES FUNCTIONS ==================== */-->
<!--  async function loadNodePolicies(nodeId) {-->
<!--      try {-->
<!--          const response = await fetch(`${API_BASE}/policies`);-->
<!--          if (!response.ok) throw new Error('Failed to load policies');-->

<!--          const result = await response.json();-->

<!--          // Get policies array-->
<!--          let policiesArray = [];-->
<!--          if (Array.isArray(result)) {-->
<!--              policiesArray = result;-->
<!--          } else if (result.data && Array.isArray(result.data)) {-->
<!--              policiesArray = result.data;-->
<!--          }-->

<!--          // Filter policies for this node-->
<!--          activeNodePolicies = policiesArray.filter(p =>-->
<!--              p.nodeId === nodeId || p.node_id === nodeId-->
<!--          );-->

<!--          // Update UI-->
<!--          const section = document.getElementById('activePoliciesSection');-->
<!--          const policiesList = document.getElementById('selectedNodePolicies');-->
<!--          const noPoliciesMsg = document.getElementById('noPoliciesMsg');-->
<!--          const removeContainer = document.getElementById('removePolicyContainer');-->

<!--          if (activeNodePolicies.length > 0) {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'block';-->
<!--              noPoliciesMsg.style.display = 'none';-->

<!--              // Render policies-->
<!--              policiesList.innerHTML = '';-->
<!--              activeNodePolicies.forEach(policy => {-->
<!--                  const policyItem = document.createElement('div');-->
<!--                  policyItem.className = 'policy-item-small';-->

<!--                  const nodeId = policy.nodeId || policy.node_id;-->
<!--                  const operations = policy.operations || {};-->
<!--                  const isBlockAll = operations.read === true;-->

<!--                  if (isBlockAll) {-->
<!--                      policyItem.classList.add('block-all');-->
<!--                  }-->

<!--                  // Format operations-->
<!--                  const ops = [];-->
<!--                  if (operations.read === true) ops.push('READ');-->
<!--                  if (operations.write === true) ops.push('WRITE');-->
<!--                  if (operations.delete === true) ops.push('DELETE');-->
<!--                  if (operations.rename === true) ops.push('RENAME');-->
<!--                  if (operations.create === true) ops.push('CREATE');-->

<!--                  policyItem.innerHTML = `-->
<!--                      <div class="policy-info-compact">-->
<!--                          <div class="policy-name-compact">-->
<!--                              ${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}-->
<!--                          </div>-->
<!--                          <div class="policy-details-compact">-->
<!--                              Scope: ${policy.scope || 'file'} | ID: ${policy.id}-->
<!--                          </div>-->
<!--                      </div>-->
<!--                      <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">-->
<!--                          <i class="fas fa-times"></i>-->
<!--                      </button>-->
<!--                  `;-->

<!--                  policiesList.appendChild(policyItem);-->
<!--              });-->
<!--          } else {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'none';-->
<!--              noPoliciesMsg.style.display = 'flex';-->
<!--              policiesList.innerHTML = '';-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Error loading node policies:', error);-->
<!--      }-->
<!--  }-->

<!--  function showRemovePolicyModal() {-->
<!--      if (activeNodePolicies.length === 0) return;-->

<!--      // If multiple policies, show selection-->
<!--      if (activeNodePolicies.length > 1) {-->
<!--          showPolicySelectionModal();-->
<!--      } else {-->
<!--          // Single policy, show remove modal directly-->
<!--          showRemovePolicyModalForPolicy(activeNodePolicies[0].id);-->
<!--      }-->
<!--  }-->

<!--  function showPolicySelectionModal() {-->
<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      // Build policy selection-->
<!--      let html = '<p><strong>Multiple policies found:</strong></p>';-->
<!--      html += '<div style="margin: 15px 0;">';-->

<!--      activeNodePolicies.forEach(policy => {-->
<!--          const operations = policy.operations || {};-->
<!--          const ops = Object.entries(operations)-->
<!--              .filter(([op, val]) => val)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          html += `-->
<!--              <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">-->
<!--                  <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">-->
<!--                  <label for="policy_${policy.id}" style="flex: 1;">-->
<!--                      <strong>Policy ID ${policy.id}</strong><br>-->
<!--                      Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}-->
<!--                  </label>-->
<!--              </div>-->
<!--          `;-->
<!--      });-->

<!--      html += '</div>';-->
<!--      html += '<p>Select a policy to remove:</p>';-->

<!--      details.innerHTML = html;-->

<!--      // Add change handler for radio buttons-->
<!--      setTimeout(() => {-->
<!--          const radios = document.querySelectorAll('input[name="policySelect"]');-->
<!--          radios.forEach(radio => {-->
<!--              radio.addEventListener('change', function() {-->
<!--                  policyToRemove = parseInt(this.value);-->
<!--                  updateRemoveConfirmButton();-->
<!--              });-->
<!--          });-->
<!--      }, 100);-->

<!--      confirmInput.value = '';-->
<!--      confirmInput.disabled = false;-->
<!--      confirmBtn.disabled = true;-->

<!--      // Update handler for confirm input-->
<!--      confirmInput.oninput = function() {-->
<!--          updateRemoveConfirmButton();-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function showRemovePolicyModalForPolicy(policyId) {-->
<!--      const policy = activeNodePolicies.find(p => p.id === policyId);-->
<!--      if (!policy) return;-->

<!--      policyToRemove = policyId;-->

<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      const operations = policy.operations || {};-->
<!--      const ops = Object.entries(operations)-->
<!--          .filter(([op, val]) => val)-->
<!--          .map(([op]) => op.toUpperCase())-->
<!--          .join(', ');-->

<!--      details.innerHTML = `-->
<!--          <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Policy ID:</strong> ${policy.id}</div>-->
<!--          <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>-->
<!--          <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>-->
<!--      `;-->

<!--      confirmInput.value = '';-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function updateRemoveConfirmButton() {-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;-->
<!--  }-->

<!--  function closeRemovePolicyModal() {-->
<!--      document.getElementById('removePolicyModal').classList.remove('active');-->
<!--      policyToRemove = null;-->
<!--  }-->

<!--  async function removeSelectedPolicy() {-->
<!--      if (!policyToRemove) {-->
<!--          closeRemovePolicyModal();-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const response = await fetch(`${API_BASE}/policies/${policyToRemove}`, {-->
<!--              method: 'DELETE'-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error('Failed to remove policy');-->
<!--          }-->

<!--          showToast("Policy removed successfully!", "success");-->
<!--          closeRemovePolicyModal();-->

<!--          // Reload policies for this node-->
<!--          if (selectedNode) {-->
<!--              await loadNodePolicies(selectedNode.id);-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Remove policy error:', error);-->
<!--          showToast("Failed to remove policy: " + error.message, "error");-->
<!--          closeRemovePolicyModal();-->
<!--      }-->
<!--  }-->

<!--    document.getElementById('removeConfirmInput')?.addEventListener('input', function() {-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--  });-->

<!--    document.addEventListener("click", function(e) {-->
<!--        const sidebar = document.getElementById("sidebar");-->
<!--        const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");-->

<!--        if (sidebar && window.innerWidth <= 968) {-->
<!--            if (-->
<!--                !sidebar.contains(e.target) &&-->
<!--                (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))-->
<!--            ) {-->
<!--                sidebar.classList.remove("mobile-open");-->
<!--                const overlay = document.getElementById("sidebarOverlay");-->
<!--                if (overlay) {-->
<!--                    overlay.classList.remove("active");-->
<!--                }-->
<!--            }-->
<!--        }-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->



<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <title>DLP Shield - Assign Policy</title>-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />-->
<!--  <style>-->
<!--    /* All existing styles from first file remain exactly the same */-->
<!--    * {-->
<!--        margin: 0;-->
<!--        padding: 0;-->
<!--        box-sizing: border-box;-->
<!--    }-->

<!--    body {-->
<!--        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;-->
<!--        background: #f3f4f6;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .dashboard-container {-->
<!--        display: flex;-->
<!--        min-height: 100vh;-->
<!--        max-width: 100vw;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content {-->
<!--        flex: 1;-->
<!--        margin-left: 240px;-->
<!--        transition: margin-left 0.3s ease;-->
<!--        min-height: 100vh;-->
<!--        max-width: calc(100vw - 240px);-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content.expanded {-->
<!--        margin-left: 70px;-->
<!--        max-width: calc(100vw - 70px);-->
<!--    }-->

<!--    .content-area {-->
<!--        padding: 24px;-->
<!--        padding-top: 100px;-->
<!--        max-width: 1400px;-->
<!--        margin: 0 auto;-->
<!--    }-->

<!--    /* ================ SIDEBAR STYLES ================ */-->
<!--    .sidebar {-->
<!--        width: 240px;-->
<!--        background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);-->
<!--        color: white;-->
<!--        position: fixed;-->
<!--        height: 100vh;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: width 0.3s ease;-->
<!--        z-index: 1000;-->
<!--        left: 0;-->
<!--        top: 0;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar {-->
<!--        width: 4px;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar-thumb {-->
<!--        background: rgba(255, 255, 255, 0.3);-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .sidebar-header {-->
<!--        padding: 18px 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        border-bottom: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo {-->
<!--        width: 38px;-->
<!--        height: 38px;-->
<!--        background: white;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo i {-->
<!--        font-size: 20px;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .sidebar-title {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        white-space: nowrap;-->
<!--        transition: opacity 0.2s, width 0.3s;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .nav-menu {-->
<!--        padding: 12px 0;-->
<!--        overflow-y: auto;-->
<!--        overflow-x: hidden;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .nav-item {-->
<!--        margin: 2px 8px;-->
<!--    }-->

<!--    .nav-link {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        color: rgba(255, 255, 255, 0.8);-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        transition: all 0.2s;-->
<!--        font-size: 0.9em;-->
<!--        cursor: pointer;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .nav-link:hover {-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        color: white;-->
<!--    }-->

<!--    .nav-link.active,-->
<!--    .sub-menu-item.active {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .nav-link i:first-child {-->
<!--        width: 20px;-->
<!--        font-size: 0.95em;-->
<!--        margin-right: 10px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .chevron-icon {-->
<!--        margin-left: auto !important;-->
<!--        font-size: 0.7em !important;-->
<!--        transition: transform 0.3s;-->
<!--        width: auto !important;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .nav-link.expanded .chevron-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sub-menu {-->
<!--        max-height: 0;-->
<!--        overflow: hidden;-->
<!--        transition: max-height 0.3s ease;-->
<!--    }-->

<!--    .sub-menu.open {-->
<!--        max-height: 500px;-->
<!--    }-->

<!--    .sub-menu-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px 8px 42px;-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        text-decoration: none;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--        margin: 2px 0;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .sub-menu-item:hover {-->
<!--        color: white;-->
<!--        background: rgba(255, 255, 255, 0.08);-->
<!--    }-->

<!--    .sub-menu-item::before {-->
<!--        content: "â€¢";-->
<!--        margin-right: 10px;-->
<!--        font-size: 1.2em;-->
<!--    }-->

<!--    .sidebar-footer {-->
<!--        padding: 12px 16px;-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .collapse-btn {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        gap: 8px;-->
<!--        padding: 10px;-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        border: none;-->
<!--        color: white;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        width: 100%;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        white-space: nowrap;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .collapse-btn:hover {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--    }-->

<!--    .collapse-btn i {-->
<!--        transition: transform 0.3s;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    /* Sidebar collapsed state */-->
<!--    .sidebar.collapsed {-->
<!--        width: 70px;-->
<!--    }-->

<!--    .sidebar.collapsed .sidebar-title {-->
<!--        opacity: 0;-->
<!--        width: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link span,-->
<!--    .sidebar.collapsed .collapse-btn span {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .sub-menu {-->
<!--        display: none !important;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link {-->
<!--        justify-content: center;-->
<!--        padding: 10px;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link i:first-child {-->
<!--        margin-right: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .chevron-icon {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn {-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn i {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    /* Mobile Overlay */-->
<!--    .sidebar-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 999;-->
<!--        opacity: 0;-->
<!--        transition: opacity 0.3s;-->
<!--    }-->

<!--    .sidebar-overlay.active {-->
<!--        display: block;-->
<!--        opacity: 1;-->
<!--    }-->

<!--    /* ================ HEADER STYLES ================ */-->
<!--    .top-header {-->
<!--        background: white;-->
<!--        padding: 14px 24px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: space-between;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 240px;-->
<!--        right: 0;-->
<!--        z-index: 500;-->
<!--        gap: 16px;-->
<!--        transition: left 0.3s ease;-->
<!--    }-->

<!--    .mobile-menu-toggle {-->
<!--        display: none;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.3em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: color 0.2s;-->
<!--    }-->

<!--    .mobile-menu-toggle:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .search-bar {-->
<!--        flex: 1;-->
<!--        max-width: 400px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .search-bar i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 9px 14px 9px 38px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: #f9fafb;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--        background: white;-->
<!--        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);-->
<!--    }-->

<!--    .header-actions {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .notification-btn {-->
<!--        position: relative;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.1em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--    }-->

<!--    .notification-btn:hover {-->
<!--        color: #111827;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .notification-btn.active {-->
<!--        color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .notification-badge {-->
<!--        position: absolute;-->
<!--        top: 4px;-->
<!--        right: 4px;-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--        font-size: 0.65em;-->
<!--        min-width: 18px;-->
<!--        height: 18px;-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        padding: 0 4px;-->
<!--    }-->

<!--    .user-profile {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        cursor: pointer;-->
<!--        padding: 6px 10px;-->
<!--        border-radius: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .user-profile:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .user-avatar {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .user-info {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--    }-->

<!--    .user-name {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .user-role {-->
<!--        font-size: 0.75em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .dropdown-icon {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.75em;-->
<!--        margin-left: 4px;-->
<!--        transition: transform 0.3s;-->
<!--    }-->

<!--    .user-profile.active .dropdown-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .user-dropdown {-->
<!--        position: absolute;-->
<!--        top: 100%;-->
<!--        right: 0;-->
<!--        margin-top: 8px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 10px 15px rgba(0, 0, 0, 0.1);-->
<!--        min-width: 200px;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transform: translateY(-10px);-->
<!--        transition: all 0.3s ease;-->
<!--        z-index: 1000;-->
<!--    }-->

<!--    .user-dropdown.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--        transform: translateY(0);-->
<!--    }-->

<!--    .dropdown-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        padding: 10px 14px;-->
<!--        color: #374151;-->
<!--        text-decoration: none;-->
<!--        font-size: 0.9em;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .dropdown-item:first-child {-->
<!--        border-radius: 8px 8px 0 0;-->
<!--    }-->

<!--    .dropdown-item:last-child {-->
<!--        border-radius: 0 0 8px 8px;-->
<!--    }-->

<!--    .dropdown-item:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .dropdown-item i {-->
<!--        width: 18px;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .dropdown-item.danger {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-item.danger i {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-divider {-->
<!--        height: 1px;-->
<!--        background: #e5e7eb;-->
<!--        margin: 4px 0;-->
<!--    }-->

<!--    /* ================ NOTIFICATIONS PANEL ================ */-->
<!--    .notifications-panel {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        right: -50%;-->
<!--        width: 50%;-->
<!--        max-width: 600px;-->
<!--        height: 100vh;-->
<!--        background: white;-->
<!--        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);-->
<!--        z-index: 1001;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--    }-->

<!--    .notifications-panel.show {-->
<!--        right: 0;-->
<!--    }-->

<!--    .notifications-header {-->
<!--        padding: 20px 24px;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notifications-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .close-notifications {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        padding: 6px;-->
<!--        border-radius: 6px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .close-notifications:hover {-->
<!--        background: #f3f4f6;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .notifications-tabs {-->
<!--        display: flex;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        padding: 0 24px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .tab-btn {-->
<!--        flex: 1;-->
<!--        padding: 12px;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 500;-->
<!--        cursor: pointer;-->
<!--        border-bottom: 2px solid transparent;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .tab-btn:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .tab-btn.active {-->
<!--        color: #2563eb;-->
<!--        border-bottom-color: #2563eb;-->
<!--    }-->

<!--    .notifications-content {-->
<!--        flex: 1;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px 0;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar {-->
<!--        width: 6px;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar-thumb {-->
<!--        background: #d1d5db;-->
<!--        border-radius: 3px;-->
<!--    }-->

<!--    .notification-item {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        padding: 14px 24px;-->
<!--        cursor: pointer;-->
<!--        transition: background 0.2s;-->
<!--        border-left: 3px solid transparent;-->
<!--    }-->

<!--    .notification-item:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .notification-item.unread {-->
<!--        background: #eff6ff;-->
<!--        border-left-color: #3b82f6;-->
<!--    }-->

<!--    .notification-item.unread:hover {-->
<!--        background: #dbeafe;-->
<!--    }-->

<!--    .notification-icon {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-size: 1.1em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notification-icon.critical {-->
<!--        background: #fee2e2;-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .notification-icon.warning {-->
<!--        background: #fef3c7;-->
<!--        color: #f59e0b;-->
<!--    }-->

<!--    .notification-icon.info {-->
<!--        background: #dbeafe;-->
<!--        color: #3b82f6;-->
<!--    }-->

<!--    .notification-icon.success {-->
<!--        background: #d1fae5;-->
<!--        color: #10b981;-->
<!--    }-->

<!--    .notification-body {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .notification-title {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .notification-text {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 6px;-->
<!--        line-height: 1.4;-->
<!--    }-->

<!--    .notification-time {-->
<!--        font-size: 0.75em;-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .notification-dot {-->
<!--        width: 8px;-->
<!--        height: 8px;-->
<!--        background: #3b82f6;-->
<!--        border-radius: 50%;-->
<!--        flex-shrink: 0;-->
<!--        margin-top: 8px;-->
<!--    }-->

<!--    .notification-item:not(.unread) .notification-dot {-->
<!--        display: none;-->
<!--    }-->

<!--    .notifications-footer {-->
<!--        padding: 16px 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .view-all-btn {-->
<!--        display: block;-->
<!--        width: 100%;-->
<!--        padding: 10px;-->
<!--        background: #f3f4f6;-->
<!--        color: #2563eb;-->
<!--        text-align: center;-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .view-all-btn:hover {-->
<!--        background: #e5e7eb;-->
<!--    }-->

<!--    .notification-overlay {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.4);-->
<!--        z-index: 1000;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .notification-overlay.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--    }-->

<!--    /* Assign Policy Page Styles */-->
<!--    .page-header {-->
<!--        background: white;-->
<!--        padding: 20px 24px;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        margin-bottom: 24px;-->
<!--    }-->

<!--    .page-title-section {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .page-icon {-->
<!--        width: 48px;-->
<!--        height: 48px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 12px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .page-icon i {-->
<!--        font-size: 22px;-->
<!--        color: white;-->
<!--    }-->

<!--    .page-title-text h1 {-->
<!--        font-size: 1.5em;-->
<!--        color: #111827;-->
<!--        font-weight: 700;-->
<!--    }-->

<!--    .page-subtitle {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        margin-top: 4px;-->
<!--    }-->

<!--    .breadcrumb {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        font-size: 0.85em;-->
<!--    }-->

<!--    .breadcrumb a {-->
<!--        color: #6b7280;-->
<!--        text-decoration: none;-->
<!--    }-->

<!--    .breadcrumb a:hover {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .breadcrumb span {-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .assign-container {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        padding: 28px;-->
<!--    }-->

<!--    .step-indicator {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        margin-bottom: 32px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .step-indicator::before {-->
<!--        content: "";-->
<!--        position: absolute;-->
<!--        top: 20px;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        height: 2px;-->
<!--        background: #e5e7eb;-->
<!--        z-index: 0;-->
<!--    }-->

<!--    .step {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        position: relative;-->
<!--        z-index: 1;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .step-circle {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 50%;-->
<!--        background: white;-->
<!--        border: 2px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        color: #9ca3af;-->
<!--        transition: all 0.3s;-->
<!--    }-->

<!--    .step.active .step-circle {-->
<!--        background: #2563eb;-->
<!--        border-color: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .step.completed .step-circle {-->
<!--        background: #10b981;-->
<!--        border-color: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .step-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    .step.active .step-label {-->
<!--        color: #2563eb;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .section {-->
<!--        margin-bottom: 28px;-->
<!--    }-->

<!--    .section-title {-->
<!--        font-size: 1.1em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .section-desc {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-group {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-label {-->
<!--        display: block;-->
<!--        font-size: 0.9em;-->
<!--        color: #374151;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .form-select {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .form-select:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .form-select:disabled {-->
<!--        background: #f9fafb;-->
<!--        cursor: not-allowed;-->
<!--        opacity: 0.6;-->
<!--    }-->

<!--    .search-box {-->
<!--        position: relative;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .search-box i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px 11px 42px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .agents-grid {-->
<!--        display: grid;-->
<!--        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));-->
<!--        gap: 12px;-->
<!--        max-height: 400px;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .agent-card {-->
<!--        background: white;-->
<!--        padding: 14px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        cursor: pointer;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .agent-card:hover {-->
<!--        border-color: #3b82f6;-->
<!--        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);-->
<!--    }-->

<!--    .agent-card.selected {-->
<!--        border-color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .agent-card-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .agent-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .agent-name {-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .agent-status {-->
<!--        font-size: 0.75em;-->
<!--        padding: 3px 8px;-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .status-online {-->
<!--        background: #d1fae5;-->
<!--        color: #059669;-->
<!--    }-->

<!--    .status-offline {-->
<!--        background: #f3f4f6;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .agent-info {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-top: 6px;-->
<!--    }-->

<!--    .selected-count {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        margin-bottom: 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--    }-->

<!--    .selected-count i {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .selected-count span {-->
<!--        font-size: 0.9em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    /* File Explorer Styles */-->
<!--    .file-explorer-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        background: #f9fafb;-->
<!--        padding: 16px;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .explorer-header {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .explorer-btn {-->
<!--        padding: 8px 16px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 6px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .explorer-btn:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .explorer-btn:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .tree-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 6px;-->
<!--        padding: 12px;-->
<!--        height: 300px;-->
<!--        overflow-y: auto;-->
<!--        background: white;-->
<!--        font-family: monospace;-->
<!--        font-size: 13px;-->
<!--    }-->

<!--    .tree-node {-->
<!--        padding: 6px 8px;-->
<!--        margin: 2px 0;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .tree-node:hover {-->
<!--        background: #e8f0fe;-->
<!--    }-->

<!--    .tree-node.selected {-->
<!--        background: #d2e3fc;-->
<!--        border-left: 3px solid #2563eb;-->
<!--    }-->

<!--    .tree-node.protected {-->
<!--        background: #fee2e2;-->
<!--        border-left: 3px solid #dc2626;-->
<!--    }-->

<!--    .tree-node-icon {-->
<!--        width: 20px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .tree-node-name {-->
<!--        flex: 1;-->
<!--        overflow: hidden;-->
<!--        text-overflow: ellipsis;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .tree-node-badge {-->
<!--        background: #dc2626;-->
<!--        color: white;-->
<!--        font-size: 10px;-->
<!--        padding: 2px 6px;-->
<!--        border-radius: 12px;-->
<!--        margin-left: 8px;-->
<!--        font-family: sans-serif;-->
<!--    }-->

<!--    .tree-node-children {-->
<!--        margin-left: 24px;-->
<!--        border-left: 1px dashed #ddd;-->
<!--        padding-left: 12px;-->
<!--    }-->

<!--    .tree-node-expand {-->
<!--        font-size: 10px;-->
<!--        color: #6b7280;-->
<!--        cursor: pointer;-->
<!--        width: 16px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .selected-path-info {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .path-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .path-value {-->
<!--        font-family: monospace;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        word-break: break-all;-->
<!--    }-->

<!--    /* Active Policies Section */-->
<!--    .active-policies-section {-->
<!--        margin-top: 20px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .policies-list {-->
<!--        max-height: 200px;-->
<!--        overflow-y: auto;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 12px;-->
<!--        background: white;-->
<!--    }-->

<!--    .policy-item {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        margin: 6px 0;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 6px;-->
<!--        border-left: 4px solid #2563eb;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .policy-item.block-all {-->
<!--        border-left-color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    .policy-info {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .policy-name {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-details {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-top: 2px;-->
<!--    }-->

<!--    .policy-remove-btn {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #9ca3af;-->
<!--        cursor: pointer;-->
<!--        padding: 4px 8px;-->
<!--        border-radius: 4px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .policy-remove-btn:hover {-->
<!--        color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    /* Operations List */-->
<!--    .operations-list {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 12px;-->
<!--        margin: 20px 0;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .operation-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .operation-item.disabled {-->
<!--        opacity: 0.5;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .operation-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        margin-right: 12px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .operation-label {-->
<!--        flex: 1;-->
<!--        font-weight: 500;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .operation-desc {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        margin-left: 8px;-->
<!--    }-->

<!--    .read-block-all {-->
<!--        background: #fee2e2;-->
<!--        border: 1px solid #fecaca;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 6px;-->
<!--        margin-top: 12px;-->
<!--        display: none;-->
<!--        color: #991b1b;-->
<!--        font-weight: 500;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--    }-->

<!--    .read-block-all.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    /* Domain/IP Input Styles */-->
<!--    .domain-input-container, .ip-input-container {-->
<!--        margin-top: 16px;-->
<!--    }-->

<!--    .domain-input-group {-->
<!--        display: flex;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 12px;-->
<!--    }-->

<!--    .domain-input {-->
<!--        flex: 1;-->
<!--        padding: 10px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .domain-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .btn-add-domain {-->
<!--        padding: 10px 20px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .btn-add-domain:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .domain-tags {-->
<!--        display: flex;-->
<!--        flex-wrap: wrap;-->
<!--        gap: 8px;-->
<!--        margin-top: 12px;-->
<!--    }-->

<!--    .domain-tag {-->
<!--        background: #eff6ff;-->
<!--        color: #1e40af;-->
<!--        padding: 6px 12px;-->
<!--        border-radius: 6px;-->
<!--        font-size: 0.85em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .domain-tag i {-->
<!--        cursor: pointer;-->
<!--        color: #ef4444;-->
<!--    }-->

<!--    .domain-tag i:hover {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .summary-box {-->
<!--        background: #f9fafb;-->
<!--        padding: 20px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        padding: 10px 0;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row:last-child {-->
<!--        border-bottom: none;-->
<!--    }-->

<!--    .summary-label {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .summary-value {-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .policy-preview {-->
<!--        background: white;-->
<!--        padding: 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #3b82f6;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .policy-preview-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .policy-preview-icon {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: #eff6ff;-->
<!--        border-radius: 8px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .policy-preview-title {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-preview-desc {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .btn-group {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--        padding-top: 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .btn {-->
<!--        padding: 11px 24px;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        cursor: pointer;-->
<!--        border: none;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .btn-primary {-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-primary:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .btn-primary:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .btn-secondary {-->
<!--        background: white;-->
<!--        color: #374151;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--    }-->

<!--    .btn-secondary:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .btn-danger {-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-danger:hover {-->
<!--        background: #dc2626;-->
<!--    }-->

<!--    .btn-warning {-->
<!--        background: #f59e0b;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-warning:hover {-->
<!--        background: #d97706;-->
<!--    }-->

<!--    .alert {-->
<!--        padding: 14px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 12px;-->
<!--    }-->

<!--    .alert-info {-->
<!--        background: #eff6ff;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        color: #1e40af;-->
<!--    }-->

<!--    .alert-success {-->
<!--        background: #d1fae5;-->
<!--        border: 1px solid #a7f3d0;-->
<!--        color: #065f46;-->
<!--    }-->

<!--    .alert-warning {-->
<!--        background: #fff3cd;-->
<!--        border: 1px solid #ffeeba;-->
<!--        color: #856404;-->
<!--    }-->

<!--    .alert i {-->
<!--        font-size: 1.1em;-->
<!--    }-->

<!--    .loading {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #6b7280;-->
<!--        font-style: italic;-->
<!--    }-->

<!--    .error {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #ef4444;-->
<!--        background: #fee2e2;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #fca5a5;-->
<!--    }-->

<!--    /* Modal Styles */-->
<!--    .modal-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 2000;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .modal-overlay.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    .modal {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        padding: 24px;-->
<!--        max-width: 500px;-->
<!--        width: 90%;-->
<!--        max-height: 80vh;-->
<!--        overflow-y: auto;-->
<!--        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);-->
<!--        animation: modalSlideIn 0.3s ease;-->
<!--    }-->

<!--    .modal-header {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .modal-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .modal-close {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .modal-body {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .modal-footer {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--    }-->

<!--    @keyframes modalSlideIn {-->
<!--        from {-->
<!--            transform: translateY(-20px);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateY(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    .text-error {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .mt-20 {-->
<!--        margin-top: 20px;-->
<!--    }-->

<!--    .mb-10 {-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    /* Toast Notifications */-->
<!--    .toast {-->
<!--        position: fixed;-->
<!--        top: 20px;-->
<!--        right: 20px;-->
<!--        padding: 12px 20px;-->
<!--        border-radius: 8px;-->
<!--        color: white;-->
<!--        font-weight: 500;-->
<!--        z-index: 10000;-->
<!--        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);-->
<!--        animation: slideIn 0.3s ease;-->
<!--    }-->

<!--    .toast.success {-->
<!--        background: #10b981;-->
<!--    }-->

<!--    .toast.error {-->
<!--        background: #ef4444;-->
<!--    }-->

<!--    .toast.warning {-->
<!--        background: #f59e0b;-->
<!--    }-->

<!--    .toast.info {-->
<!--        background: #3b82f6;-->
<!--    }-->

<!--    @keyframes slideIn {-->
<!--        from {-->
<!--            transform: translateX(100%);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateX(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    /* Mobile responsive */-->
<!--    @media (max-width: 1200px) {-->
<!--        .main-content {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .main-content.expanded {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 70px;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 968px) {-->
<!--        .main-content {-->
<!--            margin-left: 0;-->
<!--            max-width: 100vw;-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 0;-->
<!--        }-->

<!--        .mobile-menu-toggle {-->
<!--            display: block;-->
<!--        }-->

<!--        .sidebar {-->
<!--            transform: translateX(-100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .sidebar.mobile-open {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        .agents-grid {-->
<!--            grid-template-columns: 1fr;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 768px) {-->
<!--        .content-area {-->
<!--            padding: 16px;-->
<!--            padding-top: 80px;-->
<!--        }-->

<!--        .notifications-panel {-->
<!--            width: 90%;-->
<!--            right: -90%;-->
<!--        }-->

<!--        .step-indicator {-->
<!--            flex-direction: column;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .step-indicator::before {-->
<!--            display: none;-->
<!--        }-->

<!--        .btn-group {-->
<!--            flex-direction: column;-->
<!--        }-->

<!--        .btn {-->
<!--            width: 100%;-->
<!--            justify-content: center;-->
<!--        }-->

<!--        .user-info {-->
<!--            display: none;-->
<!--        }-->

<!--        .explorer-header {-->
<!--            flex-direction: column;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 640px) {-->
<!--        .content-area {-->
<!--            padding: 12px;-->
<!--            padding-top: 70px;-->
<!--        }-->

<!--        .page-title-section {-->
<!--            flex-direction: column;-->
<!--            align-items: flex-start;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .page-icon {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--        }-->

<!--        .page-icon i {-->
<!--            font-size: 18px;-->
<!--        }-->

<!--        .page-title-text h1 {-->
<!--            font-size: 1.3em;-->
<!--        }-->

<!--        .assign-container {-->
<!--            padding: 16px;-->
<!--        }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="dashboard-container">-->
<!--  &lt;!&ndash; ==================== SIDEBAR ==================== &ndash;&gt;-->
<!--  <aside class="sidebar" id="sidebar">-->
<!--    <div class="sidebar-header">-->
<!--      <div class="sidebar-logo">-->
<!--        <i class="fas fa-shield-halved"></i>-->
<!--      </div>-->
<!--      <div class="sidebar-title">DLP Shield</div>-->
<!--    </div>-->

<!--    <nav class="nav-menu">-->
<!--      <div class="nav-item">-->
<!--        <a href="dashboard.html" class="nav-link" data-page="dashboard">-->
<!--          <i class="fas fa-th-large"></i>-->
<!--          <span>Dashboard</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="alerts.html" class="nav-link" data-page="alerts">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--          <span>Alerts &amp; Incidents</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-shield-alt"></i>-->
<!--          <span>Policies</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu open">-->
<!--          <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>-->
<!--          <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>-->
<!--          <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="agents.html" class="nav-link" data-page="agents">-->
<!--          <i class="fas fa-desktop"></i>-->
<!--          <span>Agents / Endpoints</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-eye"></i>-->
<!--          <span>OCR &amp; Image Analysis</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>-->
<!--          <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-file-lines"></i>-->
<!--          <span>Reports &amp; Logs</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>-->
<!--          <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>-->
<!--          <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>-->
<!--          <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-users"></i>-->
<!--          <span>Users &amp; Roles</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="users.html" class="sub-menu-item" data-page="users">Users</a>-->
<!--          <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>-->
<!--          <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-gear"></i>-->
<!--          <span>Settings</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="general.html" class="sub-menu-item" data-page="general">General</a>-->
<!--          <a href="security.html" class="sub-menu-item" data-page="security">Security</a>-->
<!--          <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>-->
<!--          <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </nav>-->

<!--    <div class="sidebar-footer">-->
<!--      <button class="collapse-btn" onclick="toggleSidebar()">-->
<!--        <i class="fas fa-chevron-left"></i>-->
<!--        <span>Collapse</span>-->
<!--      </button>-->
<!--    </div>-->
<!--  </aside>-->

<!--  &lt;!&ndash; Mobile Overlay (for sidebar) &ndash;&gt;-->
<!--  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>-->

<!--  &lt;!&ndash; ==================== HEADER ==================== &ndash;&gt;-->
<!--  <header class="top-header" id="topHeader">-->
<!--    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">-->
<!--      <i class="fas fa-bars"></i>-->
<!--    </button>-->

<!--    <div class="search-bar">-->
<!--      <i class="fas fa-search"></i>-->
<!--      <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />-->
<!--    </div>-->

<!--    <div class="header-actions">-->
<!--      <button class="notification-btn" onclick="toggleNotifications(event)">-->
<!--        <i class="fas fa-bell"></i>-->
<!--        <span class="notification-badge" id="alertBadge">5</span>-->
<!--      </button>-->

<!--      <div class="user-profile" onclick="toggleUserDropdown(event)">-->
<!--        <div class="user-avatar">A</div>-->
<!--        <div class="user-info">-->
<!--          <div class="user-name">Admin</div>-->
<!--          <div class="user-role">Security Admin</div>-->
<!--        </div>-->
<!--        <i class="fas fa-chevron-down dropdown-icon"></i>-->

<!--        <div class="user-dropdown" id="userDropdown">-->
<!--          <a href="general.html" class="dropdown-item">-->
<!--            <i class="fas fa-gear"></i>-->
<!--            <span>Settings</span>-->
<!--          </a>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-circle-question"></i>-->
<!--            <span>Help &amp; Support</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="index.html" class="dropdown-item danger" onclick="logout(event)">-->
<!--            <i class="fas fa-right-from-bracket"></i>-->
<!--            <span>Sign out</span>-->
<!--          </a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </header>-->

<!--  &lt;!&ndash; ==================== NOTIFICATIONS PANEL ==================== &ndash;&gt;-->
<!--  <div class="notifications-panel" id="notificationsPanel">-->
<!--    <div class="notifications-header">-->
<!--      <h3>Notifications</h3>-->
<!--      <button class="close-notifications" onclick="closeNotifications()">-->
<!--        <i class="fas fa-times"></i>-->
<!--      </button>-->
<!--    </div>-->

<!--    <div class="notifications-tabs">-->
<!--      <button class="tab-btn active" onclick="switchTab(event, 'all')">All (5)</button>-->
<!--      <button class="tab-btn" onclick="switchTab(event, 'unread')">Unread (3)</button>-->
<!--    </div>-->

<!--    <div class="notifications-content" id="notificationsContent">-->
<!--      &lt;!&ndash; Notification items &ndash;&gt;-->
<!--    </div>-->

<!--    <div class="notifications-footer">-->
<!--      <a href="alerts.html" class="view-all-btn">View All Notifications</a>-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Notification Overlay &ndash;&gt;-->
<!--  <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>-->

<!--  &lt;!&ndash; Remove Policy Modal &ndash;&gt;-->
<!--  <div class="modal-overlay" id="removePolicyModal">-->
<!--    <div class="modal">-->
<!--      <div class="modal-header">-->
<!--        <h3>Remove Policy</h3>-->
<!--        <button class="modal-close" onclick="closeRemovePolicyModal()">-->
<!--          <i class="fas fa-times"></i>-->
<!--        </button>-->
<!--      </div>-->
<!--      <div class="modal-body">-->
<!--        <p>Type <strong>REMOVE</strong> to confirm policy removal:</p>-->
<!--        <input type="text" id="removeConfirmInput" class="domain-input" style="width: 100%; margin: 10px 0;" placeholder="REMOVE">-->
<!--        <div id="removeModalDetails"></div>-->
<!--      </div>-->
<!--      <div class="modal-footer">-->
<!--        <button class="btn btn-secondary" onclick="closeRemovePolicyModal()">Cancel</button>-->
<!--        <button class="btn btn-danger" id="confirmRemoveBtn" onclick="removeSelectedPolicy()" disabled>Remove</button>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <main class="main-content" id="mainContent">-->
<!--    <div class="content-area">-->
<!--      <div class="breadcrumb">-->
<!--        <a href="dashboard.html"><i class="fas fa-home"></i></a>-->
<!--        <span>/</span>-->
<!--        <a href="file-policies.html">Policies</a>-->
<!--        <span>/</span>-->
<!--        <span>Assign Policy</span>-->
<!--      </div>-->

<!--      <div class="page-header">-->
<!--        <div class="page-title-section">-->
<!--          <div class="page-icon"><i class="fas fa-user-shield"></i></div>-->
<!--          <div class="page-title-text">-->
<!--            <h1>Assign Policy to Agents</h1>-->
<!--            <p class="page-subtitle">Select agents and assign protection policies</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="assign-container">-->
<!--        <div class="step-indicator">-->
<!--          <div class="step active" data-step="1">-->
<!--            <div class="step-circle">1</div>-->
<!--            <div class="step-label">Choose Agent</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="2">-->
<!--            <div class="step-circle">2</div>-->
<!--            <div class="step-label">Policy Type</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="3">-->
<!--            <div class="step-circle">3</div>-->
<!--            <div class="step-label">Configure Policy</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="4">-->
<!--            <div class="step-circle">4</div>-->
<!--            <div class="step-label">Review & Apply</div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 1: Choose Agent &ndash;&gt;-->
<!--        <div id="step1">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 1: Choose Agent</div>-->
<!--            <div class="section-desc">Select the agents you want to assign a policy to</div>-->

<!--            <div class="search-box">-->
<!--              <i class="fas fa-search"></i>-->
<!--              <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..." id="agentSearch" />-->
<!--            </div>-->

<!--            <div class="selected-count" id="selectedCount">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>0 agents selected</span>-->
<!--            </div>-->

<!--            <div class="agents-grid" id="agentsGrid"></div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Select at least one agent to continue</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 2: Policy Type &ndash;&gt;-->
<!--        <div id="step2" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 2: Select Policy Type</div>-->
<!--            <div class="section-desc">Choose the type of policy you want to assign</div>-->

<!--            <div class="form-group">-->
<!--              <label class="form-label">Policy Type</label>-->
<!--              <select class="form-select" id="policyType">-->
<!--                <option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>-->
<!--                <option value="FILE">File Protection</option>-->
<!--                <option value="NETWORK">Network Policy</option>-->
<!--                <option value="USB">USB Control</option>-->
<!--                <option value="SECURITY_MONITOR">OCR & Security Monitor</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Different policy types provide different protection mechanisms</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 3: Configure Policy &ndash;&gt;-->
<!--        <div id="step3" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 3: Configure Policy</div>-->
<!--            <div class="section-desc" id="step3Description">Configure the specific settings for your selected policy type</div>-->

<!--            &lt;!&ndash; ===== FILE PROTECTION UI ===== &ndash;&gt;-->
<!--            <div id="fileProtectionUI" style="display: none;">-->
<!--              &lt;!&ndash; Selected Path Info &ndash;&gt;-->
<!--              <div class="selected-path-info" id="selectedPathInfo" style="display: none;">-->
<!--                <div class="path-label">Selected Path:</div>-->
<!--                <div class="path-value" id="selectedPathValue">-</div>-->
<!--              </div>-->

<!--              &lt;!&ndash; File Explorer &ndash;&gt;-->
<!--              <div class="file-explorer-container">-->
<!--                <div class="explorer-header">-->
<!--                  <button class="explorer-btn" id="btnGetDrives">-->
<!--                    <i class="fas fa-hdd"></i> Get Drives-->
<!--                  </button>-->
<!--                  <button class="explorer-btn" id="btnRefresh" disabled>-->
<!--                    <i class="fas fa-sync-alt"></i> Refresh-->
<!--                  </button>-->
<!--                  <div style="flex:1;"></div>-->
<!--                  <button class="explorer-btn" id="btnClearSelection">-->
<!--                    <i class="fas fa-times"></i> Clear-->
<!--                  </button>-->
<!--                </div>-->
<!--                <div class="tree-container" id="treeContainer">-->
<!--                  <div class="loading">Click "Get Drives" to load file system</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Active Policies for Selected Node &ndash;&gt;-->
<!--              <div class="active-policies-section" id="activePoliciesSection" style="display: none;">-->
<!--                <div class="section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">-->
<!--                  <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                  <span>Active Policies on Selected Resource</span>-->
<!--                </div>-->
<!--                <div class="policies-list" id="selectedNodePolicies">-->
<!--                  <div class="loading">Loading policies...</div>-->
<!--                </div>-->
<!--                <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">-->
<!--                  <i class="fas fa-info-circle"></i>-->
<!--                  <span>No active policies on this resource</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Remove Policy Button &ndash;&gt;-->
<!--              <div id="removePolicyContainer" style="display: none; margin: 20px 0;">-->
<!--                <div class="alert alert-warning" style="display: flex; justify-content: space-between; align-items: center;">-->
<!--                  <div style="display: flex; align-items: center; gap: 10px;">-->
<!--                    <i class="fas fa-exclamation-triangle"></i>-->
<!--                    <span><strong>Active Policies Exist</strong> - This resource already has protection policies applied.</span>-->
<!--                  </div>-->
<!--                  <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">-->
<!--                    <i class="fas fa-trash-alt"></i> Remove All-->
<!--                  </button>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Operations Selection &ndash;&gt;-->
<!--              <div class="section-title mt-20">Block Operations</div>-->
<!--              <div class="operations-list">-->
<!--                <div class="operation-item" id="read-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">-->
<!--                  <div class="operation-label">READ</div>-->
<!--                  <div class="operation-desc">Open, view, read content</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="write-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">-->
<!--                  <div class="operation-label">WRITE</div>-->
<!--                  <div class="operation-desc">Modify, edit, save changes</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="delete-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">-->
<!--                  <div class="operation-label">DELETE</div>-->
<!--                  <div class="operation-desc">Remove, trash, permanently delete</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="rename-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">-->
<!--                  <div class="operation-label">RENAME</div>-->
<!--                  <div class="operation-desc">Change name, move within volume</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="create-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">-->
<!--                  <div class="operation-label">CREATE</div>-->
<!--                  <div class="operation-desc">New file/folder creation (folders only)</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div class="read-block-all" id="readBlockAllWarning">-->
<!--                <i class="fas fa-exclamation-triangle"></i>-->
<!--                <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== NETWORK POLICY UI ===== &ndash;&gt;-->
<!--            <div id="networkUI" style="display: none;">-->
<!--              <div class="network-config-container">-->
<!--                &lt;!&ndash; DNS Domain Blocking &ndash;&gt;-->
<!--                <div class="domain-input-container">-->
<!--                  <label class="form-label">Block Domains</label>-->
<!--                  <div class="domain-input-group">-->
<!--                    <input type="text" class="domain-input" id="domainInput"-->
<!--                           placeholder="Enter domain (e.g., www.example.com, *.social.com)" />-->
<!--                    <button class="btn-add-domain" onclick="addDomain()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="domainTags"></div>-->
<!--                  <small class="form-text text-muted">Use * for wildcards (e.g., *.social.com blocks all subdomains)</small>-->
<!--                </div>-->

<!--                &lt;!&ndash; IP Address Blocking &ndash;&gt;-->
<!--                <div class="ip-input-container" style="margin-top: 20px;">-->
<!--                  <label class="form-label">Block IP Addresses</label>-->
<!--                  <div class="domain-input-group">-->
<!--                    <input type="text" class="domain-input" id="ipInput"-->
<!--                           placeholder="Enter IP (e.g., 192.168.1.100, 10.0.0.0/24)" />-->
<!--                    <button class="btn-add-domain" onclick="addIP()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="ipTags"></div>-->
<!--                  <small class="form-text text-muted">Supports single IPs or CIDR notation (e.g., 10.0.0.0/24)</small>-->
<!--                </div>-->

<!--                &lt;!&ndash; Active Network Policies &ndash;&gt;-->
<!--                <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeNetworkPolicies">-->
<!--                  <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                    <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                    <span>Active Network Policies on Selected Agents</span>-->
<!--                  </div>-->
<!--                  <div class="policies-list" id="networkPoliciesList">-->
<!--                    <div class="loading">Loading policies...</div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== USB POLICY UI ===== &ndash;&gt;-->
<!--            <div id="usbUI" style="display: none;">-->
<!--              <div class="usb-config-container">-->
<!--                &lt;!&ndash; USB Action &ndash;&gt;-->
<!--                <div class="form-group">-->
<!--                  <label class="form-label">USB Device Action</label>-->
<!--                  <select class="form-select" id="usbAction">-->
<!--                    <option value="block_all">Block All USB Devices</option>-->
<!--                    <option value="block_write">Block Write Only (Read Allowed)</option>-->
<!--                    <option value="allow_specific">Allow Specific Devices</option>-->
<!--                    <option value="audit">Audit Only</option>-->
<!--                  </select>-->
<!--                </div>-->

<!--                &lt;!&ndash; Device Whitelist/Blacklist &ndash;&gt;-->
<!--                <div id="specificDevicesUI" style="display: none;">-->
<!--                  <label class="form-label">Allowed/Blocked Devices</label>-->
<!--                  <div class="device-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">-->
<!--                    <input type="text" class="domain-input" id="deviceInput"-->
<!--                           placeholder="Enter Device ID or VID/PID" />-->
<!--                    <button class="btn-add-domain" onclick="addDevice()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="deviceTags"></div>-->
<!--                  <small class="form-text text-muted">Format: VID:PID (e.g., 0781:5583 for Sandisk USB)</small>-->
<!--                </div>-->

<!--                &lt;!&ndash; USB Types &ndash;&gt;-->
<!--                <div style="margin-top: 20px;">-->
<!--                  <label class="form-label">USB Types to Control</label>-->
<!--                  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbStorage" checked> Storage Devices-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbKeyboard"> Keyboards-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbMouse"> Mice-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbPrinter"> Printers-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbNetwork"> Network Adapters-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="usbOther"> Other Devices-->
<!--                    </label>-->
<!--                  </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Active USB Policies &ndash;&gt;-->
<!--                <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeUSBPolicies">-->
<!--                  <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                    <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                    <span>Active USB Policies on Selected Agents</span>-->
<!--                  </div>-->
<!--                  <div class="policies-list" id="usbPoliciesList">-->
<!--                    <div class="loading">Loading policies...</div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== OCR/SECURITY MONITOR UI ===== &ndash;&gt;-->
<!--            <div id="ocrUI" style="display: none;">-->
<!--              <div class="ocr-config-container">-->
<!--                &lt;!&ndash; OCR Sensitivity &ndash;&gt;-->
<!--                <div class="form-group">-->
<!--                  <label class="form-label">OCR Sensitivity</label>-->
<!--                  <select class="form-select" id="ocrSensitivity">-->
<!--                    <option value="high">High - Detect any text in images</option>-->
<!--                    <option value="medium" selected>Medium - Detect sensitive patterns only</option>-->
<!--                    <option value="low">Low - Specific keywords only</option>-->
<!--                  </select>-->
<!--                </div>-->

<!--                &lt;!&ndash; Content to Scan &ndash;&gt;-->
<!--                <div style="margin-top: 20px;">-->
<!--                  <label class="form-label">Content to Monitor</label>-->
<!--                  <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanCreditCards" checked> Credit Card Numbers-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanSSN" checked> Social Security Numbers-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanPassports"> Passport Numbers-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanDriversLicense"> Driver's Licenses-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanBankAccounts"> Bank Account Numbers-->
<!--                    </label>-->
<!--                    <label style="display: flex; align-items: center; gap: 8px;">-->
<!--                      <input type="checkbox" id="scanCustom"> Custom Keywords-->
<!--                    </label>-->
<!--                  </div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Custom Keywords &ndash;&gt;-->
<!--                <div id="customKeywordsUI" style="display: none; margin-top: 20px;">-->
<!--                  <label class="form-label">Custom Keywords/Patterns</label>-->
<!--                  <div class="domain-input-group">-->
<!--                    <input type="text" class="domain-input" id="keywordInput"-->
<!--                           placeholder="Enter keyword or regex pattern" />-->
<!--                    <button class="btn-add-domain" onclick="addKeyword()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="keywordTags"></div>-->
<!--                </div>-->

<!--                &lt;!&ndash; Action &ndash;&gt;-->
<!--                <div style="margin-top: 20px;">-->
<!--                  <label class="form-label">On Detection</label>-->
<!--                  <select class="form-select" id="ocrAction">-->
<!--                    <option value="block">Block and Alert</option>-->
<!--                    <option value="alert">Alert Only</option>-->
<!--                    <option value="log">Log Only</option>-->
<!--                    <option value="quarantine">Quarantine File</option>-->
<!--                  </select>-->
<!--                </div>-->

<!--                &lt;!&ndash; Active OCR Policies &ndash;&gt;-->
<!--                <div class="active-policies-section" style="margin-top: 20px; display: none;" id="activeOCRPolicies">-->
<!--                  <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                    <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                    <span>Active OCR Policies on Selected Agents</span>-->
<!--                  </div>-->
<!--                  <div class="policies-list" id="ocrPoliciesList">-->
<!--                    <div class="loading">Loading policies...</div>-->
<!--                  </div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 4: Review & Apply &ndash;&gt;-->
<!--        <div id="step4" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 4: Review & Apply</div>-->
<!--            <div class="section-desc">Verify the policy assignment before applying</div>-->

<!--            <div class="summary-box" id="summaryBox">-->
<!--              &lt;!&ndash; Summary content will be dynamically updated &ndash;&gt;-->
<!--            </div>-->

<!--            <div class="alert alert-success" style="margin-top: 20px" id="step4Alert">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The policy will be applied to all selected agents within 5 minutes.</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div class="btn-group">-->
<!--          <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">-->
<!--            <i class="fas fa-arrow-left"></i><span>Previous</span>-->
<!--          </button>-->
<!--          <button class="btn btn-secondary" onclick="cancelAssignment()">-->
<!--            <i class="fas fa-times"></i><span>Cancel</span>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">-->
<!--            <span>Next</span><i class="fas fa-arrow-right"></i>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">-->
<!--            <i class="fas fa-check"></i><span>Apply Policy</span>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </main>-->
<!--</div>-->

<!--<script>-->
<!--  // ==================== GLOBAL STATE ====================-->
<!--  let selectedAgents = new Set();-->
<!--  let agentsBasicData = {};-->
<!--  let agentsCapabilities = {};-->
<!--  let currentStep = 1;-->
<!--  let selectedPolicyType = "";-->
<!--  let selectedPolicy = "";-->
<!--  let blockedDomains = [];-->
<!--  let blockedIPs = [];-->

<!--  // File Explorer State-->
<!--  let treeData = {};-->
<!--  let selectedNode = null;-->
<!--  let operations = {-->
<!--      read: false,-->
<!--      write: false,-->
<!--      delete: false,-->
<!--      rename: false,-->
<!--      create: false-->
<!--  };-->
<!--  let activeNodePolicies = [];-->
<!--  let policyToRemove = null;-->
<!--  let currentlyExpanding = new Set();-->

<!--  // ==================== AUTHENTICATION & USER DATA ====================-->
<!--  async function checkAuth() {-->
<!--      try {-->
<!--          const response = await fetch("/api/auth/check", {-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error("Not authenticated");-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (!result.success) {-->
<!--              window.location.href = "index.html";-->
<!--              return null;-->
<!--          }-->

<!--          if (result.data) {-->
<!--              localStorage.setItem("userData", JSON.stringify(result.data));-->
<!--              return result.data;-->
<!--          }-->

<!--          return null;-->
<!--      } catch (err) {-->
<!--          window.location.href = "index.html";-->
<!--          return null;-->
<!--      }-->
<!--  }-->

<!--  function loadAdminInfo() {-->
<!--      const userDataStr = localStorage.getItem("userData");-->

<!--      if (userDataStr) {-->
<!--          try {-->
<!--              const userData = JSON.parse(userDataStr);-->

<!--              const userName = document.querySelector(".user-name");-->
<!--              const userAvatar = document.querySelector(".user-avatar");-->
<!--              const userRole = document.querySelector(".user-role");-->

<!--              if (userName) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const formattedName = namePart-->
<!--                      .split(".")-->
<!--                      .map(n => n.charAt(0).toUpperCase() + n.slice(1))-->
<!--                      .join(" ");-->
<!--                  userName.textContent = formattedName;-->
<!--              }-->

<!--              if (userAvatar) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const initials = namePart-->
<!--                      .split(".")-->
<!--                      .map(n => (n[0] ? n[0].toUpperCase() : ""))-->
<!--                      .join("");-->
<!--                  userAvatar.textContent = initials || "A";-->
<!--              }-->

<!--              if (userRole) {-->
<!--                  userRole.textContent = userData.role || "Security Admin";-->
<!--              }-->
<!--          } catch (e) {-->
<!--              console.error("Error parsing user data:", e);-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  // ==================== SIDEBAR FUNCTIONS ====================-->
<!--  function toggleSubMenu(element) {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      if (sidebar.classList.contains("collapsed")) return;-->

<!--      var subMenu = element.nextElementSibling;-->
<!--      var allSubMenus = document.querySelectorAll(".sub-menu");-->
<!--      var allDropdowns = document.querySelectorAll(".nav-dropdown");-->

<!--      allSubMenus.forEach(function(menu) {-->
<!--          if (menu !== subMenu) menu.classList.remove("open");-->
<!--      });-->
<!--      allDropdowns.forEach(function(link) {-->
<!--          if (link !== element) link.classList.remove("expanded");-->
<!--      });-->

<!--      element.classList.toggle("expanded");-->
<!--      subMenu.classList.toggle("open");-->
<!--  }-->

<!--  function toggleSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var mainContent = document.getElementById("mainContent");-->
<!--      var header = document.getElementById("topHeader");-->

<!--      sidebar.classList.toggle("collapsed");-->
<!--      var isCollapsed = sidebar.classList.contains("collapsed");-->

<!--      if (mainContent) mainContent.classList.toggle("expanded");-->

<!--      if (header) {-->
<!--          header.style.left = isCollapsed ? "70px" : "240px";-->
<!--      }-->

<!--      if (isCollapsed) {-->
<!--          document.querySelectorAll(".sub-menu").forEach(function(m) {-->
<!--              m.classList.remove("open");-->
<!--          });-->
<!--          document.querySelectorAll(".nav-dropdown").forEach(function(l) {-->
<!--              l.classList.remove("expanded");-->
<!--          });-->
<!--      }-->
<!--  }-->

<!--  function openMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.add("mobile-open");-->
<!--      if (overlay) overlay.classList.add("active");-->
<!--  }-->

<!--  function closeMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.remove("mobile-open");-->
<!--      if (overlay) overlay.classList.remove("active");-->
<!--  }-->

<!--  function toggleMobileMenu() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (!sidebar) return;-->

<!--      if (sidebar.classList.contains("mobile-open")) {-->
<!--          closeMobileSidebar();-->
<!--      } else {-->
<!--          openMobileSidebar();-->
<!--      }-->
<!--  }-->

<!--  function setActiveMenuItem() {-->
<!--      var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';-->

<!--      document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {-->
<!--          el.classList.remove('active');-->
<!--      });-->

<!--      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function(item) {-->
<!--          var href = item.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              item.classList.add('active');-->
<!--              var parentSubMenu = item.closest('.sub-menu');-->
<!--              if (parentSubMenu) {-->
<!--                  parentSubMenu.classList.add('open');-->
<!--                  var parentNav = parentSubMenu.previousElementSibling;-->
<!--                  if (parentNav) parentNav.classList.add('expanded');-->
<!--              }-->
<!--          }-->
<!--      });-->

<!--      document.querySelectorAll('.nav-link[data-page]').forEach(function(link) {-->
<!--          var href = link.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              link.classList.add('active');-->
<!--          }-->
<!--      });-->
<!--  }-->

<!--  // ==================== HEADER FUNCTIONS ====================-->
<!--  function toggleNotifications(event) {-->
<!--      event.stopPropagation();-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = event.currentTarget;-->
<!--      if (!panel || !overlay) return;-->

<!--      if (panel.classList.contains("show")) {-->
<!--          closeNotifications();-->
<!--      } else {-->
<!--          closeUserDropdown();-->
<!--          panel.classList.add("show");-->
<!--          overlay.classList.add("show");-->
<!--          btn.classList.add("active");-->
<!--          document.body.style.overflow = "hidden";-->
<!--      }-->
<!--  }-->

<!--  function closeNotifications() {-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = document.querySelector(".notification-btn");-->
<!--      if (panel) panel.classList.remove("show");-->
<!--      if (overlay) overlay.classList.remove("show");-->
<!--      if (btn) btn.classList.remove("active");-->
<!--      document.body.style.overflow = "";-->
<!--  }-->

<!--  function switchTab(event, tabName) {-->
<!--      document.querySelectorAll(".tab-btn").forEach(function(t) {-->
<!--          t.classList.remove("active");-->
<!--      });-->
<!--      event.currentTarget.classList.add("active");-->

<!--      document.querySelectorAll(".notification-item").forEach(function(item) {-->
<!--          item.style.display =-->
<!--              tabName === "unread" && !item.classList.contains("unread") ? "none" : "flex";-->
<!--      });-->
<!--  }-->

<!--  function toggleUserDropdown(event) {-->
<!--      event.stopPropagation();-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = event.currentTarget;-->
<!--      if (!dropdown) return;-->

<!--      if (dropdown.classList.contains("show")) {-->
<!--          closeUserDropdown();-->
<!--      } else {-->
<!--          closeNotifications();-->
<!--          dropdown.classList.add("show");-->
<!--          userProfile.classList.add("active");-->
<!--      }-->
<!--  }-->

<!--  function closeUserDropdown() {-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = document.querySelector(".user-profile");-->
<!--      if (dropdown) dropdown.classList.remove("show");-->
<!--      if (userProfile) userProfile.classList.remove("active");-->
<!--  }-->

<!--  function logout(event) {-->
<!--      event.preventDefault();-->
<!--      window.location.href = "/logout";-->
<!--  }-->

<!--  document.addEventListener("click", function(event) {-->
<!--      if (!event.target.closest(".user-profile")) {-->
<!--          closeUserDropdown();-->
<!--      }-->
<!--      if (-->
<!--          !event.target.closest(".notification-btn") &&-->
<!--          !event.target.closest(".notifications-panel")-->
<!--      ) {-->
<!--          closeNotifications();-->
<!--      }-->
<!--  });-->

<!--  // ==================== AGENT FUNCTIONS ====================-->
<!--  async function initializeAgentCards() {-->
<!--      const agentsGrid = document.getElementById("agentsGrid");-->
<!--      if (!agentsGrid) return;-->

<!--      agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';-->

<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->

<!--          if (!result.success || !result.data) {-->
<!--              throw new Error(result.message || "No agents found");-->
<!--          }-->

<!--          const agents = result.data;-->
<!--          agentsGrid.innerHTML = "";-->

<!--          agents.forEach((agent) => {-->
<!--              const agentCard = document.createElement("div");-->
<!--              agentCard.className = "agent-card";-->
<!--              agentCard.dataset.id = agent.id;-->
<!--              agentCard.onclick = () => toggleAgent(agent.id);-->

<!--              agentCard.innerHTML = `-->
<!--                  <div class="agent-card-header">-->
<!--                      <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""}>-->
<!--                      <div class="agent-name">${agent.username}</div>-->
<!--                      <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"}">-->
<!--                          ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}-->
<!--                      </span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fas fa-user"></i> ${agent.hostname || agent.username}</span>-->
<!--                      <span><i class="fas fa-id-badge"></i> ${agent.id}</span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fab fa-${getOSIcon(agent.osType)}"></i> ${agent.osType || "Unknown OS"}</span>-->
<!--                      <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"}</span>-->
<!--                  </div>-->
<!--              `;-->

<!--              agentsGrid.appendChild(agentCard);-->

<!--              if (selectedAgents.has(agent.id)) {-->
<!--                  agentCard.classList.add("selected");-->
<!--                  agentCard.querySelector(".agent-checkbox").checked = true;-->
<!--              }-->
<!--          });-->
<!--      } catch (error) {-->
<!--          console.error("Error loading agents:", error);-->
<!--          agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;-->
<!--      }-->

<!--      updateSelectedCount();-->
<!--  }-->

<!--  function isAgentOnline(agent) {-->
<!--      if (agent.agentRuntimeState && agent.agentRuntimeState.toUpperCase() === "ONLINE") return true;-->

<!--      if (agent.lastHeartbeat) {-->
<!--          const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();-->
<!--          const now = new Date();-->
<!--          const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);-->
<!--          return diffMinutes <= 10;-->
<!--      }-->

<!--      return false;-->
<!--  }-->

<!--  function getOSIcon(os) {-->
<!--      if (!os) return "desktop";-->

<!--      const osLower = os.toLowerCase();-->
<!--      if (osLower.includes("windows")) return "windows";-->
<!--      if (osLower.includes("macos") || osLower.includes("mac")) return "apple";-->
<!--      if (osLower.includes("ubuntu") || osLower.includes("linux")) return "linux";-->
<!--      return "desktop";-->
<!--  }-->

<!--  async function toggleAgent(agentId) {-->
<!--      if (selectedAgents.has(agentId)) {-->
<!--          selectedAgents.delete(agentId);-->
<!--          delete agentsCapabilities[agentId];-->
<!--      } else {-->
<!--          selectedAgents.add(agentId);-->
<!--          if (!agentsCapabilities[agentId]) {-->
<!--              try {-->
<!--                  await fetchAgentDetails(agentId);-->
<!--              } catch (error) {-->
<!--                  console.error(`Failed to fetch capabilities for agent ${agentId}:`, error);-->
<!--                  agentsCapabilities[agentId] = {};-->
<!--              }-->
<!--          }-->
<!--      }-->

<!--      const agentCard = document.querySelector(`.agent-card[data-id="${agentId}"]`);-->
<!--      if (agentCard) {-->
<!--          agentCard.classList.toggle("selected");-->
<!--          const checkbox = agentCard.querySelector(".agent-checkbox");-->
<!--          if (checkbox) {-->
<!--              checkbox.checked = selectedAgents.has(agentId);-->
<!--          }-->
<!--      }-->

<!--      updateSelectedCount();-->

<!--      if (selectedAgents.size > 0 && selectedPolicyType) {-->
<!--          updatePolicyTypes();-->
<!--      }-->
<!--  }-->

<!--  async function fetchAgentDetails(agentId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/agents/${agentId}/capabilities`, {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error(`HTTP ${response.status}: Failed to fetch capabilities`);-->

<!--          const result = await response.json();-->

<!--          if (result.success && result.data) {-->
<!--              agentsCapabilities[agentId] = result.data;-->
<!--          } else {-->
<!--              throw new Error(result.message || "Failed to load capabilities");-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error(`Error fetching capabilities for agent ${agentId}:`, error);-->
<!--          agentsCapabilities[agentId] = {};-->
<!--          throw error;-->
<!--      }-->
<!--  }-->

<!--  async function fetchAgentSimpleDetails() {-->
<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->
<!--          if (result.success && result.data) {-->
<!--              result.data.forEach((agent) => {-->
<!--                  agentsBasicData[agent.id] = agent;-->
<!--              });-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error("Error fetching agents:", error);-->
<!--      }-->
<!--  }-->

<!--  function updateSelectedCount() {-->
<!--      const count = selectedAgents.size;-->
<!--      const selectedCountElement = document.getElementById("selectedCount");-->
<!--      if (selectedCountElement) {-->
<!--          selectedCountElement.innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>${count} agent${count !== 1 ? "s" : ""} selected</span>-->
<!--          `;-->
<!--      }-->
<!--  }-->

<!--  async function updatePolicyTypes() {-->
<!--      if (selectedAgents.size === 0 || selectedPolicyType !== "NETWORK") return;-->

<!--      // Original network policy type logic-->
<!--      let commonCategories = null;-->

<!--      for (const agentId of selectedAgents) {-->
<!--          const capabilities = agentsCapabilities[agentId];-->

<!--          if (capabilities && Object.keys(capabilities).length > 0) {-->
<!--              const agentCategories = Object.keys(capabilities);-->

<!--              if (commonCategories === null) {-->
<!--                  commonCategories = new Set(agentCategories);-->
<!--              } else {-->
<!--                  commonCategories = new Set(-->
<!--                      [...commonCategories].filter(cat => agentCategories.includes(cat))-->
<!--                  );-->
<!--              }-->
<!--          } else {-->
<!--              commonCategories = new Set();-->
<!--              break;-->
<!--          }-->
<!--      }-->

<!--      if (commonCategories && commonCategories.has("NETWORK")) {-->
<!--          updatePolicySelect();-->
<!--      }-->
<!--  }-->

<!--  function updatePolicySelect() {-->
<!--      const policySelect = document.getElementById("policySelect");-->
<!--      if (!policySelect) return;-->

<!--      policySelect.innerHTML = '<option value="">&#45;&#45; Select Policy &#45;&#45;</option>';-->

<!--      if (selectedPolicyType === "NETWORK" && selectedAgents.size > 0) {-->
<!--          let commonPolicies = null;-->

<!--          for (const agentId of selectedAgents) {-->
<!--              const capabilities = agentsCapabilities[agentId];-->

<!--              if (capabilities && capabilities.NETWORK) {-->
<!--                  const agentPolicies = capabilities.NETWORK;-->

<!--                  if (commonPolicies === null) {-->
<!--                      commonPolicies = new Map();-->
<!--                      agentPolicies.forEach(policy => {-->
<!--                          if (policy && policy.code) {-->
<!--                              commonPolicies.set(policy.code, policy);-->
<!--                          }-->
<!--                      });-->
<!--                  } else {-->
<!--                      const agentPolicyCodes = new Set(agentPolicies.map(p => p?.code).filter(code => code));-->
<!--                      commonPolicies = new Map(-->
<!--                          [...commonPolicies].filter(([code]) => agentPolicyCodes.has(code))-->
<!--                      );-->
<!--                  }-->
<!--              } else {-->
<!--                  commonPolicies = new Map();-->
<!--                  break;-->
<!--              }-->
<!--          }-->

<!--          if (commonPolicies && commonPolicies.size > 0) {-->
<!--              policySelect.disabled = false;-->

<!--              const sortedPolicies = Array.from(commonPolicies.values())-->
<!--                  .filter(policy => policy && policy.name)-->
<!--                  .sort((a, b) => a.name.localeCompare(b.name));-->

<!--              sortedPolicies.forEach(policy => {-->
<!--                  const option = document.createElement("option");-->
<!--                  option.value = policy.code;-->
<!--                  option.textContent = policy.name;-->
<!--                  option.title = policy.description || "";-->
<!--                  policySelect.appendChild(option);-->
<!--              });-->

<!--              if (sortedPolicies.length > 0) {-->
<!--                  policySelect.value = sortedPolicies[0].code;-->
<!--                  selectedPolicy = sortedPolicies[0].code;-->
<!--              }-->
<!--          } else {-->
<!--              policySelect.disabled = true;-->
<!--              policySelect.innerHTML = '<option value="">No common policies available</option>';-->
<!--              selectedPolicy = "";-->
<!--          }-->
<!--      } else {-->
<!--          policySelect.disabled = true;-->
<!--          policySelect.innerHTML = '<option value="">&#45;&#45; Select a policy type first &#45;&#45;</option>';-->
<!--          selectedPolicy = "";-->
<!--      }-->
<!--  }-->

<!--  // ==================== FILE EXPLORER FUNCTIONS ====================-->
<!--  async function getDrives() {-->
<!--      try {-->
<!--          const treeContainer = document.getElementById('treeContainer');-->
<!--          treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';-->

<!--          const response = await fetch(`/api/admin/explorer/drives`, {-->
<!--              credentials: "include"-->
<!--          });-->
<!--          const data = await response.json();-->

<!--          treeData = data;-->
<!--          document.getElementById('btnRefresh').disabled = false;-->
<!--          renderTree(data);-->
<!--      } catch (error) {-->
<!--          console.error('Failed to get drives:', error);-->
<!--          document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';-->
<!--      }-->
<!--  }-->

<!--  async function expandNode(node) {-->
<!--      if (!node || node.expanded || currentlyExpanding.has(node.id)) return;-->

<!--      currentlyExpanding.add(node.id);-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/explorer/nodes/${node.id}/expand`, {-->
<!--              method: 'POST',-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (response.status === 409) {-->
<!--              node.expanded = true;-->
<!--              return;-->
<!--          }-->

<!--          if (!response.ok) throw new Error(`HTTP ${response.status}`);-->

<!--          const data = await response.json();-->

<!--          if (!Array.isArray(data)) {-->
<!--              console.error('Invalid expand response:', data);-->
<!--              return;-->
<!--          }-->

<!--          updateTreeWithChildren(node.id, data);-->
<!--          node.expanded = true;-->

<!--      } catch (error) {-->
<!--          console.error('Expand failed:', error);-->
<!--      } finally {-->
<!--          currentlyExpanding.delete(node.id);-->
<!--          renderTree(treeData);-->
<!--      }-->
<!--  }-->

<!--  async function refreshExplorer() {-->
<!--      if (!selectedNode) {-->
<!--          await getDrives();-->
<!--          return;-->
<!--      }-->

<!--      const node = findNode(treeData, selectedNode.id);-->
<!--      if (!node) return;-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {-->
<!--          node.expanded = false;-->
<!--          node.children = [];-->
<!--          renderTree(treeData);-->

<!--          setTimeout(() => {-->
<!--              expandNode(node);-->
<!--          }, 200);-->
<!--      }-->
<!--  }-->

<!--  function findNode(nodes, id) {-->
<!--      for (const node of nodes) {-->
<!--          if (node.id === id) return node;-->
<!--          if (node.children) {-->
<!--              const found = findNode(node.children, id);-->
<!--              if (found) return found;-->
<!--          }-->
<!--      }-->
<!--      return null;-->
<!--  }-->

<!--  function renderTree(data) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      if (!treeContainer) return;-->

<!--      treeContainer.innerHTML = '';-->

<!--      if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {-->
<!--          treeContainer.innerHTML = '<div class="loading">No items found</div>';-->
<!--          return;-->
<!--      }-->

<!--      const items = Array.isArray(data) ? data : Object.values(data);-->
<!--      items.forEach(item => {-->
<!--          renderTreeNode(item, 0);-->
<!--      });-->
<!--  }-->

<!--  function renderTreeNode(node, level) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      const nodeEl = document.createElement('div');-->
<!--      const isSelected = selectedNode && selectedNode.id === node.id;-->

<!--      nodeEl.className = 'tree-node';-->
<!--      if (isSelected) nodeEl.classList.add('selected');-->

<!--      const indent = level * 20;-->
<!--      nodeEl.style.paddingLeft = `${indent + 10}px`;-->

<!--      if (node.type === 'folder' || node.type === 'drive') {-->
<!--          const expandEl = document.createElement('div');-->
<!--          expandEl.className = 'tree-node-expand';-->
<!--          expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';-->
<!--          expandEl.style.cursor = 'pointer';-->
<!--          expandEl.style.marginRight = '5px';-->
<!--          expandEl.style.fontSize = '12px';-->

<!--          expandEl.addEventListener('click', function(e) {-->
<!--              e.stopPropagation();-->
<!--              toggleFolder(node);-->
<!--          });-->

<!--          nodeEl.appendChild(expandEl);-->
<!--      } else {-->
<!--          const spacer = document.createElement('div');-->
<!--          spacer.style.width = '16px';-->
<!--          spacer.style.display = 'inline-block';-->
<!--          nodeEl.appendChild(spacer);-->
<!--      }-->

<!--      const iconEl = document.createElement('div');-->
<!--      iconEl.className = 'tree-node-icon';-->
<!--      iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';-->
<!--      nodeEl.appendChild(iconEl);-->

<!--      const nameEl = document.createElement('div');-->
<!--      nameEl.className = 'tree-node-name';-->
<!--      nameEl.textContent = node.name || 'Unnamed';-->
<!--      nodeEl.appendChild(nameEl);-->

<!--      nodeEl.addEventListener('click', function(e) {-->
<!--          e.stopPropagation();-->
<!--          selectNode(node);-->
<!--      });-->

<!--      treeContainer.appendChild(nodeEl);-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {-->
<!--          node.children.forEach(child => {-->
<!--              renderTreeNode(child, level + 1);-->
<!--          });-->
<!--      }-->
<!--  }-->

<!--  async function toggleFolder(node) {-->
<!--      if (node.expanded) {-->
<!--          try {-->
<!--              await fetch(`/api/admin/explorer/nodes/${node.id}/collapse`, {-->
<!--                  method: 'POST',-->
<!--                  credentials: "include"-->
<!--              });-->

<!--              node.expanded = false;-->
<!--              node.children = [];-->

<!--              renderTree(treeData);-->
<!--          } catch (e) {-->
<!--              console.error("Collapse failed", e);-->
<!--          }-->
<!--          return;-->
<!--      }-->

<!--      if (currentlyExpanding.has(node.id)) return;-->
<!--      expandNode(node);-->
<!--  }-->

<!--  function selectNode(node) {-->
<!--      selectedNode = node;-->

<!--      document.getElementById('selectedPathInfo').style.display = 'block';-->
<!--      document.getElementById('selectedPathValue').textContent = node.full_path || node.id;-->

<!--      loadNodePolicies(node.id);-->

<!--      const cbCreate = document.getElementById('cb-create');-->
<!--      if (node.type === 'file') {-->
<!--          operations.create = false;-->
<!--          cbCreate.checked = false;-->
<!--          cbCreate.disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      } else {-->
<!--          cbCreate.disabled = false;-->
<!--          document.getElementById('create-operation').classList.remove('disabled');-->
<!--      }-->

<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--      updatePolicyButtons();-->
<!--  }-->

<!--  function clearSelection() {-->
<!--      selectedNode = null;-->
<!--      document.getElementById('selectedPathInfo').style.display = 'none';-->
<!--      document.getElementById('selectedPathValue').textContent = '-';-->
<!--      document.getElementById('activePoliciesSection').style.display = 'none';-->
<!--      document.getElementById('removePolicyContainer').style.display = 'none';-->
<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--  }-->

<!--  function updateTreeWithChildren(parentId, children) {-->
<!--      if (!Array.isArray(children)) {-->
<!--          console.error("Children is not array:", children);-->
<!--          return;-->
<!--      }-->

<!--      function updateNode(nodes) {-->
<!--          for (let node of nodes) {-->
<!--              if (!node) continue;-->

<!--              if (node.id === parentId) {-->
<!--                  node.children = children;-->
<!--                  node.expanded = true;-->
<!--                  return true;-->
<!--              }-->

<!--              if (Array.isArray(node.children)) {-->
<!--                  if (updateNode(node.children)) return true;-->
<!--              }-->
<!--          }-->
<!--          return false;-->
<!--      }-->

<!--      if (Array.isArray(treeData)) {-->
<!--          updateNode(treeData);-->
<!--      }-->
<!--  }-->

<!--  // ==================== ACTIVE POLICIES FUNCTIONS ====================-->
<!--  async function loadNodePolicies(nodeId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies/node/${nodeId}`, {-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              if (response.status === 404) {-->
<!--                  activeNodePolicies = [];-->
<!--              } else {-->
<!--                  throw new Error('Failed to load policies');-->
<!--              }-->
<!--          } else {-->
<!--              const result = await response.json();-->

<!--              if (Array.isArray(result)) {-->
<!--                  activeNodePolicies = result;-->
<!--              } else if (result.data && Array.isArray(result.data)) {-->
<!--                  activeNodePolicies = result.data;-->
<!--              } else {-->
<!--                  activeNodePolicies = [];-->
<!--              }-->
<!--          }-->

<!--          const section = document.getElementById('activePoliciesSection');-->
<!--          const policiesList = document.getElementById('selectedNodePolicies');-->
<!--          const noPoliciesMsg = document.getElementById('noPoliciesMsg');-->
<!--          const removeContainer = document.getElementById('removePolicyContainer');-->

<!--          if (activeNodePolicies.length > 0) {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'block';-->
<!--              noPoliciesMsg.style.display = 'none';-->

<!--              policiesList.innerHTML = '';-->
<!--              activeNodePolicies.forEach(policy => {-->
<!--                  const policyItem = document.createElement('div');-->
<!--                  policyItem.className = 'policy-item';-->

<!--                  const operations = policy.operations || {};-->
<!--                  const isBlockAll = operations.read === true;-->

<!--                  if (isBlockAll) {-->
<!--                      policyItem.classList.add('block-all');-->
<!--                  }-->

<!--                  const ops = [];-->
<!--                  if (operations.read === true) ops.push('READ');-->
<!--                  if (operations.write === true) ops.push('WRITE');-->
<!--                  if (operations.delete === true) ops.push('DELETE');-->
<!--                  if (operations.rename === true) ops.push('RENAME');-->
<!--                  if (operations.create === true) ops.push('CREATE');-->

<!--                  policyItem.innerHTML = `-->
<!--                      <div class="policy-info">-->
<!--                          <div class="policy-name">${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}</div>-->
<!--                          <div class="policy-details">Scope: ${policy.scope || 'file'} | ID: ${policy.id}</div>-->
<!--                      </div>-->
<!--                      <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">-->
<!--                          <i class="fas fa-times"></i>-->
<!--                      </button>-->
<!--                  `;-->

<!--                  policiesList.appendChild(policyItem);-->
<!--              });-->
<!--          } else {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'none';-->
<!--              noPoliciesMsg.style.display = 'flex';-->
<!--              policiesList.innerHTML = '';-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Error loading node policies:', error);-->
<!--      }-->
<!--  }-->

<!--  function showRemovePolicyModal() {-->
<!--      if (activeNodePolicies.length === 0) return;-->

<!--      if (activeNodePolicies.length > 1) {-->
<!--          showPolicySelectionModal();-->
<!--      } else {-->
<!--          showRemovePolicyModalForPolicy(activeNodePolicies[0].id);-->
<!--      }-->
<!--  }-->

<!--  function showPolicySelectionModal() {-->
<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      let html = '<p><strong>Multiple policies found:</strong></p>';-->
<!--      html += '<div style="margin: 15px 0;">';-->

<!--      activeNodePolicies.forEach(policy => {-->
<!--          const operations = policy.operations || {};-->
<!--          const ops = Object.entries(operations)-->
<!--              .filter(([op, val]) => val)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          html += `-->
<!--              <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">-->
<!--                  <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">-->
<!--                  <label for="policy_${policy.id}" style="flex: 1;">-->
<!--                      <strong>Policy ID ${policy.id}</strong><br>-->
<!--                      Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}-->
<!--                  </label>-->
<!--              </div>-->
<!--          `;-->
<!--      });-->

<!--      html += '</div>';-->
<!--      html += '<p>Select a policy to remove:</p>';-->

<!--      details.innerHTML = html;-->

<!--      setTimeout(() => {-->
<!--          const radios = document.querySelectorAll('input[name="policySelect"]');-->
<!--          radios.forEach(radio => {-->
<!--              radio.addEventListener('change', function() {-->
<!--                  policyToRemove = parseInt(this.value);-->
<!--                  updateRemoveConfirmButton();-->
<!--              });-->
<!--          });-->
<!--      }, 100);-->

<!--      confirmInput.value = '';-->
<!--      confirmInput.disabled = false;-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          updateRemoveConfirmButton();-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function showRemovePolicyModalForPolicy(policyId) {-->
<!--      const policy = activeNodePolicies.find(p => p.id === policyId);-->
<!--      if (!policy) return;-->

<!--      policyToRemove = policyId;-->

<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      const operations = policy.operations || {};-->
<!--      const ops = Object.entries(operations)-->
<!--          .filter(([op, val]) => val)-->
<!--          .map(([op]) => op.toUpperCase())-->
<!--          .join(', ');-->

<!--      details.innerHTML = `-->
<!--          <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Policy ID:</strong> ${policy.id}</div>-->
<!--          <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>-->
<!--          <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>-->
<!--      `;-->

<!--      confirmInput.value = '';-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function updateRemoveConfirmButton() {-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;-->
<!--  }-->

<!--  function closeRemovePolicyModal() {-->
<!--      document.getElementById('removePolicyModal').classList.remove('active');-->
<!--      policyToRemove = null;-->
<!--  }-->

<!--  async function removeSelectedPolicy() {-->
<!--      if (!policyToRemove) {-->
<!--          closeRemovePolicyModal();-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies/node/${selectedNode.id}`, {-->
<!--              method: 'DELETE',-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error('Failed to remove policies');-->
<!--          }-->

<!--          showToast("Policies removed successfully!", "success");-->
<!--          closeRemovePolicyModal();-->

<!--          if (selectedNode) {-->
<!--              await loadNodePolicies(selectedNode.id);-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Remove policy error:', error);-->
<!--          showToast("Failed to remove policies: " + error.message, "error");-->
<!--          closeRemovePolicyModal();-->
<!--      }-->
<!--  }-->

<!--  // ==================== OPERATIONS FUNCTIONS ====================-->
<!--  function initOperationCheckboxes() {-->
<!--      const checkboxes = document.querySelectorAll('.operation-checkbox');-->
<!--      checkboxes.forEach(cb => {-->
<!--          cb.addEventListener('change', function() {-->
<!--              const operation = this.getAttribute('data-operation');-->

<!--              if (operation === 'read') {-->
<!--                  handleReadCheckboxChange(this.checked);-->
<!--              } else {-->
<!--                  handleOperationChange(operation, this.checked);-->
<!--              }-->

<!--              updatePolicyButtons();-->
<!--          });-->
<!--      });-->
<!--  }-->

<!--  function handleReadCheckboxChange(isChecked) {-->
<!--      operations.read = isChecked;-->

<!--      document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);-->

<!--      if (isChecked) {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              operations[op] = false;-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.checked = false;-->
<!--              cb.disabled = true;-->
<!--              document.getElementById(`${op}-operation`).classList.add('disabled');-->
<!--          });-->
<!--      } else {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.disabled = false;-->
<!--              document.getElementById(`${op}-operation`).classList.remove('disabled');-->
<!--          });-->

<!--          if (selectedNode && selectedNode.type === 'file') {-->
<!--              document.getElementById('cb-create').disabled = true;-->
<!--              document.getElementById('create-operation').classList.add('disabled');-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  function handleOperationChange(operation, isChecked) {-->
<!--      operations[operation] = isChecked;-->
<!--  }-->

<!--  function clearOperations() {-->
<!--      Object.keys(operations).forEach(op => {-->
<!--          operations[op] = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-checkbox').forEach(cb => {-->
<!--          cb.checked = false;-->
<!--          cb.disabled = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-item').forEach(item => {-->
<!--          item.classList.remove('disabled');-->
<!--      });-->

<!--      document.getElementById('readBlockAllWarning').classList.remove('active');-->

<!--      if (selectedNode && selectedNode.type === 'file') {-->
<!--          document.getElementById('cb-create').disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      }-->
<!--  }-->

<!--  function updatePolicyButtons() {-->
<!--      const hasSelection = selectedNode !== null;-->
<!--      const hasAnyOperationChecked = Object.values(operations).some(v => v);-->
<!--      const nextBtn = document.getElementById('nextBtn');-->

<!--      if (currentStep === 3 && selectedPolicyType === 'FILE') {-->
<!--          nextBtn.disabled = !hasSelection || !hasAnyOperationChecked;-->
<!--      }-->
<!--  }-->

<!--  function validateStep3() {-->
<!--      if (selectedPolicyType === 'FILE') {-->
<!--          if (!selectedNode) {-->
<!--              showToast("Please select a file or folder", "warning");-->
<!--              return false;-->
<!--          }-->

<!--          const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--          if (!hasAnyOperation) {-->
<!--              showToast("Please select at least one operation to block", "warning");-->
<!--              return false;-->
<!--          }-->
<!--      } else if (selectedPolicyType === 'NETWORK') {-->
<!--          if (!selectedPolicy) {-->
<!--              showToast("Please select a policy", "warning");-->
<!--              return false;-->
<!--          }-->

<!--          if (selectedPolicy === "NETWORK_DNS_BLOCK" && blockedDomains.length === 0) {-->
<!--              showToast("Please add at least one domain to block", "warning");-->
<!--              return false;-->
<!--          }-->
<!--      }-->

<!--      return true;-->
<!--  }-->

<!--  // ==================== DOMAIN FUNCTIONS ====================-->
<!--  function addDomain() {-->
<!--      const domainInput = document.getElementById("domainInput");-->
<!--      let domain = domainInput.value.trim();-->

<!--      if (!domain) {-->
<!--          alert("Please enter a domain name");-->
<!--          return;-->
<!--      }-->

<!--      domain = domain.replace(/^https?:\/\//, "");-->
<!--      domain = domain.replace(/\/$/, "");-->

<!--      const domainLower = domain.toLowerCase();-->
<!--      const exists = blockedDomains.some(d => d.toLowerCase() === domainLower);-->

<!--      if (exists) {-->
<!--          alert("Domain already added");-->
<!--          return;-->
<!--      }-->
<!--      blockedDomains.push(domain);-->
<!--      domainInput.value = "";-->

<!--      renderDomainTags();-->
<!--  }-->

<!--  function renderDomainTags() {-->
<!--      const domainTags = document.getElementById("domainTags");-->
<!--      if (!domainTags) return;-->

<!--      domainTags.innerHTML = "";-->

<!--      blockedDomains.forEach((domain, index) => {-->
<!--          const tag = document.createElement("div");-->
<!--          tag.className = "domain-tag";-->
<!--          tag.innerHTML = `-->
<!--              <span>${domain}</span>-->
<!--              <i class="fas fa-times" onclick="removeDomain(${index})"></i>-->
<!--          `;-->
<!--          domainTags.appendChild(tag);-->
<!--      });-->
<!--  }-->

<!--  function removeDomain(index) {-->
<!--      blockedDomains.splice(index, 1);-->
<!--      renderDomainTags();-->
<!--  }-->

<!--  // ==================== STEP NAVIGATION ====================-->
<!--  function nextStep() {-->
<!--      if (currentStep === 1 && selectedAgents.size === 0) {-->
<!--          showToast("Please select at least one agent", "warning");-->
<!--          return;-->
<!--      }-->

<!--      if (currentStep === 2) {-->
<!--          const policyType = document.getElementById('policyType').value;-->
<!--          if (!policyType) {-->
<!--              showToast("Please select a policy type", "warning");-->
<!--              return;-->
<!--          }-->
<!--          selectedPolicyType = policyType;-->

<!--          // Reset UI based on policy type-->
<!--          document.getElementById('fileProtectionUI').style.display = 'none';-->
<!--          document.getElementById('networkUI').style.display = 'none';-->
<!--          document.getElementById('usbUI').style.display = 'none';-->
<!--          document.getElementById('ocrUI').style.display = 'none';-->

<!--          if (policyType === 'FILE') {-->
<!--              document.getElementById('fileProtectionUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Select files/folders and configure blocking operations';-->
<!--          } else if (policyType === 'NETWORK') {-->
<!--              document.getElementById('networkUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure network blocking rules';-->
<!--              updatePolicyTypes();-->
<!--          } else if (policyType === 'USB') {-->
<!--              document.getElementById('usbUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure USB device controls';-->
<!--          } else if (policyType === 'OCR') {-->
<!--              document.getElementById('ocrUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure OCR and content monitoring';-->
<!--          }-->
<!--      }-->

<!--      if (currentStep === 3) {-->
<!--          if (!validateStep3()) {-->
<!--              return;-->
<!--          }-->
<!--      }-->

<!--      currentStep++;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function previousStep() {-->
<!--      currentStep&#45;&#45;;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function cancelAssignment() {-->
<!--      if (confirm("Are you sure you want to cancel? All selections will be lost.")) {-->
<!--          window.location.href = 'file-policies.html';-->
<!--      }-->
<!--  }-->

<!--  function updateStepDisplay() {-->
<!--      document.getElementById("step1").style.display = "none";-->
<!--      document.getElementById("step2").style.display = "none";-->
<!--      document.getElementById("step3").style.display = "none";-->
<!--      document.getElementById("step4").style.display = "none";-->

<!--      document.getElementById(`step${currentStep}`).style.display = "block";-->

<!--      document.querySelectorAll(".step").forEach((step, index) => {-->
<!--          step.classList.remove("active", "completed");-->
<!--          if (index + 1 < currentStep) {-->
<!--              step.classList.add("completed");-->
<!--              step.querySelector(".step-circle").innerHTML = '<i class="fas fa-check"></i>';-->
<!--          } else if (index + 1 === currentStep) {-->
<!--              step.classList.add("active");-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          } else {-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          }-->
<!--      });-->

<!--      document.getElementById("prevBtn").style.display = currentStep > 1 ? "flex" : "none";-->
<!--      document.getElementById("nextBtn").style.display = currentStep < 4 ? "flex" : "none";-->
<!--      document.getElementById("applyBtn").style.display = currentStep === 4 ? "flex" : "none";-->

<!--      if (currentStep === 4) {-->
<!--          updateSummary();-->
<!--      }-->

<!--      if (currentStep === 3 && selectedPolicyType === 'FILE') {-->
<!--          updatePolicyButtons();-->
<!--      }-->
<!--  }-->

<!--  function updateSummary() {-->
<!--      const summaryBox = document.getElementById("summaryBox");-->

<!--      if (selectedPolicyType === 'FILE') {-->
<!--          const blockedOps = Object.entries(operations)-->
<!--              .filter(([op, checked]) => checked)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          const isBlockAll = operations.read;-->

<!--          summaryBox.innerHTML = `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Agents Selected</span>-->
<!--                  <span class="summary-value">${selectedAgents.size}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy Type</span>-->
<!--                  <span class="summary-value">File Protection</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Protected Path</span>-->
<!--                  <span class="summary-value">${selectedNode ? (selectedNode.full_path || selectedNode.id) : '-'}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Resource Type</span>-->
<!--                  <span class="summary-value">${selectedNode ? (selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File') : '-'}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Blocked Operations</span>-->
<!--                  <span class="summary-value">${blockedOps || 'None'}</span>-->
<!--              </div>-->
<!--              ${isBlockAll ? '<div class="summary-row"><span class="summary-label text-error">âš ï¸ Effect</span><span class="summary-value text-error">ALL ACCESS BLOCKED</span></div>' : ''}-->
<!--          `;-->

<!--          document.getElementById("step4Alert").innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The file protection policy will be applied to all selected agents within 5 minutes.</span>-->
<!--          `;-->

<!--      } else if (selectedPolicyType === 'NETWORK') {-->
<!--          summaryBox.innerHTML = `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Agents Selected</span>-->
<!--                  <span class="summary-value">${selectedAgents.size}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy Type</span>-->
<!--                  <span class="summary-value">Network Policy</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy</span>-->
<!--                  <span class="summary-value">${selectedPolicy || '-'}</span>-->
<!--              </div>-->
<!--              ${blockedDomains.length > 0 ? `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Blocked Domains</span>-->
<!--                  <span class="summary-value">${blockedDomains.length}</span>-->
<!--              </div>-->
<!--              ` : ''}-->
<!--          `;-->

<!--          document.getElementById("step4Alert").innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The network policy will be applied to all selected agents within 5 minutes.</span>-->
<!--          `;-->
<!--      }-->
<!--  }-->

<!--  // ==================== APPLY POLICY ====================-->
<!--  async function applyPolicy() {-->
<!--      if (selectedAgents.size === 0) {-->
<!--          showToast("No agents selected", "error");-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const agentIds = Array.from(selectedAgents);-->

<!--          if (selectedPolicyType === 'FILE') {-->
<!--              if (!selectedNode) {-->
<!--                  showToast("No file/folder selected", "error");-->
<!--                  return;-->
<!--              }-->

<!--              const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--              if (!hasAnyOperation) {-->
<!--                  showToast("Please select at least one operation to block", "warning");-->
<!--                  return;-->
<!--              }-->

<!--              const payload = {-->
<!--                  node_id: selectedNode.id,-->
<!--                  scope: selectedNode.type === 'folder' ? 'folder_recursive' : 'file',-->
<!--                  action: 'block',-->
<!--                  operations: { ...operations },-->
<!--                  created_by: 'admin',-->
<!--                  comment: 'Applied from File Protection UI',-->
<!--                  confirmed: true,-->
<!--                  agentIds: agentIds-->
<!--              };-->

<!--              showToast("Applying policy...", "info");-->

<!--              const response = await fetch(`/api/admin/policies/apply`, {-->
<!--                  method: 'POST',-->
<!--                  headers: { 'Content-Type': 'application/json' },-->
<!--                  credentials: "include",-->
<!--                  body: JSON.stringify(payload)-->
<!--              });-->

<!--              if (!response.ok) {-->
<!--                  const errorText = await response.text();-->
<!--                  throw new Error(errorText);-->
<!--              }-->

<!--              const result = await response.json();-->

<!--              const agentNames = agentIds-->
<!--                  .map(id => {-->
<!--                      const agent = agentsBasicData[id];-->
<!--                      return agent ? agent.hostname || agent.username : `Agent ${id}`;-->
<!--                  })-->
<!--                  .filter(name => name);-->

<!--              let message = `âœ… Policy applied successfully!\n\n`;-->
<!--              message += `Agents: ${agentNames.join(', ')}\n`;-->
<!--              message += `Path: ${selectedNode.full_path || selectedNode.id}\n`;-->
<!--              message += `Blocked Operations: ${Object.entries(operations).filter(([op, checked]) => checked).map(([op]) => op.toUpperCase()).join(', ')}`;-->

<!--              alert(message);-->

<!--              setTimeout(() => {-->
<!--                  window.location.href = 'file-policies.html';-->
<!--              }, 2000);-->

<!--          } else if (selectedPolicyType === 'NETWORK') {-->
<!--              if (!selectedPolicy) {-->
<!--                  showToast("No policy selected", "error");-->
<!--                  return;-->
<!--              }-->

<!--              const payload = {-->
<!--                  agentIds: agentIds,-->
<!--                  policyCode: selectedPolicy-->
<!--              };-->

<!--              if (selectedPolicy === "NETWORK_DNS_BLOCK" && blockedDomains.length > 0) {-->
<!--                  payload.policyData = JSON.stringify({-->
<!--                      domains: blockedDomains,-->
<!--                      ips: []-->
<!--                  });-->
<!--              }-->

<!--              const response = await fetch(`/api/admin/assign-protection`, {-->
<!--                  method: 'POST',-->
<!--                  headers: { 'Content-Type': 'application/json' },-->
<!--                  credentials: "include",-->
<!--                  body: JSON.stringify(payload)-->
<!--              });-->

<!--              if (!response.ok) throw new Error('Failed to apply policy');-->

<!--              const result = await response.json();-->

<!--              if (result.success) {-->
<!--                  alert(`âœ… Network policy applied successfully!`);-->
<!--                  setTimeout(() => {-->
<!--                      window.location.href = 'file-policies.html';-->
<!--                  }, 2000);-->
<!--              } else {-->
<!--                  throw new Error(result.message || 'Failed to apply policy');-->
<!--              }-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Apply policy error:', error);-->
<!--          showToast("Failed to apply policy: " + error.message, "error");-->
<!--      }-->
<!--  }-->

<!--  // ==================== UTILITY FUNCTIONS ====================-->
<!--  function showToast(message, type = 'success') {-->
<!--      const toast = document.createElement('div');-->
<!--      toast.className = `toast ${type}`;-->
<!--      toast.textContent = message;-->

<!--      document.body.appendChild(toast);-->
<!--      setTimeout(() => toast.remove(), 3000);-->
<!--  }-->

<!--  // ==================== EVENT LISTENERS ====================-->
<!--  document.addEventListener("input", function(e) {-->
<!--      if (e.target && e.target.id === "agentSearch") {-->
<!--          const searchTerm = e.target.value.toLowerCase();-->
<!--          const agentCards = document.querySelectorAll(".agent-card");-->

<!--          agentCards.forEach((card) => {-->
<!--              const text = card.textContent.toLowerCase();-->
<!--              card.style.display = text.includes(searchTerm) ? "block" : "none";-->
<!--          });-->
<!--      }-->
<!--  });-->

<!--  document.addEventListener("change", function(e) {-->
<!--      if (e.target && e.target.id === "policyType") {-->
<!--          selectedPolicyType = e.target.value;-->
<!--      }-->
<!--      if (e.target && e.target.id === "policySelect") {-->
<!--          selectedPolicy = e.target.value;-->
<!--      }-->
<!--  });-->

<!--  document.getElementById('removeConfirmInput')?.addEventListener('input', function() {-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--  });-->

<!--  // ==================== INITIALIZATION ====================-->
<!--  document.addEventListener("DOMContentLoaded", async function() {-->
<!--      loadAdminInfo();-->
<!--      setActiveMenuItem();-->

<!--      await Promise.all([-->
<!--          initializeAgentCards(),-->
<!--          fetchAgentSimpleDetails(),-->
<!--      ]);-->

<!--      initOperationCheckboxes();-->

<!--      // Set up file explorer event listeners-->
<!--      document.getElementById('btnGetDrives').addEventListener('click', getDrives);-->
<!--      document.getElementById('btnRefresh').addEventListener('click', refreshExplorer);-->
<!--      document.getElementById('btnClearSelection').addEventListener('click', clearSelection);-->
<!--  });-->

<!--  // Window resize handlers-->
<!--  window.addEventListener("resize", function() {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mainContent = document.getElementById("mainContent");-->
<!--      const header = document.getElementById("topHeader");-->
<!--      const windowWidth = window.innerWidth;-->

<!--      if (windowWidth <= 968) {-->
<!--          if (sidebar) sidebar.classList.remove("collapsed");-->
<!--          if (mainContent) mainContent.classList.remove("expanded");-->
<!--          if (header) header.style.left = "0";-->
<!--      } else {-->
<!--          if (sidebar && mainContent && header) {-->
<!--              if (sidebar.classList.contains("collapsed")) {-->
<!--                  mainContent.classList.add("expanded");-->
<!--                  header.style.left = "70px";-->
<!--              } else {-->
<!--                  mainContent.classList.remove("expanded");-->
<!--                  header.style.left = "240px";-->
<!--              }-->
<!--          }-->
<!--      }-->
<!--  });-->

<!--  // Click outside handlers for mobile-->
<!--  document.addEventListener("click", function(e) {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");-->

<!--      if (sidebar && window.innerWidth <= 968) {-->
<!--          if (-->
<!--              !sidebar.contains(e.target) &&-->
<!--              (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))-->
<!--          ) {-->
<!--              sidebar.classList.remove("mobile-open");-->
<!--              const overlay = document.getElementById("sidebarOverlay");-->
<!--              if (overlay) overlay.classList.remove("active");-->
<!--          }-->
<!--      }-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->






<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <title>DLP Shield - Assign Policy</title>-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />-->
<!--  <style>-->
<!--    /* ALL STYLES EXACTLY AS FIRST FILE - ONLY ADDED FILE EXPLORER STYLES AT THE END */-->
<!--    * {-->
<!--        margin: 0;-->
<!--        padding: 0;-->
<!--        box-sizing: border-box;-->
<!--    }-->

<!--    body {-->
<!--        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;-->
<!--        background: #f3f4f6;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .dashboard-container {-->
<!--        display: flex;-->
<!--        min-height: 100vh;-->
<!--        max-width: 100vw;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content {-->
<!--        flex: 1;-->
<!--        margin-left: 240px;-->
<!--        transition: margin-left 0.3s ease;-->
<!--        min-height: 100vh;-->
<!--        max-width: calc(100vw - 240px);-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content.expanded {-->
<!--        margin-left: 70px;-->
<!--        max-width: calc(100vw - 70px);-->
<!--    }-->

<!--    .content-area {-->
<!--        padding: 24px;-->
<!--        padding-top: 100px;-->
<!--        max-width: 1400px;-->
<!--        margin: 0 auto;-->
<!--    }-->

<!--    /* ================ SIDEBAR STYLES ================ */-->
<!--    .sidebar {-->
<!--        width: 240px;-->
<!--        background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);-->
<!--        color: white;-->
<!--        position: fixed;-->
<!--        height: 100vh;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: width 0.3s ease;-->
<!--        z-index: 1000;-->
<!--        left: 0;-->
<!--        top: 0;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar {-->
<!--        width: 4px;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar-thumb {-->
<!--        background: rgba(255, 255, 255, 0.3);-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .sidebar-header {-->
<!--        padding: 18px 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        border-bottom: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo {-->
<!--        width: 38px;-->
<!--        height: 38px;-->
<!--        background: white;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo i {-->
<!--        font-size: 20px;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .sidebar-title {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        white-space: nowrap;-->
<!--        transition: opacity 0.2s, width 0.3s;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .nav-menu {-->
<!--        padding: 12px 0;-->
<!--        overflow-y: auto;-->
<!--        overflow-x: hidden;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .nav-item {-->
<!--        margin: 2px 8px;-->
<!--    }-->

<!--    .nav-link {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        color: rgba(255, 255, 255, 0.8);-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        transition: all 0.2s;-->
<!--        font-size: 0.9em;-->
<!--        cursor: pointer;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .nav-link:hover {-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        color: white;-->
<!--    }-->

<!--    .nav-link.active,-->
<!--    .sub-menu-item.active {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .nav-link i:first-child {-->
<!--        width: 20px;-->
<!--        font-size: 0.95em;-->
<!--        margin-right: 10px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .chevron-icon {-->
<!--        margin-left: auto !important;-->
<!--        font-size: 0.7em !important;-->
<!--        transition: transform 0.3s;-->
<!--        width: auto !important;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .nav-link.expanded .chevron-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sub-menu {-->
<!--        max-height: 0;-->
<!--        overflow: hidden;-->
<!--        transition: max-height 0.3s ease;-->
<!--    }-->

<!--    .sub-menu.open {-->
<!--        max-height: 500px;-->
<!--    }-->

<!--    .sub-menu-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px 8px 42px;-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        text-decoration: none;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--        margin: 2px 0;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .sub-menu-item:hover {-->
<!--        color: white;-->
<!--        background: rgba(255, 255, 255, 0.08);-->
<!--    }-->

<!--    .sub-menu-item::before {-->
<!--        content: "â€¢";-->
<!--        margin-right: 10px;-->
<!--        font-size: 1.2em;-->
<!--    }-->

<!--    .sidebar-footer {-->
<!--        padding: 12px 16px;-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .collapse-btn {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        gap: 8px;-->
<!--        padding: 10px;-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        border: none;-->
<!--        color: white;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        width: 100%;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        white-space: nowrap;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .collapse-btn:hover {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--    }-->

<!--    .collapse-btn i {-->
<!--        transition: transform 0.3s;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar.collapsed {-->
<!--        width: 70px;-->
<!--    }-->

<!--    .sidebar.collapsed .sidebar-title {-->
<!--        opacity: 0;-->
<!--        width: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link span,-->
<!--    .sidebar.collapsed .collapse-btn span {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .sub-menu {-->
<!--        display: none !important;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link {-->
<!--        justify-content: center;-->
<!--        padding: 10px;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link i:first-child {-->
<!--        margin-right: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .chevron-icon {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn {-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn i {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sidebar-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 999;-->
<!--        opacity: 0;-->
<!--        transition: opacity 0.3s;-->
<!--    }-->

<!--    .sidebar-overlay.active {-->
<!--        display: block;-->
<!--        opacity: 1;-->
<!--    }-->

<!--    /* ================ HEADER STYLES ================ */-->
<!--    .top-header {-->
<!--        background: white;-->
<!--        padding: 14px 24px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: space-between;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 240px;-->
<!--        right: 0;-->
<!--        z-index: 500;-->
<!--        gap: 16px;-->
<!--        transition: left 0.3s ease;-->
<!--    }-->

<!--    .mobile-menu-toggle {-->
<!--        display: none;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.3em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: color 0.2s;-->
<!--    }-->

<!--    .mobile-menu-toggle:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .search-bar {-->
<!--        flex: 1;-->
<!--        max-width: 400px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .search-bar i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 9px 14px 9px 38px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: #f9fafb;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--        background: white;-->
<!--        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);-->
<!--    }-->

<!--    .header-actions {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .notification-btn {-->
<!--        position: relative;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.1em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--    }-->

<!--    .notification-btn:hover {-->
<!--        color: #111827;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .notification-btn.active {-->
<!--        color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .notification-badge {-->
<!--        position: absolute;-->
<!--        top: 4px;-->
<!--        right: 4px;-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--        font-size: 0.65em;-->
<!--        min-width: 18px;-->
<!--        height: 18px;-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        padding: 0 4px;-->
<!--    }-->

<!--    .user-profile {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        cursor: pointer;-->
<!--        padding: 6px 10px;-->
<!--        border-radius: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .user-profile:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .user-avatar {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .user-info {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--    }-->

<!--    .user-name {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .user-role {-->
<!--        font-size: 0.75em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .dropdown-icon {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.75em;-->
<!--        margin-left: 4px;-->
<!--        transition: transform 0.3s;-->
<!--    }-->

<!--    .user-profile.active .dropdown-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .user-dropdown {-->
<!--        position: absolute;-->
<!--        top: 100%;-->
<!--        right: 0;-->
<!--        margin-top: 8px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 10px 15px rgba(0, 0, 0, 0.1);-->
<!--        min-width: 200px;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transform: translateY(-10px);-->
<!--        transition: all 0.3s ease;-->
<!--        z-index: 1000;-->
<!--    }-->

<!--    .user-dropdown.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--        transform: translateY(0);-->
<!--    }-->

<!--    .dropdown-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        padding: 10px 14px;-->
<!--        color: #374151;-->
<!--        text-decoration: none;-->
<!--        font-size: 0.9em;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .dropdown-item:first-child {-->
<!--        border-radius: 8px 8px 0 0;-->
<!--    }-->

<!--    .dropdown-item:last-child {-->
<!--        border-radius: 0 0 8px 8px;-->
<!--    }-->

<!--    .dropdown-item:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .dropdown-item i {-->
<!--        width: 18px;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .dropdown-item.danger {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-item.danger i {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-divider {-->
<!--        height: 1px;-->
<!--        background: #e5e7eb;-->
<!--        margin: 4px 0;-->
<!--    }-->

<!--    /* ================ NOTIFICATIONS PANEL ================ */-->
<!--    .notifications-panel {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        right: -50%;-->
<!--        width: 50%;-->
<!--        max-width: 600px;-->
<!--        height: 100vh;-->
<!--        background: white;-->
<!--        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);-->
<!--        z-index: 1001;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--    }-->

<!--    .notifications-panel.show {-->
<!--        right: 0;-->
<!--    }-->

<!--    .notifications-header {-->
<!--        padding: 20px 24px;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notifications-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .close-notifications {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        padding: 6px;-->
<!--        border-radius: 6px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .close-notifications:hover {-->
<!--        background: #f3f4f6;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .notifications-tabs {-->
<!--        display: flex;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        padding: 0 24px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .tab-btn {-->
<!--        flex: 1;-->
<!--        padding: 12px;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 500;-->
<!--        cursor: pointer;-->
<!--        border-bottom: 2px solid transparent;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .tab-btn:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .tab-btn.active {-->
<!--        color: #2563eb;-->
<!--        border-bottom-color: #2563eb;-->
<!--    }-->

<!--    .notifications-content {-->
<!--        flex: 1;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px 0;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar {-->
<!--        width: 6px;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar-thumb {-->
<!--        background: #d1d5db;-->
<!--        border-radius: 3px;-->
<!--    }-->

<!--    .notification-item {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        padding: 14px 24px;-->
<!--        cursor: pointer;-->
<!--        transition: background 0.2s;-->
<!--        border-left: 3px solid transparent;-->
<!--    }-->

<!--    .notification-item:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .notification-item.unread {-->
<!--        background: #eff6ff;-->
<!--        border-left-color: #3b82f6;-->
<!--    }-->

<!--    .notification-item.unread:hover {-->
<!--        background: #dbeafe;-->
<!--    }-->

<!--    .notification-icon {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-size: 1.1em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notification-icon.critical {-->
<!--        background: #fee2e2;-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .notification-icon.warning {-->
<!--        background: #fef3c7;-->
<!--        color: #f59e0b;-->
<!--    }-->

<!--    .notification-icon.info {-->
<!--        background: #dbeafe;-->
<!--        color: #3b82f6;-->
<!--    }-->

<!--    .notification-icon.success {-->
<!--        background: #d1fae5;-->
<!--        color: #10b981;-->
<!--    }-->

<!--    .notification-body {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .notification-title {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .notification-text {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 6px;-->
<!--        line-height: 1.4;-->
<!--    }-->

<!--    .notification-time {-->
<!--        font-size: 0.75em;-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .notification-dot {-->
<!--        width: 8px;-->
<!--        height: 8px;-->
<!--        background: #3b82f6;-->
<!--        border-radius: 50%;-->
<!--        flex-shrink: 0;-->
<!--        margin-top: 8px;-->
<!--    }-->

<!--    .notification-item:not(.unread) .notification-dot {-->
<!--        display: none;-->
<!--    }-->

<!--    .notifications-footer {-->
<!--        padding: 16px 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .view-all-btn {-->
<!--        display: block;-->
<!--        width: 100%;-->
<!--        padding: 10px;-->
<!--        background: #f3f4f6;-->
<!--        color: #2563eb;-->
<!--        text-align: center;-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .view-all-btn:hover {-->
<!--        background: #e5e7eb;-->
<!--    }-->

<!--    .notification-overlay {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.4);-->
<!--        z-index: 1000;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .notification-overlay.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--    }-->

<!--    /* Assign Policy Page Styles */-->
<!--    .page-header {-->
<!--        background: white;-->
<!--        padding: 20px 24px;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        margin-bottom: 24px;-->
<!--    }-->

<!--    .page-title-section {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .page-icon {-->
<!--        width: 48px;-->
<!--        height: 48px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 12px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .page-icon i {-->
<!--        font-size: 22px;-->
<!--        color: white;-->
<!--    }-->

<!--    .page-title-text h1 {-->
<!--        font-size: 1.5em;-->
<!--        color: #111827;-->
<!--        font-weight: 700;-->
<!--    }-->

<!--    .page-subtitle {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        margin-top: 4px;-->
<!--    }-->

<!--    .breadcrumb {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        font-size: 0.85em;-->
<!--    }-->

<!--    .breadcrumb a {-->
<!--        color: #6b7280;-->
<!--        text-decoration: none;-->
<!--    }-->

<!--    .breadcrumb a:hover {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .breadcrumb span {-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .assign-container {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        padding: 28px;-->
<!--    }-->

<!--    .step-indicator {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        margin-bottom: 32px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .step-indicator::before {-->
<!--        content: "";-->
<!--        position: absolute;-->
<!--        top: 20px;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        height: 2px;-->
<!--        background: #e5e7eb;-->
<!--        z-index: 0;-->
<!--    }-->

<!--    .step {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        position: relative;-->
<!--        z-index: 1;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .step-circle {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 50%;-->
<!--        background: white;-->
<!--        border: 2px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        color: #9ca3af;-->
<!--        transition: all 0.3s;-->
<!--    }-->

<!--    .step.active .step-circle {-->
<!--        background: #2563eb;-->
<!--        border-color: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .step.completed .step-circle {-->
<!--        background: #10b981;-->
<!--        border-color: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .step-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    .step.active .step-label {-->
<!--        color: #2563eb;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .section {-->
<!--        margin-bottom: 28px;-->
<!--    }-->

<!--    .section-title {-->
<!--        font-size: 1.1em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .section-desc {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-group {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-label {-->
<!--        display: block;-->
<!--        font-size: 0.9em;-->
<!--        color: #374151;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .form-select {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .form-select:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .form-select:disabled {-->
<!--        background: #f9fafb;-->
<!--        cursor: not-allowed;-->
<!--        opacity: 0.6;-->
<!--    }-->

<!--    .search-box {-->
<!--        position: relative;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .search-box i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px 11px 42px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .agents-grid {-->
<!--        display: grid;-->
<!--        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));-->
<!--        gap: 12px;-->
<!--        max-height: 400px;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .agent-card {-->
<!--        background: white;-->
<!--        padding: 14px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        cursor: pointer;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .agent-card:hover {-->
<!--        border-color: #3b82f6;-->
<!--        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);-->
<!--    }-->

<!--    .agent-card.selected {-->
<!--        border-color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .agent-card-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .agent-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .agent-name {-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .agent-status {-->
<!--        font-size: 0.75em;-->
<!--        padding: 3px 8px;-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .status-online {-->
<!--        background: #d1fae5;-->
<!--        color: #059669;-->
<!--    }-->

<!--    .status-offline {-->
<!--        background: #f3f4f6;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .agent-info {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-top: 6px;-->
<!--    }-->

<!--    .selected-count {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        margin-bottom: 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--    }-->

<!--    .selected-count i {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .selected-count span {-->
<!--        font-size: 0.9em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    /* NEW: File Explorer Styles - ONLY ADDED FOR FILE PROTECTION */-->
<!--    .file-explorer-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        background: #f9fafb;-->
<!--        padding: 16px;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .explorer-header {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .explorer-btn {-->
<!--        padding: 8px 16px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 6px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .explorer-btn:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .explorer-btn:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .tree-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 6px;-->
<!--        padding: 12px;-->
<!--        height: 300px;-->
<!--        overflow-y: auto;-->
<!--        background: white;-->
<!--        font-family: monospace;-->
<!--        font-size: 13px;-->
<!--    }-->

<!--    .tree-node {-->
<!--        padding: 6px 8px;-->
<!--        margin: 2px 0;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .tree-node:hover {-->
<!--        background: #e8f0fe;-->
<!--    }-->

<!--    .tree-node.selected {-->
<!--        background: #d2e3fc;-->
<!--        border-left: 3px solid #2563eb;-->
<!--    }-->

<!--    .tree-node-icon {-->
<!--        width: 20px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .tree-node-name {-->
<!--        flex: 1;-->
<!--        overflow: hidden;-->
<!--        text-overflow: ellipsis;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .tree-node-expand {-->
<!--        font-size: 10px;-->
<!--        color: #6b7280;-->
<!--        cursor: pointer;-->
<!--        width: 16px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .selected-path-info {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .path-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .path-value {-->
<!--        font-family: monospace;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        word-break: break-all;-->
<!--    }-->

<!--    /* Active Policies Section */-->
<!--    .active-policies-section {-->
<!--        margin-top: 20px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .policies-list {-->
<!--        max-height: 200px;-->
<!--        overflow-y: auto;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 12px;-->
<!--        background: white;-->
<!--    }-->

<!--    .policy-item {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        margin: 6px 0;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 6px;-->
<!--        border-left: 4px solid #2563eb;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .policy-item.block-all {-->
<!--        border-left-color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    .policy-info {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .policy-name {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-details {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-top: 2px;-->
<!--    }-->

<!--    .policy-remove-btn {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #9ca3af;-->
<!--        cursor: pointer;-->
<!--        padding: 4px 8px;-->
<!--        border-radius: 4px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .policy-remove-btn:hover {-->
<!--        color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    /* Operations List */-->
<!--    .operations-list {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 12px;-->
<!--        margin: 20px 0;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .operation-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .operation-item.disabled {-->
<!--        opacity: 0.5;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .operation-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        margin-right: 12px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .operation-label {-->
<!--        flex: 1;-->
<!--        font-weight: 500;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .operation-desc {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        margin-left: 8px;-->
<!--    }-->

<!--    .read-block-all {-->
<!--        background: #fee2e2;-->
<!--        border: 1px solid #fecaca;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 6px;-->
<!--        margin-top: 12px;-->
<!--        display: none;-->
<!--        color: #991b1b;-->
<!--        font-weight: 500;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--    }-->

<!--    .read-block-all.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    /* Original Network/Domain Styles */-->
<!--    .domain-input-container {-->
<!--        margin-top: 16px;-->
<!--    }-->

<!--    .domain-input-group {-->
<!--        display: flex;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 12px;-->
<!--    }-->

<!--    .domain-input {-->
<!--        flex: 1;-->
<!--        padding: 10px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .domain-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .btn-add-domain {-->
<!--        padding: 10px 20px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .btn-add-domain:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .domain-tags {-->
<!--        display: flex;-->
<!--        flex-wrap: wrap;-->
<!--        gap: 8px;-->
<!--        margin-top: 12px;-->
<!--    }-->

<!--    .domain-tag {-->
<!--        background: #eff6ff;-->
<!--        color: #1e40af;-->
<!--        padding: 6px 12px;-->
<!--        border-radius: 6px;-->
<!--        font-size: 0.85em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .domain-tag i {-->
<!--        cursor: pointer;-->
<!--        color: #ef4444;-->
<!--    }-->

<!--    .domain-tag i:hover {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .summary-box {-->
<!--        background: #f9fafb;-->
<!--        padding: 20px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        padding: 10px 0;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row:last-child {-->
<!--        border-bottom: none;-->
<!--    }-->

<!--    .summary-label {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .summary-value {-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .policy-preview {-->
<!--        background: white;-->
<!--        padding: 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #3b82f6;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .policy-preview-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .policy-preview-icon {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: #eff6ff;-->
<!--        border-radius: 8px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .policy-preview-title {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-preview-desc {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .btn-group {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--        padding-top: 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .btn {-->
<!--        padding: 11px 24px;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        cursor: pointer;-->
<!--        border: none;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .btn-primary {-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-primary:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .btn-primary:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .btn-secondary {-->
<!--        background: white;-->
<!--        color: #374151;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--    }-->

<!--    .btn-secondary:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .btn-danger {-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-danger:hover {-->
<!--        background: #dc2626;-->
<!--    }-->

<!--    .btn-warning {-->
<!--        background: #f59e0b;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-warning:hover {-->
<!--        background: #d97706;-->
<!--    }-->

<!--    .alert {-->
<!--        padding: 14px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 12px;-->
<!--    }-->

<!--    .alert-info {-->
<!--        background: #eff6ff;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        color: #1e40af;-->
<!--    }-->

<!--    .alert-success {-->
<!--        background: #d1fae5;-->
<!--        border: 1px solid #a7f3d0;-->
<!--        color: #065f46;-->
<!--    }-->

<!--    .alert-warning {-->
<!--        background: #fff3cd;-->
<!--        border: 1px solid #ffeeba;-->
<!--        color: #856404;-->
<!--    }-->

<!--    .alert i {-->
<!--        font-size: 1.1em;-->
<!--    }-->

<!--    .loading {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #6b7280;-->
<!--        font-style: italic;-->
<!--    }-->

<!--    .error {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #ef4444;-->
<!--        background: #fee2e2;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #fca5a5;-->
<!--    }-->

<!--    /* Modal Styles */-->
<!--    .modal-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 2000;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .modal-overlay.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    .modal {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        padding: 24px;-->
<!--        max-width: 500px;-->
<!--        width: 90%;-->
<!--        max-height: 80vh;-->
<!--        overflow-y: auto;-->
<!--        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);-->
<!--        animation: modalSlideIn 0.3s ease;-->
<!--    }-->

<!--    .modal-header {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .modal-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .modal-close {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .modal-body {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .modal-footer {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--    }-->

<!--    @keyframes modalSlideIn {-->
<!--        from {-->
<!--            transform: translateY(-20px);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateY(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    .text-error {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .mt-20 {-->
<!--        margin-top: 20px;-->
<!--    }-->

<!--    /* Toast Notifications */-->
<!--    .toast {-->
<!--        position: fixed;-->
<!--        top: 20px;-->
<!--        right: 20px;-->
<!--        padding: 12px 20px;-->
<!--        border-radius: 8px;-->
<!--        color: white;-->
<!--        font-weight: 500;-->
<!--        z-index: 10000;-->
<!--        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);-->
<!--        animation: slideIn 0.3s ease;-->
<!--    }-->

<!--    .toast.success {-->
<!--        background: #10b981;-->
<!--    }-->

<!--    .toast.error {-->
<!--        background: #ef4444;-->
<!--    }-->

<!--    .toast.warning {-->
<!--        background: #f59e0b;-->
<!--    }-->

<!--    .toast.info {-->
<!--        background: #3b82f6;-->
<!--    }-->

<!--    @keyframes slideIn {-->
<!--        from {-->
<!--            transform: translateX(100%);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateX(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    /* Mobile responsive */-->
<!--    @media (max-width: 1200px) {-->
<!--        .main-content {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .main-content.expanded {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 70px;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 968px) {-->
<!--        .main-content {-->
<!--            margin-left: 0;-->
<!--            max-width: 100vw;-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 0;-->
<!--        }-->

<!--        .mobile-menu-toggle {-->
<!--            display: block;-->
<!--        }-->

<!--        .sidebar {-->
<!--            transform: translateX(-100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .sidebar.mobile-open {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        .agents-grid {-->
<!--            grid-template-columns: 1fr;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 768px) {-->
<!--        .content-area {-->
<!--            padding: 16px;-->
<!--            padding-top: 80px;-->
<!--        }-->

<!--        .notifications-panel {-->
<!--            width: 90%;-->
<!--            right: -90%;-->
<!--        }-->

<!--        .step-indicator {-->
<!--            flex-direction: column;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .step-indicator::before {-->
<!--            display: none;-->
<!--        }-->

<!--        .btn-group {-->
<!--            flex-direction: column;-->
<!--        }-->

<!--        .btn {-->
<!--            width: 100%;-->
<!--            justify-content: center;-->
<!--        }-->

<!--        .user-info {-->
<!--            display: none;-->
<!--        }-->

<!--        .explorer-header {-->
<!--            flex-direction: column;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 640px) {-->
<!--        .content-area {-->
<!--            padding: 12px;-->
<!--            padding-top: 70px;-->
<!--        }-->

<!--        .page-title-section {-->
<!--            flex-direction: column;-->
<!--            align-items: flex-start;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .page-icon {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--        }-->

<!--        .page-icon i {-->
<!--            font-size: 18px;-->
<!--        }-->

<!--        .page-title-text h1 {-->
<!--            font-size: 1.3em;-->
<!--        }-->

<!--        .assign-container {-->
<!--            padding: 16px;-->
<!--        }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="dashboard-container">-->
<!--  &lt;!&ndash; ==================== SIDEBAR ==================== &ndash;&gt;-->
<!--  <aside class="sidebar" id="sidebar">-->
<!--    <div class="sidebar-header">-->
<!--      <div class="sidebar-logo">-->
<!--        <i class="fas fa-shield-halved"></i>-->
<!--      </div>-->
<!--      <div class="sidebar-title">DLP Shield</div>-->
<!--    </div>-->

<!--    <nav class="nav-menu">-->
<!--      <div class="nav-item">-->
<!--        <a href="dashboard.html" class="nav-link" data-page="dashboard">-->
<!--          <i class="fas fa-th-large"></i>-->
<!--          <span>Dashboard</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="alerts.html" class="nav-link" data-page="alerts">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--          <span>Alerts &amp; Incidents</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-shield-alt"></i>-->
<!--          <span>Policies</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu open">-->
<!--          <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>-->
<!--          <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>-->
<!--          <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="agents.html" class="nav-link" data-page="agents">-->
<!--          <i class="fas fa-desktop"></i>-->
<!--          <span>Agents / Endpoints</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-eye"></i>-->
<!--          <span>OCR &amp; Image Analysis</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>-->
<!--          <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-file-lines"></i>-->
<!--          <span>Reports &amp; Logs</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>-->
<!--          <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>-->
<!--          <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>-->
<!--          <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-users"></i>-->
<!--          <span>Users &amp; Roles</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="users.html" class="sub-menu-item" data-page="users">Users</a>-->
<!--          <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>-->
<!--          <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-gear"></i>-->
<!--          <span>Settings</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="general.html" class="sub-menu-item" data-page="general">General</a>-->
<!--          <a href="security.html" class="sub-menu-item" data-page="security">Security</a>-->
<!--          <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>-->
<!--          <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </nav>-->

<!--    <div class="sidebar-footer">-->
<!--      <button class="collapse-btn" onclick="toggleSidebar()">-->
<!--        <i class="fas fa-chevron-left"></i>-->
<!--        <span>Collapse</span>-->
<!--      </button>-->
<!--    </div>-->
<!--  </aside>-->

<!--  &lt;!&ndash; Mobile Overlay (for sidebar) &ndash;&gt;-->
<!--  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>-->

<!--  &lt;!&ndash; ==================== HEADER ==================== &ndash;&gt;-->
<!--  <header class="top-header" id="topHeader">-->
<!--    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">-->
<!--      <i class="fas fa-bars"></i>-->
<!--    </button>-->

<!--    <div class="search-bar">-->
<!--      <i class="fas fa-search"></i>-->
<!--      <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />-->
<!--    </div>-->

<!--    <div class="header-actions">-->
<!--      <button class="notification-btn" onclick="toggleNotifications(event)">-->
<!--        <i class="fas fa-bell"></i>-->
<!--        <span class="notification-badge" id="alertBadge">5</span>-->
<!--      </button>-->

<!--      <div class="user-profile" onclick="toggleUserDropdown(event)">-->
<!--        <div class="user-avatar">A</div>-->
<!--        <div class="user-info">-->
<!--          <div class="user-name">Admin</div>-->
<!--          <div class="user-role">Security Admin</div>-->
<!--        </div>-->
<!--        <i class="fas fa-chevron-down dropdown-icon"></i>-->

<!--        <div class="user-dropdown" id="userDropdown">-->
<!--          <a href="general.html" class="dropdown-item">-->
<!--            <i class="fas fa-gear"></i>-->
<!--            <span>Settings</span>-->
<!--          </a>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-circle-question"></i>-->
<!--            <span>Help &amp; Support</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="index.html" class="dropdown-item danger" onclick="logout(event)">-->
<!--            <i class="fas fa-right-from-bracket"></i>-->
<!--            <span>Sign out</span>-->
<!--          </a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </header>-->

<!--  &lt;!&ndash; ==================== NOTIFICATIONS PANEL ==================== &ndash;&gt;-->
<!--  <div class="notifications-panel" id="notificationsPanel">-->
<!--    <div class="notifications-header">-->
<!--      <h3>Notifications</h3>-->
<!--      <button class="close-notifications" onclick="closeNotifications()">-->
<!--        <i class="fas fa-times"></i>-->
<!--      </button>-->
<!--    </div>-->

<!--    <div class="notifications-tabs">-->
<!--      <button class="tab-btn active" onclick="switchTab(event, 'all')">All (5)</button>-->
<!--      <button class="tab-btn" onclick="switchTab(event, 'unread')">Unread (3)</button>-->
<!--    </div>-->

<!--    <div class="notifications-content" id="notificationsContent">-->
<!--      &lt;!&ndash; Original notification items from first file &ndash;&gt;-->
<!--    </div>-->

<!--    <div class="notifications-footer">-->
<!--      <a href="alerts.html" class="view-all-btn">View All Notifications</a>-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Notification Overlay &ndash;&gt;-->
<!--  <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>-->

<!--  &lt;!&ndash; Remove Policy Modal (for File Protection only) &ndash;&gt;-->
<!--  <div class="modal-overlay" id="removePolicyModal">-->
<!--    <div class="modal">-->
<!--      <div class="modal-header">-->
<!--        <h3>Remove Policy</h3>-->
<!--        <button class="modal-close" onclick="closeRemovePolicyModal()">-->
<!--          <i class="fas fa-times"></i>-->
<!--        </button>-->
<!--      </div>-->
<!--      <div class="modal-body">-->
<!--        <p>Type <strong>REMOVE</strong> to confirm policy removal:</p>-->
<!--        <input type="text" id="removeConfirmInput" class="domain-input" style="width: 100%; margin: 10px 0;" placeholder="REMOVE">-->
<!--        <div id="removeModalDetails"></div>-->
<!--      </div>-->
<!--      <div class="modal-footer">-->
<!--        <button class="btn btn-secondary" onclick="closeRemovePolicyModal()">Cancel</button>-->
<!--        <button class="btn btn-danger" id="confirmRemoveBtn" onclick="removeSelectedPolicy()" disabled>Remove</button>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->

<!--  <main class="main-content" id="mainContent">-->
<!--    <div class="content-area">-->
<!--      <div class="breadcrumb">-->
<!--        <a href="dashboard.html"><i class="fas fa-home"></i></a>-->
<!--        <span>/</span>-->
<!--        <a href="file-policies.html">Policies</a>-->
<!--        <span>/</span>-->
<!--        <span>Assign Policy</span>-->
<!--      </div>-->

<!--      <div class="page-header">-->
<!--        <div class="page-title-section">-->
<!--          <div class="page-icon"><i class="fas fa-user-shield"></i></div>-->
<!--          <div class="page-title-text">-->
<!--            <h1>Assign Policy to Agents</h1>-->
<!--            <p class="page-subtitle">Select agents and assign protection policies</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="assign-container">-->
<!--        <div class="step-indicator">-->
<!--          <div class="step active" data-step="1">-->
<!--            <div class="step-circle">1</div>-->
<!--            <div class="step-label">Choose Agent</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="2">-->
<!--            <div class="step-circle">2</div>-->
<!--            <div class="step-label">Policy Type</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="3">-->
<!--            <div class="step-circle">3</div>-->
<!--            <div class="step-label">Configure Policy</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="4">-->
<!--            <div class="step-circle">4</div>-->
<!--            <div class="step-label">Review & Apply</div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 1: Choose Agent (EXACTLY AS FIRST FILE) &ndash;&gt;-->
<!--        <div id="step1">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 1: Choose Agent</div>-->
<!--            <div class="section-desc">Select the agents you want to assign a policy to</div>-->

<!--            <div class="search-box">-->
<!--              <i class="fas fa-search"></i>-->
<!--              <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..." id="agentSearch" />-->
<!--            </div>-->

<!--            <div class="selected-count" id="selectedCount">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>0 agents selected</span>-->
<!--            </div>-->

<!--            <div class="agents-grid" id="agentsGrid"></div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Select at least one agent to continue</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 2: Policy Type (EXACTLY AS FIRST FILE) &ndash;&gt;-->
<!--        <div id="step2" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 2: Select Policy Type</div>-->
<!--            <div class="section-desc">Choose the type of policy you want to assign</div>-->

<!--            <div class="form-group">-->
<!--              <label class="form-label">Policy Type</label>-->
<!--              <select class="form-select" id="policyType">-->
<!--                <option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>-->
<!--                <option value="network">Network Policy</option>-->
<!--                <option value="file">File Protection</option>-->
<!--                <option value="usb">USB</option>-->
<!--                <option value="ocr">OCR</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Different policy types provide different protection mechanisms</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 3: Configure Policy &ndash;&gt;-->
<!--        <div id="step3" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 3: Configure Policy</div>-->
<!--            <div class="section-desc" id="step3Description">Configure the specific settings for your selected policy type</div>-->

<!--            &lt;!&ndash; ===== FILE PROTECTION UI (NEW - ONLY FOR FILE) ===== &ndash;&gt;-->
<!--            <div id="fileProtectionUI" style="display: none;">-->
<!--              &lt;!&ndash; Selected Path Info &ndash;&gt;-->
<!--              <div class="selected-path-info" id="selectedPathInfo" style="display: none;">-->
<!--                <div class="path-label">Selected Path:</div>-->
<!--                <div class="path-value" id="selectedPathValue">-</div>-->
<!--              </div>-->

<!--              &lt;!&ndash; File Explorer &ndash;&gt;-->
<!--              <div class="file-explorer-container">-->
<!--                <div class="explorer-header">-->
<!--                  <button class="explorer-btn" id="btnGetDrives">-->
<!--                    <i class="fas fa-hdd"></i> Get Drives-->
<!--                  </button>-->
<!--                  <button class="explorer-btn" id="btnRefresh" disabled>-->
<!--                    <i class="fas fa-sync-alt"></i> Refresh-->
<!--                  </button>-->
<!--                  <div style="flex:1;"></div>-->
<!--                  <button class="explorer-btn" id="btnClearSelection">-->
<!--                    <i class="fas fa-times"></i> Clear-->
<!--                  </button>-->
<!--                </div>-->
<!--                <div class="tree-container" id="treeContainer">-->
<!--                  <div class="loading">Click "Get Drives" to load file system</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Active Policies for Selected Node &ndash;&gt;-->
<!--              <div class="active-policies-section" id="activePoliciesSection" style="display: none;">-->
<!--                <div class="section-title" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">-->
<!--                  <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                  <span>Active Policies on Selected Resource</span>-->
<!--                </div>-->
<!--                <div class="policies-list" id="selectedNodePolicies">-->
<!--                  <div class="loading">Loading policies...</div>-->
<!--                </div>-->
<!--                <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">-->
<!--                  <i class="fas fa-info-circle"></i>-->
<!--                  <span>No active policies on this resource</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Remove Policy Button &ndash;&gt;-->
<!--              <div id="removePolicyContainer" style="display: none; margin: 20px 0;">-->
<!--                <div class="alert alert-warning" style="display: flex; justify-content: space-between; align-items: center;">-->
<!--                  <div style="display: flex; align-items: center; gap: 10px;">-->
<!--                    <i class="fas fa-exclamation-triangle"></i>-->
<!--                    <span><strong>Active Policies Exist</strong> - This resource already has protection policies applied.</span>-->
<!--                  </div>-->
<!--                  <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">-->
<!--                    <i class="fas fa-trash-alt"></i> Remove All-->
<!--                  </button>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Operations Selection &ndash;&gt;-->
<!--              <div class="section-title mt-20">Block Operations</div>-->
<!--              <div class="operations-list">-->
<!--                <div class="operation-item" id="read-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">-->
<!--                  <div class="operation-label">READ</div>-->
<!--                  <div class="operation-desc">Open, view, read content</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="write-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">-->
<!--                  <div class="operation-label">WRITE</div>-->
<!--                  <div class="operation-desc">Modify, edit, save changes</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="delete-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">-->
<!--                  <div class="operation-label">DELETE</div>-->
<!--                  <div class="operation-desc">Remove, trash, permanently delete</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="rename-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">-->
<!--                  <div class="operation-label">RENAME</div>-->
<!--                  <div class="operation-desc">Change name, move within volume</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="create-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">-->
<!--                  <div class="operation-label">CREATE</div>-->
<!--                  <div class="operation-desc">New file/folder creation (folders only)</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div class="read-block-all" id="readBlockAllWarning">-->
<!--                <i class="fas fa-exclamation-triangle"></i>-->
<!--                <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== ORIGINAL NETWORK POLICY UI (EXACTLY AS FIRST FILE) ===== &ndash;&gt;-->
<!--            <div id="networkUI" style="display: none;">-->
<!--              <div class="form-group">-->
<!--                <label class="form-label">Available Policies</label>-->
<!--                <select class="form-select" id="policySelect" disabled>-->
<!--                  <option value="">&#45;&#45; Select a policy type first &#45;&#45;</option>-->
<!--                </select>-->
<!--              </div>-->

<!--              <div id="dnsInputContainer" style="display: none;">-->
<!--                <div class="domain-input-container">-->
<!--                  <label class="form-label">Block Domains</label>-->
<!--                  <div class="domain-input-group">-->
<!--                    <input type="text" class="domain-input" id="domainInput" placeholder="Enter domain (e.g., www.example.com)" />-->
<!--                    <button class="btn-add-domain" onclick="addDomain()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="domainTags"></div>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div id="fileProtectionInfo" style="display: none;">-->
<!--                <div class="alert alert-info">-->
<!--                  <i class="fas fa-shield-alt"></i>-->
<!--                  <span>File Protection policy will block unauthorized file transfers</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div id="ocrInfo" style="display: none;">-->
<!--                <div class="alert alert-info">-->
<!--                  <i class="fas fa-eye"></i>-->
<!--                  <span>OCR policy will scan and analyze text in images and documents</span>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== ORIGINAL USB UI (EXACTLY AS FIRST FILE) ===== &ndash;&gt;-->
<!--            <div id="usbUI" style="display: none;">-->
<!--              <div class="alert alert-info">-->
<!--                <i class="fas fa-info-circle"></i>-->
<!--                <span>USB policy configuration from first file</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; ===== ORIGINAL OCR UI (EXACTLY AS FIRST FILE) ===== &ndash;&gt;-->
<!--            <div id="ocrUI" style="display: none;">-->
<!--              <div class="alert alert-info">-->
<!--                <i class="fas fa-eye"></i>-->
<!--                <span>OCR policy configuration from first file</span>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 4: Review & Apply (Dynamic based on policy type) &ndash;&gt;-->
<!--        <div id="step4" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 4: Review & Apply</div>-->
<!--            <div class="section-desc">Verify the policy assignment before applying</div>-->

<!--            <div class="summary-box" id="summaryBox">-->
<!--              &lt;!&ndash; Summary content will be dynamically updated &ndash;&gt;-->
<!--            </div>-->

<!--            <div class="alert alert-success" style="margin-top: 20px" id="step4Alert">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The policy will be applied to all selected agents within 5 minutes.</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div class="btn-group">-->
<!--          <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">-->
<!--            <i class="fas fa-arrow-left"></i><span>Previous</span>-->
<!--          </button>-->
<!--          <button class="btn btn-secondary" onclick="cancelAssignment()">-->
<!--            <i class="fas fa-times"></i><span>Cancel</span>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">-->
<!--            <span>Next</span><i class="fas fa-arrow-right"></i>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">-->
<!--            <i class="fas fa-check"></i><span>Apply Policy</span>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </main>-->
<!--</div>-->

<!--<script>-->
<!--  // ==================== ALL ORIGINAL VARIABLES FROM FIRST FILE ====================-->
<!--  let selectedAgents = new Set();-->
<!--  let agentsBasicData = {};-->
<!--  let agentsCapabilities = {};-->
<!--  let currentStep = 1;-->
<!--  let selectedPolicyType = "";-->
<!--  let selectedPolicy = "";-->
<!--  let blockedDomains = [];-->
<!--  let isEditingExistingPolicy = false;-->
<!--  let statusRefreshInterval;-->

<!--  // NEW: File Explorer State (only for FILE protection)-->
<!--  let treeData = {};-->
<!--  let selectedNode = null;-->
<!--  let operations = {-->
<!--      read: false,-->
<!--      write: false,-->
<!--      delete: false,-->
<!--      rename: false,-->
<!--      create: false-->
<!--  };-->
<!--  let activeNodePolicies = [];-->
<!--  let policyToRemove = null;-->
<!--  let currentlyExpanding = new Set();-->

<!--  // ==================== ORIGINAL AUTH FUNCTIONS FROM FIRST FILE ====================-->
<!--  async function checkAuth() {-->
<!--      try {-->
<!--          const response = await fetch("/api/auth/check", {-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error("Not authenticated");-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (!result.success) {-->
<!--              window.location.href = "index.html";-->
<!--              return null;-->
<!--          }-->

<!--          if (result.data) {-->
<!--              localStorage.setItem("userData", JSON.stringify(result.data));-->
<!--              return result.data;-->
<!--          }-->

<!--          return null;-->
<!--      } catch (err) {-->
<!--          window.location.href = "index.html";-->
<!--          return null;-->
<!--      }-->
<!--  }-->

<!--  function loadAdminInfo() {-->
<!--      const userDataStr = localStorage.getItem("userData");-->

<!--      if (userDataStr) {-->
<!--          try {-->
<!--              const userData = JSON.parse(userDataStr);-->

<!--              const userName = document.querySelector(".user-name");-->
<!--              const userAvatar = document.querySelector(".user-avatar");-->
<!--              const userRole = document.querySelector(".user-role");-->

<!--              if (userName) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const formattedName = namePart-->
<!--                      .split(".")-->
<!--                      .map(n => n.charAt(0).toUpperCase() + n.slice(1))-->
<!--                      .join(" ");-->
<!--                  userName.textContent = formattedName;-->
<!--              }-->

<!--              if (userAvatar) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const initials = namePart-->
<!--                      .split(".")-->
<!--                      .map(n => (n[0] ? n[0].toUpperCase() : ""))-->
<!--                      .join("");-->
<!--                  userAvatar.textContent = initials || "A";-->
<!--              }-->

<!--              if (userRole) {-->
<!--                  userRole.textContent = userData.role || "Security Admin";-->
<!--              }-->
<!--          } catch (e) {-->
<!--              console.error("Error parsing user data:", e);-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  // ==================== ORIGINAL SIDEBAR FUNCTIONS ====================-->
<!--  function toggleSubMenu(element) {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      if (sidebar.classList.contains("collapsed")) return;-->

<!--      var subMenu = element.nextElementSibling;-->
<!--      var allSubMenus = document.querySelectorAll(".sub-menu");-->
<!--      var allDropdowns = document.querySelectorAll(".nav-dropdown");-->

<!--      allSubMenus.forEach(function(menu) {-->
<!--          if (menu !== subMenu) menu.classList.remove("open");-->
<!--      });-->
<!--      allDropdowns.forEach(function(link) {-->
<!--          if (link !== element) link.classList.remove("expanded");-->
<!--      });-->

<!--      element.classList.toggle("expanded");-->
<!--      subMenu.classList.toggle("open");-->
<!--  }-->

<!--  function toggleSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var mainContent = document.getElementById("mainContent");-->
<!--      var header = document.getElementById("topHeader");-->

<!--      sidebar.classList.toggle("collapsed");-->
<!--      var isCollapsed = sidebar.classList.contains("collapsed");-->

<!--      if (mainContent) mainContent.classList.toggle("expanded");-->

<!--      if (header) {-->
<!--          header.style.left = isCollapsed ? "70px" : "240px";-->
<!--      }-->

<!--      if (isCollapsed) {-->
<!--          document.querySelectorAll(".sub-menu").forEach(function(m) {-->
<!--              m.classList.remove("open");-->
<!--          });-->
<!--          document.querySelectorAll(".nav-dropdown").forEach(function(l) {-->
<!--              l.classList.remove("expanded");-->
<!--          });-->
<!--      }-->
<!--  }-->

<!--  function openMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.add("mobile-open");-->
<!--      if (overlay) overlay.classList.add("active");-->
<!--  }-->

<!--  function closeMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.remove("mobile-open");-->
<!--      if (overlay) overlay.classList.remove("active");-->
<!--  }-->

<!--  function toggleMobileMenu() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (!sidebar) return;-->

<!--      if (sidebar.classList.contains("mobile-open")) {-->
<!--          closeMobileSidebar();-->
<!--      } else {-->
<!--          openMobileSidebar();-->
<!--      }-->
<!--  }-->

<!--  function setActiveMenuItem() {-->
<!--      var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';-->

<!--      document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {-->
<!--          el.classList.remove('active');-->
<!--      });-->

<!--      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function(item) {-->
<!--          var href = item.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              item.classList.add('active');-->
<!--              var parentSubMenu = item.closest('.sub-menu');-->
<!--              if (parentSubMenu) {-->
<!--                  parentSubMenu.classList.add('open');-->
<!--                  var parentNav = parentSubMenu.previousElementSibling;-->
<!--                  if (parentNav) parentNav.classList.add('expanded');-->
<!--              }-->
<!--          }-->
<!--      });-->

<!--      document.querySelectorAll('.nav-link[data-page]').forEach(function(link) {-->
<!--          var href = link.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              link.classList.add('active');-->
<!--          }-->
<!--      });-->
<!--  }-->

<!--  // ==================== ORIGINAL HEADER FUNCTIONS ====================-->
<!--  function toggleNotifications(event) {-->
<!--      event.stopPropagation();-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = event.currentTarget;-->
<!--      if (!panel || !overlay) return;-->

<!--      if (panel.classList.contains("show")) {-->
<!--          closeNotifications();-->
<!--      } else {-->
<!--          closeUserDropdown();-->
<!--          panel.classList.add("show");-->
<!--          overlay.classList.add("show");-->
<!--          btn.classList.add("active");-->
<!--          document.body.style.overflow = "hidden";-->
<!--      }-->
<!--  }-->

<!--  function closeNotifications() {-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = document.querySelector(".notification-btn");-->
<!--      if (panel) panel.classList.remove("show");-->
<!--      if (overlay) overlay.classList.remove("show");-->
<!--      if (btn) btn.classList.remove("active");-->
<!--      document.body.style.overflow = "";-->
<!--  }-->

<!--  function switchTab(event, tabName) {-->
<!--      document.querySelectorAll(".tab-btn").forEach(function(t) {-->
<!--          t.classList.remove("active");-->
<!--      });-->
<!--      event.currentTarget.classList.add("active");-->

<!--      document.querySelectorAll(".notification-item").forEach(function(item) {-->
<!--          item.style.display =-->
<!--              tabName === "unread" && !item.classList.contains("unread") ? "none" : "flex";-->
<!--      });-->
<!--  }-->

<!--  function toggleUserDropdown(event) {-->
<!--      event.stopPropagation();-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = event.currentTarget;-->
<!--      if (!dropdown) return;-->

<!--      if (dropdown.classList.contains("show")) {-->
<!--          closeUserDropdown();-->
<!--      } else {-->
<!--          closeNotifications();-->
<!--          dropdown.classList.add("show");-->
<!--          userProfile.classList.add("active");-->
<!--      }-->
<!--  }-->

<!--  function closeUserDropdown() {-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = document.querySelector(".user-profile");-->
<!--      if (dropdown) dropdown.classList.remove("show");-->
<!--      if (userProfile) userProfile.classList.remove("active");-->
<!--  }-->

<!--  function logout(event) {-->
<!--      event.preventDefault();-->
<!--      window.location.href = "/logout";-->
<!--  }-->

<!--  document.addEventListener("click", function(event) {-->
<!--      if (!event.target.closest(".user-profile")) {-->
<!--          closeUserDropdown();-->
<!--      }-->
<!--      if (-->
<!--          !event.target.closest(".notification-btn") &&-->
<!--          !event.target.closest(".notifications-panel")-->
<!--      ) {-->
<!--          closeNotifications();-->
<!--      }-->
<!--  });-->

<!--  // ==================== ORIGINAL AGENT FUNCTIONS FROM FIRST FILE ====================-->
<!--  function startStatusRefresh() {-->
<!--      if (statusRefreshInterval) {-->
<!--          clearInterval(statusRefreshInterval);-->
<!--      }-->
<!--      statusRefreshInterval = setInterval(async () => {-->
<!--          console.log("Refreshing agent status...");-->
<!--          await refreshAllAgents();-->
<!--      }, 10000);-->
<!--  }-->

<!--  async function refreshAllAgents() {-->
<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->

<!--          if (result.success && result.data) {-->
<!--              const agents = result.data;-->
<!--              agents.forEach((agent) => {-->
<!--                  agentsBasicData[agent.id] = agent;-->
<!--              });-->
<!--              await initializeAgentCards();-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error("Error refreshing agents:", error);-->
<!--      }-->
<!--  }-->

<!--  async function initializeAgentCards() {-->
<!--      const agentsGrid = document.getElementById("agentsGrid");-->
<!--      if (!agentsGrid) return;-->

<!--      agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';-->

<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->

<!--          if (!result.success || !result.data) {-->
<!--              throw new Error(result.message || "No agents found");-->
<!--          }-->

<!--          const agents = result.data;-->
<!--          agentsGrid.innerHTML = "";-->

<!--          agents.forEach((agent) => {-->
<!--              const agentCard = document.createElement("div");-->
<!--              agentCard.className = "agent-card";-->
<!--              agentCard.dataset.id = agent.id;-->
<!--              agentCard.onclick = () => toggleAgent(agent.id);-->

<!--              agentCard.innerHTML = `-->
<!--                  <div class="agent-card-header">-->
<!--                      <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""}>-->
<!--                      <div class="agent-name">${agent.username}</div>-->
<!--                      <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"}">-->
<!--                          ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}-->
<!--                      </span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fas fa-user"></i> ${agent.hostname || agent.username}</span>-->
<!--                      <span><i class="fas fa-id-badge"></i> ${agent.id}</span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fab fa-${getOSIcon(agent.osType)}"></i> ${agent.osType || "Unknown OS"}</span>-->
<!--                      <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"}</span>-->
<!--                  </div>-->
<!--              `;-->

<!--              agentsGrid.appendChild(agentCard);-->

<!--              if (selectedAgents.has(agent.id)) {-->
<!--                  agentCard.classList.add("selected");-->
<!--                  agentCard.querySelector(".agent-checkbox").checked = true;-->
<!--              }-->
<!--          });-->
<!--      } catch (error) {-->
<!--          console.error("Error loading agents:", error);-->
<!--          agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;-->
<!--      }-->

<!--      updateSelectedCount();-->
<!--  }-->

<!--  function isAgentOnline(agent) {-->
<!--      if (agent.agentRuntimeState && agent.agentRuntimeState.toUpperCase() === "ONLINE") return true;-->

<!--      if (agent.lastHeartbeat) {-->
<!--          const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();-->
<!--          const now = new Date();-->
<!--          const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);-->
<!--          return diffMinutes <= 10;-->
<!--      }-->

<!--      return false;-->
<!--  }-->

<!--  function getOSIcon(os) {-->
<!--      if (!os) return "desktop";-->

<!--      const osLower = os.toLowerCase();-->
<!--      if (osLower.includes("windows")) return "windows";-->
<!--      if (osLower.includes("macos") || osLower.includes("mac")) return "apple";-->
<!--      if (osLower.includes("ubuntu") || osLower.includes("linux")) return "linux";-->
<!--      return "desktop";-->
<!--  }-->

<!--  async function toggleAgent(agentId) {-->
<!--      if (selectedAgents.has(agentId)) {-->
<!--          selectedAgents.delete(agentId);-->
<!--          delete agentsCapabilities[agentId];-->
<!--      } else {-->
<!--          selectedAgents.add(agentId);-->
<!--          if (!agentsCapabilities[agentId]) {-->
<!--              try {-->
<!--                  await fetchAgentDetails(agentId);-->
<!--              } catch (error) {-->
<!--                  console.error(`Failed to fetch capabilities for agent ${agentId}:`, error);-->
<!--                  agentsCapabilities[agentId] = {};-->
<!--              }-->
<!--          }-->
<!--      }-->

<!--      const agentCard = document.querySelector(`.agent-card[data-id="${agentId}"]`);-->
<!--      if (agentCard) {-->
<!--          agentCard.classList.toggle("selected");-->
<!--          const checkbox = agentCard.querySelector(".agent-checkbox");-->
<!--          if (checkbox) {-->
<!--              checkbox.checked = selectedAgents.has(agentId);-->
<!--          }-->
<!--      }-->

<!--      updateSelectedCount();-->

<!--      if (selectedAgents.size > 0) {-->
<!--          updatePolicyTypes();-->
<!--      }-->
<!--  }-->

<!--  async function fetchAgentDetails(agentId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/agents/${agentId}/capabilities`, {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error(`HTTP ${response.status}: Failed to fetch capabilities`);-->

<!--          const result = await response.json();-->

<!--          if (result.success && result.data) {-->
<!--              agentsCapabilities[agentId] = result.data;-->
<!--          } else {-->
<!--              throw new Error(result.message || "Failed to load capabilities");-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error(`Error fetching capabilities for agent ${agentId}:`, error);-->
<!--          agentsCapabilities[agentId] = {};-->
<!--          throw error;-->
<!--      }-->
<!--  }-->

<!--  async function fetchAgentSimpleDetails() {-->
<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->
<!--          if (result.success && result.data) {-->
<!--              result.data.forEach((agent) => {-->
<!--                  agentsBasicData[agent.id] = agent;-->
<!--              });-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error("Error fetching agents:", error);-->
<!--      }-->
<!--  }-->

<!--  async function updatePolicyTypes() {-->
<!--      if (selectedAgents.size === 0) {-->
<!--          const policyTypeSelect = document.getElementById("policyType");-->
<!--          policyTypeSelect.innerHTML = '<option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>';-->
<!--          selectedPolicyType = "";-->
<!--          updatePolicySelect();-->
<!--          return;-->
<!--      }-->

<!--      let commonCategories = null;-->

<!--      for (const agentId of selectedAgents) {-->
<!--          const capabilities = agentsCapabilities[agentId];-->

<!--          if (capabilities && Object.keys(capabilities).length > 0) {-->
<!--              const agentCategories = Object.keys(capabilities);-->

<!--              if (commonCategories === null) {-->
<!--                  commonCategories = new Set(agentCategories);-->
<!--              } else {-->
<!--                  commonCategories = new Set(-->
<!--                      [...commonCategories].filter(cat => agentCategories.includes(cat))-->
<!--                  );-->
<!--              }-->
<!--          } else {-->
<!--              commonCategories = new Set();-->
<!--              break;-->
<!--          }-->
<!--      }-->

<!--      const policyTypeSelect = document.getElementById("policyType");-->
<!--      const currentValue = policyTypeSelect.value;-->

<!--      policyTypeSelect.innerHTML = '<option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>';-->

<!--      if (commonCategories && commonCategories.size > 0) {-->
<!--          const sortedCategories = Array.from(commonCategories).sort();-->

<!--          sortedCategories.forEach((category) => {-->
<!--              const option = document.createElement("option");-->
<!--              option.value = category.toLowerCase();-->
<!--              option.textContent = category;-->
<!--              policyTypeSelect.appendChild(option);-->
<!--          });-->

<!--          if (currentValue && commonCategories.has(currentValue.toUpperCase())) {-->
<!--              policyTypeSelect.value = currentValue;-->
<!--              selectedPolicyType = currentValue;-->
<!--          } else {-->
<!--              selectedPolicyType = "";-->
<!--          }-->
<!--      } else {-->
<!--          selectedPolicyType = "";-->
<!--      }-->

<!--      updatePolicySelect();-->
<!--  }-->

<!--  function updatePolicySelect() {-->
<!--      const policySelect = document.getElementById("policySelect");-->
<!--      if (!policySelect) return;-->

<!--      policySelect.innerHTML = '<option value="">&#45;&#45; Select Policy &#45;&#45;</option>';-->

<!--      if (selectedPolicyType && selectedAgents.size > 0) {-->
<!--          let commonPolicies = null;-->
<!--          let policyStatusMap = new Map();-->

<!--          for (const agentId of selectedAgents) {-->
<!--              const capabilities = agentsCapabilities[agentId];-->

<!--              if (capabilities && capabilities[selectedPolicyType.toUpperCase()]) {-->
<!--                  const agentPolicies = capabilities[selectedPolicyType.toUpperCase()];-->

<!--                  if (!Array.isArray(agentPolicies)) {-->
<!--                      commonPolicies = new Map();-->
<!--                      break;-->
<!--                  }-->

<!--                  if (commonPolicies === null) {-->
<!--                      commonPolicies = new Map();-->
<!--                      agentPolicies.forEach((policy) => {-->
<!--                          if (policy && policy.code) {-->
<!--                              commonPolicies.set(policy.code, policy);-->
<!--                              policyStatusMap.set(policy.code, {-->
<!--                                  [agentId]: policy.isActive || false,-->
<!--                              });-->
<!--                          }-->
<!--                      });-->
<!--                  } else {-->
<!--                      const agentPolicyCodes = new Set(agentPolicies.map(p => p?.code).filter(code => code));-->

<!--                      agentPolicies.forEach((policy) => {-->
<!--                          if (policy && policy.code && policyStatusMap.has(policy.code)) {-->
<!--                              policyStatusMap.get(policy.code)[agentId] = policy.isActive || false;-->
<!--                          }-->
<!--                      });-->

<!--                      commonPolicies = new Map(-->
<!--                          [...commonPolicies].filter(([code]) => agentPolicyCodes.has(code))-->
<!--                      );-->
<!--                  }-->
<!--              } else {-->
<!--                  commonPolicies = new Map();-->
<!--                  break;-->
<!--              }-->
<!--          }-->

<!--          if (commonPolicies && commonPolicies.size > 0) {-->
<!--              policySelect.disabled = false;-->

<!--              const sortedPolicies = Array.from(commonPolicies.values())-->
<!--                  .filter(policy => policy && policy.name)-->
<!--                  .sort((a, b) => a.name.localeCompare(b.name));-->

<!--              sortedPolicies.forEach((policy) => {-->
<!--                  const option = document.createElement("option");-->
<!--                  option.value = policy.code;-->

<!--                  const statusInfo = policyStatusMap.get(policy.code);-->
<!--                  let appliedCount = 0;-->
<!--                  if (statusInfo) {-->
<!--                      appliedCount = Object.values(statusInfo).filter(isActive => isActive).length;-->
<!--                  }-->

<!--                  let statusText = "";-->
<!--                  if (appliedCount === selectedAgents.size) {-->
<!--                      statusText = " (Applied to all)";-->
<!--                  } else if (appliedCount > 0) {-->
<!--                      statusText = ` (Applied to ${appliedCount}/${selectedAgents.size})`;-->
<!--                  }-->

<!--                  option.textContent = policy.name + statusText;-->
<!--                  option.title = policy.description || "";-->
<!--                  option.dataset.isApplied = appliedCount === selectedAgents.size;-->

<!--                  policySelect.appendChild(option);-->
<!--              });-->

<!--              if (sortedPolicies.length > 0) {-->
<!--                  policySelect.value = sortedPolicies[0].code;-->
<!--                  selectedPolicy = sortedPolicies[0].code;-->
<!--              }-->
<!--          } else {-->
<!--              policySelect.disabled = true;-->
<!--              policySelect.innerHTML = '<option value="">No common policies available</option>';-->
<!--              selectedPolicy = "";-->
<!--          }-->
<!--      } else {-->
<!--          policySelect.disabled = true;-->
<!--          policySelect.innerHTML = '<option value="">&#45;&#45; Select a policy type first &#45;&#45;</option>';-->
<!--          selectedPolicy = "";-->
<!--      }-->

<!--      updatePolicyOptions();-->
<!--  }-->

<!--  function updatePolicyOptions() {-->
<!--      const dnsContainer = document.getElementById("dnsInputContainer");-->
<!--      const fileInfo = document.getElementById("fileProtectionInfo");-->
<!--      const ocrInfo = document.getElementById("ocrInfo");-->

<!--      if (dnsContainer) dnsContainer.style.display = "none";-->
<!--      if (fileInfo) fileInfo.style.display = "none";-->
<!--      if (ocrInfo) ocrInfo.style.display = "none";-->

<!--      if (!selectedPolicy || !selectedPolicyType) return;-->

<!--      if (selectedPolicy === "NETWORK_DNS_BLOCK") {-->
<!--          if (dnsContainer) dnsContainer.style.display = "block";-->
<!--      } else if (selectedPolicyType.toUpperCase() === "FILE") {-->
<!--          if (fileInfo) fileInfo.style.display = "block";-->
<!--      } else if (selectedPolicyType.toUpperCase() === "SECURITY_MONITOR") {-->
<!--          if (ocrInfo) ocrInfo.style.display = "block";-->
<!--      }-->
<!--  }-->

<!--  function updateSelectedCount() {-->
<!--      const count = selectedAgents.size;-->
<!--      const selectedCountElement = document.getElementById("selectedCount");-->
<!--      if (selectedCountElement) {-->
<!--          selectedCountElement.innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>${count} agent${count !== 1 ? "s" : ""} selected</span>-->
<!--          `;-->
<!--      }-->
<!--  }-->

<!--  document.addEventListener("input", function(e) {-->
<!--      if (e.target && e.target.id === "agentSearch") {-->
<!--          const searchTerm = e.target.value.toLowerCase();-->
<!--          const agentCards = document.querySelectorAll(".agent-card");-->

<!--          agentCards.forEach((card) => {-->
<!--              const text = card.textContent.toLowerCase();-->
<!--              card.style.display = text.includes(searchTerm) ? "block" : "none";-->
<!--          });-->
<!--      }-->
<!--  });-->

<!--  document.addEventListener("change", function(e) {-->
<!--      if (e.target && e.target.id === "policyType") {-->
<!--          selectedPolicyType = e.target.value;-->
<!--          updatePolicySelect();-->
<!--      }-->
<!--      if (e.target && e.target.id === "policySelect") {-->
<!--          selectedPolicy = e.target.value;-->
<!--          updatePolicyOptions();-->
<!--      }-->
<!--  });-->

<!--  // ==================== NEW FILE EXPLORER FUNCTIONS (ONLY FOR FILE) ====================-->
<!--  async function getDrives() {-->
<!--      try {-->
<!--          const treeContainer = document.getElementById('treeContainer');-->
<!--          treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';-->

<!--          const response = await fetch(`/api/admin/explorer/drives`, {-->
<!--              credentials: "include"-->
<!--          });-->
<!--          const data = await response.json();-->

<!--          treeData = data;-->
<!--          document.getElementById('btnRefresh').disabled = false;-->
<!--          renderTree(data);-->
<!--      } catch (error) {-->
<!--          console.error('Failed to get drives:', error);-->
<!--          document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';-->
<!--      }-->
<!--  }-->

<!--  async function expandNode(node) {-->
<!--      if (!node || node.expanded || currentlyExpanding.has(node.id)) return;-->

<!--      currentlyExpanding.add(node.id);-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/explorer/nodes/${node.id}/expand`, {-->
<!--              method: 'POST',-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (response.status === 409) {-->
<!--              node.expanded = true;-->
<!--              return;-->
<!--          }-->

<!--          if (!response.ok) throw new Error(`HTTP ${response.status}`);-->

<!--          const data = await response.json();-->

<!--          if (!Array.isArray(data)) {-->
<!--              console.error('Invalid expand response:', data);-->
<!--              return;-->
<!--          }-->

<!--          updateTreeWithChildren(node.id, data);-->
<!--          node.expanded = true;-->

<!--      } catch (error) {-->
<!--          console.error('Expand failed:', error);-->
<!--      } finally {-->
<!--          currentlyExpanding.delete(node.id);-->
<!--          renderTree(treeData);-->
<!--      }-->
<!--  }-->

<!--  async function refreshExplorer() {-->
<!--      if (!selectedNode) {-->
<!--          await getDrives();-->
<!--          return;-->
<!--      }-->

<!--      const node = findNode(treeData, selectedNode.id);-->
<!--      if (!node) return;-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {-->
<!--          node.expanded = false;-->
<!--          node.children = [];-->
<!--          renderTree(treeData);-->

<!--          setTimeout(() => {-->
<!--              expandNode(node);-->
<!--          }, 200);-->
<!--      }-->
<!--  }-->

<!--  function findNode(nodes, id) {-->
<!--      for (const node of nodes) {-->
<!--          if (node.id === id) return node;-->
<!--          if (node.children) {-->
<!--              const found = findNode(node.children, id);-->
<!--              if (found) return found;-->
<!--          }-->
<!--      }-->
<!--      return null;-->
<!--  }-->

<!--  function renderTree(data) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      if (!treeContainer) return;-->

<!--      treeContainer.innerHTML = '';-->

<!--      if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {-->
<!--          treeContainer.innerHTML = '<div class="loading">No items found</div>';-->
<!--          return;-->
<!--      }-->

<!--      const items = Array.isArray(data) ? data : Object.values(data);-->
<!--      items.forEach(item => {-->
<!--          renderTreeNode(item, 0);-->
<!--      });-->
<!--  }-->

<!--  function renderTreeNode(node, level) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      const nodeEl = document.createElement('div');-->
<!--      const isSelected = selectedNode && selectedNode.id === node.id;-->

<!--      nodeEl.className = 'tree-node';-->
<!--      if (isSelected) nodeEl.classList.add('selected');-->

<!--      const indent = level * 20;-->
<!--      nodeEl.style.paddingLeft = `${indent + 10}px`;-->

<!--      if (node.type === 'folder' || node.type === 'drive') {-->
<!--          const expandEl = document.createElement('div');-->
<!--          expandEl.className = 'tree-node-expand';-->
<!--          expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';-->
<!--          expandEl.style.cursor = 'pointer';-->
<!--          expandEl.style.marginRight = '5px';-->
<!--          expandEl.style.fontSize = '12px';-->

<!--          expandEl.addEventListener('click', function(e) {-->
<!--              e.stopPropagation();-->
<!--              toggleFolder(node);-->
<!--          });-->

<!--          nodeEl.appendChild(expandEl);-->
<!--      } else {-->
<!--          const spacer = document.createElement('div');-->
<!--          spacer.style.width = '16px';-->
<!--          spacer.style.display = 'inline-block';-->
<!--          nodeEl.appendChild(spacer);-->
<!--      }-->

<!--      const iconEl = document.createElement('div');-->
<!--      iconEl.className = 'tree-node-icon';-->
<!--      iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';-->
<!--      nodeEl.appendChild(iconEl);-->

<!--      const nameEl = document.createElement('div');-->
<!--      nameEl.className = 'tree-node-name';-->
<!--      nameEl.textContent = node.name || 'Unnamed';-->
<!--      nodeEl.appendChild(nameEl);-->

<!--      nodeEl.addEventListener('click', function(e) {-->
<!--          e.stopPropagation();-->
<!--          selectNode(node);-->
<!--      });-->

<!--      treeContainer.appendChild(nodeEl);-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {-->
<!--          node.children.forEach(child => {-->
<!--              renderTreeNode(child, level + 1);-->
<!--          });-->
<!--      }-->
<!--  }-->

<!--  async function toggleFolder(node) {-->
<!--      if (node.expanded) {-->
<!--          try {-->
<!--              await fetch(`/api/admin/explorer/nodes/${node.id}/collapse`, {-->
<!--                  method: 'POST',-->
<!--                  credentials: "include"-->
<!--              });-->

<!--              node.expanded = false;-->
<!--              node.children = [];-->

<!--              renderTree(treeData);-->
<!--          } catch (e) {-->
<!--              console.error("Collapse failed", e);-->
<!--          }-->
<!--          return;-->
<!--      }-->

<!--      if (currentlyExpanding.has(node.id)) return;-->
<!--      expandNode(node);-->
<!--  }-->

<!--  function selectNode(node) {-->
<!--      selectedNode = node;-->

<!--      document.getElementById('selectedPathInfo').style.display = 'block';-->
<!--      document.getElementById('selectedPathValue').textContent = node.full_path || node.id;-->

<!--      loadNodePolicies(node.id);-->

<!--      const cbCreate = document.getElementById('cb-create');-->
<!--      if (node.type === 'file') {-->
<!--          operations.create = false;-->
<!--          cbCreate.checked = false;-->
<!--          cbCreate.disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      } else {-->
<!--          cbCreate.disabled = false;-->
<!--          document.getElementById('create-operation').classList.remove('disabled');-->
<!--      }-->

<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--  }-->

<!--  function clearSelection() {-->
<!--      selectedNode = null;-->
<!--      document.getElementById('selectedPathInfo').style.display = 'none';-->
<!--      document.getElementById('selectedPathValue').textContent = '-';-->
<!--      document.getElementById('activePoliciesSection').style.display = 'none';-->
<!--      document.getElementById('removePolicyContainer').style.display = 'none';-->
<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--  }-->

<!--  function updateTreeWithChildren(parentId, children) {-->
<!--      if (!Array.isArray(children)) {-->
<!--          console.error("Children is not array:", children);-->
<!--          return;-->
<!--      }-->

<!--      function updateNode(nodes) {-->
<!--          for (let node of nodes) {-->
<!--              if (!node) continue;-->

<!--              if (node.id === parentId) {-->
<!--                  node.children = children;-->
<!--                  node.expanded = true;-->
<!--                  return true;-->
<!--              }-->

<!--              if (Array.isArray(node.children)) {-->
<!--                  if (updateNode(node.children)) return true;-->
<!--              }-->
<!--          }-->
<!--          return false;-->
<!--      }-->

<!--      if (Array.isArray(treeData)) {-->
<!--          updateNode(treeData);-->
<!--      }-->
<!--  }-->

<!--  // ==================== NEW ACTIVE POLICIES FUNCTIONS (ONLY FOR FILE) ====================-->
<!--  async function loadNodePolicies(nodeId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies/node/${nodeId}`, {-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              if (response.status === 404) {-->
<!--                  activeNodePolicies = [];-->
<!--              } else {-->
<!--                  throw new Error('Failed to load policies');-->
<!--              }-->
<!--          } else {-->
<!--              const result = await response.json();-->

<!--              if (Array.isArray(result)) {-->
<!--                  activeNodePolicies = result;-->
<!--              } else if (result.data && Array.isArray(result.data)) {-->
<!--                  activeNodePolicies = result.data;-->
<!--              } else {-->
<!--                  activeNodePolicies = [];-->
<!--              }-->
<!--          }-->

<!--          const section = document.getElementById('activePoliciesSection');-->
<!--          const policiesList = document.getElementById('selectedNodePolicies');-->
<!--          const noPoliciesMsg = document.getElementById('noPoliciesMsg');-->
<!--          const removeContainer = document.getElementById('removePolicyContainer');-->

<!--          if (activeNodePolicies.length > 0) {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'block';-->
<!--              noPoliciesMsg.style.display = 'none';-->

<!--              policiesList.innerHTML = '';-->
<!--              activeNodePolicies.forEach(policy => {-->
<!--                  const policyItem = document.createElement('div');-->
<!--                  policyItem.className = 'policy-item';-->

<!--                  const operations = policy.operations || {};-->
<!--                  const isBlockAll = operations.read === true;-->

<!--                  if (isBlockAll) {-->
<!--                      policyItem.classList.add('block-all');-->
<!--                  }-->

<!--                  const ops = [];-->
<!--                  if (operations.read === true) ops.push('READ');-->
<!--                  if (operations.write === true) ops.push('WRITE');-->
<!--                  if (operations.delete === true) ops.push('DELETE');-->
<!--                  if (operations.rename === true) ops.push('RENAME');-->
<!--                  if (operations.create === true) ops.push('CREATE');-->

<!--                  policyItem.innerHTML = `-->
<!--                      <div class="policy-info">-->
<!--                          <div class="policy-name">${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}</div>-->
<!--                          <div class="policy-details">Scope: ${policy.scope || 'file'} | ID: ${policy.id}</div>-->
<!--                      </div>-->
<!--                      <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">-->
<!--                          <i class="fas fa-times"></i>-->
<!--                      </button>-->
<!--                  `;-->

<!--                  policiesList.appendChild(policyItem);-->
<!--              });-->
<!--          } else {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'none';-->
<!--              noPoliciesMsg.style.display = 'flex';-->
<!--              policiesList.innerHTML = '';-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Error loading node policies:', error);-->
<!--      }-->
<!--  }-->

<!--  function showRemovePolicyModal() {-->
<!--      if (activeNodePolicies.length === 0) return;-->

<!--      if (activeNodePolicies.length > 1) {-->
<!--          showPolicySelectionModal();-->
<!--      } else {-->
<!--          showRemovePolicyModalForPolicy(activeNodePolicies[0].id);-->
<!--      }-->
<!--  }-->

<!--  function showPolicySelectionModal() {-->
<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      let html = '<p><strong>Multiple policies found:</strong></p>';-->
<!--      html += '<div style="margin: 15px 0;">';-->

<!--      activeNodePolicies.forEach(policy => {-->
<!--          const operations = policy.operations || {};-->
<!--          const ops = Object.entries(operations)-->
<!--              .filter(([op, val]) => val)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          html += `-->
<!--              <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">-->
<!--                  <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">-->
<!--                  <label for="policy_${policy.id}" style="flex: 1;">-->
<!--                      <strong>Policy ID ${policy.id}</strong><br>-->
<!--                      Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}-->
<!--                  </label>-->
<!--              </div>-->
<!--          `;-->
<!--      });-->

<!--      html += '</div>';-->
<!--      html += '<p>Select a policy to remove:</p>';-->

<!--      details.innerHTML = html;-->

<!--      setTimeout(() => {-->
<!--          const radios = document.querySelectorAll('input[name="policySelect"]');-->
<!--          radios.forEach(radio => {-->
<!--              radio.addEventListener('change', function() {-->
<!--                  policyToRemove = parseInt(this.value);-->
<!--                  updateRemoveConfirmButton();-->
<!--              });-->
<!--          });-->
<!--      }, 100);-->

<!--      confirmInput.value = '';-->
<!--      confirmInput.disabled = false;-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          updateRemoveConfirmButton();-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function showRemovePolicyModalForPolicy(policyId) {-->
<!--      const policy = activeNodePolicies.find(p => p.id === policyId);-->
<!--      if (!policy) return;-->

<!--      policyToRemove = policyId;-->

<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      const operations = policy.operations || {};-->
<!--      const ops = Object.entries(operations)-->
<!--          .filter(([op, val]) => val)-->
<!--          .map(([op]) => op.toUpperCase())-->
<!--          .join(', ');-->

<!--      details.innerHTML = `-->
<!--          <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Policy ID:</strong> ${policy.id}</div>-->
<!--          <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>-->
<!--          <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>-->
<!--      `;-->

<!--      confirmInput.value = '';-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function updateRemoveConfirmButton() {-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;-->
<!--  }-->

<!--  function closeRemovePolicyModal() {-->
<!--      document.getElementById('removePolicyModal').classList.remove('active');-->
<!--      policyToRemove = null;-->
<!--  }-->

<!--  async function removeSelectedPolicy() {-->
<!--      if (!policyToRemove) {-->
<!--          closeRemovePolicyModal();-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies/node/${selectedNode.id}`, {-->
<!--              method: 'DELETE',-->
<!--              credentials: "include"-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error('Failed to remove policies');-->
<!--          }-->

<!--          showToast("Policies removed successfully!", "success");-->
<!--          closeRemovePolicyModal();-->

<!--          if (selectedNode) {-->
<!--              await loadNodePolicies(selectedNode.id);-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Remove policy error:', error);-->
<!--          showToast("Failed to remove policies: " + error.message, "error");-->
<!--          closeRemovePolicyModal();-->
<!--      }-->
<!--  }-->

<!--  // ==================== NEW OPERATIONS FUNCTIONS (ONLY FOR FILE) ====================-->
<!--  function initOperationCheckboxes() {-->
<!--      const checkboxes = document.querySelectorAll('.operation-checkbox');-->
<!--      checkboxes.forEach(cb => {-->
<!--          cb.addEventListener('change', function() {-->
<!--              const operation = this.getAttribute('data-operation');-->

<!--              if (operation === 'read') {-->
<!--                  handleReadCheckboxChange(this.checked);-->
<!--              } else {-->
<!--                  handleOperationChange(operation, this.checked);-->
<!--              }-->
<!--          });-->
<!--      });-->
<!--  }-->

<!--  function handleReadCheckboxChange(isChecked) {-->
<!--      operations.read = isChecked;-->

<!--      document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);-->

<!--      if (isChecked) {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              operations[op] = false;-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.checked = false;-->
<!--              cb.disabled = true;-->
<!--              document.getElementById(`${op}-operation`).classList.add('disabled');-->
<!--          });-->
<!--      } else {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.disabled = false;-->
<!--              document.getElementById(`${op}-operation`).classList.remove('disabled');-->
<!--          });-->

<!--          if (selectedNode && selectedNode.type === 'file') {-->
<!--              document.getElementById('cb-create').disabled = true;-->
<!--              document.getElementById('create-operation').classList.add('disabled');-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  function handleOperationChange(operation, isChecked) {-->
<!--      operations[operation] = isChecked;-->
<!--  }-->

<!--  function clearOperations() {-->
<!--      Object.keys(operations).forEach(op => {-->
<!--          operations[op] = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-checkbox').forEach(cb => {-->
<!--          cb.checked = false;-->
<!--          cb.disabled = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-item').forEach(item => {-->
<!--          item.classList.remove('disabled');-->
<!--      });-->

<!--      document.getElementById('readBlockAllWarning').classList.remove('active');-->

<!--      if (selectedNode && selectedNode.type === 'file') {-->
<!--          document.getElementById('cb-create').disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      }-->
<!--  }-->

<!--  // ==================== ORIGINAL DOMAIN FUNCTIONS ====================-->
<!--  function addDomain() {-->
<!--      const domainInput = document.getElementById("domainInput");-->
<!--      let domain = domainInput.value.trim();-->

<!--      if (!domain) {-->
<!--          alert("Please enter a domain name");-->
<!--          return;-->
<!--      }-->

<!--      domain = domain.replace(/^https?:\/\//, "");-->
<!--      domain = domain.replace(/\/$/, "");-->

<!--      const domainLower = domain.toLowerCase();-->
<!--      const exists = blockedDomains.some(d => d.toLowerCase() === domainLower);-->

<!--      if (exists) {-->
<!--          alert("Domain already added");-->
<!--          return;-->
<!--      }-->
<!--      blockedDomains.push(domain);-->
<!--      domainInput.value = "";-->

<!--      renderDomainTags();-->
<!--  }-->

<!--  function renderDomainTags() {-->
<!--      const domainTags = document.getElementById("domainTags");-->
<!--      if (!domainTags) return;-->

<!--      domainTags.innerHTML = "";-->

<!--      blockedDomains.forEach((domain, index) => {-->
<!--          const tag = document.createElement("div");-->
<!--          tag.className = "domain-tag";-->
<!--          tag.innerHTML = `-->
<!--              <span>${domain}</span>-->
<!--              <i class="fas fa-times" onclick="removeDomain(${index})"></i>-->
<!--          `;-->
<!--          domainTags.appendChild(tag);-->
<!--      });-->
<!--  }-->

<!--  function removeDomain(index) {-->
<!--      blockedDomains.splice(index, 1);-->
<!--      renderDomainTags();-->
<!--  }-->

<!--  // ==================== STEP NAVIGATION ====================-->
<!--  function nextStep() {-->
<!--      if (currentStep === 1 && selectedAgents.size === 0) {-->
<!--          alert("Please select at least one agent");-->
<!--          return;-->
<!--      }-->

<!--      if (currentStep === 2) {-->
<!--          const policyType = document.getElementById('policyType').value;-->
<!--          if (!policyType) {-->
<!--              alert("Please select a policy type");-->
<!--              return;-->
<!--          }-->
<!--          selectedPolicyType = policyType;-->

<!--          // Reset UI based on policy type-->
<!--          document.getElementById('fileProtectionUI').style.display = 'none';-->
<!--          document.getElementById('networkUI').style.display = 'none';-->
<!--          document.getElementById('usbUI').style.display = 'none';-->
<!--          document.getElementById('ocrUI').style.display = 'none';-->

<!--          if (policyType === 'file') {-->
<!--              document.getElementById('fileProtectionUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Select files/folders and configure blocking operations';-->
<!--          } else if (policyType === 'network') {-->
<!--              document.getElementById('networkUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure network blocking rules';-->
<!--              updatePolicyTypes();-->
<!--          } else if (policyType === 'usb') {-->
<!--              document.getElementById('usbUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure USB device controls';-->
<!--          } else if (policyType === 'ocr') {-->
<!--              document.getElementById('ocrUI').style.display = 'block';-->
<!--              document.getElementById('step3Description').textContent = 'Configure OCR and content monitoring';-->
<!--          }-->
<!--      }-->

<!--      if (currentStep === 3) {-->
<!--          if (selectedPolicyType === 'file') {-->
<!--              if (!selectedNode) {-->
<!--                  alert("Please select a file or folder");-->
<!--                  return;-->
<!--              }-->

<!--              const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--              if (!hasAnyOperation) {-->
<!--                  alert("Please select at least one operation to block");-->
<!--                  return;-->
<!--              }-->
<!--          } else if (selectedPolicyType === 'network') {-->
<!--              if (!selectedPolicy) {-->
<!--                  alert("Please select a policy");-->
<!--                  return;-->
<!--              }-->

<!--              if (selectedPolicy === "NETWORK_DNS_BLOCK" && blockedDomains.length === 0) {-->
<!--                  alert("Please add at least one domain to block");-->
<!--                  return;-->
<!--              }-->
<!--          }-->
<!--      }-->

<!--      currentStep++;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function previousStep() {-->
<!--      currentStep&#45;&#45;;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function cancelAssignment() {-->
<!--      if (confirm("Are you sure you want to cancel? All selections will be lost.")) {-->
<!--          window.location.href = 'file-policies.html';-->
<!--      }-->
<!--  }-->

<!--  function updateStepDisplay() {-->
<!--      document.getElementById("step1").style.display = "none";-->
<!--      document.getElementById("step2").style.display = "none";-->
<!--      document.getElementById("step3").style.display = "none";-->
<!--      document.getElementById("step4").style.display = "none";-->

<!--      document.getElementById(`step${currentStep}`).style.display = "block";-->

<!--      document.querySelectorAll(".step").forEach((step, index) => {-->
<!--          step.classList.remove("active", "completed");-->
<!--          if (index + 1 < currentStep) {-->
<!--              step.classList.add("completed");-->
<!--              step.querySelector(".step-circle").innerHTML = '<i class="fas fa-check"></i>';-->
<!--          } else if (index + 1 === currentStep) {-->
<!--              step.classList.add("active");-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          } else {-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          }-->
<!--      });-->

<!--      document.getElementById("prevBtn").style.display = currentStep > 1 ? "flex" : "none";-->
<!--      document.getElementById("nextBtn").style.display = currentStep < 4 ? "flex" : "none";-->
<!--      document.getElementById("applyBtn").style.display = currentStep === 4 ? "flex" : "none";-->

<!--      if (currentStep === 4) {-->
<!--          updateSummary();-->
<!--      }-->
<!--  }-->

<!--  function updateSummary() {-->
<!--      const summaryBox = document.getElementById("summaryBox");-->

<!--      if (selectedPolicyType === 'file') {-->
<!--          const blockedOps = Object.entries(operations)-->
<!--              .filter(([op, checked]) => checked)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          const isBlockAll = operations.read;-->

<!--          summaryBox.innerHTML = `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Agents Selected</span>-->
<!--                  <span class="summary-value">${selectedAgents.size}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy Type</span>-->
<!--                  <span class="summary-value">File Protection</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Protected Path</span>-->
<!--                  <span class="summary-value">${selectedNode ? (selectedNode.full_path || selectedNode.id) : '-'}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Resource Type</span>-->
<!--                  <span class="summary-value">${selectedNode ? (selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File') : '-'}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Blocked Operations</span>-->
<!--                  <span class="summary-value">${blockedOps || 'None'}</span>-->
<!--              </div>-->
<!--              ${isBlockAll ? '<div class="summary-row"><span class="summary-label">âš ï¸ Effect</span><span class="summary-value">ALL ACCESS BLOCKED</span></div>' : ''}-->
<!--          `;-->

<!--          document.getElementById("step4Alert").innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The file protection policy will be applied to all selected agents within 5 minutes.</span>-->
<!--          `;-->

<!--      } else if (selectedPolicyType === 'network') {-->
<!--          summaryBox.innerHTML = `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Agents Selected</span>-->
<!--                  <span class="summary-value">${selectedAgents.size}</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy Type</span>-->
<!--                  <span class="summary-value">Network Policy</span>-->
<!--              </div>-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Policy</span>-->
<!--                  <span class="summary-value">${selectedPolicy || '-'}</span>-->
<!--              </div>-->
<!--              ${blockedDomains.length > 0 ? `-->
<!--              <div class="summary-row">-->
<!--                  <span class="summary-label">Blocked Domains</span>-->
<!--                  <span class="summary-value">${blockedDomains.length}</span>-->
<!--              </div>-->
<!--              ` : ''}-->
<!--          `;-->

<!--          document.getElementById("step4Alert").innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The network policy will be applied to all selected agents within 5 minutes.</span>-->
<!--          `;-->
<!--      }-->
<!--  }-->

<!--  // ==================== APPLY POLICY (HANDLES BOTH FILE AND NETWORK) ====================-->
<!--  async function applyPolicy() {-->
<!--      if (selectedAgents.size === 0) {-->
<!--          alert("No agents selected");-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const agentIds = Array.from(selectedAgents);-->

<!--          if (selectedPolicyType === 'file') {-->
<!--              if (!selectedNode) {-->
<!--                  alert("No file/folder selected");-->
<!--                  return;-->
<!--              }-->

<!--              const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--              if (!hasAnyOperation) {-->
<!--                  alert("Please select at least one operation to block");-->
<!--                  return;-->
<!--              }-->

<!--              const payload = {-->
<!--                  node_id: selectedNode.id,-->
<!--                  scope: selectedNode.type === 'folder' ? 'folder_recursive' : 'file',-->
<!--                  action: 'block',-->
<!--                  operations: { ...operations },-->
<!--                  created_by: 'admin',-->
<!--                  comment: 'Applied from File Protection UI',-->
<!--                  confirmed: true,-->
<!--                  agentIds: agentIds-->
<!--              };-->

<!--              showToast("Applying policy...", "info");-->

<!--              const response = await fetch(`/api/admin/policies/apply`, {-->
<!--                  method: 'POST',-->
<!--                  headers: { 'Content-Type': 'application/json' },-->
<!--                  credentials: "include",-->
<!--                  body: JSON.stringify(payload)-->
<!--              });-->

<!--              if (!response.ok) {-->
<!--                  const errorText = await response.text();-->
<!--                  throw new Error(errorText);-->
<!--              }-->

<!--              const result = await response.json();-->

<!--              const agentNames = agentIds-->
<!--                  .map(id => {-->
<!--                      const agent = agentsBasicData[id];-->
<!--                      return agent ? agent.hostname || agent.username : `Agent ${id}`;-->
<!--                  })-->
<!--                  .filter(name => name);-->

<!--              let message = `âœ… Policy applied successfully!\n\n`;-->
<!--              message += `Agents: ${agentNames.join(', ')}\n`;-->
<!--              message += `Path: ${selectedNode.full_path || selectedNode.id}\n`;-->
<!--              message += `Blocked Operations: ${Object.entries(operations).filter(([op, checked]) => checked).map(([op]) => op.toUpperCase()).join(', ')}`;-->

<!--              alert(message);-->

<!--              setTimeout(() => {-->
<!--                  window.location.href = 'file-policies.html';-->
<!--              }, 2000);-->

<!--          } else if (selectedPolicyType === 'network') {-->
<!--              if (!selectedPolicy) {-->
<!--                  alert("No policy selected");-->
<!--                  return;-->
<!--              }-->

<!--              const payload = {-->
<!--                  agentIds: agentIds,-->
<!--                  policyCode: selectedPolicy-->
<!--              };-->

<!--              if (selectedPolicy === "NETWORK_DNS_BLOCK" && blockedDomains.length > 0) {-->
<!--                  payload.policyData = JSON.stringify({-->
<!--                      domains: blockedDomains,-->
<!--                      ips: []-->
<!--                  });-->
<!--              }-->

<!--              const response = await fetch(`/api/admin/assign-protection`, {-->
<!--                  method: 'POST',-->
<!--                  headers: { 'Content-Type': 'application/json' },-->
<!--                  credentials: "include",-->
<!--                  body: JSON.stringify(payload)-->
<!--              });-->

<!--              if (!response.ok) throw new Error('Failed to apply policy');-->

<!--              const result = await response.json();-->

<!--              if (result.success) {-->
<!--                  alert(`âœ… Network policy applied successfully!`);-->
<!--                  setTimeout(() => {-->
<!--                      window.location.href = 'file-policies.html';-->
<!--                  }, 2000);-->
<!--              } else {-->
<!--                  throw new Error(result.message || 'Failed to apply policy');-->
<!--              }-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Apply policy error:', error);-->
<!--          showToast("Failed to apply policy: " + error.message, "error");-->
<!--      }-->
<!--  }-->

<!--  // ==================== UTILITY FUNCTIONS ====================-->
<!--  function showToast(message, type = 'success') {-->
<!--      const toast = document.createElement('div');-->
<!--      toast.className = `toast ${type}`;-->
<!--      toast.textContent = message;-->

<!--      document.body.appendChild(toast);-->
<!--      setTimeout(() => toast.remove(), 3000);-->
<!--  }-->

<!--  // ==================== INITIALIZATION ====================-->
<!--  document.addEventListener("DOMContentLoaded", async function() {-->
<!--      loadAdminInfo();-->
<!--      setActiveMenuItem();-->

<!--      await Promise.all([-->
<!--          initializeAgentCards(),-->
<!--          fetchAgentSimpleDetails(),-->
<!--      ]);-->

<!--      startStatusRefresh();-->
<!--      initOperationCheckboxes();-->

<!--      // Set up file explorer event listeners (only for FILE)-->
<!--      document.getElementById('btnGetDrives').addEventListener('click', getDrives);-->
<!--      document.getElementById('btnRefresh').addEventListener('click', refreshExplorer);-->
<!--      document.getElementById('btnClearSelection').addEventListener('click', clearSelection);-->
<!--  });-->

<!--  // Window resize handlers-->
<!--  window.addEventListener("resize", function() {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mainContent = document.getElementById("mainContent");-->
<!--      const header = document.getElementById("topHeader");-->
<!--      const windowWidth = window.innerWidth;-->

<!--      if (windowWidth <= 968) {-->
<!--          if (sidebar) sidebar.classList.remove("collapsed");-->
<!--          if (mainContent) mainContent.classList.remove("expanded");-->
<!--          if (header) header.style.left = "0";-->
<!--      } else {-->
<!--          if (sidebar && mainContent && header) {-->
<!--              if (sidebar.classList.contains("collapsed")) {-->
<!--                  mainContent.classList.add("expanded");-->
<!--                  header.style.left = "70px";-->
<!--              } else {-->
<!--                  mainContent.classList.remove("expanded");-->
<!--                  header.style.left = "240px";-->
<!--              }-->
<!--          }-->
<!--      }-->
<!--  });-->

<!--  // Click outside handlers for mobile-->
<!--  document.addEventListener("click", function(e) {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");-->

<!--      if (sidebar && window.innerWidth <= 968) {-->
<!--          if (-->
<!--              !sidebar.contains(e.target) &&-->
<!--              (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))-->
<!--          ) {-->
<!--              sidebar.classList.remove("mobile-open");-->
<!--              const overlay = document.getElementById("sidebarOverlay");-->
<!--              if (overlay) overlay.classList.remove("active");-->
<!--          }-->
<!--      }-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->



<!--not proper -->

<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--  <meta charset="UTF-8" />-->
<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
<!--  <title>DLP Shield - Assign Policy</title>-->
<!--  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />-->
<!--  <style>-->
<!--    /* All original styles remain exactly the same */-->
<!--    * {-->
<!--        margin: 0;-->
<!--        padding: 0;-->
<!--        box-sizing: border-box;-->
<!--    }-->

<!--    body {-->
<!--        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;-->
<!--        background: #f3f4f6;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .dashboard-container {-->
<!--        display: flex;-->
<!--        min-height: 100vh;-->
<!--        max-width: 100vw;-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content {-->
<!--        flex: 1;-->
<!--        margin-left: 240px;-->
<!--        transition: margin-left 0.3s ease;-->
<!--        min-height: 100vh;-->
<!--        max-width: calc(100vw - 240px);-->
<!--        overflow-x: hidden;-->
<!--    }-->

<!--    .main-content.expanded {-->
<!--        margin-left: 70px;-->
<!--        max-width: calc(100vw - 70px);-->
<!--    }-->

<!--    .content-area {-->
<!--        padding: 24px;-->
<!--        padding-top: 100px;-->
<!--        max-width: 1400px;-->
<!--        margin: 0 auto;-->
<!--    }-->

<!--    /* ================ SIDEBAR STYLES ================ */-->
<!--    .sidebar {-->
<!--        width: 240px;-->
<!--        background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);-->
<!--        color: white;-->
<!--        position: fixed;-->
<!--        height: 100vh;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: width 0.3s ease;-->
<!--        z-index: 1000;-->
<!--        left: 0;-->
<!--        top: 0;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar {-->
<!--        width: 4px;-->
<!--    }-->

<!--    .sidebar::-webkit-scrollbar-thumb {-->
<!--        background: rgba(255, 255, 255, 0.3);-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .sidebar-header {-->
<!--        padding: 18px 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        border-bottom: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo {-->
<!--        width: 38px;-->
<!--        height: 38px;-->
<!--        background: white;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .sidebar-logo i {-->
<!--        font-size: 20px;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .sidebar-title {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        white-space: nowrap;-->
<!--        transition: opacity 0.2s, width 0.3s;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .nav-menu {-->
<!--        padding: 12px 0;-->
<!--        overflow-y: auto;-->
<!--        overflow-x: hidden;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .nav-item {-->
<!--        margin: 2px 8px;-->
<!--    }-->

<!--    .nav-link {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        color: rgba(255, 255, 255, 0.8);-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        transition: all 0.2s;-->
<!--        font-size: 0.9em;-->
<!--        cursor: pointer;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .nav-link:hover {-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        color: white;-->
<!--    }-->

<!--    .nav-link.active,-->
<!--    .sub-menu-item.active {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .nav-link i:first-child {-->
<!--        width: 20px;-->
<!--        font-size: 0.95em;-->
<!--        margin-right: 10px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .chevron-icon {-->
<!--        margin-left: auto !important;-->
<!--        font-size: 0.7em !important;-->
<!--        transition: transform 0.3s;-->
<!--        width: auto !important;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .nav-link.expanded .chevron-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .sub-menu {-->
<!--        max-height: 0;-->
<!--        overflow: hidden;-->
<!--        transition: max-height 0.3s ease;-->
<!--    }-->

<!--    .sub-menu.open {-->
<!--        max-height: 500px;-->
<!--    }-->

<!--    .sub-menu-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px 8px 42px;-->
<!--        color: rgba(255, 255, 255, 0.7);-->
<!--        text-decoration: none;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--        margin: 2px 0;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .sub-menu-item:hover {-->
<!--        color: white;-->
<!--        background: rgba(255, 255, 255, 0.08);-->
<!--    }-->

<!--    .sub-menu-item::before {-->
<!--        content: "â€¢";-->
<!--        margin-right: 10px;-->
<!--        font-size: 1.2em;-->
<!--    }-->

<!--    .sidebar-footer {-->
<!--        padding: 12px 16px;-->
<!--        border-top: 1px solid rgba(255, 255, 255, 0.1);-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .collapse-btn {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        gap: 8px;-->
<!--        padding: 10px;-->
<!--        background: rgba(255, 255, 255, 0.1);-->
<!--        border: none;-->
<!--        color: white;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        width: 100%;-->
<!--        font-size: 0.85em;-->
<!--        transition: all 0.2s;-->
<!--        white-space: nowrap;-->
<!--        overflow: hidden;-->
<!--    }-->

<!--    .collapse-btn:hover {-->
<!--        background: rgba(255, 255, 255, 0.15);-->
<!--    }-->

<!--    .collapse-btn i {-->
<!--        transition: transform 0.3s;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    /* Sidebar collapsed state */-->
<!--    .sidebar.collapsed {-->
<!--        width: 70px;-->
<!--    }-->

<!--    .sidebar.collapsed .sidebar-title {-->
<!--        opacity: 0;-->
<!--        width: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link span,-->
<!--    .sidebar.collapsed .collapse-btn span {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .sub-menu {-->
<!--        display: none !important;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link {-->
<!--        justify-content: center;-->
<!--        padding: 10px;-->
<!--    }-->

<!--    .sidebar.collapsed .nav-link i:first-child {-->
<!--        margin-right: 0;-->
<!--    }-->

<!--    .sidebar.collapsed .chevron-icon {-->
<!--        display: none;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn {-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .sidebar.collapsed .collapse-btn i {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    /* Mobile Overlay */-->
<!--    .sidebar-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 999;-->
<!--        opacity: 0;-->
<!--        transition: opacity 0.3s;-->
<!--    }-->

<!--    .sidebar-overlay.active {-->
<!--        display: block;-->
<!--        opacity: 1;-->
<!--    }-->

<!--    /* ================ HEADER STYLES ================ */-->
<!--    .top-header {-->
<!--        background: white;-->
<!--        padding: 14px 24px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: space-between;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 240px;-->
<!--        right: 0;-->
<!--        z-index: 500;-->
<!--        gap: 16px;-->
<!--        transition: left 0.3s ease;-->
<!--    }-->

<!--    .mobile-menu-toggle {-->
<!--        display: none;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.3em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: color 0.2s;-->
<!--    }-->

<!--    .mobile-menu-toggle:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .search-bar {-->
<!--        flex: 1;-->
<!--        max-width: 400px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .search-bar i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 9px 14px 9px 38px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: #f9fafb;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--        background: white;-->
<!--        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);-->
<!--    }-->

<!--    .header-actions {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .notification-btn {-->
<!--        position: relative;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.1em;-->
<!--        cursor: pointer;-->
<!--        padding: 8px;-->
<!--        transition: all 0.2s;-->
<!--        border-radius: 8px;-->
<!--    }-->

<!--    .notification-btn:hover {-->
<!--        color: #111827;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .notification-btn.active {-->
<!--        color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .notification-badge {-->
<!--        position: absolute;-->
<!--        top: 4px;-->
<!--        right: 4px;-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--        font-size: 0.65em;-->
<!--        min-width: 18px;-->
<!--        height: 18px;-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        padding: 0 4px;-->
<!--    }-->

<!--    .user-profile {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        cursor: pointer;-->
<!--        padding: 6px 10px;-->
<!--        border-radius: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .user-profile:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .user-avatar {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 50%;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: white;-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .user-info {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--    }-->

<!--    .user-name {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .user-role {-->
<!--        font-size: 0.75em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .dropdown-icon {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.75em;-->
<!--        margin-left: 4px;-->
<!--        transition: transform 0.3s;-->
<!--    }-->

<!--    .user-profile.active .dropdown-icon {-->
<!--        transform: rotate(180deg);-->
<!--    }-->

<!--    .user-dropdown {-->
<!--        position: absolute;-->
<!--        top: 100%;-->
<!--        right: 0;-->
<!--        margin-top: 8px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07), 0 10px 15px rgba(0, 0, 0, 0.1);-->
<!--        min-width: 200px;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transform: translateY(-10px);-->
<!--        transition: all 0.3s ease;-->
<!--        z-index: 1000;-->
<!--    }-->

<!--    .user-dropdown.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--        transform: translateY(0);-->
<!--    }-->

<!--    .dropdown-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        padding: 10px 14px;-->
<!--        color: #374151;-->
<!--        text-decoration: none;-->
<!--        font-size: 0.9em;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .dropdown-item:first-child {-->
<!--        border-radius: 8px 8px 0 0;-->
<!--    }-->

<!--    .dropdown-item:last-child {-->
<!--        border-radius: 0 0 8px 8px;-->
<!--    }-->

<!--    .dropdown-item:hover {-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .dropdown-item i {-->
<!--        width: 18px;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .dropdown-item.danger {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-item.danger i {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .dropdown-divider {-->
<!--        height: 1px;-->
<!--        background: #e5e7eb;-->
<!--        margin: 4px 0;-->
<!--    }-->

<!--    /* ================ NOTIFICATIONS PANEL ================ */-->
<!--    .notifications-panel {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        right: -50%;-->
<!--        width: 50%;-->
<!--        max-width: 600px;-->
<!--        height: 100vh;-->
<!--        background: white;-->
<!--        box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);-->
<!--        z-index: 1001;-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);-->
<!--    }-->

<!--    .notifications-panel.show {-->
<!--        right: 0;-->
<!--    }-->

<!--    .notifications-header {-->
<!--        padding: 20px 24px;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notifications-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .close-notifications {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        padding: 6px;-->
<!--        border-radius: 6px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .close-notifications:hover {-->
<!--        background: #f3f4f6;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .notifications-tabs {-->
<!--        display: flex;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        padding: 0 24px;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .tab-btn {-->
<!--        flex: 1;-->
<!--        padding: 12px;-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 500;-->
<!--        cursor: pointer;-->
<!--        border-bottom: 2px solid transparent;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .tab-btn:hover {-->
<!--        color: #111827;-->
<!--    }-->

<!--    .tab-btn.active {-->
<!--        color: #2563eb;-->
<!--        border-bottom-color: #2563eb;-->
<!--    }-->

<!--    .notifications-content {-->
<!--        flex: 1;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px 0;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar {-->
<!--        width: 6px;-->
<!--    }-->

<!--    .notifications-content::-webkit-scrollbar-thumb {-->
<!--        background: #d1d5db;-->
<!--        border-radius: 3px;-->
<!--    }-->

<!--    .notification-item {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        padding: 14px 24px;-->
<!--        cursor: pointer;-->
<!--        transition: background 0.2s;-->
<!--        border-left: 3px solid transparent;-->
<!--    }-->

<!--    .notification-item:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .notification-item.unread {-->
<!--        background: #eff6ff;-->
<!--        border-left-color: #3b82f6;-->
<!--    }-->

<!--    .notification-item.unread:hover {-->
<!--        background: #dbeafe;-->
<!--    }-->

<!--    .notification-icon {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 10px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-size: 1.1em;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .notification-icon.critical {-->
<!--        background: #fee2e2;-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .notification-icon.warning {-->
<!--        background: #fef3c7;-->
<!--        color: #f59e0b;-->
<!--    }-->

<!--    .notification-icon.info {-->
<!--        background: #dbeafe;-->
<!--        color: #3b82f6;-->
<!--    }-->

<!--    .notification-icon.success {-->
<!--        background: #d1fae5;-->
<!--        color: #10b981;-->
<!--    }-->

<!--    .notification-body {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .notification-title {-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .notification-text {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 6px;-->
<!--        line-height: 1.4;-->
<!--    }-->

<!--    .notification-time {-->
<!--        font-size: 0.75em;-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .notification-dot {-->
<!--        width: 8px;-->
<!--        height: 8px;-->
<!--        background: #3b82f6;-->
<!--        border-radius: 50%;-->
<!--        flex-shrink: 0;-->
<!--        margin-top: 8px;-->
<!--    }-->

<!--    .notification-item:not(.unread) .notification-dot {-->
<!--        display: none;-->
<!--    }-->

<!--    .notifications-footer {-->
<!--        padding: 16px 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--        flex-shrink: 0;-->
<!--    }-->

<!--    .view-all-btn {-->
<!--        display: block;-->
<!--        width: 100%;-->
<!--        padding: 10px;-->
<!--        background: #f3f4f6;-->
<!--        color: #2563eb;-->
<!--        text-align: center;-->
<!--        text-decoration: none;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .view-all-btn:hover {-->
<!--        background: #e5e7eb;-->
<!--    }-->

<!--    .notification-overlay {-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.4);-->
<!--        z-index: 1000;-->
<!--        opacity: 0;-->
<!--        visibility: hidden;-->
<!--        transition: all 0.3s ease;-->
<!--    }-->

<!--    .notification-overlay.show {-->
<!--        opacity: 1;-->
<!--        visibility: visible;-->
<!--    }-->

<!--    /* Assign Policy Page Styles */-->
<!--    .page-header {-->
<!--        background: white;-->
<!--        padding: 20px 24px;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        margin-bottom: 24px;-->
<!--    }-->

<!--    .page-title-section {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 16px;-->
<!--    }-->

<!--    .page-icon {-->
<!--        width: 48px;-->
<!--        height: 48px;-->
<!--        background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);-->
<!--        border-radius: 12px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .page-icon i {-->
<!--        font-size: 22px;-->
<!--        color: white;-->
<!--    }-->

<!--    .page-title-text h1 {-->
<!--        font-size: 1.5em;-->
<!--        color: #111827;-->
<!--        font-weight: 700;-->
<!--    }-->

<!--    .page-subtitle {-->
<!--        color: #6b7280;-->
<!--        font-size: 0.9em;-->
<!--        margin-top: 4px;-->
<!--    }-->

<!--    .breadcrumb {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        font-size: 0.85em;-->
<!--    }-->

<!--    .breadcrumb a {-->
<!--        color: #6b7280;-->
<!--        text-decoration: none;-->
<!--    }-->

<!--    .breadcrumb a:hover {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .breadcrumb span {-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .assign-container {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        padding: 28px;-->
<!--    }-->

<!--    .step-indicator {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        margin-bottom: 32px;-->
<!--        position: relative;-->
<!--    }-->

<!--    .step-indicator::before {-->
<!--        content: "";-->
<!--        position: absolute;-->
<!--        top: 20px;-->
<!--        left: 0;-->
<!--        right: 0;-->
<!--        height: 2px;-->
<!--        background: #e5e7eb;-->
<!--        z-index: 0;-->
<!--    }-->

<!--    .step {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        position: relative;-->
<!--        z-index: 1;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .step-circle {-->
<!--        width: 40px;-->
<!--        height: 40px;-->
<!--        border-radius: 50%;-->
<!--        background: white;-->
<!--        border: 2px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        font-weight: 600;-->
<!--        color: #9ca3af;-->
<!--        transition: all 0.3s;-->
<!--    }-->

<!--    .step.active .step-circle {-->
<!--        background: #2563eb;-->
<!--        border-color: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .step.completed .step-circle {-->
<!--        background: #10b981;-->
<!--        border-color: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .step-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    .step.active .step-label {-->
<!--        color: #2563eb;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .section {-->
<!--        margin-bottom: 28px;-->
<!--    }-->

<!--    .section-title {-->
<!--        font-size: 1.1em;-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .section-desc {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-group {-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .form-label {-->
<!--        display: block;-->
<!--        font-size: 0.9em;-->
<!--        color: #374151;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .form-select {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .form-select:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .form-select:disabled {-->
<!--        background: #f9fafb;-->
<!--        cursor: not-allowed;-->
<!--        opacity: 0.6;-->
<!--    }-->

<!--    .search-box {-->
<!--        position: relative;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .search-box i {-->
<!--        position: absolute;-->
<!--        left: 14px;-->
<!--        top: 50%;-->
<!--        transform: translateY(-50%);-->
<!--        color: #9ca3af;-->
<!--    }-->

<!--    .search-input {-->
<!--        width: 100%;-->
<!--        padding: 11px 14px 11px 42px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .search-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .agents-grid {-->
<!--        display: grid;-->
<!--        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));-->
<!--        gap: 12px;-->
<!--        max-height: 400px;-->
<!--        overflow-y: auto;-->
<!--        padding: 12px;-->
<!--        background: #f9fafb;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .agent-card {-->
<!--        background: white;-->
<!--        padding: 14px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        cursor: pointer;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .agent-card:hover {-->
<!--        border-color: #3b82f6;-->
<!--        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.1);-->
<!--    }-->

<!--    .agent-card.selected {-->
<!--        border-color: #2563eb;-->
<!--        background: #eff6ff;-->
<!--    }-->

<!--    .agent-card-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 8px;-->
<!--    }-->

<!--    .agent-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .agent-name {-->
<!--        font-weight: 600;-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        flex: 1;-->
<!--    }-->

<!--    .agent-status {-->
<!--        font-size: 0.75em;-->
<!--        padding: 3px 8px;-->
<!--        border-radius: 4px;-->
<!--    }-->

<!--    .status-online {-->
<!--        background: #d1fae5;-->
<!--        color: #059669;-->
<!--    }-->

<!--    .status-offline {-->
<!--        background: #f3f4f6;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .agent-info {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-top: 6px;-->
<!--    }-->

<!--    .selected-count {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        margin-bottom: 16px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--    }-->

<!--    .selected-count i {-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .selected-count span {-->
<!--        font-size: 0.9em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--    }-->

<!--    /* NEW: File Protection UI Styles */-->
<!--    .file-explorer-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        background: #f9fafb;-->
<!--        padding: 16px;-->
<!--        margin-bottom: 20px;-->
<!--    }-->

<!--    .explorer-header {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .explorer-btn {-->
<!--        padding: 8px 16px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 6px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--    }-->

<!--    .explorer-btn:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .explorer-btn:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .tree-container {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 6px;-->
<!--        padding: 12px;-->
<!--        height: 300px;-->
<!--        overflow-y: auto;-->
<!--        background: white;-->
<!--        font-family: monospace;-->
<!--        font-size: 13px;-->
<!--    }-->

<!--    .tree-node {-->
<!--        padding: 6px 8px;-->
<!--        margin: 2px 0;-->
<!--        border-radius: 4px;-->
<!--        cursor: pointer;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: background 0.2s;-->
<!--        position: relative;-->
<!--    }-->

<!--    .tree-node:hover {-->
<!--        background: #e8f0fe;-->
<!--    }-->

<!--    .tree-node.selected {-->
<!--        background: #d2e3fc;-->
<!--        border-left: 3px solid #2563eb;-->
<!--    }-->

<!--    .tree-node.protected {-->
<!--        background: #fee2e2;-->
<!--        border-left: 3px solid #dc2626;-->
<!--    }-->

<!--    .tree-node-icon {-->
<!--        width: 20px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .tree-node-name {-->
<!--        flex: 1;-->
<!--        overflow: hidden;-->
<!--        text-overflow: ellipsis;-->
<!--        white-space: nowrap;-->
<!--    }-->

<!--    .tree-node-badge {-->
<!--        background: #dc2626;-->
<!--        color: white;-->
<!--        font-size: 10px;-->
<!--        padding: 2px 6px;-->
<!--        border-radius: 12px;-->
<!--        margin-left: 8px;-->
<!--        font-family: sans-serif;-->
<!--    }-->

<!--    .tree-node-children {-->
<!--        margin-left: 24px;-->
<!--        border-left: 1px dashed #ddd;-->
<!--        padding-left: 12px;-->
<!--    }-->

<!--    .tree-node-expand {-->
<!--        font-size: 10px;-->
<!--        color: #6b7280;-->
<!--        cursor: pointer;-->
<!--        width: 16px;-->
<!--        text-align: center;-->
<!--    }-->

<!--    .selected-path-info {-->
<!--        background: #eff6ff;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .path-label {-->
<!--        font-size: 0.85em;-->
<!--        color: #1e40af;-->
<!--        font-weight: 500;-->
<!--        margin-bottom: 4px;-->
<!--    }-->

<!--    .path-value {-->
<!--        font-family: monospace;-->
<!--        font-size: 0.9em;-->
<!--        background: white;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        word-break: break-all;-->
<!--    }-->

<!--    .operations-list {-->
<!--        display: flex;-->
<!--        flex-direction: column;-->
<!--        gap: 12px;-->
<!--        margin: 20px 0;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .operation-item {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        padding: 8px 12px;-->
<!--        border-radius: 6px;-->
<!--        background: white;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .operation-item.disabled {-->
<!--        opacity: 0.5;-->
<!--        background: #f3f4f6;-->
<!--    }-->

<!--    .operation-checkbox {-->
<!--        width: 18px;-->
<!--        height: 18px;-->
<!--        margin-right: 12px;-->
<!--        cursor: pointer;-->
<!--    }-->

<!--    .operation-label {-->
<!--        flex: 1;-->
<!--        font-weight: 500;-->
<!--        font-size: 0.95em;-->
<!--    }-->

<!--    .operation-desc {-->
<!--        font-size: 0.8em;-->
<!--        color: #6b7280;-->
<!--        margin-left: 8px;-->
<!--    }-->

<!--    .read-block-all {-->
<!--        background: #fee2e2;-->
<!--        border: 1px solid #fecaca;-->
<!--        padding: 12px 16px;-->
<!--        border-radius: 6px;-->
<!--        margin-top: 12px;-->
<!--        display: none;-->
<!--        color: #991b1b;-->
<!--        font-weight: 500;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--    }-->

<!--    .read-block-all.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    /* Active Policies Section */-->
<!--    .active-policies-section {-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 16px;-->
<!--        background: #f9fafb;-->
<!--        margin-top: 20px;-->
<!--    }-->

<!--    .policies-list {-->
<!--        max-height: 150px;-->
<!--        overflow-y: auto;-->
<!--        border: 1px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        padding: 12px;-->
<!--        background: white;-->
<!--    }-->

<!--    .policy-item-small {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--        padding: 10px 12px;-->
<!--        margin: 6px 0;-->
<!--        background: white;-->
<!--        border-radius: 6px;-->
<!--        border-left: 4px solid #2563eb;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .policy-item-small.block-all {-->
<!--        border-left-color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    .policy-info-compact {-->
<!--        flex: 1;-->
<!--    }-->

<!--    .policy-name-compact {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-details-compact {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--        margin-top: 2px;-->
<!--    }-->

<!--    .policy-remove-btn {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #9ca3af;-->
<!--        cursor: pointer;-->
<!--        padding: 4px 8px;-->
<!--        border-radius: 4px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .policy-remove-btn:hover {-->
<!--        color: #dc2626;-->
<!--        background: #fee2e2;-->
<!--    }-->

<!--    .remove-policy-container {-->
<!--        margin-top: 20px;-->
<!--        animation: slideDown 0.3s ease;-->
<!--    }-->

<!--    @keyframes slideDown {-->
<!--        from {-->
<!--            opacity: 0;-->
<!--            transform: translateY(-10px);-->
<!--        }-->
<!--        to {-->
<!--            opacity: 1;-->
<!--            transform: translateY(0);-->
<!--        }-->
<!--    }-->

<!--    /* Modal Styles */-->
<!--    .modal-overlay {-->
<!--        display: none;-->
<!--        position: fixed;-->
<!--        top: 0;-->
<!--        left: 0;-->
<!--        width: 100%;-->
<!--        height: 100%;-->
<!--        background: rgba(0, 0, 0, 0.5);-->
<!--        z-index: 2000;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--    }-->

<!--    .modal-overlay.active {-->
<!--        display: flex;-->
<!--    }-->

<!--    .modal {-->
<!--        background: white;-->
<!--        border-radius: 12px;-->
<!--        width: 90%;-->
<!--        max-width: 500px;-->
<!--        max-height: 80vh;-->
<!--        overflow-y: auto;-->
<!--        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);-->
<!--        animation: modalSlideIn 0.3s ease;-->
<!--    }-->

<!--    @keyframes modalSlideIn {-->
<!--        from {-->
<!--            transform: translateY(-20px);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateY(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    .modal-header {-->
<!--        padding: 20px 24px;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        align-items: center;-->
<!--    }-->

<!--    .modal-header h3 {-->
<!--        font-size: 1.2em;-->
<!--        font-weight: 700;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .modal-close {-->
<!--        background: none;-->
<!--        border: none;-->
<!--        color: #6b7280;-->
<!--        font-size: 1.2em;-->
<!--        cursor: pointer;-->
<!--        padding: 6px;-->
<!--        border-radius: 6px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .modal-close:hover {-->
<!--        background: #f3f4f6;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .modal-body {-->
<!--        padding: 24px;-->
<!--    }-->

<!--    .modal-footer {-->
<!--        padding: 20px 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--        display: flex;-->
<!--        justify-content: flex-end;-->
<!--        gap: 12px;-->
<!--    }-->

<!--    .domain-input-container {-->
<!--        margin-top: 16px;-->
<!--    }-->

<!--    .domain-input-group {-->
<!--        display: flex;-->
<!--        gap: 8px;-->
<!--        margin-bottom: 12px;-->
<!--    }-->

<!--    .domain-input {-->
<!--        flex: 1;-->
<!--        padding: 10px 14px;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--    }-->

<!--    .domain-input:focus {-->
<!--        outline: none;-->
<!--        border-color: #3b82f6;-->
<!--    }-->

<!--    .btn-add-domain {-->
<!--        padding: 10px 20px;-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--        border: none;-->
<!--        border-radius: 8px;-->
<!--        cursor: pointer;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .btn-add-domain:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .domain-tags {-->
<!--        display: flex;-->
<!--        flex-wrap: wrap;-->
<!--        gap: 8px;-->
<!--        margin-top: 12px;-->
<!--    }-->

<!--    .domain-tag {-->
<!--        background: #eff6ff;-->
<!--        color: #1e40af;-->
<!--        padding: 6px 12px;-->
<!--        border-radius: 6px;-->
<!--        font-size: 0.85em;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .domain-tag i {-->
<!--        cursor: pointer;-->
<!--        color: #ef4444;-->
<!--    }-->

<!--    .domain-tag i:hover {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .btn-group {-->
<!--        display: flex;-->
<!--        gap: 12px;-->
<!--        justify-content: flex-end;-->
<!--        padding-top: 24px;-->
<!--        border-top: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .btn {-->
<!--        padding: 11px 24px;-->
<!--        border-radius: 8px;-->
<!--        font-size: 0.9em;-->
<!--        font-weight: 600;-->
<!--        cursor: pointer;-->
<!--        border: none;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 8px;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .btn-primary {-->
<!--        background: #2563eb;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-primary:hover {-->
<!--        background: #1d4ed8;-->
<!--    }-->

<!--    .btn-primary:disabled {-->
<!--        background: #9ca3af;-->
<!--        cursor: not-allowed;-->
<!--    }-->

<!--    .btn-secondary {-->
<!--        background: white;-->
<!--        color: #374151;-->
<!--        border: 1.5px solid #e5e7eb;-->
<!--    }-->

<!--    .btn-secondary:hover {-->
<!--        background: #f9fafb;-->
<!--    }-->

<!--    .btn-danger {-->
<!--        background: #ef4444;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-danger:hover {-->
<!--        background: #dc2626;-->
<!--    }-->

<!--    .btn-warning {-->
<!--        background: #f59e0b;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-warning:hover {-->
<!--        background: #d97706;-->
<!--    }-->

<!--    .btn-success {-->
<!--        background: #10b981;-->
<!--        color: white;-->
<!--    }-->

<!--    .btn-success:hover {-->
<!--        background: #059669;-->
<!--    }-->

<!--    .alert {-->
<!--        padding: 14px 16px;-->
<!--        border-radius: 8px;-->
<!--        margin-bottom: 20px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 12px;-->
<!--    }-->

<!--    .alert-info {-->
<!--        background: #eff6ff;-->
<!--        border: 1px solid #bfdbfe;-->
<!--        color: #1e40af;-->
<!--    }-->

<!--    .alert-success {-->
<!--        background: #d1fae5;-->
<!--        border: 1px solid #a7f3d0;-->
<!--        color: #065f46;-->
<!--    }-->

<!--    .alert-warning {-->
<!--        background: #fff3cd;-->
<!--        border: 1px solid #ffeeba;-->
<!--        color: #856404;-->
<!--    }-->

<!--    .alert i {-->
<!--        font-size: 1.1em;-->
<!--    }-->

<!--    .loading {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #6b7280;-->
<!--        font-style: italic;-->
<!--    }-->

<!--    .error {-->
<!--        padding: 40px;-->
<!--        text-align: center;-->
<!--        color: #ef4444;-->
<!--        background: #fee2e2;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #fca5a5;-->
<!--    }-->

<!--    .summary-box {-->
<!--        background: #f9fafb;-->
<!--        padding: 20px;-->
<!--        border-radius: 8px;-->
<!--        border: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row {-->
<!--        display: flex;-->
<!--        justify-content: space-between;-->
<!--        padding: 10px 0;-->
<!--        border-bottom: 1px solid #e5e7eb;-->
<!--    }-->

<!--    .summary-row:last-child {-->
<!--        border-bottom: none;-->
<!--    }-->

<!--    .summary-label {-->
<!--        font-size: 0.9em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .summary-value {-->
<!--        font-size: 0.9em;-->
<!--        color: #111827;-->
<!--        font-weight: 600;-->
<!--    }-->

<!--    .text-error {-->
<!--        color: #dc2626;-->
<!--    }-->

<!--    .policy-preview {-->
<!--        background: white;-->
<!--        padding: 16px;-->
<!--        border-radius: 8px;-->
<!--        border: 1.5px solid #3b82f6;-->
<!--        margin-bottom: 16px;-->
<!--    }-->

<!--    .policy-preview-header {-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        gap: 10px;-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    .policy-preview-icon {-->
<!--        width: 36px;-->
<!--        height: 36px;-->
<!--        background: #eff6ff;-->
<!--        border-radius: 8px;-->
<!--        display: flex;-->
<!--        align-items: center;-->
<!--        justify-content: center;-->
<!--        color: #2563eb;-->
<!--    }-->

<!--    .policy-preview-title {-->
<!--        font-weight: 600;-->
<!--        color: #111827;-->
<!--    }-->

<!--    .policy-preview-desc {-->
<!--        font-size: 0.85em;-->
<!--        color: #6b7280;-->
<!--    }-->

<!--    .summary-domain-tag {-->
<!--        background: #eff6ff;-->
<!--        color: #1e40af;-->
<!--        padding: 4px 10px;-->
<!--        border-radius: 16px;-->
<!--        font-size: 0.8em;-->
<!--        display: inline-flex;-->
<!--        align-items: center;-->
<!--        gap: 6px;-->
<!--        border: 1px solid #bfdbfe;-->
<!--    }-->

<!--    .summary-domain-tag i {-->
<!--        cursor: pointer;-->
<!--        color: #ef4444;-->
<!--        font-size: 0.8em;-->
<!--        transition: all 0.2s;-->
<!--    }-->

<!--    .summary-domain-tag i:hover {-->
<!--        color: #dc2626;-->
<!--        transform: scale(1.1);-->
<!--    }-->

<!--    #summaryDomainTags {-->
<!--        display: flex;-->
<!--        flex-wrap: wrap;-->
<!--        gap: 8px;-->
<!--        padding: 8px 0;-->
<!--    }-->

<!--    .mt-10 {-->
<!--        margin-top: 10px;-->
<!--    }-->

<!--    .mt-20 {-->
<!--        margin-top: 20px;-->
<!--    }-->

<!--    .mb-10 {-->
<!--        margin-bottom: 10px;-->
<!--    }-->

<!--    /* Toast Notifications */-->
<!--    .toast {-->
<!--        position: fixed;-->
<!--        top: 20px;-->
<!--        right: 20px;-->
<!--        padding: 12px 20px;-->
<!--        border-radius: 8px;-->
<!--        color: white;-->
<!--        font-weight: 500;-->
<!--        z-index: 10000;-->
<!--        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);-->
<!--        animation: slideIn 0.3s ease;-->
<!--    }-->

<!--    .toast.success {-->
<!--        background: #10b981;-->
<!--    }-->

<!--    .toast.error {-->
<!--        background: #ef4444;-->
<!--    }-->

<!--    .toast.warning {-->
<!--        background: #f59e0b;-->
<!--    }-->

<!--    .toast.info {-->
<!--        background: #3b82f6;-->
<!--    }-->

<!--    @keyframes slideIn {-->
<!--        from {-->
<!--            transform: translateX(100%);-->
<!--            opacity: 0;-->
<!--        }-->
<!--        to {-->
<!--            transform: translateX(0);-->
<!--            opacity: 1;-->
<!--        }-->
<!--    }-->

<!--    /* Mobile responsive */-->
<!--    @media (max-width: 1200px) {-->
<!--        .main-content {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .main-content.expanded {-->
<!--            margin-left: 70px;-->
<!--            max-width: calc(100vw - 70px);-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 70px;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 968px) {-->
<!--        .main-content {-->
<!--            margin-left: 0;-->
<!--            max-width: 100vw;-->
<!--        }-->

<!--        .top-header {-->
<!--            left: 0;-->
<!--        }-->

<!--        .mobile-menu-toggle {-->
<!--            display: block;-->
<!--        }-->

<!--        .sidebar {-->
<!--            transform: translateX(-100%);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->

<!--        .sidebar.mobile-open {-->
<!--            transform: translateX(0);-->
<!--        }-->

<!--        .agents-grid {-->
<!--            grid-template-columns: 1fr;-->
<!--        }-->

<!--        .explorer-header {-->
<!--            flex-direction: column;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 768px) {-->
<!--        .content-area {-->
<!--            padding: 16px;-->
<!--            padding-top: 80px;-->
<!--        }-->

<!--        .notifications-panel {-->
<!--            width: 90%;-->
<!--            right: -90%;-->
<!--        }-->

<!--        .step-indicator {-->
<!--            flex-direction: column;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .step-indicator::before {-->
<!--            display: none;-->
<!--        }-->

<!--        .btn-group {-->
<!--            flex-direction: column;-->
<!--        }-->

<!--        .btn {-->
<!--            width: 100%;-->
<!--            justify-content: center;-->
<!--        }-->

<!--        .user-info {-->
<!--            display: none;-->
<!--        }-->
<!--    }-->

<!--    @media (max-width: 640px) {-->
<!--        .content-area {-->
<!--            padding: 12px;-->
<!--            padding-top: 70px;-->
<!--        }-->

<!--        .page-title-section {-->
<!--            flex-direction: column;-->
<!--            align-items: flex-start;-->
<!--            gap: 12px;-->
<!--        }-->

<!--        .page-icon {-->
<!--            width: 40px;-->
<!--            height: 40px;-->
<!--        }-->

<!--        .page-icon i {-->
<!--            font-size: 18px;-->
<!--        }-->

<!--        .page-title-text h1 {-->
<!--            font-size: 1.3em;-->
<!--        }-->

<!--        .assign-container {-->
<!--            padding: 16px;-->
<!--        }-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="dashboard-container">-->
<!--  &lt;!&ndash; ==================== SIDEBAR ==================== &ndash;&gt;-->
<!--  <aside class="sidebar" id="sidebar">-->
<!--    <div class="sidebar-header">-->
<!--      <div class="sidebar-logo">-->
<!--        <i class="fas fa-shield-halved"></i>-->
<!--      </div>-->
<!--      <div class="sidebar-title">DLP Shield</div>-->
<!--    </div>-->

<!--    <nav class="nav-menu">-->
<!--      <div class="nav-item">-->
<!--        <a href="dashboard.html" class="nav-link" data-page="dashboard">-->
<!--          <i class="fas fa-th-large"></i>-->
<!--          <span>Dashboard</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="alerts.html" class="nav-link" data-page="alerts">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--          <span>Alerts &amp; Incidents</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown expanded" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-shield-alt"></i>-->
<!--          <span>Policies</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu open">-->
<!--          <a href="manage-agents.html" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>-->
<!--          <a href="file-policies.html" class="sub-menu-item" data-page="file-policies">File Policies</a>-->
<!--          <a href="assign-policy.html" class="sub-menu-item active" data-page="assign-policy">Assign Policy</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <a href="agents.html" class="nav-link" data-page="agents">-->
<!--          <i class="fas fa-desktop"></i>-->
<!--          <span>Agents / Endpoints</span>-->
<!--        </a>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-eye"></i>-->
<!--          <span>OCR &amp; Image Analysis</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="ocr-dashboard.html" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>-->
<!--          <a href="ocr-policies.html" class="sub-menu-item" data-page="ocr-policies">OCR Policies</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-file-lines"></i>-->
<!--          <span>Reports &amp; Logs</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="reports.html" class="sub-menu-item" data-page="reports">Reports</a>-->
<!--          <a href="generate-report.html" class="sub-menu-item" data-page="generate-report">Generate Report</a>-->
<!--          <a href="audit-logs.html" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>-->
<!--          <a href="device-logs.html" class="sub-menu-item" data-page="device-logs">Device Logs</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-users"></i>-->
<!--          <span>Users &amp; Roles</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="users.html" class="sub-menu-item" data-page="users">Users</a>-->
<!--          <a href="roles.html" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>-->
<!--          <a href="permissions.html" class="sub-menu-item" data-page="permissions">Permissions</a>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="nav-item">-->
<!--        <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">-->
<!--          <i class="fas fa-gear"></i>-->
<!--          <span>Settings</span>-->
<!--          <i class="fas fa-chevron-down chevron-icon"></i>-->
<!--        </div>-->
<!--        <div class="sub-menu">-->
<!--          <a href="general.html" class="sub-menu-item" data-page="general">General</a>-->
<!--          <a href="security.html" class="sub-menu-item" data-page="security">Security</a>-->
<!--          <a href="integrations.html" class="sub-menu-item" data-page="integrations">Integrations</a>-->
<!--          <a href="data-retention.html" class="sub-menu-item" data-page="data-retention">Data Retention</a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </nav>-->

<!--    <div class="sidebar-footer">-->
<!--      <button class="collapse-btn" onclick="toggleSidebar()">-->
<!--        <i class="fas fa-chevron-left"></i>-->
<!--        <span>Collapse</span>-->
<!--      </button>-->
<!--    </div>-->
<!--  </aside>-->

<!--  &lt;!&ndash; Mobile Overlay (for sidebar) &ndash;&gt;-->
<!--  <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>-->

<!--  &lt;!&ndash; ==================== HEADER ==================== &ndash;&gt;-->
<!--  <header class="top-header" id="topHeader">-->
<!--    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">-->
<!--      <i class="fas fa-bars"></i>-->
<!--    </button>-->

<!--    <div class="search-bar">-->
<!--      <i class="fas fa-search"></i>-->
<!--      <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />-->
<!--    </div>-->

<!--    <div class="header-actions">-->
<!--      <button class="notification-btn" onclick="toggleNotifications(event)">-->
<!--        <i class="fas fa-bell"></i>-->
<!--        <span class="notification-badge" id="alertBadge">5</span>-->
<!--      </button>-->

<!--      <div class="user-profile" onclick="toggleUserDropdown(event)">-->
<!--        <div class="user-avatar">A</div>-->
<!--        <div class="user-info">-->
<!--          <div class="user-name">Admin</div>-->
<!--          <div class="user-role">Security Admin</div>-->
<!--        </div>-->
<!--        <i class="fas fa-chevron-down dropdown-icon"></i>-->

<!--        <div class="user-dropdown" id="userDropdown">-->
<!--          <a href="general.html" class="dropdown-item">-->
<!--            <i class="fas fa-gear"></i>-->
<!--            <span>Settings</span>-->
<!--          </a>-->
<!--          <a href="#" class="dropdown-item">-->
<!--            <i class="fas fa-circle-question"></i>-->
<!--            <span>Help &amp; Support</span>-->
<!--          </a>-->
<!--          <div class="dropdown-divider"></div>-->
<!--          <a href="index.html" class="dropdown-item danger" onclick="logout(event)">-->
<!--            <i class="fas fa-right-from-bracket"></i>-->
<!--            <span>Sign out</span>-->
<!--          </a>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </header>-->

<!--  &lt;!&ndash; ==================== NOTIFICATIONS PANEL ==================== &ndash;&gt;-->
<!--  <div class="notifications-panel" id="notificationsPanel">-->
<!--    <div class="notifications-header">-->
<!--      <h3>Notifications</h3>-->
<!--      <button class="close-notifications" onclick="closeNotifications()">-->
<!--        <i class="fas fa-times"></i>-->
<!--      </button>-->
<!--    </div>-->

<!--    <div class="notifications-tabs">-->
<!--      <button class="tab-btn active" onclick="switchTab(event, 'all')">All (5)</button>-->
<!--      <button class="tab-btn" onclick="switchTab(event, 'unread')">Unread (3)</button>-->
<!--    </div>-->

<!--    <div class="notifications-content" id="notificationsContent">-->
<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon critical">-->
<!--          <i class="fas fa-shield-exclamation"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Critical Policy Violation</div>-->
<!--          <div class="notification-text">User attempted to copy sensitive files to USB drive</div>-->
<!--          <div class="notification-time">2 minutes ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon warning">-->
<!--          <i class="fas fa-triangle-exclamation"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Agent Offline</div>-->
<!--          <div class="notification-text">DESKTOP-DEF456 has been offline for 2 hours</div>-->
<!--          <div class="notification-time">15 minutes ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item unread">-->
<!--        <div class="notification-icon info">-->
<!--          <i class="fas fa-info-circle"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Policy Updated</div>-->
<!--          <div class="notification-text">File Protection Policy has been modified by Admin</div>-->
<!--          <div class="notification-time">1 hour ago</div>-->
<!--        </div>-->
<!--        <div class="notification-dot"></div>-->
<!--      </div>-->

<!--      <div class="notification-item">-->
<!--        <div class="notification-icon success">-->
<!--          <i class="fas fa-check-circle"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Agent Connected</div>-->
<!--          <div class="notification-text">New agent LAPTOP-XYZ789 successfully registered</div>-->
<!--          <div class="notification-time">3 hours ago</div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="notification-item">-->
<!--        <div class="notification-icon info">-->
<!--          <i class="fas fa-file-alt"></i>-->
<!--        </div>-->
<!--        <div class="notification-body">-->
<!--          <div class="notification-title">Report Generated</div>-->
<!--          <div class="notification-text">Weekly security report is ready for review</div>-->
<!--          <div class="notification-time">5 hours ago</div>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->

<!--    <div class="notifications-footer">-->
<!--      <a href="alerts.html" class="view-all-btn">View All Notifications</a>-->
<!--    </div>-->
<!--  </div>-->

<!--  &lt;!&ndash; Notification Overlay &ndash;&gt;-->
<!--  <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>-->

<!--  &lt;!&ndash; Main Content &ndash;&gt;-->
<!--  <main class="main-content" id="mainContent">-->
<!--    <div class="content-area">-->
<!--      <div class="breadcrumb">-->
<!--        <a href="dashboard.html"><i class="fas fa-home"></i></a>-->
<!--        <span>/</span>-->
<!--        <a href="file-policies.html">Policies</a>-->
<!--        <span>/</span>-->
<!--        <span>Assign Policy</span>-->
<!--      </div>-->

<!--      <div class="page-header">-->
<!--        <div class="page-title-section">-->
<!--          <div class="page-icon"><i class="fas fa-user-shield"></i></div>-->
<!--          <div class="page-title-text">-->
<!--            <h1>Assign Policy to Agents</h1>-->
<!--            <p class="page-subtitle">Select agents and assign protection policies</p>-->
<!--          </div>-->
<!--        </div>-->
<!--      </div>-->

<!--      <div class="assign-container">-->
<!--        <div class="step-indicator">-->
<!--          <div class="step active" data-step="1">-->
<!--            <div class="step-circle">1</div>-->
<!--            <div class="step-label">Choose Agent</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="2">-->
<!--            <div class="step-circle">2</div>-->
<!--            <div class="step-label">Policy Type</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="3">-->
<!--            <div class="step-circle">3</div>-->
<!--            <div class="step-label">Configure Policy</div>-->
<!--          </div>-->
<!--          <div class="step" data-step="4">-->
<!--            <div class="step-circle">4</div>-->
<!--            <div class="step-label">Review & Apply</div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 1: Choose Agent &ndash;&gt;-->
<!--        <div id="step1">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 1: Choose Agent</div>-->
<!--            <div class="section-desc">Select the agents you want to assign a policy to</div>-->

<!--            <div class="search-box">-->
<!--              <i class="fas fa-search"></i>-->
<!--              <input type="text" class="search-input" placeholder="Search agents by name, user, or IP..." id="agentSearch" />-->
<!--            </div>-->

<!--            <div class="selected-count" id="selectedCount">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>0 agents selected</span>-->
<!--            </div>-->

<!--            <div class="agents-grid" id="agentsGrid">-->
<!--              &lt;!&ndash; Agent cards will be dynamically generated &ndash;&gt;-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Select at least one agent to continue</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 2: Policy Type &ndash;&gt;-->
<!--        <div id="step2" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 2: Select Policy Type</div>-->
<!--            <div class="section-desc">Choose the type of policy you want to assign</div>-->

<!--            <div class="form-group">-->
<!--              <label class="form-label">Policy Type</label>-->
<!--              <select class="form-select" id="policyType">-->
<!--                <option value="">&#45;&#45; Select Policy Type &#45;&#45;</option>-->
<!--                <option value="NETWORK">Network Policy</option>-->
<!--                <option value="FILE">File Protection</option>-->
<!--                <option value="USB">USB Control</option>-->
<!--                <option value="SECURITY_MONITOR">OCR & Security Monitor</option>-->
<!--              </select>-->
<!--            </div>-->

<!--            <div class="alert alert-info">-->
<!--              <i class="fas fa-info-circle"></i>-->
<!--              <span>Different policy types provide different protection mechanisms</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 3: Configure Policy &ndash;&gt;-->
<!--        <div id="step3" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 3: Configure Policy</div>-->
<!--            <div class="section-desc" id="step3Description">Configure the specific settings for your selected policy type</div>-->

<!--            &lt;!&ndash; FILE PROTECTION UI (Comprehensive) &ndash;&gt;-->
<!--            <div id="fileProtectionUI" style="display: none;">-->
<!--              &lt;!&ndash; Selected Path Info &ndash;&gt;-->
<!--              <div class="selected-path-info" id="selectedPathInfo" style="display: none;">-->
<!--                <div class="path-label">Selected Path:</div>-->
<!--                <div class="path-value" id="selectedPathValue">-</div>-->
<!--              </div>-->

<!--              &lt;!&ndash; File Explorer &ndash;&gt;-->
<!--              <div class="file-explorer-container">-->
<!--                <div class="explorer-header">-->
<!--                  <button class="explorer-btn" id="btnGetDrives" onclick="getDrives()">-->
<!--                    <i class="fas fa-hdd"></i> Get Drives-->
<!--                  </button>-->
<!--                  <button class="explorer-btn" id="btnRefresh" onclick="refreshExplorer()" disabled>-->
<!--                    <i class="fas fa-sync-alt"></i> Refresh-->
<!--                  </button>-->
<!--                  <div style="flex:1;"></div>-->
<!--                  <button class="explorer-btn" id="btnClearSelection" onclick="clearSelection()">-->
<!--                    <i class="fas fa-times"></i> Clear-->
<!--                  </button>-->
<!--                </div>-->
<!--                <div class="tree-container" id="treeContainer">-->
<!--                  <div class="loading">Click "Get Drives" to load file system</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Active Policies for Selected Node &ndash;&gt;-->
<!--              <div class="active-policies-section" id="activePoliciesSection" style="display: none;">-->
<!--                <div class="section-title" style="display: flex; align-items: center; gap: 8px;">-->
<!--                  <i class="fas fa-shield-alt" style="color: #2563eb;"></i>-->
<!--                  <span>Active Policies on Selected Resource</span>-->
<!--                </div>-->
<!--                <div class="policies-list" id="selectedNodePolicies">-->
<!--                  <div class="loading">Loading policies...</div>-->
<!--                </div>-->
<!--                <div class="alert alert-info" id="noPoliciesMsg" style="display: none; margin-top: 10px;">-->
<!--                  <i class="fas fa-info-circle"></i>-->
<!--                  <span>No active policies on this resource</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Remove Policy Container &ndash;&gt;-->
<!--              <div class="remove-policy-container" id="removePolicyContainer" style="display: none;">-->
<!--                <div class="alert alert-warning" style="display: flex; justify-content: space-between; align-items: center;">-->
<!--                  <div style="display: flex; align-items: center; gap: 10px;">-->
<!--                    <i class="fas fa-exclamation-triangle"></i>-->
<!--                    <span><strong>Policy Already Exists</strong> - This resource already has protection policies applied.</span>-->
<!--                  </div>-->
<!--                  <button class="btn btn-danger" onclick="showRemovePolicyModal()" style="width: auto;">-->
<!--                    <i class="fas fa-trash-alt"></i> Remove Policy-->
<!--                  </button>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; Operations Selection &ndash;&gt;-->
<!--              <div class="section-title mt-20">Block Operations</div>-->
<!--              <div class="operations-list">-->
<!--                <div class="operation-item" id="read-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-read" data-operation="read">-->
<!--                  <div class="operation-label">READ</div>-->
<!--                  <div class="operation-desc">Open, view, read content</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="write-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-write" data-operation="write">-->
<!--                  <div class="operation-label">WRITE</div>-->
<!--                  <div class="operation-desc">Modify, edit, save changes</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="delete-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-delete" data-operation="delete">-->
<!--                  <div class="operation-label">DELETE</div>-->
<!--                  <div class="operation-desc">Remove, trash, permanently delete</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="rename-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-rename" data-operation="rename">-->
<!--                  <div class="operation-label">RENAME</div>-->
<!--                  <div class="operation-desc">Change name, move within volume</div>-->
<!--                </div>-->
<!--                <div class="operation-item" id="create-operation">-->
<!--                  <input type="checkbox" class="operation-checkbox" id="cb-create" data-operation="create">-->
<!--                  <div class="operation-label">CREATE</div>-->
<!--                  <div class="operation-desc">New file/folder creation (folders only)</div>-->
<!--                </div>-->
<!--              </div>-->

<!--              <div class="read-block-all" id="readBlockAllWarning">-->
<!--                <i class="fas fa-exclamation-triangle"></i>-->
<!--                <span>READ = BLOCK ALL ACCESS - All other operations will be automatically blocked</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; NETWORK POLICY UI (Original) &ndash;&gt;-->
<!--            <div id="networkUI" style="display: none;">-->
<!--              <div id="dnsInputContainer">-->
<!--                <div class="domain-input-container">-->
<!--                  <label class="form-label">Block Domains</label>-->
<!--                  <div class="domain-input-group">-->
<!--                    <input type="text" class="domain-input" id="domainInput" placeholder="Enter domain (e.g., www.example.com)" />-->
<!--                    <button class="btn-add-domain" onclick="addDomain()">-->
<!--                      <i class="fas fa-plus"></i> Add-->
<!--                    </button>-->
<!--                  </div>-->
<!--                  <div class="domain-tags" id="domainTags"></div>-->
<!--                </div>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; FILE INFO (Original Simple) - Kept for backward compatibility &ndash;&gt;-->
<!--            <div id="fileProtectionInfo" style="display: none;">-->
<!--              <div class="alert alert-info">-->
<!--                <i class="fas fa-shield-alt"></i>-->
<!--                <span>File Protection policy will block unauthorized file transfers</span>-->
<!--              </div>-->
<!--            </div>-->

<!--            &lt;!&ndash; OCR INFO (Original) &ndash;&gt;-->
<!--            <div id="ocrInfo" style="display: none;">-->
<!--              <div class="alert alert-info">-->
<!--                <i class="fas fa-eye"></i>-->
<!--                <span>OCR policy will scan and analyze text in images and documents</span>-->
<!--              </div>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; STEP 4: Review & Apply &ndash;&gt;-->
<!--        <div id="step4" style="display: none">-->
<!--          <div class="section">-->
<!--            <div class="section-title">Step 4: Review & Apply</div>-->
<!--            <div class="section-desc">Verify the policy assignment before applying</div>-->

<!--            <div class="summary-box">-->
<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Agents Selected</span>-->
<!--                <span class="summary-value" id="summaryAgentCount">0</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Policy Type</span>-->
<!--                <span class="summary-value" id="summaryPolicyType">-</span>-->
<!--              </div>-->

<!--              <div class="summary-row">-->
<!--                <span class="summary-label">Policy Name</span>-->
<!--                <span class="summary-value" id="summaryPolicyName">-</span>-->
<!--              </div>-->

<!--              &lt;!&ndash; File Protection Summary &ndash;&gt;-->
<!--              <div id="fileSummaryContainer" style="display: none;">-->
<!--                <div class="summary-row">-->
<!--                  <span class="summary-label">Protected Path</span>-->
<!--                  <span class="summary-value" id="summaryPath">-</span>-->
<!--                </div>-->
<!--                <div class="summary-row">-->
<!--                  <span class="summary-label">Resource Type</span>-->
<!--                  <span class="summary-value" id="summaryResourceType">-</span>-->
<!--                </div>-->
<!--                <div class="summary-row">-->
<!--                  <span class="summary-label">Blocked Operations</span>-->
<!--                  <span class="summary-value" id="summaryOperations">-</span>-->
<!--                </div>-->
<!--                <div class="summary-row" id="summaryBlockAllRow" style="display: none;">-->
<!--                  <span class="summary-label text-error">âš ï¸ Effect</span>-->
<!--                  <span class="summary-value text-error">ALL ACCESS BLOCKED</span>-->
<!--                </div>-->
<!--              </div>-->

<!--              &lt;!&ndash; DNS Domains Summary &ndash;&gt;-->
<!--              <div id="summaryDomainsContainer" style="display: none;">-->
<!--                <div class="summary-row" style="border-bottom: none; padding-bottom: 5px">-->
<!--                  <span class="summary-label">Blocked Domains</span>-->
<!--                  <span class="summary-value" style="display: flex; align-items: center; gap: 10px;">-->
<!--                                        <span id="summaryDomainsCount">0</span> domains-->
<!--                                    </span>-->
<!--                </div>-->
<!--                <div class="domain-tags" id="summaryDomainTags" style="margin-top: 5px; margin-bottom: 10px; padding-left: 20px;"></div>-->
<!--              </div>-->
<!--            </div>-->

<!--            <div class="alert alert-success" style="margin-top: 20px" id="successAlert">-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>The policy will be applied to all selected agents within 5 minutes.</span>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

<!--        <div class="btn-group">-->
<!--          <button class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none">-->
<!--            <i class="fas fa-arrow-left"></i><span>Previous</span>-->
<!--          </button>-->
<!--          <button class="btn btn-secondary" onclick="window.location.href = 'file-policies.html'">-->
<!--            <i class="fas fa-times"></i><span>Cancel</span>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">-->
<!--            <span>Next</span><i class="fas fa-arrow-right"></i>-->
<!--          </button>-->
<!--          <button class="btn btn-primary" onclick="applyPolicy()" id="applyBtn" style="display: none">-->
<!--            <i class="fas fa-check"></i><span>Apply Policy</span>-->
<!--          </button>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </main>-->
<!--</div>-->

<!--&lt;!&ndash; Remove Policy Modal &ndash;&gt;-->
<!--<div class="modal-overlay" id="removePolicyModal">-->
<!--  <div class="modal">-->
<!--    <div class="modal-header">-->
<!--      <h3>Remove Policy</h3>-->
<!--      <button class="modal-close" onclick="closeRemovePolicyModal()">-->
<!--        <i class="fas fa-times"></i>-->
<!--      </button>-->
<!--    </div>-->
<!--    <div class="modal-body">-->
<!--      <p>Type <strong>REMOVE</strong> to confirm policy removal:</p>-->
<!--      <div style="margin: 15px 0;" id="removeModalDetails"></div>-->
<!--      <input type="text" class="domain-input" id="removeConfirmInput" placeholder="Type REMOVE to confirm" style="width: 100%;">-->
<!--    </div>-->
<!--    <div class="modal-footer">-->
<!--      <button class="btn btn-secondary" onclick="closeRemovePolicyModal()">Cancel</button>-->
<!--      <button class="btn btn-danger" onclick="removeSelectedPolicy()" id="confirmRemoveBtn" disabled>Remove Policy</button>-->
<!--    </div>-->
<!--  </div>-->
<!--</div>-->

<!--<script>-->
<!--  /* ==================== AUTHENTICATION & USER DATA ==================== */-->
<!--  async function checkAuth() {-->
<!--      try {-->
<!--          const response = await fetch("/api/auth/check", {-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error("Not authenticated");-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (!result.success) {-->
<!--              window.location.href = "index.html";-->
<!--              return null;-->
<!--          }-->

<!--          if (result.data) {-->
<!--              localStorage.setItem("userData", JSON.stringify(result.data));-->
<!--              return result.data;-->
<!--          }-->

<!--          return null;-->
<!--      } catch (err) {-->
<!--          window.location.href = "index.html";-->
<!--          return null;-->
<!--      }-->
<!--  }-->

<!--  function loadAdminInfo() {-->
<!--      const userDataStr = localStorage.getItem("userData");-->

<!--      if (userDataStr) {-->
<!--          try {-->
<!--              const userData = JSON.parse(userDataStr);-->

<!--              const userName = document.querySelector(".user-name");-->
<!--              const userAvatar = document.querySelector(".user-avatar");-->
<!--              const userRole = document.querySelector(".user-role");-->

<!--              if (userName) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const formattedName = namePart.split(".").map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(" ");-->
<!--                  userName.textContent = formattedName;-->
<!--              }-->

<!--              if (userAvatar) {-->
<!--                  const namePart = userData.username || "Admin";-->
<!--                  const initials = namePart.split(".").map(n => (n[0] ? n[0].toUpperCase() : "")).join("");-->
<!--                  userAvatar.textContent = initials || "A";-->
<!--              }-->

<!--              if (userRole) {-->
<!--                  userRole.textContent = userData.role || "Security Admin";-->
<!--              }-->
<!--          } catch (e) {-->
<!--              console.error("Error parsing user data:", e);-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  async function refreshUserData() {-->
<!--      const userData = await checkAuth();-->
<!--      if (userData) {-->
<!--          localStorage.setItem("userData", JSON.stringify(userData));-->
<!--          loadAdminInfo();-->
<!--      }-->
<!--  }-->

<!--  setInterval(refreshUserData, 5 * 60 * 1000);-->

<!--  /* ==================== SIDEBAR FUNCTIONS ==================== */-->
<!--  function toggleSubMenu(element) {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      if (sidebar.classList.contains("collapsed")) return;-->

<!--      var subMenu = element.nextElementSibling;-->
<!--      var allSubMenus = document.querySelectorAll(".sub-menu");-->
<!--      var allDropdowns = document.querySelectorAll(".nav-dropdown");-->

<!--      allSubMenus.forEach(function(menu) {-->
<!--          if (menu !== subMenu) menu.classList.remove("open");-->
<!--      });-->
<!--      allDropdowns.forEach(function(link) {-->
<!--          if (link !== element) link.classList.remove("expanded");-->
<!--      });-->

<!--      element.classList.toggle("expanded");-->
<!--      subMenu.classList.toggle("open");-->
<!--  }-->

<!--  function toggleSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var mainContent = document.getElementById("mainContent");-->
<!--      var header = document.getElementById("topHeader");-->

<!--      sidebar.classList.toggle("collapsed");-->
<!--      var isCollapsed = sidebar.classList.contains("collapsed");-->

<!--      if (mainContent) mainContent.classList.toggle("expanded");-->

<!--      if (header) {-->
<!--          header.style.left = isCollapsed ? "70px" : "240px";-->
<!--      }-->

<!--      if (isCollapsed) {-->
<!--          document.querySelectorAll(".sub-menu").forEach(function(m) {-->
<!--              m.classList.remove("open");-->
<!--          });-->
<!--          document.querySelectorAll(".nav-dropdown").forEach(function(l) {-->
<!--              l.classList.remove("expanded");-->
<!--          });-->
<!--      }-->

<!--      window.dispatchEvent(-->
<!--          new CustomEvent("sidebarToggle", {-->
<!--              detail: { collapsed: isCollapsed },-->
<!--          })-->
<!--      );-->
<!--  }-->

<!--  function openMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.add("mobile-open");-->
<!--      if (overlay) overlay.classList.add("active");-->
<!--  }-->

<!--  function closeMobileSidebar() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (sidebar) sidebar.classList.remove("mobile-open");-->
<!--      if (overlay) overlay.classList.remove("active");-->
<!--  }-->

<!--  function toggleMobileMenu() {-->
<!--      var sidebar = document.getElementById("sidebar");-->
<!--      var overlay = document.getElementById("sidebarOverlay");-->
<!--      if (!sidebar) return;-->

<!--      if (sidebar.classList.contains("mobile-open")) {-->
<!--          closeMobileSidebar();-->
<!--      } else {-->
<!--          openMobileSidebar();-->
<!--      }-->
<!--  }-->

<!--  function setActiveMenuItem() {-->
<!--      var currentPage = window.location.pathname.split('/').pop() || 'assign-policy.html';-->

<!--      document.querySelectorAll('.nav-link, .sub-menu-item').forEach(function(el) {-->
<!--          el.classList.remove('active');-->
<!--      });-->

<!--      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function(item) {-->
<!--          var href = item.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              item.classList.add('active');-->
<!--              var parentSubMenu = item.closest('.sub-menu');-->
<!--              if (parentSubMenu) {-->
<!--                  parentSubMenu.classList.add('open');-->
<!--                  var parentNav = parentSubMenu.previousElementSibling;-->
<!--                  if (parentNav) parentNav.classList.add('expanded');-->
<!--              }-->
<!--          }-->
<!--      });-->

<!--      document.querySelectorAll('.nav-link[data-page]').forEach(function(link) {-->
<!--          var href = link.getAttribute('href');-->
<!--          if (href === currentPage) {-->
<!--              link.classList.add('active');-->
<!--          }-->
<!--      });-->
<!--  }-->

<!--  /* ==================== HEADER FUNCTIONS ==================== */-->
<!--  function toggleNotifications(event) {-->
<!--      event.stopPropagation();-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = event.currentTarget;-->
<!--      if (!panel || !overlay) return;-->

<!--      if (panel.classList.contains("show")) {-->
<!--          closeNotifications();-->
<!--      } else {-->
<!--          closeUserDropdown();-->
<!--          panel.classList.add("show");-->
<!--          overlay.classList.add("show");-->
<!--          btn.classList.add("active");-->
<!--          document.body.style.overflow = "hidden";-->
<!--      }-->
<!--  }-->

<!--  function closeNotifications() {-->
<!--      var panel = document.getElementById("notificationsPanel");-->
<!--      var overlay = document.getElementById("notificationOverlay");-->
<!--      var btn = document.querySelector(".notification-btn");-->
<!--      if (panel) panel.classList.remove("show");-->
<!--      if (overlay) overlay.classList.remove("show");-->
<!--      if (btn) btn.classList.remove("active");-->
<!--      document.body.style.overflow = "";-->
<!--  }-->

<!--  function switchTab(event, tabName) {-->
<!--      document.querySelectorAll(".tab-btn").forEach(function(t) {-->
<!--          t.classList.remove("active");-->
<!--      });-->
<!--      event.currentTarget.classList.add("active");-->

<!--      document.querySelectorAll(".notification-item").forEach(function(item) {-->
<!--          item.style.display =-->
<!--              tabName === "unread" && !item.classList.contains("unread") ? "none" : "flex";-->
<!--      });-->
<!--  }-->

<!--  function toggleUserDropdown(event) {-->
<!--      event.stopPropagation();-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = event.currentTarget;-->
<!--      if (!dropdown) return;-->

<!--      if (dropdown.classList.contains("show")) {-->
<!--          closeUserDropdown();-->
<!--      } else {-->
<!--          closeNotifications();-->
<!--          dropdown.classList.add("show");-->
<!--          userProfile.classList.add("active");-->
<!--      }-->
<!--  }-->

<!--  function closeUserDropdown() {-->
<!--      var dropdown = document.getElementById("userDropdown");-->
<!--      var userProfile = document.querySelector(".user-profile");-->
<!--      if (dropdown) dropdown.classList.remove("show");-->
<!--      if (userProfile) userProfile.classList.remove("active");-->
<!--  }-->

<!--  function logout(event) {-->
<!--      event.preventDefault();-->
<!--      window.location.href = "/logout";-->
<!--  }-->

<!--  document.addEventListener("click", function(event) {-->
<!--      if (!event.target.closest(".user-profile")) {-->
<!--          closeUserDropdown();-->
<!--      }-->
<!--      if (-->
<!--          !event.target.closest(".notification-btn") &&-->
<!--          !event.target.closest(".notifications-panel")-->
<!--      ) {-->
<!--          closeNotifications();-->
<!--      }-->
<!--  });-->

<!--  /* ==================== ASSIGN POLICY STATE ==================== */-->
<!--  let selectedAgents = new Set();-->
<!--  let agentsBasicData = {};-->
<!--  let agentsCapabilities = {};-->
<!--  let currentStep = 1;-->
<!--  let selectedPolicyType = "";-->
<!--  let selectedPolicy = "";-->
<!--  let blockedDomains = [];-->
<!--  let isEditingExistingPolicy = false;-->
<!--  let statusRefreshInterval;-->

<!--  // File Protection State-->
<!--  let treeData = {};-->
<!--  let selectedNode = null;-->
<!--  let operations = {-->
<!--      read: false,-->
<!--      write: false,-->
<!--      delete: false,-->
<!--      rename: false,-->
<!--      create: false-->
<!--  };-->
<!--  let activeNodePolicies = [];-->
<!--  let policyToRemove = null;-->
<!--  let currentlyExpanding = new Set();-->

<!--  /* ==================== AGENT FUNCTIONS ==================== */-->
<!--  function startStatusRefresh() {-->
<!--      if (statusRefreshInterval) {-->
<!--          clearInterval(statusRefreshInterval);-->
<!--      }-->
<!--      statusRefreshInterval = setInterval(async () => {-->
<!--          console.log("Refreshing agent status...");-->
<!--          await refreshAllAgents();-->
<!--      }, 10000);-->
<!--  }-->

<!--  async function refreshAllAgents() {-->
<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error("Failed to fetch agents");-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (result.success && result.data) {-->
<!--              const agents = result.data;-->
<!--              agents.forEach((agent) => {-->
<!--                  agentsBasicData[agent.id] = agent;-->
<!--              });-->
<!--              await initializeAgentCards();-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error("Error refreshing agents:", error);-->
<!--      }-->
<!--  }-->

<!--  async function initializeAgentCards() {-->
<!--      const agentsGrid = document.getElementById("agentsGrid");-->
<!--      if (!agentsGrid) return;-->

<!--      agentsGrid.innerHTML = '<div class="loading">Loading agents...</div>';-->

<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error("Failed to fetch agents");-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (!result.success || !result.data) {-->
<!--              throw new Error(result.message || "No agents found");-->
<!--          }-->

<!--          const agents = result.data;-->
<!--          agentsGrid.innerHTML = "";-->

<!--          agents.forEach((agent) => {-->
<!--              const agentCard = document.createElement("div");-->
<!--              agentCard.className = "agent-card";-->
<!--              agentCard.dataset.id = agent.id;-->
<!--              agentCard.onclick = () => toggleAgent(agent.id);-->

<!--              agentCard.innerHTML = `-->
<!--                  <div class="agent-card-header">-->
<!--                      <input type="checkbox" class="agent-checkbox" ${selectedAgents.has(agent.id) ? "checked" : ""}>-->
<!--                      <div class="agent-name">${agent.username}</div>-->
<!--                      <span class="agent-status ${isAgentOnline(agent) ? "status-online" : "status-offline"}">-->
<!--                          ${isAgentOnline(agent) ? "ONLINE" : "OFFLINE"}-->
<!--                      </span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fas fa-user"></i> ${agent.hostname || agent.username}</span>-->
<!--                      <span><i class="fas fa-id-badge"></i> ${agent.id}</span>-->
<!--                  </div>-->
<!--                  <div class="agent-info">-->
<!--                      <span><i class="fab fa-${getOSIcon(agent.osType)}"></i> ${agent.osType || "Unknown OS"}</span>-->
<!--                      <span><i class="fas fa-network-wired"></i> ${agent.ipAddress || "N/A"}</span>-->
<!--                  </div>-->
<!--              `;-->

<!--              agentsGrid.appendChild(agentCard);-->

<!--              if (selectedAgents.has(agent.id)) {-->
<!--                  agentCard.classList.add("selected");-->
<!--                  agentCard.querySelector(".agent-checkbox").checked = true;-->
<!--              }-->
<!--          });-->
<!--      } catch (error) {-->
<!--          console.error("Error loading agents:", error);-->
<!--          agentsGrid.innerHTML = `<div class="error">Error loading agents: ${error.message}</div>`;-->
<!--      }-->

<!--      updateSelectedCount();-->
<!--  }-->

<!--  function isAgentOnline(agent) {-->
<!--      if (agent.agentRuntimeState && agent.agentRuntimeState.toUpperCase() === "ONLINE") {-->
<!--          return true;-->
<!--      }-->

<!--      if (agent.lastHeartbeat) {-->
<!--          const lastHeartbeat = new Date(agent.lastHeartbeat).getTime();-->
<!--          const now = new Date();-->
<!--          const diffMinutes = Math.floor((now - lastHeartbeat) / 1000);-->
<!--          return diffMinutes <= 10;-->
<!--      }-->

<!--      return false;-->
<!--  }-->

<!--  function getOSIcon(os) {-->
<!--      if (!os) return "desktop";-->
<!--      const osLower = os.toLowerCase();-->
<!--      if (osLower.includes("windows")) return "windows";-->
<!--      if (osLower.includes("macos") || osLower.includes("mac")) return "apple";-->
<!--      if (osLower.includes("ubuntu") || osLower.includes("linux")) return "linux";-->
<!--      return "desktop";-->
<!--  }-->

<!--  async function toggleAgent(agentId) {-->
<!--      if (selectedAgents.has(agentId)) {-->
<!--          selectedAgents.delete(agentId);-->
<!--          delete agentsCapabilities[agentId];-->
<!--      } else {-->
<!--          selectedAgents.add(agentId);-->
<!--          if (!agentsCapabilities[agentId]) {-->
<!--              try {-->
<!--                  await fetchAgentDetails(agentId);-->
<!--              } catch (error) {-->
<!--                  console.error(`Failed to fetch capabilities for agent ${agentId}:`, error);-->
<!--                  agentsCapabilities[agentId] = {};-->
<!--              }-->
<!--          }-->
<!--      }-->

<!--      const agentCard = document.querySelector(`.agent-card[data-id="${agentId}"]`);-->
<!--      if (agentCard) {-->
<!--          agentCard.classList.toggle("selected");-->
<!--          const checkbox = agentCard.querySelector(".agent-checkbox");-->
<!--          if (checkbox) {-->
<!--              checkbox.checked = selectedAgents.has(agentId);-->
<!--          }-->
<!--      }-->

<!--      updateSelectedCount();-->
<!--  }-->

<!--  async function fetchAgentDetails(agentId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/agents/${agentId}/capabilities`, {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error(`HTTP ${response.status}: Failed to fetch capabilities`);-->
<!--          }-->

<!--          const result = await response.json();-->

<!--          if (result.success && result.data) {-->
<!--              agentsCapabilities[agentId] = result.data;-->
<!--          } else {-->
<!--              throw new Error(result.message || "Failed to load capabilities");-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error(`Error fetching capabilities for agent ${agentId}:`, error);-->
<!--          agentsCapabilities[agentId] = {};-->
<!--          throw error;-->
<!--      }-->
<!--  }-->

<!--  async function fetchAgentSimpleDetails() {-->
<!--      try {-->
<!--          const response = await fetch("/api/admin/agents", {-->
<!--              headers: { "Content-Type": "application/json" },-->
<!--              credentials: "include",-->
<!--          });-->

<!--          if (!response.ok) throw new Error("Failed to fetch agents");-->

<!--          const result = await response.json();-->
<!--          if (result.success && result.data) {-->
<!--              result.data.forEach((agent) => {-->
<!--                  agentsBasicData[agent.id] = agent;-->
<!--              });-->
<!--          }-->
<!--      } catch (error) {-->
<!--          console.error("Error fetching agents:", error);-->
<!--      }-->
<!--  }-->

<!--  function updateSelectedCount() {-->
<!--      const count = selectedAgents.size;-->
<!--      const selectedCountElement = document.getElementById("selectedCount");-->
<!--      if (selectedCountElement) {-->
<!--          selectedCountElement.innerHTML = `-->
<!--              <i class="fas fa-check-circle"></i>-->
<!--              <span>${count} agent${count !== 1 ? "s" : ""} selected</span>-->
<!--          `;-->
<!--      }-->
<!--  }-->

<!--  document.addEventListener("input", function(e) {-->
<!--      if (e.target && e.target.id === "agentSearch") {-->
<!--          const searchTerm = e.target.value.toLowerCase();-->
<!--          const agentCards = document.querySelectorAll(".agent-card");-->

<!--          agentCards.forEach((card) => {-->
<!--              const text = card.textContent.toLowerCase();-->
<!--              card.style.display = text.includes(searchTerm) ? "block" : "none";-->
<!--          });-->
<!--      }-->
<!--  });-->

<!--  document.addEventListener("change", function(e) {-->
<!--      if (e.target && e.target.id === "policyType") {-->
<!--          selectedPolicyType = e.target.value;-->
<!--          updatePolicyOptions();-->
<!--      }-->

<!--      if (e.target && e.target.id === "policySelect") {-->
<!--          selectedPolicy = e.target.value;-->
<!--      }-->
<!--  });-->

<!--  function updatePolicyOptions() {-->
<!--      const fileProtectionUI = document.getElementById("fileProtectionUI");-->
<!--      const networkUI = document.getElementById("networkUI");-->
<!--      const fileProtectionInfo = document.getElementById("fileProtectionInfo");-->
<!--      const ocrInfo = document.getElementById("ocrInfo");-->
<!--      const dnsInputContainer = document.getElementById("dnsInputContainer");-->
<!--      const step3Description = document.getElementById("step3Description");-->

<!--      // Hide all first-->
<!--      if (fileProtectionUI) fileProtectionUI.style.display = "none";-->
<!--      if (networkUI) networkUI.style.display = "none";-->
<!--      if (fileProtectionInfo) fileProtectionInfo.style.display = "none";-->
<!--      if (ocrInfo) ocrInfo.style.display = "none";-->
<!--      if (dnsInputContainer) dnsInputContainer.style.display = "none";-->

<!--      // Show based on policy type-->
<!--      if (selectedPolicyType === "FILE") {-->
<!--          if (fileProtectionUI) {-->
<!--              fileProtectionUI.style.display = "block";-->
<!--              step3Description.textContent = "Select files/folders and choose operations to block";-->
<!--              // Initialize file explorer if not already loaded-->
<!--              if (Object.keys(treeData).length === 0) {-->
<!--                  getDrives();-->
<!--              }-->
<!--          }-->
<!--      } else if (selectedPolicyType === "NETWORK") {-->
<!--          if (networkUI) {-->
<!--              networkUI.style.display = "block";-->
<!--              if (dnsInputContainer) dnsInputContainer.style.display = "block";-->
<!--              step3Description.textContent = "Configure network blocking settings";-->
<!--          }-->
<!--      } else if (selectedPolicyType === "SECURITY_MONITOR") {-->
<!--          if (ocrInfo) {-->
<!--              ocrInfo.style.display = "block";-->
<!--              step3Description.textContent = "Configure OCR and security monitoring";-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  /* ==================== FILE EXPLORER FUNCTIONS ==================== */-->
<!--  async function getDrives() {-->
<!--      try {-->
<!--          const treeContainer = document.getElementById('treeContainer');-->
<!--          treeContainer.innerHTML = '<div class="loading">Loading drives...</div>';-->

<!--          const response = await fetch(`/api/admin/explorer/drives`);-->
<!--          const data = await response.json();-->

<!--          treeData = data;-->
<!--          document.getElementById('btnRefresh').disabled = false;-->
<!--          renderTree(data);-->
<!--      } catch (error) {-->
<!--          console.error('Failed to get drives:', error);-->
<!--          document.getElementById('treeContainer').innerHTML = '<div class="error">Error loading drives. Please try again.</div>';-->
<!--      }-->
<!--  }-->

<!--  async function expandNode(node) {-->
<!--      if (!node || node.expanded || currentlyExpanding.has(node.id)) {-->
<!--          return;-->
<!--      }-->

<!--      currentlyExpanding.add(node.id);-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/explorer/nodes/${node.id}/expand`, { method: 'POST' });-->

<!--          if (response.status === 409) {-->
<!--              console.info(`Node already expanded: ${node.name}`);-->
<!--              node.expanded = true;-->
<!--              return;-->
<!--          }-->

<!--          if (!response.ok) {-->
<!--              throw new Error(`HTTP ${response.status}`);-->
<!--          }-->

<!--          const data = await response.json();-->

<!--          if (!Array.isArray(data)) {-->
<!--              console.error('Invalid expand response:', data);-->
<!--              return;-->
<!--          }-->

<!--          updateTreeWithChildren(node.id, data);-->
<!--          node.expanded = true;-->

<!--      } catch (error) {-->
<!--          console.error('Expand failed:', error);-->
<!--      } finally {-->
<!--          currentlyExpanding.delete(node.id);-->
<!--          renderTree(treeData);-->
<!--      }-->
<!--  }-->

<!--  async function refreshExplorer() {-->
<!--      if (!selectedNode) {-->
<!--          await getDrives();-->
<!--          return;-->
<!--      }-->

<!--      const node = findNode(treeData, selectedNode.id);-->
<!--      if (!node) return;-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded) {-->
<!--          node.expanded = false;-->
<!--          node.children = [];-->
<!--          renderTree(treeData);-->

<!--          setTimeout(() => {-->
<!--              expandNode(node);-->
<!--          }, 200);-->
<!--      }-->
<!--  }-->

<!--  function findNode(nodes, id) {-->
<!--      for (const node of nodes) {-->
<!--          if (node.id === id) return node;-->
<!--          if (node.children) {-->
<!--              const found = findNode(node.children, id);-->
<!--              if (found) return found;-->
<!--          }-->
<!--      }-->
<!--      return null;-->
<!--  }-->

<!--  function renderTree(data) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      if (!treeContainer) return;-->

<!--      treeContainer.innerHTML = '';-->

<!--      if (!data || (Array.isArray(data) && data.length === 0) || (!Array.isArray(data) && Object.keys(data).length === 0)) {-->
<!--          treeContainer.innerHTML = '<div class="loading">No items found</div>';-->
<!--          return;-->
<!--      }-->

<!--      const items = Array.isArray(data) ? data : Object.values(data);-->
<!--      items.forEach(item => {-->
<!--          renderTreeNode(item, 0);-->
<!--      });-->
<!--  }-->

<!--  function renderTreeNode(node, level) {-->
<!--      const treeContainer = document.getElementById('treeContainer');-->
<!--      const nodeEl = document.createElement('div');-->
<!--      const isSelected = selectedNode && selectedNode.id === node.id;-->

<!--      nodeEl.className = 'tree-node';-->
<!--      if (isSelected) nodeEl.classList.add('selected');-->

<!--      const indent = level * 20;-->
<!--      nodeEl.style.paddingLeft = `${indent + 10}px`;-->

<!--      if (node.type === 'folder' || node.type === 'drive') {-->
<!--          const expandEl = document.createElement('div');-->
<!--          expandEl.className = 'tree-node-expand';-->
<!--          expandEl.textContent = node.expanded ? 'â–¼' : 'â–¶';-->
<!--          expandEl.style.cursor = 'pointer';-->
<!--          expandEl.style.marginRight = '5px';-->
<!--          expandEl.style.fontSize = '12px';-->

<!--          expandEl.addEventListener('click', function(e) {-->
<!--              e.stopPropagation();-->
<!--              toggleFolder(node);-->
<!--          });-->

<!--          nodeEl.appendChild(expandEl);-->
<!--      } else {-->
<!--          const spacer = document.createElement('div');-->
<!--          spacer.style.width = '16px';-->
<!--          spacer.style.display = 'inline-block';-->
<!--          nodeEl.appendChild(spacer);-->
<!--      }-->

<!--      const iconEl = document.createElement('div');-->
<!--      iconEl.className = 'tree-node-icon';-->
<!--      iconEl.textContent = node.type === 'folder' || node.type === 'drive' ? 'ðŸ“‚' : 'ðŸ“„';-->
<!--      nodeEl.appendChild(iconEl);-->

<!--      const nameEl = document.createElement('div');-->
<!--      nameEl.className = 'tree-node-name';-->
<!--      nameEl.textContent = node.name || 'Unnamed';-->
<!--      nodeEl.appendChild(nameEl);-->

<!--      nodeEl.addEventListener('click', function(e) {-->
<!--          e.stopPropagation();-->
<!--          selectNode(node);-->
<!--      });-->

<!--      treeContainer.appendChild(nodeEl);-->

<!--      if ((node.type === 'folder' || node.type === 'drive') && node.expanded && Array.isArray(node.children)) {-->
<!--          node.children.forEach(child => {-->
<!--              renderTreeNode(child, level + 1);-->
<!--          });-->
<!--      }-->
<!--  }-->

<!--  async function toggleFolder(node) {-->
<!--      if (node.expanded) {-->
<!--          try {-->
<!--              await fetch(`/api/admin/explorer/nodes/${node.id}/collapse`, { method: 'POST' });-->
<!--              node.expanded = false;-->
<!--              node.children = [];-->
<!--              renderTree(treeData);-->
<!--          } catch (e) {-->
<!--              console.error("Collapse failed", e);-->
<!--          }-->
<!--          return;-->
<!--      }-->

<!--      if (currentlyExpanding.has(node.id)) return;-->
<!--      expandNode(node);-->
<!--  }-->

<!--  function selectNode(node) {-->
<!--      selectedNode = node;-->

<!--      document.getElementById('selectedPathInfo').style.display = 'block';-->
<!--      document.getElementById('selectedPathValue').textContent = node.full_path || node.id;-->

<!--      loadNodePolicies(node.id);-->

<!--      const cbCreate = document.getElementById('cb-create');-->
<!--      if (node.type === 'file') {-->
<!--          operations.create = false;-->
<!--          cbCreate.checked = false;-->
<!--          cbCreate.disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      } else {-->
<!--          cbCreate.disabled = false;-->
<!--          document.getElementById('create-operation').classList.remove('disabled');-->
<!--      }-->

<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--      updateNextButton();-->
<!--  }-->

<!--  function clearSelection() {-->
<!--      selectedNode = null;-->
<!--      document.getElementById('selectedPathInfo').style.display = 'none';-->
<!--      document.getElementById('selectedPathValue').textContent = '-';-->
<!--      clearOperations();-->
<!--      renderTree(treeData);-->
<!--  }-->

<!--  function updateTreeWithChildren(parentId, children) {-->
<!--      if (!Array.isArray(children)) {-->
<!--          console.error("Children is not array:", children);-->
<!--          return;-->
<!--      }-->

<!--      function updateNode(nodes) {-->
<!--          for (let node of nodes) {-->
<!--              if (!node) continue;-->

<!--              if (node.id === parentId) {-->
<!--                  node.children = children;-->
<!--                  node.expanded = true;-->
<!--                  return true;-->
<!--              }-->

<!--              if (Array.isArray(node.children)) {-->
<!--                  if (updateNode(node.children)) return true;-->
<!--              }-->
<!--          }-->
<!--          return false;-->
<!--      }-->

<!--      if (Array.isArray(treeData)) {-->
<!--          updateNode(treeData);-->
<!--      }-->
<!--  }-->

<!--  /* ==================== OPERATIONS FUNCTIONS ==================== */-->
<!--  function initOperationCheckboxes() {-->
<!--      const checkboxes = document.querySelectorAll('.operation-checkbox');-->
<!--      checkboxes.forEach(cb => {-->
<!--          cb.addEventListener('change', function() {-->
<!--              const operation = this.getAttribute('data-operation');-->

<!--              if (operation === 'read') {-->
<!--                  handleReadCheckboxChange(this.checked);-->
<!--              } else {-->
<!--                  handleOperationChange(operation, this.checked);-->
<!--              }-->

<!--              updateNextButton();-->
<!--          });-->
<!--      });-->
<!--  }-->

<!--  function handleReadCheckboxChange(isChecked) {-->
<!--      operations.read = isChecked;-->

<!--      document.getElementById('readBlockAllWarning').classList.toggle('active', isChecked);-->

<!--      if (isChecked) {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              operations[op] = false;-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.checked = false;-->
<!--              cb.disabled = true;-->
<!--              document.getElementById(`${op}-operation`).classList.add('disabled');-->
<!--          });-->
<!--      } else {-->
<!--          const otherOperations = ['write', 'delete', 'rename', 'create'];-->
<!--          otherOperations.forEach(op => {-->
<!--              const cb = document.getElementById(`cb-${op}`);-->
<!--              cb.disabled = false;-->
<!--              document.getElementById(`${op}-operation`).classList.remove('disabled');-->
<!--          });-->

<!--          if (selectedNode && selectedNode.type === 'file') {-->
<!--              document.getElementById('cb-create').disabled = true;-->
<!--              document.getElementById('create-operation').classList.add('disabled');-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  function handleOperationChange(operation, isChecked) {-->
<!--      operations[operation] = isChecked;-->
<!--  }-->

<!--  function clearOperations() {-->
<!--      Object.keys(operations).forEach(op => {-->
<!--          operations[op] = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-checkbox').forEach(cb => {-->
<!--          cb.checked = false;-->
<!--          cb.disabled = false;-->
<!--      });-->

<!--      document.querySelectorAll('.operation-item').forEach(item => {-->
<!--          item.classList.remove('disabled');-->
<!--      });-->

<!--      document.getElementById('readBlockAllWarning').classList.remove('active');-->

<!--      if (selectedNode && selectedNode.type === 'file') {-->
<!--          document.getElementById('cb-create').disabled = true;-->
<!--          document.getElementById('create-operation').classList.add('disabled');-->
<!--      }-->
<!--  }-->

<!--  function updateNextButton() {-->
<!--      const hasSelection = selectedNode !== null;-->
<!--      const hasAnyOperationChecked = Object.values(operations).some(v => v);-->
<!--      const nextBtn = document.getElementById('nextBtn');-->

<!--      if (currentStep === 3 && selectedPolicyType === "FILE") {-->
<!--          nextBtn.disabled = !hasSelection || !hasAnyOperationChecked;-->
<!--      } else {-->
<!--          nextBtn.disabled = false;-->
<!--      }-->
<!--  }-->

<!--  function validateStep3() {-->
<!--      if (selectedPolicyType === "FILE") {-->
<!--          if (!selectedNode) {-->
<!--              showToast("Please select a file or folder", "warning");-->
<!--              return false;-->
<!--          }-->

<!--          const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--          if (!hasAnyOperation) {-->
<!--              showToast("Please select at least one operation to block", "warning");-->
<!--              return false;-->
<!--          }-->
<!--      } else if (selectedPolicyType === "NETWORK") {-->
<!--          if (blockedDomains.length === 0) {-->
<!--              showToast("Please add at least one domain to block", "warning");-->
<!--              return false;-->
<!--          }-->
<!--      }-->

<!--      return true;-->
<!--  }-->

<!--  /* ==================== ACTIVE POLICIES FUNCTIONS ==================== */-->
<!--  async function loadNodePolicies(nodeId) {-->
<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies`);-->
<!--          if (!response.ok) throw new Error('Failed to load policies');-->

<!--          const result = await response.json();-->

<!--          let policiesArray = [];-->
<!--          if (Array.isArray(result)) {-->
<!--              policiesArray = result;-->
<!--          } else if (result.data && Array.isArray(result.data)) {-->
<!--              policiesArray = result.data;-->
<!--          }-->

<!--          activeNodePolicies = policiesArray.filter(p =>-->
<!--              p.nodeId === nodeId || p.node_id === nodeId-->
<!--          );-->

<!--          const section = document.getElementById('activePoliciesSection');-->
<!--          const policiesList = document.getElementById('selectedNodePolicies');-->
<!--          const noPoliciesMsg = document.getElementById('noPoliciesMsg');-->
<!--          const removeContainer = document.getElementById('removePolicyContainer');-->

<!--          if (activeNodePolicies.length > 0) {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'block';-->
<!--              noPoliciesMsg.style.display = 'none';-->

<!--              policiesList.innerHTML = '';-->
<!--              activeNodePolicies.forEach(policy => {-->
<!--                  const policyItem = document.createElement('div');-->
<!--                  policyItem.className = 'policy-item-small';-->

<!--                  const nodeId = policy.nodeId || policy.node_id;-->
<!--                  const operations = policy.operations || {};-->
<!--                  const isBlockAll = operations.read === true;-->

<!--                  if (isBlockAll) {-->
<!--                      policyItem.classList.add('block-all');-->
<!--                  }-->

<!--                  const ops = [];-->
<!--                  if (operations.read === true) ops.push('READ');-->
<!--                  if (operations.write === true) ops.push('WRITE');-->
<!--                  if (operations.delete === true) ops.push('DELETE');-->
<!--                  if (operations.rename === true) ops.push('RENAME');-->
<!--                  if (operations.create === true) ops.push('CREATE');-->

<!--                  policyItem.innerHTML = `-->
<!--                      <div class="policy-info-compact">-->
<!--                          <div class="policy-name-compact">-->
<!--                              ${isBlockAll ? 'âš ï¸ ALL ACCESS BLOCKED' : ops.join(', ')}-->
<!--                          </div>-->
<!--                          <div class="policy-details-compact">-->
<!--                              Scope: ${policy.scope || 'file'} | ID: ${policy.id}-->
<!--                          </div>-->
<!--                      </div>-->
<!--                      <button class="policy-remove-btn" onclick="showRemovePolicyModalForPolicy(${policy.id})" title="Remove this policy">-->
<!--                          <i class="fas fa-times"></i>-->
<!--                      </button>-->
<!--                  `;-->

<!--                  policiesList.appendChild(policyItem);-->
<!--              });-->
<!--          } else {-->
<!--              section.style.display = 'block';-->
<!--              removeContainer.style.display = 'none';-->
<!--              noPoliciesMsg.style.display = 'flex';-->
<!--              policiesList.innerHTML = '';-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Error loading node policies:', error);-->
<!--      }-->
<!--  }-->

<!--  function showRemovePolicyModal() {-->
<!--      if (activeNodePolicies.length === 0) return;-->

<!--      if (activeNodePolicies.length > 1) {-->
<!--          showPolicySelectionModal();-->
<!--      } else {-->
<!--          showRemovePolicyModalForPolicy(activeNodePolicies[0].id);-->
<!--      }-->
<!--  }-->

<!--  function showPolicySelectionModal() {-->
<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      let html = '<p><strong>Multiple policies found:</strong></p>';-->
<!--      html += '<div style="margin: 15px 0;">';-->

<!--      activeNodePolicies.forEach(policy => {-->
<!--          const operations = policy.operations || {};-->
<!--          const ops = Object.entries(operations)-->
<!--              .filter(([op, val]) => val)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          html += `-->
<!--              <div style="padding: 10px; margin: 5px 0; background: #f3f4f6; border-radius: 6px; display: flex; align-items: center; gap: 10px;">-->
<!--                  <input type="radio" name="policySelect" value="${policy.id}" id="policy_${policy.id}" style="width: 18px; height: 18px;">-->
<!--                  <label for="policy_${policy.id}" style="flex: 1;">-->
<!--                      <strong>Policy ID ${policy.id}</strong><br>-->
<!--                      Operations: ${ops || 'None'} | Scope: ${policy.scope || 'file'}-->
<!--                  </label>-->
<!--              </div>-->
<!--          `;-->
<!--      });-->

<!--      html += '</div>';-->
<!--      html += '<p>Select a policy to remove:</p>';-->

<!--      details.innerHTML = html;-->

<!--      setTimeout(() => {-->
<!--          const radios = document.querySelectorAll('input[name="policySelect"]');-->
<!--          radios.forEach(radio => {-->
<!--              radio.addEventListener('change', function() {-->
<!--                  policyToRemove = parseInt(this.value);-->
<!--                  updateRemoveConfirmButton();-->
<!--              });-->
<!--          });-->
<!--      }, 100);-->

<!--      confirmInput.value = '';-->
<!--      confirmInput.disabled = false;-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          updateRemoveConfirmButton();-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function showRemovePolicyModalForPolicy(policyId) {-->
<!--      const policy = activeNodePolicies.find(p => p.id === policyId);-->
<!--      if (!policy) return;-->

<!--      policyToRemove = policyId;-->

<!--      const modal = document.getElementById('removePolicyModal');-->
<!--      const details = document.getElementById('removeModalDetails');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->

<!--      const operations = policy.operations || {};-->
<!--      const ops = Object.entries(operations)-->
<!--          .filter(([op, val]) => val)-->
<!--          .map(([op]) => op.toUpperCase())-->
<!--          .join(', ');-->

<!--      details.innerHTML = `-->
<!--          <div><strong>Resource:</strong> ${selectedNode ? selectedNode.name || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Path:</strong> ${selectedNode ? selectedNode.full_path || selectedNode.id : 'Unknown'}</div>-->
<!--          <div><strong>Policy ID:</strong> ${policy.id}</div>-->
<!--          <div><strong>Blocked Operations:</strong> ${ops || 'None'}</div>-->
<!--          <div><strong>Scope:</strong> ${policy.scope || 'file'}</div>-->
<!--      `;-->

<!--      confirmInput.value = '';-->
<!--      confirmBtn.disabled = true;-->

<!--      confirmInput.oninput = function() {-->
<!--          confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--      };-->

<!--      modal.classList.add('active');-->
<!--  }-->

<!--  function updateRemoveConfirmButton() {-->
<!--      const confirmInput = document.getElementById('removeConfirmInput');-->
<!--      const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--      confirmBtn.disabled = confirmInput.value !== 'REMOVE' || !policyToRemove;-->
<!--  }-->

<!--  function closeRemovePolicyModal() {-->
<!--      document.getElementById('removePolicyModal').classList.remove('active');-->
<!--      policyToRemove = null;-->
<!--  }-->

<!--  async function removeSelectedPolicy() {-->
<!--      if (!policyToRemove) {-->
<!--          closeRemovePolicyModal();-->
<!--          return;-->
<!--      }-->

<!--      try {-->
<!--          const response = await fetch(`/api/admin/policies/${policyToRemove}`, {-->
<!--              method: 'DELETE'-->
<!--          });-->

<!--          if (!response.ok) {-->
<!--              throw new Error('Failed to remove policy');-->
<!--          }-->

<!--          showToast("Policy removed successfully!", "success");-->
<!--          closeRemovePolicyModal();-->

<!--          if (selectedNode) {-->
<!--              await loadNodePolicies(selectedNode.id);-->
<!--          }-->

<!--      } catch (error) {-->
<!--          console.error('Remove policy error:', error);-->
<!--          showToast("Failed to remove policy: " + error.message, "error");-->
<!--          closeRemovePolicyModal();-->
<!--      }-->
<!--  }-->

<!--  /* ==================== DOMAIN FUNCTIONS ==================== */-->
<!--  function addDomain() {-->
<!--      const domainInput = document.getElementById("domainInput");-->
<!--      let domain = domainInput.value.trim();-->

<!--      if (!domain) {-->
<!--          alert("Please enter a domain name");-->
<!--          return;-->
<!--      }-->

<!--      domain = domain.replace(/^https?:\/\//, "");-->
<!--      domain = domain.replace(/\/$/, "");-->

<!--      const domainLower = domain.toLowerCase();-->
<!--      const exists = blockedDomains.some(d => d.toLowerCase() === domainLower);-->

<!--      if (exists) {-->
<!--          alert("Domain already added");-->
<!--          return;-->
<!--      }-->
<!--      blockedDomains.push(domain);-->
<!--      domainInput.value = "";-->

<!--      renderDomainTags();-->

<!--      if (currentStep === 4) {-->
<!--          renderSummaryDomainTags();-->
<!--          const summaryDomainsCount = document.getElementById("summaryDomainsCount");-->
<!--          if (summaryDomainsCount) {-->
<!--              summaryDomainsCount.textContent = blockedDomains.length;-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  function renderDomainTags() {-->
<!--      const domainTags = document.getElementById("domainTags");-->
<!--      if (!domainTags) return;-->

<!--      domainTags.innerHTML = "";-->

<!--      blockedDomains.forEach((domain, index) => {-->
<!--          const tag = document.createElement("div");-->
<!--          tag.className = "domain-tag";-->
<!--          tag.innerHTML = `-->
<!--              <span>${domain}</span>-->
<!--              <i class="fas fa-times" onclick="removeDomain(${index})"></i>-->
<!--          `;-->
<!--          domainTags.appendChild(tag);-->
<!--      });-->
<!--  }-->

<!--  function removeDomain(index) {-->
<!--      blockedDomains.splice(index, 1);-->
<!--      renderDomainTags();-->
<!--  }-->

<!--  function renderSummaryDomainTags() {-->
<!--      const domainTags = document.getElementById("summaryDomainTags");-->
<!--      if (!domainTags) return;-->

<!--      domainTags.innerHTML = "";-->
<!--      if (blockedDomains.length === 0) {-->
<!--          const emptyMsg = document.createElement("div");-->
<!--          emptyMsg.style.color = "#6b7280";-->
<!--          emptyMsg.style.fontStyle = "italic";-->
<!--          emptyMsg.style.padding = "8px";-->
<!--          emptyMsg.textContent = "No domains added";-->
<!--          domainTags.appendChild(emptyMsg);-->
<!--          return;-->
<!--      }-->
<!--      blockedDomains.forEach((domain, index) => {-->
<!--          const tag = document.createElement("span");-->
<!--          tag.className = "summary-domain-tag";-->
<!--          tag.innerHTML = `-->
<!--              <span>${domain}</span>-->
<!--              <i class="fas fa-times" onclick="removeDomainFromSummary(${index})"></i>-->
<!--          `;-->
<!--          domainTags.appendChild(tag);-->
<!--      });-->
<!--  }-->

<!--  function removeDomainFromSummary(index) {-->
<!--      blockedDomains.splice(index, 1);-->
<!--      renderDomainTags();-->
<!--      renderSummaryDomainTags();-->

<!--      const summaryDomainsCount = document.getElementById("summaryDomainsCount");-->
<!--      if (summaryDomainsCount) {-->
<!--          summaryDomainsCount.textContent = blockedDomains.length;-->
<!--      }-->

<!--      if (blockedDomains.length === 0) {-->
<!--          const domainsContainer = document.getElementById("summaryDomainsContainer");-->
<!--          if (domainsContainer) {-->
<!--              domainsContainer.style.display = "none";-->
<!--          }-->

<!--          if (currentStep === 4) {-->
<!--              const alertBox = document.querySelector(".alert.alert-info, .alert.alert-success");-->
<!--              if (alertBox) {-->
<!--                  alertBox.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>No domains to block. Please add domains in Step 3.</span>';-->
<!--                  alertBox.className = "alert alert-warning";-->
<!--              }-->
<!--          }-->
<!--      }-->
<!--  }-->

<!--  /* ==================== STEP NAVIGATION ==================== */-->
<!--  function nextStep() {-->
<!--      if (currentStep === 1 && selectedAgents.size === 0) {-->
<!--          showToast("Please select at least one agent", "warning");-->
<!--          return;-->
<!--      }-->

<!--      if (currentStep === 2) {-->
<!--          const policyType = document.getElementById('policyType').value;-->
<!--          if (!policyType) {-->
<!--              showToast("Please select a policy type", "warning");-->
<!--              return;-->
<!--          }-->
<!--      }-->

<!--      if (currentStep === 3) {-->
<!--          if (!validateStep3()) {-->
<!--              return;-->
<!--          }-->
<!--      }-->

<!--      currentStep++;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function previousStep() {-->
<!--      currentStep&#45;&#45;;-->
<!--      updateStepDisplay();-->
<!--  }-->

<!--  function updateStepDisplay() {-->
<!--      document.getElementById("step1").style.display = "none";-->
<!--      document.getElementById("step2").style.display = "none";-->
<!--      document.getElementById("step3").style.display = "none";-->
<!--      document.getElementById("step4").style.display = "none";-->

<!--      document.getElementById(`step${currentStep}`).style.display = "block";-->

<!--      document.querySelectorAll(".step").forEach((step, index) => {-->
<!--          step.classList.remove("active", "completed");-->
<!--          if (index + 1 < currentStep) {-->
<!--              step.classList.add("completed");-->
<!--              step.querySelector(".step-circle").innerHTML = '<i class="fas fa-check"></i>';-->
<!--          } else if (index + 1 === currentStep) {-->
<!--              step.classList.add("active");-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          } else {-->
<!--              step.querySelector(".step-circle").textContent = index + 1;-->
<!--          }-->
<!--      });-->

<!--      document.getElementById("prevBtn").style.display = currentStep > 1 ? "flex" : "none";-->
<!--      document.getElementById("nextBtn").style.display = currentStep < 4 ? "flex" : "none";-->
<!--      document.getElementById("applyBtn").style.display = currentStep === 4 ? "flex" : "none";-->

<!--      if (currentStep === 4) {-->
<!--          updateSummary();-->
<!--      }-->

<!--      if (currentStep === 3) {-->
<!--          updateNextButton();-->
<!--      }-->
<!--  }-->

<!--  function updateSummary() {-->
<!--      document.getElementById("summaryAgentCount").textContent = selectedAgents.size;-->
<!--      document.getElementById("summaryPolicyType").textContent = selectedPolicyType || "-";-->

<!--      // Handle File Protection Summary-->
<!--      if (selectedPolicyType === "FILE" && selectedNode) {-->
<!--          document.getElementById("fileSummaryContainer").style.display = "block";-->
<!--          document.getElementById("summaryDomainsContainer").style.display = "none";-->

<!--          document.getElementById("summaryPath").textContent = selectedNode.full_path || selectedNode.id;-->
<!--          document.getElementById("summaryResourceType").textContent = selectedNode.type === 'folder' ? 'Folder (recursive)' : 'File';-->

<!--          const blockedOps = Object.entries(operations)-->
<!--              .filter(([op, checked]) => checked)-->
<!--              .map(([op]) => op.toUpperCase())-->
<!--              .join(', ');-->

<!--          document.getElementById("summaryOperations").textContent = blockedOps || 'None';-->
<!--          document.getElementById("summaryBlockAllRow").style.display = operations.read ? 'flex' : 'none';-->
<!--          document.getElementById("summaryPolicyName").textContent = "File Protection Policy";-->

<!--      } else if (selectedPolicyType === "NETWORK") {-->
<!--          document.getElementById("fileSummaryContainer").style.display = "none";-->
<!--          document.getElementById("summaryDomainsContainer").style.display = "block";-->
<!--          document.getElementById("summaryDomainsCount").textContent = blockedDomains.length;-->
<!--          renderSummaryDomainTags();-->
<!--          document.getElementById("summaryPolicyName").textContent = "Network DNS Block Policy";-->
<!--      } else {-->
<!--          document.getElementById("fileSummaryContainer").style.display = "none";-->
<!--          document.getElementById("summaryDomainsContainer").style.display = "none";-->
<!--          document.getElementById("summaryPolicyName").textContent = "-";-->
<!--      }-->
<!--  }-->

<!--  /* ==================== APPLY POLICY ==================== */-->
<!--  async function applyPolicy() {-->
<!--      if (selectedAgents.size === 0) {-->
<!--          showToast("Please select agents first", "error");-->
<!--          return;-->
<!--      }-->

<!--      const agentIds = Array.from(selectedAgents);-->

<!--      if (selectedPolicyType === "FILE") {-->
<!--          if (!selectedNode) {-->
<!--              showToast("Please select a file or folder", "error");-->
<!--              return;-->
<!--          }-->

<!--          const hasAnyOperation = Object.values(operations).some(v => v);-->
<!--          if (!hasAnyOperation) {-->
<!--              showToast("Please select at least one operation to block", "warning");-->
<!--              return;-->
<!--          }-->

<!--          try {-->
<!--              const payload = {-->
<!--                  node_id: selectedNode.id,-->
<!--                  scope: selectedNode.type === 'folder' ? 'folder_recursive' : 'file',-->
<!--                  action: 'block',-->
<!--                  operations: { ...operations },-->
<!--                  created_by: 'admin',-->
<!--                  comment: 'Applied from File Protection UI',-->
<!--                  confirmed: true,-->
<!--                  agentIds: agentIds-->
<!--              };-->

<!--              showToast("Applying policy...", "info");-->

<!--              const response = await fetch(`/api/admin/policies/apply`, {-->
<!--                  method: 'POST',-->
<!--                  headers: { 'Content-Type': 'application/json' },-->
<!--                  body: JSON.stringify(payload)-->
<!--              });-->

<!--              if (!response.ok) {-->
<!--                  const errorText = await response.text();-->
<!--                  throw new Error(errorText);-->
<!--              }-->

<!--              const result = await response.json();-->

<!--              const agentNames = agentIds-->
<!--                  .map(id => {-->
<!--                      const agent = agentsBasicData[id];-->
<!--                      return agent ? agent.hostname || agent.username : `Agent ${id}`;-->
<!--                  })-->
<!--                  .filter(name => name);-->

<!--              let message = `âœ… Policy applied successfully!\n\n`;-->
<!--              message += `Agents: ${agentNames.join(', ')}\n`;-->
<!--              message += `Path: ${selectedNode.full_path || selectedNode.id}\n`;-->
<!--              message += `Blocked Operations: ${Object.entries(operations).filter(([op, checked]) => checked).map(([op]) => op.toUpperCase()).join(', ')}`;-->

<!--              alert(message);-->

<!--              setTimeout(() => {-->
<!--                  window.location.href = 'file-policies.html';-->
<!--              }, 2000);-->

<!--          } catch (error) {-->
<!--              console.error('Apply policy error:', error);-->
<!--              showToast("Failed to apply policy: " + error.message, "error");-->
<!--          }-->

<!--      } else if (selectedPolicyType === "NETWORK") {-->
<!--          if (blockedDomains.length === 0) {-->
<!--              alert("Please add at least one domain to block");-->
<!--              return;-->
<!--          }-->

<!--          try {-->
<!--              const requestBody = {-->
<!--                  agentIds: agentIds,-->
<!--                  policyCode: "NETWORK_DNS_BLOCK",-->
<!--                  policyData: JSON.stringify({-->
<!--                      domains: blockedDomains,-->
<!--                      ips: []-->
<!--                  })-->
<!--              };-->

<!--              console.log("Applying network policy:", requestBody);-->

<!--              const response = await fetch("/api/admin/assign-protection", {-->
<!--                  method: "POST",-->
<!--                  headers: { "Content-Type": "application/json" },-->
<!--                  credentials: "include",-->
<!--                  body: JSON.stringify(requestBody),-->
<!--              });-->

<!--              const result = await response.json();-->

<!--              if (result.success) {-->
<!--                  const agentNames = agentIds-->
<!--                      .map(id => {-->
<!--                          const agent = agentsBasicData[id];-->
<!--                          return agent ? agent.hostname || agent.username : `Agent ${id}`;-->
<!--                      })-->
<!--                      .filter(name => name);-->

<!--                  let message = `âœ… Policy applied successfully!\n\n`;-->
<!--                  message += `Agents: ${agentNames.join(', ')}\n`;-->
<!--                  message += `Policy: Network DNS Block\n`;-->
<!--                  message += `Blocked Domains: ${blockedDomains.join(', ')}\n`;-->

<!--                  alert(message);-->

<!--                  setTimeout(() => {-->
<!--                      window.location.href = 'file-policies.html';-->
<!--                  }, 2000);-->
<!--              } else {-->
<!--                  alert(`âŒ Failed to apply policy: ${result.message}`);-->
<!--              }-->
<!--          } catch (error) {-->
<!--              console.error("Error applying policy:", error);-->
<!--              alert(`âŒ Error applying policy: ${error.message}`);-->
<!--          }-->
<!--      } else {-->
<!--          showToast("This policy type is not fully implemented in this demo", "info");-->
<!--      }-->
<!--  }-->

<!--  function showToast(message, type = 'success') {-->
<!--      const toast = document.createElement('div');-->
<!--      toast.className = `toast ${type}`;-->
<!--      toast.textContent = message;-->

<!--      document.body.appendChild(toast);-->
<!--      setTimeout(() => toast.remove(), 3000);-->
<!--  }-->

<!--  /* ==================== INITIALIZATION ==================== */-->
<!--  document.addEventListener("DOMContentLoaded", async function() {-->
<!--      loadAdminInfo();-->
<!--      setActiveMenuItem();-->

<!--      await Promise.all([-->
<!--          initializeAgentCards(),-->
<!--          fetchAgentSimpleDetails(),-->
<!--      ]);-->

<!--      startStatusRefresh();-->
<!--      initOperationCheckboxes();-->

<!--      // Setup policy type change handler-->
<!--      document.getElementById('policyType').addEventListener('change', function(e) {-->
<!--          selectedPolicyType = e.target.value;-->
<!--          updatePolicyOptions();-->
<!--      });-->

<!--      // Setup remove confirm input-->
<!--      document.getElementById('removeConfirmInput')?.addEventListener('input', function() {-->
<!--          const confirmBtn = document.getElementById('confirmRemoveBtn');-->
<!--          confirmBtn.disabled = this.value !== 'REMOVE';-->
<!--      });-->
<!--  });-->

<!--  window.addEventListener("resize", function() {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mainContent = document.getElementById("mainContent");-->
<!--      const header = document.getElementById("topHeader");-->
<!--      const windowWidth = window.innerWidth;-->

<!--      if (windowWidth <= 968) {-->
<!--          if (sidebar) sidebar.classList.remove("collapsed");-->
<!--          if (mainContent) mainContent.classList.remove("expanded");-->
<!--          if (header) {-->
<!--              header.style.left = "0";-->
<!--          }-->
<!--      } else {-->
<!--          if (sidebar && mainContent && header) {-->
<!--              if (sidebar.classList.contains("collapsed")) {-->
<!--                  mainContent.classList.add("expanded");-->
<!--                  header.style.left = "70px";-->
<!--              } else {-->
<!--                  mainContent.classList.remove("expanded");-->
<!--                  header.style.left = "240px";-->
<!--              }-->
<!--          }-->
<!--      }-->
<!--  });-->

<!--  window.addEventListener("sidebarToggle", function(event) {-->
<!--      const header = document.getElementById("topHeader");-->
<!--      const mainContent = document.getElementById("mainContent");-->

<!--      if (header && mainContent) {-->
<!--          if (event.detail.collapsed) {-->
<!--              header.style.left = "70px";-->
<!--              mainContent.classList.add("expanded");-->
<!--          } else {-->
<!--              header.style.left = "240px";-->
<!--              mainContent.classList.remove("expanded");-->
<!--          }-->
<!--      }-->
<!--  });-->

<!--  document.addEventListener("click", function(e) {-->
<!--      const sidebar = document.getElementById("sidebar");-->
<!--      const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");-->

<!--      if (sidebar && window.innerWidth <= 968) {-->
<!--          if (-->
<!--              !sidebar.contains(e.target) &&-->
<!--              (!mobileMenuToggle || !mobileMenuToggle.contains(e.target))-->
<!--          ) {-->
<!--              sidebar.classList.remove("mobile-open");-->
<!--              const overlay = document.getElementById("sidebarOverlay");-->
<!--              if (overlay) {-->
<!--                  overlay.classList.remove("active");-->
<!--              }-->
<!--          }-->
<!--      }-->
<!--  });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->