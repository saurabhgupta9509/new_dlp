<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DLP Shield - Alert Details</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family:
        -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
        Cantarell, sans-serif;
      background: #f3f4f6;
      overflow-x: hidden;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
      max-width: 100vw;
      overflow-x: hidden;
    }

    .main-content {
      flex: 1;
      margin-left: 240px;
      transition: margin-left 0.3s ease;
      min-height: 100vh;
      max-width: calc(100vw - 240px);
      overflow-x: hidden;
      position: relative;
    }

    .main-content.expanded {
      margin-left: 70px;
      max-width: calc(100vw - 70px);
    }

    .content-area {
      padding: 24px;
      padding-top: 100px;
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }

    /* ================ SIDEBAR STYLES ================ */
    .sidebar {
      width: 240px;
      background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 100%);
      color: white;
      position: fixed;
      height: 100vh;
      display: flex;
      flex-direction: column;
      transition: width 0.3s ease;
      z-index: 1000;
      left: 0;
      top: 0;
      overflow: hidden;
    }

    .sidebar::-webkit-scrollbar {
      width: 4px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 4px;
    }

    .sidebar-header {
      padding: 18px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .sidebar-logo {
      width: 38px;
      height: 38px;
      background: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .sidebar-logo i {
      font-size: 20px;
      color: #2563eb;
    }

    .sidebar-title {
      font-size: 1.2em;
      font-weight: 700;
      white-space: nowrap;
      transition:
        opacity 0.2s,
        width 0.3s;
      overflow: hidden;
    }

    .nav-menu {
      padding: 12px 0;
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
    }

    .nav-item {
      margin: 2px 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 10px 12px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 0.9em;
      cursor: pointer;
      white-space: nowrap;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .nav-link.active,
    .sub-menu-item.active {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      font-weight: 600;
    }

    .nav-link i:first-child {
      width: 20px;
      font-size: 0.95em;
      margin-right: 10px;
      flex-shrink: 0;
    }

    .chevron-icon {
      margin-left: auto !important;
      font-size: 0.7em !important;
      transition: transform 0.3s;
      width: auto !important;
      flex-shrink: 0;
    }

    .nav-link.expanded .chevron-icon {
      transform: rotate(180deg);
    }

    .sub-menu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .sub-menu.open {
      max-height: 500px;
    }

    .sub-menu-item {
      display: flex;
      align-items: center;
      padding: 8px 12px 8px 42px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      font-size: 0.85em;
      transition: all 0.2s;
      border-radius: 8px;
      margin: 2px 0;
      white-space: nowrap;
    }

    .sub-menu-item:hover {
      color: white;
      background: rgba(255, 255, 255, 0.08);
    }

    .sub-menu-item::before {
      content: "â€¢";
      margin-right: 10px;
      font-size: 1.2em;
    }

    .sidebar-footer {
      padding: 12px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .collapse-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 0.85em;
      transition: all 0.2s;
      white-space: nowrap;
      overflow: hidden;
    }

    .collapse-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .collapse-btn i {
      transition: transform 0.3s;
      flex-shrink: 0;
    }

    /* Sidebar collapsed state */
    .sidebar.collapsed {
      width: 70px;
    }

    .sidebar.collapsed .sidebar-title {
      opacity: 0;
      width: 0;
    }

    .sidebar.collapsed .nav-link span,
    .sidebar.collapsed .collapse-btn span {
      display: none;
    }

    .sidebar.collapsed .sub-menu {
      display: none !important;
    }

    .sidebar.collapsed .nav-link {
      justify-content: center;
      padding: 10px;
    }

    .sidebar.collapsed .nav-link i:first-child {
      margin-right: 0;
    }

    .sidebar.collapsed .chevron-icon {
      display: none;
    }

    .sidebar.collapsed .collapse-btn {
      justify-content: center;
    }

    .sidebar.collapsed .collapse-btn i {
      transform: rotate(180deg);
    }

    /* Mobile Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .sidebar-overlay.active {
      display: block;
      opacity: 1;
    }

    /* ================ HEADER STYLES ================ */
    .top-header {
      background: white;
      padding: 14px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #e5e7eb;
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 500;
      gap: 16px;
      transition: left 0.3s ease;
    }

    .mobile-menu-toggle {
      display: none;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.3em;
      cursor: pointer;
      padding: 8px;
      transition: color 0.2s;
    }

    .mobile-menu-toggle:hover {
      color: #111827;
    }

    .search-bar {
      flex: 1;
      max-width: 400px;
      position: relative;
    }

    .search-bar i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 0.9em;
    }

    .search-input {
      width: 100%;
      padding: 9px 14px 9px 38px;
      border: 1.5px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.9em;
      background: #f9fafb;
      transition: all 0.3s ease;
    }

    .search-input:focus {
      outline: none;
      border-color: #3b82f6;
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .notification-btn {
      position: relative;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.1em;
      cursor: pointer;
      padding: 8px;
      transition: all 0.2s;
      border-radius: 8px;
    }

    .notification-btn:hover {
      color: #111827;
      background: #f3f4f6;
    }

    .notification-btn.active {
      color: #2563eb;
      background: #eff6ff;
    }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: #ef4444;
      color: white;
      font-size: 0.65em;
      min-width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      padding: 0 4px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 8px;
      transition: background 0.2s;
      position: relative;
    }

    .user-profile:hover {
      background: #f3f4f6;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.9em;
      flex-shrink: 0;
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
    }

    .user-role {
      font-size: 0.75em;
      color: #6b7280;
    }

    .dropdown-icon {
      color: #6b7280;
      font-size: 0.75em;
      margin-left: 4px;
      transition: transform 0.3s;
    }

    .user-profile.active .dropdown-icon {
      transform: rotate(180deg);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow:
        0 4px 6px rgba(0, 0, 0, 0.07),
        0 10px 15px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      color: #374151;
      text-decoration: none;
      font-size: 0.9em;
      transition: background 0.2s;
    }

    .dropdown-item:first-child {
      border-radius: 8px 8px 0 0;
    }

    .dropdown-item:last-child {
      border-radius: 0 0 8px 8px;
    }

    .dropdown-item:hover {
      background: #f3f4f6;
    }

    .dropdown-item i {
      width: 18px;
      color: #6b7280;
      font-size: 0.95em;
    }

    .dropdown-item.danger {
      color: #dc2626;
    }

    .dropdown-item.danger i {
      color: #dc2626;
    }

    .dropdown-divider {
      height: 1px;
      background: #e5e7eb;
      margin: 4px 0;
    }

    /* ================ NOTIFICATIONS PANEL ================ */
    .notifications-panel {
      position: fixed;
      top: 0;
      right: -50%;
      width: 50%;
      max-width: 600px;
      height: 100vh;
      background: white;
      box-shadow: -4px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1001;
      display: flex;
      flex-direction: column;
      transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .notifications-panel.show {
      right: 0;
    }

    .notifications-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .notifications-header h3 {
      font-size: 1.2em;
      font-weight: 700;
      color: #111827;
    }

    .close-notifications {
      background: none;
      border: none;
      color: #6b7280;
      font-size: 1.2em;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .close-notifications:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .notifications-tabs {
      display: flex;
      border-bottom: 1px solid #e5e7eb;
      padding: 0 24px;
      flex-shrink: 0;
    }

    .tab-btn {
      flex: 1;
      padding: 12px;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 0.9em;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      color: #111827;
    }

    .tab-btn.active {
      color: #2563eb;
      border-bottom-color: #2563eb;
    }

    .notifications-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px 0;
    }

    .notifications-content::-webkit-scrollbar {
      width: 6px;
    }

    .notifications-content::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 3px;
    }

    .notification-item {
      display: flex;
      gap: 12px;
      padding: 14px 24px;
      cursor: pointer;
      transition: background 0.2s;
      border-left: 3px solid transparent;
    }

    .notification-item:hover {
      background: #f9fafb;
    }

    .notification-item.unread {
      background: #eff6ff;
      border-left-color: #3b82f6;
    }

    .notification-item.unread:hover {
      background: #dbeafe;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1em;
      flex-shrink: 0;
    }

    .notification-icon.critical {
      background: #fee2e2;
      color: #dc2626;
    }

    .notification-icon.warning {
      background: #fef3c7;
      color: #f59e0b;
    }

    .notification-icon.info {
      background: #dbeafe;
      color: #3b82f6;
    }

    .notification-icon.success {
      background: #d1fae5;
      color: #10b981;
    }

    .notification-body {
      flex: 1;
    }

    .notification-title {
      font-size: 0.9em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 4px;
    }

    .notification-text {
      font-size: 0.85em;
      color: #6b7280;
      margin-bottom: 6px;
      line-height: 1.4;
    }

    .notification-time {
      font-size: 0.75em;
      color: #9ca3af;
    }

    .notification-dot {
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 8px;
    }

    .notification-item:not(.unread) .notification-dot {
      display: none;
    }

    .notifications-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e7eb;
      flex-shrink: 0;
    }

    .view-all-btn {
      display: block;
      width: 100%;
      padding: 10px;
      background: #f3f4f6;
      color: #2563eb;
      text-align: center;
      text-decoration: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.2s;
    }

    .view-all-btn:hover {
      background: #e5e7eb;
    }

    .notification-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .notification-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    /* Alert Details Styles */
    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      color: #6b7280;
      text-decoration: none;
      font-size: 0.9em;
      margin-bottom: 20px;
      transition: all 0.2s;
    }

    .back-button:hover {
      background: #f9fafb;
      color: #111827;
    }

    .alert-header {
      background: white;
      padding: 24px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      margin-bottom: 20px;
      width: 100%;
    }

    .alert-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .alert-title-section {
      display: flex;
      align-items: center;
      gap: 16px;
      flex: 1;
      min-width: 300px;
    }

    .alert-icon {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4em;
      flex-shrink: 0;
    }

    .alert-icon.network {
      background: #dbeafe;
      color: #3b82f6;
    }

    .alert-icon.usb {
      background: #fee2e2;
      color: #dc2626;
    }

    .alert-icon.file {
      background: #fef3c7;
      color: #f59e0b;
    }

    .alert-icon.ocr {
      background: #e0e7ff;
      color: #6366f1;
    }

    .alert-title h1 {
      font-size: 1.4em;
      color: #111827;
      margin-bottom: 6px;
      word-break: break-word;
    }

    .alert-id {
      color: #6b7280;
      font-size: 0.9em;
    }

    .alert-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 18px;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .alert-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .meta-item {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .meta-label {
      font-size: 0.8em;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .meta-value {
      font-size: 0.95em;
      color: #111827;
      font-weight: 600;
      word-break: break-word;
    }

    .severity-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      font-weight: 600;
      white-space: nowrap;
    }

    .severity-critical {
      background: #fee2e2;
      color: #dc2626;
    }

    .severity-high {
      background: #fef3c7;
      color: #d97706;
    }

    .severity-medium {
      background: #fef3c7;
      color: #f59e0b;
    }

    .severity-low {
      background: #dbeafe;
      color: #2563eb;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85em;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-open {
      background: #fee2e2;
      color: #dc2626;
    }

    .status-investigating {
      background: #fef3c7;
      color: #f59e0b;
    }

    .status-resolved {
      background: #d1fae5;
      color: #059669;
    }

    .details-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      width: 100%;
    }

    .details-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      width: 100%;
    }

    .card-header {
      font-size: 1.1em;
      font-weight: 600;
      color: #111827;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f3f4f6;
      flex-wrap: wrap;
      gap: 8px;
    }

    .detail-row:last-child {
      border-bottom: none;
    }

    .detail-label {
      font-size: 0.9em;
      color: #6b7280;
      flex: 1;
      min-width: 120px;
    }

    .detail-value {
      font-size: 0.9em;
      color: #111827;
      font-weight: 500;
      text-align: right;
      flex: 2;
      word-break: break-word;
    }

    .policy-info {
      background: #f9fafb;
      padding: 14px;
      border-radius: 8px;
      margin-top: 12px;
      width: 100%;
    }

    .policy-info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .policy-info-item:last-child {
      margin-bottom: 0;
    }

    @media (max-width: 1200px) {
      .main-content {
        margin-left: 70px;
        max-width: calc(100vw - 70px);
      }

      .main-content.expanded {
        margin-left: 70px;
        max-width: calc(100vw - 70px);
      }

      .top-header {
        left: 70px;
      }
    }

    @media (max-width: 968px) {
      .main-content {
        margin-left: 0;
        max-width: 100vw;
      }

      .details-grid {
        grid-template-columns: 1fr;
      }

      .alert-header-top {
        flex-direction: column;
        align-items: stretch;
      }

      .alert-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .btn {
        flex: 1;
        min-width: 140px;
        justify-content: center;
      }

      .content-area {
        padding: 16px;
        padding-top: 80px;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.mobile-open {
        transform: translateX(0);
      }

      .top-header {
        left: 0;
      }
    }

    @media (max-width: 768px) {
      .notifications-panel {
        width: 90%;
        right: -90%;
      }
    }

    @media (max-width: 640px) {
      .content-area {
        padding: 12px;
        padding-top: 70px;
      }

      .alert-meta {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .alert-title-section {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }

      .alert-title h1 {
        font-size: 1.2em;
      }

      .details-card {
        padding: 16px;
      }

      .detail-row {
        flex-direction: column;
        gap: 4px;
      }

      .detail-value {
        text-align: left;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .user-info {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="dashboard-container">
    <!-- ==================== SIDEBAR ==================== -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <i class="fas fa-shield-halved"></i>
        </div>
        <div class="sidebar-title">DLP Shield</div>
      </div>

      <nav class="nav-menu">
        <div class="nav-item">
          <a href="dashboard" class="nav-link" data-page="dashboard">
            <i class="fas fa-th-large"></i>
            <span>Dashboard</span>
          </a>
        </div>

        <div class="nav-item">
          <a href="alerts" class="nav-link active" data-page="alerts">
            <i class="fas fa-triangle-exclamation"></i>
            <span>Alerts &amp; Incidents</span>
          </a>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-shield-alt"></i>
            <span>Policies</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="manage-agents" class="sub-menu-item" data-page="manage-agents">Manage Agents</a>
            <!-- <a
                href="file-policies.html"
                class="sub-menu-item"
                data-page="file-policies"
                >File Policies</a
              > -->
            <a href="assign-policy" class="sub-menu-item" data-page="assign-policy">Assign Policy</a>
          </div>
        </div>

        <!-- <div class="nav-item">
            <a href="agents.html" class="nav-link" data-page="agents">
              <i class="fas fa-desktop"></i>
              <span>Agents / Endpoints</span>
            </a>
          </div> -->

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-eye"></i>
            <span>OCR &amp; Image Analysis</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="ocr-dashboard" class="sub-menu-item" data-page="ocr-dashboard">OCR Dashboard</a>
            <!--              <a-->
            <!--                href="ocr-policies"-->
            <!--                class="sub-menu-item"-->
            <!--                data-page="ocr-policies"-->
            <!--                >OCR Policies</a-->
            <!--              >-->
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-file-lines"></i>
            <span>Reports &amp; Logs</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="reports" class="sub-menu-item" data-page="reports">Reports</a>
            <a href="generate-report" class="sub-menu-item" data-page="generate-report">Generate Report</a>
            <a href="audit-logs" class="sub-menu-item" data-page="audit-logs">Audit Logs</a>
            <a href="device-logs" class="sub-menu-item" data-page="device-logs">Device Logs</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-users"></i>
            <span>Users &amp; Roles</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="users" class="sub-menu-item" data-page="users">Users</a>
            <a href="roles" class="sub-menu-item" data-page="roles">Roles &amp; Permissions</a>
            <a href="permissions" class="sub-menu-item" data-page="permissions">Permissions</a>
          </div>
        </div>

        <div class="nav-item">
          <div class="nav-link nav-dropdown" onclick="toggleSubMenu(this)">
            <i class="fas fa-gear"></i>
            <span>Settings</span>
            <i class="fas fa-chevron-down chevron-icon"></i>
          </div>
          <div class="sub-menu">
            <a href="general" class="sub-menu-item" data-page="general">General</a>
            <a href="security" class="sub-menu-item" data-page="security">Security</a>
            <a href="integrations" class="sub-menu-item" data-page="integrations">Integrations</a>
            <a href="data-retention" class="sub-menu-item" data-page="data-retention">Data Retention</a>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <button class="collapse-btn" onclick="toggleSidebar()">
          <i class="fas fa-chevron-left"></i>
          <span>Collapse</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Overlay (for sidebar) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <main class="main-content" id="mainContent">
      <!-- ==================== HEADER ==================== -->
      <header class="top-header" id="topHeader">
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" class="search-input" placeholder="Search alerts, agents, policies..." />
        </div>

        <div class="header-actions">
          <button class="notification-btn" onclick="toggleNotifications(event)">
            <i class="fas fa-bell"></i>
            <span class="notification-badge" id="alertBadge">5</span>
          </button>

          <div class="user-profile" onclick="toggleUserDropdown(event)">
            <div class="user-avatar">[[${userInitials}]]</div>
            <div class="user-info">
              <div class="user-name">[[${userName}]]</div>
              <div class="user-role">[[${userRole}]]</div>
              <div id="userEmail">[[${userEmail}]]</div>
            </div>
            <i class="fas fa-chevron-down dropdown-icon"></i>

            <div class="user-dropdown" id="userDropdown">
              <a href="general" class="dropdown-item">
                <i class="fas fa-gear"></i>
                <span>Settings</span>
              </a>
              <a href="#" class="dropdown-item">
                <i class="fas fa-circle-question"></i>
                <span>Help &amp; Support</span>
              </a>
              <div class="dropdown-divider"></div>
              <a href="index" class="dropdown-item danger" onclick="logout(event)">
                <i class="fas fa-right-from-bracket"></i>
                <span>Sign out</span>
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- ==================== NOTIFICATIONS PANEL ==================== -->
      <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
          <h3>Notifications</h3>
          <button class="close-notifications" onclick="closeNotifications()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="notifications-tabs">
          <button class="tab-btn active" onclick="switchTab(event, 'all')">
            All (5)
          </button>
          <button class="tab-btn" onclick="switchTab(event, 'unread')">
            Unread (3)
          </button>
        </div>

        <div class="notifications-content" id="notificationsContent">
          <div class="notification-item unread">
            <div class="notification-icon critical">
              <i class="fas fa-shield-exclamation"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Critical Policy Violation</div>
              <div class="notification-text">
                User attempted to copy sensitive files to USB drive
              </div>
              <div class="notification-time">2 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item unread">
            <div class="notification-icon warning">
              <i class="fas fa-triangle-exclamation"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Agent Offline</div>
              <div class="notification-text">
                DESKTOP-DEF456 has been offline for 2 hours
              </div>
              <div class="notification-time">15 minutes ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item unread">
            <div class="notification-icon info">
              <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Policy Updated</div>
              <div class="notification-text">
                File Protection Policy has been modified by Admin
              </div>
              <div class="notification-time">1 hour ago</div>
            </div>
            <div class="notification-dot"></div>
          </div>

          <div class="notification-item">
            <div class="notification-icon success">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Agent Connected</div>
              <div class="notification-text">
                New agent LAPTOP-XYZ789 successfully registered
              </div>
              <div class="notification-time">3 hours ago</div>
            </div>
          </div>

          <div class="notification-item">
            <div class="notification-icon info">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="notification-body">
              <div class="notification-title">Report Generated</div>
              <div class="notification-text">
                Weekly security report is ready for review
              </div>
              <div class="notification-time">5 hours ago</div>
            </div>
          </div>
        </div>

        <div class="notifications-footer">
          <a href="alerts" class="view-all-btn">View All Notifications</a>
        </div>
      </div>

      <!-- Notification Overlay -->
      <div class="notification-overlay" id="notificationOverlay" onclick="closeNotifications()"></div>

      <div class="content-area">
        <a href="alerts" class="back-button">
          <i class="fas fa-arrow-left"></i>
          <span>Back to Alerts</span>
        </a>

        <div class="alert-header">
          <div class="alert-header-top">
            <div class="alert-title-section">
              <div class="alert-icon network">
                <i class="fas fa-wifi"></i>
              </div>
              <div class="alert-title">
                <h1 th:text="${alert?.subject ?: 'Blocked network connection attempt'}">Blocked network connection
                  attempt</h1>
                <div class="alert-id" th:text="${'Alert ID: ' + (alert?.id ?: 'ALT-003')}">Alert ID: ALT-003</div>
              </div>
            </div>

            <div class="alert-actions">
              <button class="btn btn-primary" onclick="investigateAlert()">
                <i class="fas fa-magnifying-glass"></i>
                <span>Investigate</span>
              </button>
              <button class="btn btn-secondary" onclick="resolveAlert()">
                <i class="fas fa-check"></i>
                <span>Mark Resolved</span>
              </button>
            </div>
          </div>

          <div class="alert-meta">
            <div class="meta-item">
              <div class="meta-label">Severity</div>
              <div class="meta-value">
                <span th:if="${alert != null}"
                  th:class="${'severity-badge ' + (alert.mlScore > 0.8 ? 'severity-critical' : (alert.mlScore > 0.6 ? 'severity-high' : (alert.mlScore > 0.4 ? 'severity-medium' : 'severity-low')))}"
                  th:text="${alert.mlScore > 0.8 ? 'Critical' : (alert.mlScore > 0.6 ? 'High' : (alert.mlScore > 0.4 ? 'Medium' : 'Low'))}">Medium</span>
                <span th:if="${alert == null}" class="severity-badge severity-medium">Medium</span>
              </div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Status</div>
              <div class="meta-value">
                <span th:if="${alert != null}"
                  th:class="${'status-badge ' + (alert.mlPrediction == 'Phishing' ? 'status-open' : 'status-resolved')}"
                  th:text="${alert.mlPrediction == 'Phishing' ? 'Open' : 'Resolved'}">Investigating</span>
                <span th:if="${alert == null}" class="status-badge status-investigating">Investigating</span>
              </div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Source</div>
              <div class="meta-value" th:text="${alert?.source ?: 'Network Access Control'}">Network Access Control
              </div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Timestamp</div>
              <div class="meta-value"
                th:text="${alert != null ? #temporals.format(alert.timestamp, 'yyyy-MM-dd HH:mm:ss') : '2024-01-15 08:45:12'}">
                2024-01-15 08:45:12</div>
            </div>
          </div>
        </div>

        <div class="details-grid">
          <div class="details-card">
            <div class="card-header">Alert Details</div>

            <div class="detail-row">
              <div class="detail-label">Body Preview</div>
              <div class="detail-value"
                th:text="${alert?.bodyPreview ?: 'Blocked network connection attempt to unauthorized domain'}">
                Blocked network connection attempt to unauthorized domain
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-label">Sender</div>
              <div class="detail-value" th:text="${alert?.sender ?: 'WORKSTATION-001'}">WORKSTATION-001</div>
            </div>

            <div class="detail-row">
              <div class="detail-label">Receiver</div>
              <div class="detail-value" th:text="${alert?.receiver ?: 'bob.wilson@company.com'}">bob.wilson@company.com
              </div>
            </div>

            <div class="detail-row">
              <div class="detail-label">ML Score</div>
              <div class="detail-value" th:text="${alert != null ? alert.mlScore : '0.45'}">0.45</div>
            </div>

            <div class="detail-row">
              <div class="detail-label">ML Confidence</div>
              <div class="detail-value" th:text="${alert != null ? alert.mlConfidence : '0.88'}">0.88</div>
            </div>

            <div class="detail-row">
              <div class="detail-label">ML Prediction</div>
              <div class="detail-value" th:text="${alert?.mlPrediction ?: 'Phishing'}">Phishing</div>
            </div>

            <div class="policy-info">
              <div class="policy-info-item">
                <span style="color: #6b7280; font-size: 0.9em">Target Domain:</span>
                <span style="color: #111827; font-weight: 600; font-size: 0.9em">suspicious-site.example.com</span>
              </div>
              <div class="policy-info-item">
                <span style="color: #6b7280; font-size: 0.9em">IP Address:</span>
                <span style="color: #111827; font-weight: 600; font-size: 0.9em">192.168.1.101</span>
              </div>
              <div class="policy-info-item">
                <span style="color: #6b7280; font-size: 0.9em">Port:</span>
                <span style="color: #111827; font-weight: 600; font-size: 0.9em">443 (HTTPS)</span>
              </div>
            </div>
          </div>

          <div>
            <div class="details-card" style="margin-bottom: 20px">
              <div class="card-header">Agent Information</div>

              <div class="detail-row">
                <div class="detail-label">Operating System</div>
                <div class="detail-value">Windows 11 Pro</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">IP Address</div>
                <div class="detail-value">192.168.1.101</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">MAC Address</div>
                <div class="detail-value">00:1B:44:11:3A:B7</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">Installed Date</div>
                <div class="detail-value">2024-01-01</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">Agent Version</div>
                <div class="detail-value">v2.4.1</div>
              </div>
            </div>

            <div class="details-card">
              <div class="card-header">User Information</div>

              <div class="detail-row">
                <div class="detail-label">Name</div>
                <div class="detail-value">Bob Wilson</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">Email</div>
                <div class="detail-value">bob.wilson@company.com</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">Department</div>
                <div class="detail-value">IT Operations</div>
              </div>

              <div class="detail-row">
                <div class="detail-label">Role</div>
                <div class="detail-value">System Administrator</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script th:inline="javascript">
    /* ==================== AUTHENTICATION & USER DATA ==================== */
    const userData = {
      username: [[${ username }]],
      userName: [[${ userName }]],
      userInitials: [[${ userInitials }]],
      userRole: [[${ userRole }]],
      userEmail: [[${ userEmail }]],
      userId: [[${ userId }]]
    };

    function loadAdminInfo() {
      const userName = document.querySelector(".user-name");
      const userAvatar = document.querySelector(".user-avatar");
      const userRole = document.querySelector(".user-role");
      const userEmail = document.getElementById("userEmail");

      if (userName && userData.userName) {
        userName.textContent = userData.userName;
      }

      if (userAvatar && userData.userInitials) {
        userAvatar.textContent = userData.userInitials;
      }

      if (userRole && userData.userRole) {
        userRole.textContent = userData.userRole;
      }

      if (userEmail && userData.userEmail) {
        userEmail.textContent = userData.userEmail;
      }
    }

    /* ==================== SIDEBAR FUNCTIONS ==================== */
    function toggleSubMenu(element) {
      var sidebar = document.getElementById("sidebar");
      if (sidebar.classList.contains("collapsed")) return;

      var subMenu = element.nextElementSibling;
      var allSubMenus = document.querySelectorAll(".sub-menu");
      var allDropdowns = document.querySelectorAll(".nav-dropdown");

      allSubMenus.forEach(function (menu) {
        if (menu !== subMenu) menu.classList.remove("open");
      });
      allDropdowns.forEach(function (link) {
        if (link !== element) link.classList.remove("expanded");
      });

      element.classList.toggle("expanded");
      subMenu.classList.toggle("open");
    }

    function toggleSidebar() {
      var sidebar = document.getElementById("sidebar");
      var mainContent = document.getElementById("mainContent");
      var header = document.getElementById("topHeader");

      sidebar.classList.toggle("collapsed");
      var isCollapsed = sidebar.classList.contains("collapsed");

      if (mainContent) mainContent.classList.toggle("expanded");

      if (header) {
        header.style.left = isCollapsed ? "70px" : "240px";
      }

      if (isCollapsed) {
        document.querySelectorAll(".sub-menu").forEach(function (m) {
          m.classList.remove("open");
        });
        document.querySelectorAll(".nav-dropdown").forEach(function (l) {
          l.classList.remove("expanded");
        });
      }

      window.dispatchEvent(
        new CustomEvent("sidebarToggle", {
          detail: { collapsed: isCollapsed },
        })
      );
    }

    function openMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.add("mobile-open");
      if (overlay) overlay.classList.add("active");
    }

    function closeMobileSidebar() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (sidebar) sidebar.classList.remove("mobile-open");
      if (overlay) overlay.classList.remove("active");
    }

    function toggleMobileMenu() {
      var sidebar = document.getElementById("sidebar");
      var overlay = document.getElementById("sidebarOverlay");
      if (!sidebar) return;

      if (sidebar.classList.contains("mobile-open")) {
        closeMobileSidebar();
      } else {
        openMobileSidebar();
      }
    }

    function setActiveMenuItem() {
      var currentPage = window.location.pathname.split("/").pop() || "alert-details";

      document.querySelectorAll('.nav-link[data-page]').forEach(function (link) {
        var href = link.getAttribute('href');
        if (href === currentPage) {
          link.classList.add('active');
        }
      });

      document.querySelectorAll('.sub-menu-item[data-page]').forEach(function (item) {
        var href = item.getAttribute('href');
        if (href === currentPage) {
          item.classList.add('active');
          var parentSubMenu = item.closest('.sub-menu');
          if (parentSubMenu) {
            parentSubMenu.classList.add('open');
            var parentNav = parentSubMenu.previousElementSibling;
            if (parentNav) parentNav.classList.add('expanded');
          }
        }
      });
    }

    /* ==================== HEADER FUNCTIONS ==================== */
    function toggleNotifications(event) {
      event.stopPropagation();
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = event.currentTarget;
      if (!panel || !overlay) return;

      if (panel.classList.contains("show")) {
        closeNotifications();
      } else {
        closeUserDropdown();
        panel.classList.add("show");
        overlay.classList.add("show");
        btn.classList.add("active");
        document.body.style.overflow = "hidden";
      }
    }

    function closeNotifications() {
      var panel = document.getElementById("notificationsPanel");
      var overlay = document.getElementById("notificationOverlay");
      var btn = document.querySelector(".notification-btn");
      if (panel) panel.classList.remove("show");
      if (overlay) overlay.classList.remove("show");
      if (btn) btn.classList.remove("active");
      document.body.style.overflow = "";
    }

    function switchTab(event, tabName) {
      document.querySelectorAll(".tab-btn").forEach(function (t) {
        t.classList.remove("active");
      });
      event.currentTarget.classList.add("active");

      document.querySelectorAll(".notification-item").forEach(function (item) {
        item.style.display =
          tabName === "unread" && !item.classList.contains("unread")
            ? "none"
            : "flex";
      });
    }

    function toggleUserDropdown(event) {
      event.stopPropagation();
      var dropdown = document.getElementById("userDropdown");
      var userProfile = event.currentTarget;
      if (!dropdown) return;

      if (dropdown.classList.contains("show")) {
        closeUserDropdown();
      } else {
        closeNotifications();
        dropdown.classList.add("show");
        userProfile.classList.add("active");
      }
    }

    function closeUserDropdown() {
      var dropdown = document.getElementById("userDropdown");
      var userProfile = document.querySelector(".user-profile");
      if (dropdown) dropdown.classList.remove("show");
      if (userProfile) userProfile.classList.remove("active");
    }

    function logout(event) {
      event.preventDefault();
      window.location.href = "/logout";
    }

    document.addEventListener("click", function (event) {
      if (!event.target.closest(".user-profile")) {
        closeUserDropdown();
      }
      if (
        !event.target.closest(".notification-btn") &&
        !event.target.closest(".notifications-panel")
      ) {
        closeNotifications();
      }
    });

    /* ==================== ALERT DETAILS FUNCTIONS ==================== */

    // Get alert ID from URL
    function getAlertIdFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get("id");
    }

    // API call function
    async function callApi(path, options = {}) {
      const defaultOptions = {
        method: "GET",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
      };
      const opts = { ...defaultOptions, ...options };

      try {
        const response = await fetch(path, opts);
        const text = await response.text();

        let json;
        try {
          json = text ? JSON.parse(text) : null;
        } catch (e) {
          throw new Error("Invalid JSON response from server.");
        }

        if (!response.ok) {
          const message =
            json && json.message
              ? json.message
              : `HTTP ${response.status}: ${response.statusText}`;
          throw new Error(message);
        }

        return json;
      } catch (error) {
        console.error(`API call to ${path} failed:`, error);
        return {
          success: false,
          error: error.message || "API call failed",
        };
      }
    }

    // Load alert details from API
    async function loadAlertDetails() {
      const alertId = getAlertIdFromUrl();
      if (!alertId) {
        showError("No alert ID provided");
        return;
      }

      try {
        console.log("Loading alert details for ID:", alertId);
        showLoadingState();

        const result = await callApi(`/api/admin/alerts/${alertId}`);

        if (result && result.success && result.data) {
          updateAlertDetails(result.data);
          updateNotificationBadge();
        } else {
          showError("Failed to load alert details");
        }
      } catch (error) {
        console.error("Error loading alert details:", error);
        showError("Error loading alert: " + error.message);
      }
    }

    function showLoadingState() {
      // Show loading state in the UI
      const titleEl = document.querySelector(".alert-title h1");
      if (titleEl) titleEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';

      // You could also show a loading spinner overlay if needed
    }

    function showError(message) {
      const titleEl = document.querySelector(".alert-title h1");
      if (titleEl) {
        titleEl.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #dc2626;"></i> Error Loading Alert';
      }

      const alertIdEl = document.querySelector(".alert-id");
      if (alertIdEl) {
        alertIdEl.innerHTML = `<span style="color: #dc2626;">${message}</span>`;
      }

      // Hide action buttons maybe
      const alertActions = document.querySelector(".alert-actions");
      if (alertActions) {
        alertActions.style.display = "none";
      }

      // Show error toast
      showToast(message, "error");
    }

    // Update UI with alert details
    function updateAlertDetails(alert) {
      if (!alert) return;

      console.log("Updating UI with alert:", alert);

      // Update title and alert ID
      const titleEl = document.querySelector(".alert-title h1");
      if (titleEl) {
        titleEl.textContent = alert.description || alert.alertType || "Alert Details";
      }

      const alertIdEl = document.querySelector(".alert-id");
      if (alertIdEl) {
        alertIdEl.textContent = `Alert ID: ${alert.alertCode || alert.id || "N/A"}`;
      }

      // Update alert icon based on type
      updateAlertIcon(alert.alertType || "");

      // Update severity
      updateSeverity(alert.severity || "MEDIUM");

      // Update status
      updateStatus(alert.status || "OPEN");

      // Update policy name
      const policyEl = document.querySelector(".meta-item:nth-child(3) .meta-value");
      if (policyEl) {
        policyEl.textContent = getPolicyName(alert.alertType || "Unknown");
      }

      // Update timestamp
      const timestampEl = document.querySelector(".meta-item:nth-child(4) .meta-value");
      if (timestampEl) {
        timestampEl.textContent = formatTimestamp(alert.createdAt || alert.timestamp);
      }

      // Update alert details section
      updateDetailRows(alert);

      // Update agent information
      updateAgentInfo(alert);

      // Update user information
      updateUserInfo(alert);

      // Update policy info section
      updatePolicyInfo(alert);
    }

    function updateAlertIcon(alertType) {
      const iconContainer = document.querySelector(".alert-icon");
      if (!iconContainer) return;

      const type = (alertType || "").toLowerCase();
      let iconClass = "fas fa-bell";
      let bgClass = "network";

      if (type.includes("usb")) {
        iconClass = "fas fa-usb";
        bgClass = "usb";
      } else if (type.includes("file")) {
        iconClass = "fas fa-file";
        bgClass = "file";
      } else if (type.includes("network") || type.includes("dns")) {
        iconClass = "fas fa-wifi";
        bgClass = "network";
      } else if (type.includes("ocr") || type.includes("screen") || type.includes("high_threat")) {
        iconClass = "fas fa-eye";
        bgClass = "ocr";
      }

      // Remove existing classes and add new ones
      iconContainer.className = `alert-icon ${bgClass}`;
      iconContainer.innerHTML = `<i class="${iconClass}"></i>`;
    }

    function updateSeverity(severity) {
      const severityEl = document.querySelector(".meta-item:first-child .meta-value .severity-badge");
      if (!severityEl) return;

      const sev = (severity || "MEDIUM").toLowerCase();
      let sevClass = "severity-medium";
      let sevText = severity.charAt(0).toUpperCase() + severity.slice(1).toLowerCase();

      if (sev.includes("critical")) {
        sevClass = "severity-critical";
      } else if (sev.includes("high")) {
        sevClass = "severity-high";
      } else if (sev.includes("low")) {
        sevClass = "severity-low";
      }

      severityEl.className = `severity-badge ${sevClass}`;
      severityEl.textContent = sevText;
    }

    function updateStatus(status) {
      const statusEl = document.querySelector(".meta-item:nth-child(2) .meta-value .status-badge");
      if (!statusEl) return;

      const stat = (status || "OPEN").toLowerCase();
      let statusClass = "status-open";
      let statusText = status.charAt(0).toUpperCase() + status.slice(1).toLowerCase();

      if (stat.includes("resolved")) {
        statusClass = "status-resolved";
      } else if (stat.includes("investigating") || stat.includes("pending")) {
        statusClass = "status-investigating";
      }

      statusEl.className = `status-badge ${statusClass}`;
      statusEl.textContent = statusText;
    }

    function getPolicyName(alertType) {
      const type = alertType.toLowerCase();
      if (type.includes("usb")) return "USB Device Control";
      if (type.includes("file")) return "File Protection Policy";
      if (type.includes("network")) return "Network Access Control";
      if (type.includes("ocr") || type.includes("high_threat")) return "OCR Threat Detection";
      return "Security Policy";
    }

    function updateDetailRows(alert) {
      // Map of detail labels to their values
      const details = {
        "Description": alert.description || "No description available",
        "Agent": alert.agentName || alert.hostname || "Unknown",
        "User": alert.username || "Unknown",
        "Timestamp": formatTimestamp(alert.createdAt || alert.timestamp),
        "Event Type": alert.alertType || "Unknown",
        "Action Taken": alert.actionTaken || "Blocked"
      };

      const detailRows = document.querySelectorAll(".detail-row");
      detailRows.forEach((row) => {
        const label = row.querySelector(".detail-label")?.textContent;
        if (label && details[label]) {
          const valueEl = row.querySelector(".detail-value");
          if (valueEl) {
            valueEl.textContent = details[label];
          }
        }
      });
    }

    function updateAgentInfo(alert) {
      // This would need to fetch agent details or use data from the alert
      // For now, use what's available in the alert
      const agentDetails = {
        "Operating System": alert.os || "Windows 11 Pro",
        "IP Address": alert.ipAddress || alert.agentIp || "192.168.1.101",
        "MAC Address": alert.macAddress || "00:1B:44:11:3A:B7",
        "Installed Date": alert.installedDate || "2024-01-01",
        "Agent Version": alert.agentVersion || "v2.4.1"
      };

      // Update agent info rows if they exist
      const detailRows = document.querySelectorAll(".details-card .detail-row");
      if (detailRows.length > 0) {
        // Assuming the second details card contains agent info
        // This is a bit fragile - might need to be more specific
      }
    }

    function updateUserInfo(alert) {
      // Update user information if elements exist
      const userDetailRows = document.querySelectorAll(".details-card:last-child .detail-row");
      if (userDetailRows.length >= 4) {
        const userData = {
          "Name": alert.userFullName || alert.username || "Unknown User",
          "Email": alert.userEmail || (alert.username ? alert.username + "@company.com" : "Unknown"),
          "Department": alert.department || "IT Operations",
          "Role": alert.userRole || "System Administrator"
        };

        userDetailRows.forEach((row, index) => {
          const valueEl = row.querySelector(".detail-value");
          if (valueEl && index < 4) {
            const keys = Object.keys(userData);
            valueEl.textContent = userData[keys[index]];
          }
        });
      }
    }

    function updatePolicyInfo(alert) {
      const policyInfo = document.querySelector(".policy-info");
      if (!policyInfo) return;

      // Get policy details based on alert type
      let policyDetails = {};

      if (alert.details && typeof alert.details === 'object') {
        policyDetails = alert.details;
      } else {
        const type = (alert.alertType || "").toLowerCase();
        if (type.includes("usb")) {
          policyDetails = {
            "Device Name": alert.deviceInfo || "Unknown USB Device",
            "Vendor ID": alert.vendorId || "0x1234",
            "Product ID": alert.productId || "0x5678",
            "Action": alert.actionTaken || "Blocked"
          };
        } else if (type.includes("file")) {
          policyDetails = {
            "File Path": alert.fileDetails || "C:\\Users\\Documents\\file.pdf",
            "Operation": "COPY",
            "Policy": "Confidential Files Protection"
          };
        } else if (type.includes("network")) {
          policyDetails = {
            "Target Domain": "suspicious-site.example.com",
            "IP Address": "192.168.1.101",
            "Port": "443 (HTTPS)"
          };
        } else if (type.includes("ocr") || type.includes("high_threat")) {
          policyDetails = {
            "Threat Score": alert.threatScore || "85",
            "Detected Content": alert.detectedContent || "Confidential information",
            "Confidence": "High"
          };
        }
      }

      // Update policy info HTML
      let html = "";
      Object.entries(policyDetails).forEach(([key, value]) => {
        html += `
                    <div class="policy-info-item">
                        <span style="color: #6b7280; font-size: 0.9em;">${key}:</span>
                        <span style="color: #111827; font-weight: 600; font-size: 0.9em;">${value}</span>
                    </div>
                `;
      });

      policyInfo.innerHTML = html;
    }

    function formatTimestamp(timestamp) {
      if (!timestamp) return "N/A";

      try {
        let date;

        // Handle array format: [year, month, day, hour, minute, second]
        if (Array.isArray(timestamp) && timestamp.length >= 6) {
          const [year, month, day, hour, minute, second] = timestamp;
          date = new Date(year, month - 1, day, hour, minute, second);
        } else {
          date = new Date(timestamp);
        }

        if (isNaN(date.getTime())) {
          return String(timestamp);
        }

        return date.toLocaleString('en-US', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        });
      } catch (e) {
        return String(timestamp);
      }
    }

    async function updateNotificationBadge() {
      try {
        const result = await callApi("/api/admin/alerts/all");
        if (result && result.success && Array.isArray(result.data)) {
          const pendingCount = result.data.filter(a =>
            a.status && a.status.toUpperCase() === "PENDING"
          ).length;

          const badge = document.getElementById("alertBadge");
          if (badge) {
            badge.textContent = pendingCount;
          }

          // Update notification counts
          const totalEl = document.getElementById('totalNotifications');
          const unreadEl = document.getElementById('unreadNotifications');
          if (totalEl) totalEl.textContent = result.data.length;
          if (unreadEl) unreadEl.textContent = pendingCount;
        }
      } catch (error) {
        console.error("Error updating notification badge:", error);
      }
    }

    async function investigateAlert() {
      const alertId = getAlertIdFromUrl();
      if (!alertId) {
        alert("Cannot investigate: Alert ID not found");
        return;
      }

      if (confirm("Start investigation for this alert?")) {
        await changeAlertStatus(alertId, "INVESTIGATING");
      }
    }

    async function resolveAlert() {
      const alertId = getAlertIdFromUrl();
      if (!alertId) {
        alert("Cannot resolve: Alert ID not found");
        return;
      }

      if (confirm("Mark this alert as resolved?")) {
        await changeAlertStatus(alertId, "RESOLVED");
      }
    }

    async function changeAlertStatus(alertId, status) {
      try {
        showToast(`Updating alert status to ${status}...`, "info");

        const result = await callApi(`/api/admin/alerts/${alertId}/decision?decision=${status}`, {
          method: 'POST'
        });

        if (result && result.success) {
          showToast(`Alert status updated to ${status}`, "success");

          // Reload alert details to show updated status
          setTimeout(() => {
            loadAlertDetails();
          }, 500);
        } else {
          throw new Error(result?.message || "Failed to update status");
        }
      } catch (error) {
        console.error("Error updating alert status:", error);
        showToast("Failed to update alert status", "error");
      }
    }

    function showToast(message, type = "info") {
      const existingToast = document.querySelector(".toast-notification");
      if (existingToast) existingToast.remove();

      const toast = document.createElement("div");
      toast.className = `toast-notification toast-${type}`;

      let icon = "fa-info-circle";
      if (type === "success") icon = "fa-check-circle";
      if (type === "error") icon = "fa-exclamation-circle";

      toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `;

      toast.style.position = "fixed";
      toast.style.top = "20px";
      toast.style.right = "20px";
      toast.style.zIndex = "9999";
      toast.style.padding = "12px 20px";
      toast.style.borderRadius = "8px";
      toast.style.boxShadow = "0 4px 12px rgba(0,0,0,0.15)";
      toast.style.fontSize = "0.9em";
      toast.style.minWidth = "250px";

      if (type === "success") {
        toast.style.background = "#d1fae5";
        toast.style.color = "#059669";
        toast.style.border = "1px solid #a7f3d0";
      } else if (type === "error") {
        toast.style.background = "#fee2e2";
        toast.style.color = "#dc2626";
        toast.style.border = "1px solid #fecaca";
      } else {
        toast.style.background = "#dbeafe";
        toast.style.color = "#3b82f6";
        toast.style.border = "1px solid #bfdbfe";
      }

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = "0";
        toast.style.transition = "opacity 0.3s ease";
        setTimeout(() => {
          if (toast.parentNode) toast.parentNode.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Handle window resize
    window.addEventListener("resize", function () {
      const sidebar = document.getElementById("sidebar");
      const mainContent = document.getElementById("mainContent");
      const header = document.getElementById("topHeader");
      const windowWidth = window.innerWidth;

      if (windowWidth <= 968) {
        if (mainContent) {
          mainContent.style.marginLeft = "0";
          mainContent.classList.remove("expanded");
        }
        if (header) {
          header.style.left = "0";
        }
      } else {
        if (sidebar && mainContent && header) {
          if (sidebar.classList.contains("collapsed")) {
            mainContent.classList.add("expanded");
            header.style.left = "70px";
          } else {
            mainContent.classList.remove("expanded");
            header.style.left = "240px";
          }
        }
      }
    });

    // Handle sidebar toggle events
    window.addEventListener("sidebarToggle", function (event) {
      const mainContent = document.getElementById("mainContent");
      const header = document.getElementById("topHeader");
      if (mainContent && header) {
        if (event.detail.collapsed) {
          mainContent.classList.add("expanded");
          header.style.left = "70px";
        } else {
          mainContent.classList.remove("expanded");
          header.style.left = "240px";
        }
      }
    });

    // Initialize on DOM ready
    document.addEventListener("DOMContentLoaded", async function () {
      // Load admin info into header
      loadAdminInfo();

      // Set active menu item
      setActiveMenuItem();

      // Check if there's an alert ID in the URL
      const alertId = getAlertIdFromUrl();

      if (alertId) {
        // Load alert details
        await loadAlertDetails();
      } else {
        // No alert ID provided
        showError("No alert ID specified in URL");

        // Update the back button to go to alerts page
        const backBtn = document.querySelector('.back-button');
        if (backBtn) {
          backBtn.href = 'alerts';
        }
      }

      // Update notification badge
      updateNotificationBadge();
    });
  </script>
</body>

</html>